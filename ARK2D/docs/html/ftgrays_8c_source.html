<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ARK2D: src/ARK2D/vendor/android/freetype/jni/src/smooth/ftgrays.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ARK2D
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ftgrays_8c.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">src/ARK2D/vendor/android/freetype/jni/src/smooth/ftgrays.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ftgrays_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************/</span>
<a name="l00002"></a>00002 <span class="comment">/*                                                                         */</span>
<a name="l00003"></a>00003 <span class="comment">/*  ftgrays.c                                                              */</span>
<a name="l00004"></a>00004 <span class="comment">/*                                                                         */</span>
<a name="l00005"></a>00005 <span class="comment">/*    A new `perfect&#39; anti-aliasing renderer (body).                       */</span>
<a name="l00006"></a>00006 <span class="comment">/*                                                                         */</span>
<a name="l00007"></a>00007 <span class="comment">/*  Copyright 2000-2001, 2002, 2003, 2005, 2006, 2007, 2008, 2009, 2010 by */</span>
<a name="l00008"></a>00008 <span class="comment">/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<a name="l00009"></a>00009 <span class="comment">/*                                                                         */</span>
<a name="l00010"></a>00010 <span class="comment">/*  This file is part of the FreeType project, and may only be used,       */</span>
<a name="l00011"></a>00011 <span class="comment">/*  modified, and distributed under the terms of the FreeType project      */</span>
<a name="l00012"></a>00012 <span class="comment">/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<a name="l00013"></a>00013 <span class="comment">/*  this file you indicate that you have read the license and              */</span>
<a name="l00014"></a>00014 <span class="comment">/*  understand and accept it fully.                                        */</span>
<a name="l00015"></a>00015 <span class="comment">/*                                                                         */</span>
<a name="l00016"></a>00016 <span class="comment">/***************************************************************************/</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018   <span class="comment">/*************************************************************************/</span>
<a name="l00019"></a>00019   <span class="comment">/*                                                                       */</span>
<a name="l00020"></a>00020   <span class="comment">/* This file can be compiled without the rest of the FreeType engine, by */</span>
<a name="l00021"></a>00021   <span class="comment">/* defining the _STANDALONE_ macro when compiling it.  You also need to  */</span>
<a name="l00022"></a>00022   <span class="comment">/* put the files `ftgrays.h&#39; and `ftimage.h&#39; into the current            */</span>
<a name="l00023"></a>00023   <span class="comment">/* compilation directory.  Typically, you could do something like        */</span>
<a name="l00024"></a>00024   <span class="comment">/*                                                                       */</span>
<a name="l00025"></a>00025   <span class="comment">/* - copy `src/smooth/ftgrays.c&#39; (this file) to your current directory   */</span>
<a name="l00026"></a>00026   <span class="comment">/*                                                                       */</span>
<a name="l00027"></a>00027   <span class="comment">/* - copy `include/freetype/ftimage.h&#39; and `src/smooth/ftgrays.h&#39; to the */</span>
<a name="l00028"></a>00028   <span class="comment">/*   same directory                                                      */</span>
<a name="l00029"></a>00029   <span class="comment">/*                                                                       */</span>
<a name="l00030"></a>00030   <span class="comment">/* - compile `ftgrays&#39; with the _STANDALONE_ macro defined, as in        */</span>
<a name="l00031"></a>00031   <span class="comment">/*                                                                       */</span>
<a name="l00032"></a>00032   <span class="comment">/*     cc -c -D_STANDALONE_ ftgrays.c                                    */</span>
<a name="l00033"></a>00033   <span class="comment">/*                                                                       */</span>
<a name="l00034"></a>00034   <span class="comment">/* The renderer can be initialized with a call to                        */</span>
<a name="l00035"></a>00035   <span class="comment">/* `ft_gray_raster.raster_new&#39;; an anti-aliased bitmap can be generated  */</span>
<a name="l00036"></a>00036   <span class="comment">/* with a call to `ft_gray_raster.raster_render&#39;.                        */</span>
<a name="l00037"></a>00037   <span class="comment">/*                                                                       */</span>
<a name="l00038"></a>00038   <span class="comment">/* See the comments and documentation in the file `ftimage.h&#39; for more   */</span>
<a name="l00039"></a>00039   <span class="comment">/* details on how the raster works.                                      */</span>
<a name="l00040"></a>00040   <span class="comment">/*                                                                       */</span>
<a name="l00041"></a>00041   <span class="comment">/*************************************************************************/</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   <span class="comment">/*************************************************************************/</span>
<a name="l00044"></a>00044   <span class="comment">/*                                                                       */</span>
<a name="l00045"></a>00045   <span class="comment">/* This is a new anti-aliasing scan-converter for FreeType 2.  The       */</span>
<a name="l00046"></a>00046   <span class="comment">/* algorithm used here is _very_ different from the one in the standard  */</span>
<a name="l00047"></a>00047   <span class="comment">/* `ftraster&#39; module.  Actually, `ftgrays&#39; computes the _exact_          */</span>
<a name="l00048"></a>00048   <span class="comment">/* coverage of the outline on each pixel cell.                           */</span>
<a name="l00049"></a>00049   <span class="comment">/*                                                                       */</span>
<a name="l00050"></a>00050   <span class="comment">/* It is based on ideas that I initially found in Raph Levien&#39;s          */</span>
<a name="l00051"></a>00051   <span class="comment">/* excellent LibArt graphics library (see http://www.levien.com/libart   */</span>
<a name="l00052"></a>00052   <span class="comment">/* for more information, though the web pages do not tell anything       */</span>
<a name="l00053"></a>00053   <span class="comment">/* about the renderer; you&#39;ll have to dive into the source code to       */</span>
<a name="l00054"></a>00054   <span class="comment">/* understand how it works).                                             */</span>
<a name="l00055"></a>00055   <span class="comment">/*                                                                       */</span>
<a name="l00056"></a>00056   <span class="comment">/* Note, however, that this is a _very_ different implementation         */</span>
<a name="l00057"></a>00057   <span class="comment">/* compared to Raph&#39;s.  Coverage information is stored in a very         */</span>
<a name="l00058"></a>00058   <span class="comment">/* different way, and I don&#39;t use sorted vector paths.  Also, it doesn&#39;t */</span>
<a name="l00059"></a>00059   <span class="comment">/* use floating point values.                                            */</span>
<a name="l00060"></a>00060   <span class="comment">/*                                                                       */</span>
<a name="l00061"></a>00061   <span class="comment">/* This renderer has the following advantages:                           */</span>
<a name="l00062"></a>00062   <span class="comment">/*                                                                       */</span>
<a name="l00063"></a>00063   <span class="comment">/* - It doesn&#39;t need an intermediate bitmap.  Instead, one can supply a  */</span>
<a name="l00064"></a>00064   <span class="comment">/*   callback function that will be called by the renderer to draw gray  */</span>
<a name="l00065"></a>00065   <span class="comment">/*   spans on any target surface.  You can thus do direct composition on */</span>
<a name="l00066"></a>00066   <span class="comment">/*   any kind of bitmap, provided that you give the renderer the right   */</span>
<a name="l00067"></a>00067   <span class="comment">/*   callback.                                                           */</span>
<a name="l00068"></a>00068   <span class="comment">/*                                                                       */</span>
<a name="l00069"></a>00069   <span class="comment">/* - A perfect anti-aliaser, i.e., it computes the _exact_ coverage on   */</span>
<a name="l00070"></a>00070   <span class="comment">/*   each pixel cell.                                                    */</span>
<a name="l00071"></a>00071   <span class="comment">/*                                                                       */</span>
<a name="l00072"></a>00072   <span class="comment">/* - It performs a single pass on the outline (the `standard&#39; FT2        */</span>
<a name="l00073"></a>00073   <span class="comment">/*   renderer makes two passes).                                         */</span>
<a name="l00074"></a>00074   <span class="comment">/*                                                                       */</span>
<a name="l00075"></a>00075   <span class="comment">/* - It can easily be modified to render to _any_ number of gray levels  */</span>
<a name="l00076"></a>00076   <span class="comment">/*   cheaply.                                                            */</span>
<a name="l00077"></a>00077   <span class="comment">/*                                                                       */</span>
<a name="l00078"></a>00078   <span class="comment">/* - For small (&lt; 20) pixel sizes, it is faster than the standard        */</span>
<a name="l00079"></a>00079   <span class="comment">/*   renderer.                                                           */</span>
<a name="l00080"></a>00080   <span class="comment">/*                                                                       */</span>
<a name="l00081"></a>00081   <span class="comment">/*************************************************************************/</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="comment">/*************************************************************************/</span>
<a name="l00085"></a>00085   <span class="comment">/*                                                                       */</span>
<a name="l00086"></a>00086   <span class="comment">/* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<a name="l00087"></a>00087   <span class="comment">/* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<a name="l00088"></a>00088   <span class="comment">/* messages during execution.                                            */</span>
<a name="l00089"></a>00089   <span class="comment">/*                                                                       */</span>
<a name="l00090"></a>00090 <span class="preprocessor">#undef  FT_COMPONENT</span>
<a name="l00091"></a><a class="code" href="ftgrays_8c.html#a9c208ea57bc9a5fcbfc81a6106d28f3a">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define FT_COMPONENT  trace_smooth</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="preprocessor">#ifdef _STANDALONE_</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   <span class="comment">/* define this to dump debugging information */</span>
<a name="l00098"></a>00098 <span class="comment">/* #define FT_DEBUG_LEVEL_TRACE */</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="preprocessor">#ifdef FT_DEBUG_LEVEL_TRACE</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00103"></a>00103 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00104"></a>00104 <span class="preprocessor">#endif</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>
<a name="l00106"></a>00106 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00107"></a>00107 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00108"></a>00108 <span class="preprocessor">#include &lt;setjmp.h&gt;</span>
<a name="l00109"></a>00109 <span class="preprocessor">#include &lt;limits.h&gt;</span>
<a name="l00110"></a>00110 <span class="preprocessor">#define FT_UINT_MAX  UINT_MAX</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="preprocessor">#define FT_INT_MAX   INT_MAX</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>
<a name="l00113"></a>00113 <span class="preprocessor">#define ft_memset   memset</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>
<a name="l00115"></a>00115 <span class="preprocessor">#define ft_setjmp   setjmp</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span><span class="preprocessor">#define ft_longjmp  longjmp</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span><span class="preprocessor">#define ft_jmp_buf  jmp_buf</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a>00119 <span class="keyword">typedef</span> ptrdiff_t  <a class="code" href="fttypes_8h.html#a2469cb02129d36e468be22f7a8bf5b33">FT_PtrDist</a>;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="preprocessor">#define ErrRaster_Invalid_Mode      -2</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span><span class="preprocessor">#define ErrRaster_Invalid_Outline   -1</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span><span class="preprocessor">#define ErrRaster_Invalid_Argument  -3</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span><span class="preprocessor">#define ErrRaster_Memory_Overflow   -4</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>
<a name="l00127"></a>00127 <span class="preprocessor">#define FT_BEGIN_HEADER</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span><span class="preprocessor">#define FT_END_HEADER</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>
<a name="l00130"></a>00130 <span class="preprocessor">#include &quot;<a class="code" href="ftimage_8h.html">ftimage.h</a>&quot;</span>
<a name="l00131"></a>00131 <span class="preprocessor">#include &quot;<a class="code" href="ftgrays_8h.html">ftgrays.h</a>&quot;</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <span class="comment">/* This macro is used to indicate that a function parameter is unused. */</span>
<a name="l00135"></a>00135   <span class="comment">/* Its purpose is simply to reduce compiler warnings.  Note also that  */</span>
<a name="l00136"></a>00136   <span class="comment">/* simply defining it as `(void)x&#39; doesn&#39;t avoid warnings with certain */</span>
<a name="l00137"></a>00137   <span class="comment">/* ANSI compilers (e.g. LCC).                                          */</span>
<a name="l00138"></a>00138 <span class="preprocessor">#define FT_UNUSED( x )  (x) = (x)</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00140"></a>00140 
<a name="l00141"></a>00141   <span class="comment">/* we only use level 5 &amp; 7 tracing messages; cf. ftdebug.h */</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="preprocessor">#ifdef FT_DEBUG_LEVEL_TRACE</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>
<a name="l00145"></a>00145   <span class="keywordtype">void</span>
<a name="l00146"></a>00146   FT_Message( <span class="keyword">const</span> <span class="keywordtype">char</span>*  fmt,
<a name="l00147"></a>00147               ... )
<a name="l00148"></a>00148   {
<a name="l00149"></a>00149     va_list  ap;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     va_start( ap, fmt );
<a name="l00153"></a>00153     vfprintf( stderr, fmt, ap );
<a name="l00154"></a>00154     va_end( ap );
<a name="l00155"></a>00155   }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   <span class="comment">/* we don&#39;t handle tracing levels in stand-alone mode; */</span>
<a name="l00158"></a>00158 <span class="preprocessor">#ifndef FT_TRACE5</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span><span class="preprocessor">#define FT_TRACE5( varformat )  FT_Message varformat</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span><span class="preprocessor">#ifndef FT_TRACE7</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span><span class="preprocessor">#define FT_TRACE7( varformat )  FT_Message varformat</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span><span class="preprocessor">#ifndef FT_ERROR</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span><span class="preprocessor">#define FT_ERROR( varformat )   FT_Message varformat</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>
<a name="l00168"></a>00168 <span class="preprocessor">#else </span><span class="comment">/* !FT_DEBUG_LEVEL_TRACE */</span>
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="preprocessor">#define FT_TRACE5( x )  do { } while ( 0 )     </span><span class="comment">/* nothing */</span>
<a name="l00171"></a>00171 <span class="preprocessor">#define FT_TRACE7( x )  do { } while ( 0 )     </span><span class="comment">/* nothing */</span>
<a name="l00172"></a>00172 <span class="preprocessor">#define FT_ERROR( x )   do { } while ( 0 )     </span><span class="comment">/* nothing */</span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 <span class="preprocessor">#endif </span><span class="comment">/* !FT_DEBUG_LEVEL_TRACE */</span>
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="preprocessor">#define FT_DEFINE_OUTLINE_FUNCS( class_,               \</span>
<a name="l00178"></a>00178 <span class="preprocessor">                                 move_to_, line_to_,   \</span>
<a name="l00179"></a>00179 <span class="preprocessor">                                 conic_to_, cubic_to_, \</span>
<a name="l00180"></a>00180 <span class="preprocessor">                                 shift_, delta_ )      \</span>
<a name="l00181"></a>00181 <span class="preprocessor">          static const FT_Outline_Funcs class_ =       \</span>
<a name="l00182"></a>00182 <span class="preprocessor">          {                                            \</span>
<a name="l00183"></a>00183 <span class="preprocessor">            move_to_,                                  \</span>
<a name="l00184"></a>00184 <span class="preprocessor">            line_to_,                                  \</span>
<a name="l00185"></a>00185 <span class="preprocessor">            conic_to_,                                 \</span>
<a name="l00186"></a>00186 <span class="preprocessor">            cubic_to_,                                 \</span>
<a name="l00187"></a>00187 <span class="preprocessor">            shift_,                                    \</span>
<a name="l00188"></a>00188 <span class="preprocessor">            delta_                                     \</span>
<a name="l00189"></a>00189 <span class="preprocessor">         };</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>                                          
<a name="l00191"></a>00191 <span class="preprocessor">#define FT_DEFINE_RASTER_FUNCS( class_, glyph_format_,            \</span>
<a name="l00192"></a>00192 <span class="preprocessor">                                raster_new_, raster_reset_,       \</span>
<a name="l00193"></a>00193 <span class="preprocessor">                                raster_set_mode_, raster_render_, \</span>
<a name="l00194"></a>00194 <span class="preprocessor">                                raster_done_ )                    \</span>
<a name="l00195"></a>00195 <span class="preprocessor">          const FT_Raster_Funcs class_ =                          \</span>
<a name="l00196"></a>00196 <span class="preprocessor">          {                                                       \</span>
<a name="l00197"></a>00197 <span class="preprocessor">            glyph_format_,                                        \</span>
<a name="l00198"></a>00198 <span class="preprocessor">            raster_new_,                                          \</span>
<a name="l00199"></a>00199 <span class="preprocessor">            raster_reset_,                                        \</span>
<a name="l00200"></a>00200 <span class="preprocessor">            raster_set_mode_,                                     \</span>
<a name="l00201"></a>00201 <span class="preprocessor">            raster_render_,                                       \</span>
<a name="l00202"></a>00202 <span class="preprocessor">            raster_done_                                          \</span>
<a name="l00203"></a>00203 <span class="preprocessor">         };</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span>
<a name="l00205"></a>00205 <span class="preprocessor">#else </span><span class="comment">/* !_STANDALONE_ */</span>
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="preprocessor">#include &lt;<a class="code" href="ft2build_8h.html">ft2build.h</a>&gt;</span>
<a name="l00209"></a>00209 <span class="preprocessor">#include &quot;<a class="code" href="ftgrays_8h.html">ftgrays.h</a>&quot;</span>
<a name="l00210"></a>00210 <span class="preprocessor">#include FT_INTERNAL_OBJECTS_H</span>
<a name="l00211"></a>00211 <span class="preprocessor"></span><span class="preprocessor">#include FT_INTERNAL_DEBUG_H</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span><span class="preprocessor">#include FT_OUTLINE_H</span>
<a name="l00213"></a>00213 <span class="preprocessor"></span>
<a name="l00214"></a>00214 <span class="preprocessor">#include &quot;<a class="code" href="ftsmerrs_8h.html">ftsmerrs.h</a>&quot;</span>
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 <span class="preprocessor">#include &quot;<a class="code" href="ftspic_8h.html">ftspic.h</a>&quot;</span>
<a name="l00217"></a>00217 
<a name="l00218"></a><a class="code" href="ftgrays_8c.html#a82ee96034fc68f34601fe16538ce8c3a">00218</a> <span class="preprocessor">#define ErrRaster_Invalid_Mode      Smooth_Err_Cannot_Render_Glyph</span>
<a name="l00219"></a><a class="code" href="ftgrays_8c.html#ae5a591c1fc2df77dbf1c713d3cfb28be">00219</a> <span class="preprocessor"></span><span class="preprocessor">#define ErrRaster_Invalid_Outline   Smooth_Err_Invalid_Outline</span>
<a name="l00220"></a><a class="code" href="ftgrays_8c.html#a1c119fbb760129ad7e98b7102e5dca5a">00220</a> <span class="preprocessor"></span><span class="preprocessor">#define ErrRaster_Memory_Overflow   Smooth_Err_Out_Of_Memory</span>
<a name="l00221"></a><a class="code" href="ftgrays_8c.html#a42c64a7abfcdf753c14851925bd7da0f">00221</a> <span class="preprocessor"></span><span class="preprocessor">#define ErrRaster_Invalid_Argument  Smooth_Err_Invalid_Argument</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>
<a name="l00223"></a>00223 <span class="preprocessor">#endif </span><span class="comment">/* !_STANDALONE_ */</span>
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="preprocessor">#ifndef FT_MEM_SET</span>
<a name="l00226"></a><a class="code" href="ftgrays_8c.html#a6475871875685d4e791a1d0f3780744e">00226</a> <span class="preprocessor"></span><span class="preprocessor">#define FT_MEM_SET( d, s, c )  ft_memset( d, s, c )</span>
<a name="l00227"></a>00227 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>
<a name="l00229"></a>00229 <span class="preprocessor">#ifndef FT_MEM_ZERO</span>
<a name="l00230"></a><a class="code" href="ftgrays_8c.html#ad04dbb2871d7219281966386fffaf909">00230</a> <span class="preprocessor"></span><span class="preprocessor">#define FT_MEM_ZERO( dest, count )  FT_MEM_SET( dest, 0, count )</span>
<a name="l00231"></a>00231 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>
<a name="l00233"></a>00233   <span class="comment">/* as usual, for the speed hungry :-) */</span>
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <span class="preprocessor">#ifndef FT_STATIC_RASTER</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>
<a name="l00237"></a><a class="code" href="ftgrays_8c.html#a1523f79d603e23dfea98f6f5a2dcd8b4">00237</a> <span class="preprocessor">#define RAS_ARG   PWorker  worker</span>
<a name="l00238"></a><a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">00238</a> <span class="preprocessor"></span><span class="preprocessor">#define RAS_ARG_  PWorker  worker,</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>
<a name="l00240"></a><a class="code" href="ftgrays_8c.html#a71d83a981d5845ee2392a85c2369311a">00240</a> <span class="preprocessor">#define RAS_VAR   worker</span>
<a name="l00241"></a><a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">00241</a> <span class="preprocessor"></span><span class="preprocessor">#define RAS_VAR_  worker,</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>
<a name="l00243"></a>00243 <span class="preprocessor">#else </span><span class="comment">/* FT_STATIC_RASTER */</span>
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 <span class="preprocessor">#define RAS_ARG   </span><span class="comment">/* empty */</span>
<a name="l00246"></a>00246 <span class="preprocessor">#define RAS_ARG_  </span><span class="comment">/* empty */</span>
<a name="l00247"></a>00247 <span class="preprocessor">#define RAS_VAR   </span><span class="comment">/* empty */</span>
<a name="l00248"></a>00248 <span class="preprocessor">#define RAS_VAR_  </span><span class="comment">/* empty */</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="preprocessor">#endif </span><span class="comment">/* FT_STATIC_RASTER */</span>
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <span class="comment">/* must be at least 6 bits! */</span>
<a name="l00254"></a><a class="code" href="ftgrays_8c.html#a8059c4d10c45379712a990807796c73e">00254</a> <span class="preprocessor">#define PIXEL_BITS  8</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>
<a name="l00256"></a><a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">00256</a> <span class="preprocessor">#define ONE_PIXEL       ( 1L &lt;&lt; PIXEL_BITS )</span>
<a name="l00257"></a><a class="code" href="ftgrays_8c.html#ab6f50f912664d0ec6665dc491d3063c8">00257</a> <span class="preprocessor"></span><span class="preprocessor">#define PIXEL_MASK      ( -1L &lt;&lt; PIXEL_BITS )</span>
<a name="l00258"></a><a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">00258</a> <span class="preprocessor"></span><span class="preprocessor">#define TRUNC( x )      ( (TCoord)( (x) &gt;&gt; PIXEL_BITS ) )</span>
<a name="l00259"></a><a class="code" href="ftgrays_8c.html#ad063c772cf2b01dffd373c556829559a">00259</a> <span class="preprocessor"></span><span class="preprocessor">#define SUBPIXELS( x )  ( (TPos)(x) &lt;&lt; PIXEL_BITS )</span>
<a name="l00260"></a><a class="code" href="ftgrays_8c.html#a2f0eecb0f7856721f56faff8f27b0dc1">00260</a> <span class="preprocessor"></span><span class="preprocessor">#define FLOOR( x )      ( (x) &amp; -ONE_PIXEL )</span>
<a name="l00261"></a><a class="code" href="ftgrays_8c.html#a6288138452f7c77b85d2ea4ea2a168e1">00261</a> <span class="preprocessor"></span><span class="preprocessor">#define CEILING( x )    ( ( (x) + ONE_PIXEL - 1 ) &amp; -ONE_PIXEL )</span>
<a name="l00262"></a><a class="code" href="ftgrays_8c.html#acd66e8cacf954c3bc3bba81d09425a12">00262</a> <span class="preprocessor"></span><span class="preprocessor">#define ROUND( x )      ( ( (x) + ONE_PIXEL / 2 ) &amp; -ONE_PIXEL )</span>
<a name="l00263"></a>00263 <span class="preprocessor"></span>
<a name="l00264"></a>00264 <span class="preprocessor">#if PIXEL_BITS &gt;= 6</span>
<a name="l00265"></a><a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">00265</a> <span class="preprocessor"></span><span class="preprocessor">#define UPSCALE( x )    ( (x) &lt;&lt; ( PIXEL_BITS - 6 ) )</span>
<a name="l00266"></a><a class="code" href="ftgrays_8c.html#a8da23e0751f5a82c45414bbd2389d326">00266</a> <span class="preprocessor"></span><span class="preprocessor">#define DOWNSCALE( x )  ( (x) &gt;&gt; ( PIXEL_BITS - 6 ) )</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00268"></a>00268 <span class="preprocessor"></span><span class="preprocessor">#define UPSCALE( x )    ( (x) &gt;&gt; ( 6 - PIXEL_BITS ) )</span>
<a name="l00269"></a>00269 <span class="preprocessor"></span><span class="preprocessor">#define DOWNSCALE( x )  ( (x) &lt;&lt; ( 6 - PIXEL_BITS ) )</span>
<a name="l00270"></a>00270 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00271"></a>00271 <span class="preprocessor"></span>
<a name="l00272"></a>00272 
<a name="l00273"></a>00273   <span class="comment">/*************************************************************************/</span>
<a name="l00274"></a>00274   <span class="comment">/*                                                                       */</span>
<a name="l00275"></a>00275   <span class="comment">/*   TYPE DEFINITIONS                                                    */</span>
<a name="l00276"></a>00276   <span class="comment">/*                                                                       */</span>
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   <span class="comment">/* don&#39;t change the following types to FT_Int or FT_Pos, since we might */</span>
<a name="l00279"></a>00279   <span class="comment">/* need to define them to &quot;float&quot; or &quot;double&quot; when experimenting with   */</span>
<a name="l00280"></a>00280   <span class="comment">/* new algorithms                                                       */</span>
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">00282</a>   <span class="keyword">typedef</span> <span class="keywordtype">long</span>  <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>;   <span class="comment">/* integer scanline/pixel coordinate */</span>
<a name="l00283"></a><a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">00283</a>   <span class="keyword">typedef</span> <span class="keywordtype">long</span>  <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>;     <span class="comment">/* sub-pixel coordinate              */</span>
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <span class="comment">/* determine the type used to store cell areas.  This normally takes at */</span>
<a name="l00286"></a>00286   <span class="comment">/* least PIXEL_BITS*2 + 1 bits.  On 16-bit systems, we need to use      */</span>
<a name="l00287"></a>00287   <span class="comment">/* `long&#39; instead of `int&#39;, otherwise bad things happen                 */</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="preprocessor">#if PIXEL_BITS &lt;= 7</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>
<a name="l00291"></a>00291   <span class="keyword">typedef</span> <span class="keywordtype">int</span>  <a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="preprocessor">#else </span><span class="comment">/* PIXEL_BITS &gt;= 8 */</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   <span class="comment">/* approximately determine the size of integers using an ANSI-C header */</span>
<a name="l00296"></a>00296 <span class="preprocessor">#if FT_UINT_MAX == 0xFFFFU</span>
<a name="l00297"></a>00297 <span class="preprocessor"></span>  <span class="keyword">typedef</span> <span class="keywordtype">long</span>  <a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>;
<a name="l00298"></a>00298 <span class="preprocessor">#else</span>
<a name="l00299"></a><a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">00299</a> <span class="preprocessor"></span>  <span class="keyword">typedef</span> <span class="keywordtype">int</span>   <a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>;
<a name="l00300"></a>00300 <span class="preprocessor">#endif</span>
<a name="l00301"></a>00301 <span class="preprocessor"></span>
<a name="l00302"></a>00302 <span class="preprocessor">#endif </span><span class="comment">/* PIXEL_BITS &gt;= 8 */</span>
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   <span class="comment">/* maximal number of gray spans in a call to the span callback */</span>
<a name="l00306"></a><a class="code" href="ftgrays_8c.html#afa494e5252ce5c5cbda6a931cf3ef8fa">00306</a> <span class="preprocessor">#define FT_MAX_GRAY_SPANS  32</span>
<a name="l00307"></a>00307 <span class="preprocessor"></span>
<a name="l00308"></a>00308 
<a name="l00309"></a><a class="code" href="ftgrays_8c.html#aa5dea8fee85f1a98fa52257da9c389c1">00309</a>   <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_t_cell__.html">TCell_</a>*  <a class="code" href="ftgrays_8c.html#aa5dea8fee85f1a98fa52257da9c389c1">PCell</a>;
<a name="l00310"></a>00310 
<a name="l00311"></a><a class="code" href="struct_t_cell__.html">00311</a>   <span class="keyword">typedef</span> <span class="keyword">struct  </span><a class="code" href="struct_t_cell__.html">TCell_</a>
<a name="l00312"></a>00312   {
<a name="l00313"></a><a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">00313</a>     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>   <a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a>;     <span class="comment">/* same with TWorker.ex */</span>
<a name="l00314"></a><a class="code" href="struct_t_cell__.html#a28686cf9daed2749bd5a6efda14a9843">00314</a>     <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a> <a class="code" href="struct_t_cell__.html#a28686cf9daed2749bd5a6efda14a9843">cover</a>; <span class="comment">/* same with TWorker.cover */</span>
<a name="l00315"></a><a class="code" href="struct_t_cell__.html#af7ad708f810a148a0303bb851f82fe7b">00315</a>     <a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>  <a class="code" href="struct_t_cell__.html#af7ad708f810a148a0303bb851f82fe7b">area</a>;
<a name="l00316"></a><a class="code" href="struct_t_cell__.html#a2b668ed32d6a79702931eb7f78f4b2d6">00316</a>     PCell  <a class="code" href="struct_t_cell__.html#a2b668ed32d6a79702931eb7f78f4b2d6">next</a>;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318   } <a class="code" href="ftgrays_8c.html#adffe80f61398f3d06a05e4531ab12876">TCell</a>;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 
<a name="l00321"></a>00321   <span class="keyword">typedef</span> <span class="keyword">struct  </span><a class="code" href="struct_t_worker__.html">TWorker_</a>
<a name="l00322"></a>00322   {
<a name="l00323"></a><a class="code" href="struct_t_worker__.html#a9a20ecec5a49a4591ad83f797e85ad8d">00323</a>     <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  <a class="code" href="struct_t_worker__.html#a264dfa510cdffa4511132c2cab2d4204">ex</a>, <a class="code" href="struct_t_worker__.html#a9a20ecec5a49a4591ad83f797e85ad8d">ey</a>;
<a name="l00324"></a><a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">00324</a>     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    <a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a>, <a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a>;
<a name="l00325"></a><a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">00325</a>     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    <a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a>, <a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a>;
<a name="l00326"></a><a class="code" href="struct_t_worker__.html#a56f5fc2f91c85196c24ebec1e48c0322">00326</a>     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    <a class="code" href="struct_t_worker__.html#afdf6647ea98e47e0adb9948c2d16f03c">count_ex</a>, <a class="code" href="struct_t_worker__.html#a56f5fc2f91c85196c24ebec1e48c0322">count_ey</a>;
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">00328</a>     <a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>   <a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>;
<a name="l00329"></a><a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">00329</a>     <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  <a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a>;
<a name="l00330"></a><a class="code" href="struct_t_worker__.html#acbf1d08171d29ce1f71651171323c321">00330</a>     <span class="keywordtype">int</span>     <a class="code" href="struct_t_worker__.html#acbf1d08171d29ce1f71651171323c321">invalid</a>;
<a name="l00331"></a>00331 
<a name="l00332"></a><a class="code" href="struct_t_worker__.html#a089f0962c5ada881137d1e0af513ed1e">00332</a>     PCell   <a class="code" href="struct_t_worker__.html#a089f0962c5ada881137d1e0af513ed1e">cells</a>;
<a name="l00333"></a><a class="code" href="struct_t_worker__.html#af981fd29b780b01490707307527ee160">00333</a>     <a class="code" href="fttypes_8h.html#a2469cb02129d36e468be22f7a8bf5b33">FT_PtrDist</a>  <a class="code" href="struct_t_worker__.html#af981fd29b780b01490707307527ee160">max_cells</a>;
<a name="l00334"></a><a class="code" href="struct_t_worker__.html#af2565e836b65311cad38b51caec64dfe">00334</a>     <a class="code" href="fttypes_8h.html#a2469cb02129d36e468be22f7a8bf5b33">FT_PtrDist</a>  <a class="code" href="struct_t_worker__.html#af2565e836b65311cad38b51caec64dfe">num_cells</a>;
<a name="l00335"></a>00335 
<a name="l00336"></a><a class="code" href="struct_t_worker__.html#ae682ed960f3f0bdc14eb86a682244efd">00336</a>     <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  <a class="code" href="struct_t_worker__.html#a90d99bacf0369d81caa49bad5fcd8e87">cx</a>, <a class="code" href="struct_t_worker__.html#ae682ed960f3f0bdc14eb86a682244efd">cy</a>;
<a name="l00337"></a><a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">00337</a>     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    <a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a>,  <a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a>;
<a name="l00338"></a>00338 
<a name="l00339"></a><a class="code" href="struct_t_worker__.html#a6bdaa6192fac756a7a3bf8556474893e">00339</a>     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    <a class="code" href="struct_t_worker__.html#a6bdaa6192fac756a7a3bf8556474893e">last_ey</a>;
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="struct_t_worker__.html#a1d2860e47c0b917d4ed9596cb7cf9484">00341</a>     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>   <a class="code" href="struct_t_worker__.html#a1d2860e47c0b917d4ed9596cb7cf9484">bez_stack</a>[32 * 3 + 1];
<a name="l00342"></a><a class="code" href="struct_t_worker__.html#af10c5bacba83e3abf8234a9e4b4cb792">00342</a>     <span class="keywordtype">int</span>         <a class="code" href="struct_t_worker__.html#af10c5bacba83e3abf8234a9e4b4cb792">lev_stack</a>[32];
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <a class="code" href="struct_f_t___outline__.html">FT_Outline</a>  <a class="code" href="struct_t_worker__.html#a943f8085950441ac728a25bc49327601">outline</a>;
<a name="l00345"></a>00345     <a class="code" href="struct_f_t___bitmap__.html">FT_Bitmap</a>   <a class="code" href="struct_t_worker__.html#a7bc261f8cce875cf8c78aad7386e8884">target</a>;
<a name="l00346"></a><a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">00346</a>     <a class="code" href="struct_f_t___b_box__.html">FT_BBox</a>     <a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>;
<a name="l00347"></a>00347 
<a name="l00348"></a><a class="code" href="struct_t_worker__.html#ac51cde9a5cf6ff2c17f28450632beec0">00348</a>     <a class="code" href="struct_f_t___span__.html">FT_Span</a>     <a class="code" href="struct_t_worker__.html#ac51cde9a5cf6ff2c17f28450632beec0">gray_spans</a>[<a class="code" href="ftgrays_8c.html#afa494e5252ce5c5cbda6a931cf3ef8fa">FT_MAX_GRAY_SPANS</a>];
<a name="l00349"></a><a class="code" href="struct_t_worker__.html#aaf76891630160804f0cef7dd89b635e0">00349</a>     <span class="keywordtype">int</span>         <a class="code" href="struct_t_worker__.html#aaf76891630160804f0cef7dd89b635e0">num_gray_spans</a>;
<a name="l00350"></a>00350 
<a name="l00351"></a><a class="code" href="struct_t_worker__.html#a65f7b375e13f82384dd56bef7451cd39">00351</a>     <a class="code" href="ftimage_8h.html#a27308127a1ced75fcb7c2af04a858a54">FT_Raster_Span_Func</a>  <a class="code" href="struct_t_worker__.html#a65f7b375e13f82384dd56bef7451cd39">render_span</a>;
<a name="l00352"></a><a class="code" href="struct_t_worker__.html#a9163ea80b63aee1e18f5b4c111584ec8">00352</a>     <span class="keywordtype">void</span>*                <a class="code" href="struct_t_worker__.html#a9163ea80b63aee1e18f5b4c111584ec8">render_span_data</a>;
<a name="l00353"></a><a class="code" href="struct_t_worker__.html#a70859f8f020cdd79f9c4636191dadb3b">00353</a>     <span class="keywordtype">int</span>                  <a class="code" href="struct_t_worker__.html#a70859f8f020cdd79f9c4636191dadb3b">span_y</a>;
<a name="l00354"></a>00354 
<a name="l00355"></a><a class="code" href="struct_t_worker__.html#af286ee860140e2d0abd1650600bc8586">00355</a>     <span class="keywordtype">int</span>  <a class="code" href="struct_t_worker__.html#af286ee860140e2d0abd1650600bc8586">band_size</a>;
<a name="l00356"></a><a class="code" href="struct_t_worker__.html#a140a65d0a3a36eacc379eb5385da094d">00356</a>     <span class="keywordtype">int</span>  <a class="code" href="struct_t_worker__.html#a140a65d0a3a36eacc379eb5385da094d">band_shoot</a>;
<a name="l00357"></a><a class="code" href="struct_t_worker__.html#aeedfb86fae2d26779aae3b04e767c44f">00357</a>     <span class="keywordtype">int</span>  <a class="code" href="struct_t_worker__.html#aeedfb86fae2d26779aae3b04e767c44f">conic_level</a>;
<a name="l00358"></a><a class="code" href="struct_t_worker__.html#ace9a8b37b9118308ec5c74c2716ae228">00358</a>     <span class="keywordtype">int</span>  <a class="code" href="struct_t_worker__.html#ace9a8b37b9118308ec5c74c2716ae228">cubic_level</a>;
<a name="l00359"></a>00359 
<a name="l00360"></a><a class="code" href="struct_t_worker__.html#a6196d62ea93584ca6fcb88a7e282e872">00360</a>     <a class="code" href="ftstdlib_8h.html#a4c13ff957e7b63737a04c178c5b0fd86">ft_jmp_buf</a>  <a class="code" href="struct_t_worker__.html#a6196d62ea93584ca6fcb88a7e282e872">jump_buffer</a>;
<a name="l00361"></a>00361 
<a name="l00362"></a><a class="code" href="struct_t_worker__.html#a42f739d61a410947666aa88c374ddfdd">00362</a>     <span class="keywordtype">void</span>*       <a class="code" href="struct_t_worker__.html#a42f739d61a410947666aa88c374ddfdd">buffer</a>;
<a name="l00363"></a><a class="code" href="struct_t_worker__.html#a4d741143905671f7c65794020b9dc555">00363</a>     <span class="keywordtype">long</span>        <a class="code" href="struct_t_worker__.html#a4d741143905671f7c65794020b9dc555">buffer_size</a>;
<a name="l00364"></a>00364 
<a name="l00365"></a><a class="code" href="struct_t_worker__.html#a0392f5e32f211c88712518ecf1c38bb2">00365</a>     PCell*     <a class="code" href="struct_t_worker__.html#a0392f5e32f211c88712518ecf1c38bb2">ycells</a>;
<a name="l00366"></a><a class="code" href="struct_t_worker__.html#a2ddb5a24054498746886e38916e0c82d">00366</a>     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>       <a class="code" href="struct_t_worker__.html#a2ddb5a24054498746886e38916e0c82d">ycount</a>;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368   } <a class="code" href="ftraster_8c.html#a2084f2281045ebbb173b4350ab0199b5">TWorker</a>, *<a class="code" href="ftraster_8c.html#a26d77f35fd799cf8597356e8e1351040">PWorker</a>;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <span class="preprocessor">#ifndef FT_STATIC_RASTER</span>
<a name="l00372"></a><a class="code" href="ftgrays_8c.html#a8e181e0a2fa64bf35d8f9e6994fb1c60">00372</a> <span class="preprocessor"></span><span class="preprocessor">#define ras  (*worker)</span>
<a name="l00373"></a>00373 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00374"></a>00374 <span class="preprocessor"></span>  <span class="keyword">static</span> <a class="code" href="struct_t_worker__.html">TWorker</a>  <a class="code" href="ftgrays_8c.html#a8e181e0a2fa64bf35d8f9e6994fb1c60">ras</a>;
<a name="l00375"></a>00375 <span class="preprocessor">#endif</span>
<a name="l00376"></a>00376 <span class="preprocessor"></span>
<a name="l00377"></a>00377 
<a name="l00378"></a>00378   <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_t_raster__.html">TRaster_</a>
<a name="l00379"></a>00379   {
<a name="l00380"></a><a class="code" href="struct_t_raster__.html#a8909520f227b82f73389e5fe75599259">00380</a>     <span class="keywordtype">void</span>*    <a class="code" href="struct_t_raster__.html#a8909520f227b82f73389e5fe75599259">buffer</a>;
<a name="l00381"></a>00381     <span class="keywordtype">long</span>     <a class="code" href="struct_t_raster__.html#a1b800cee545f7cc1bd5a168de13f580b">buffer_size</a>;
<a name="l00382"></a><a class="code" href="struct_t_raster__.html#acb7d271e9f9f6346d0642c3f8300032c">00382</a>     <span class="keywordtype">int</span>      <a class="code" href="struct_t_raster__.html#acb7d271e9f9f6346d0642c3f8300032c">band_size</a>;
<a name="l00383"></a>00383     <span class="keywordtype">void</span>*    <a class="code" href="struct_t_raster__.html#ac0245d05777969f7138e28eeb50a2324">memory</a>;
<a name="l00384"></a>00384     PWorker  <a class="code" href="struct_t_raster__.html#abad968ddaa0f88d709352aaf4d3ad614">worker</a>;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   } <a class="code" href="ftraster_8c.html#af109dc9dbc1d5ea376e0c8373f5b0991">TRaster</a>, *<a class="code" href="ftraster_8c.html#acd4c2764c8a7a1a44c0e794af9db83e7">PRaster</a>;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 
<a name="l00390"></a>00390   <span class="comment">/*************************************************************************/</span>
<a name="l00391"></a>00391   <span class="comment">/*                                                                       */</span>
<a name="l00392"></a>00392   <span class="comment">/* Initialize the cells table.                                           */</span>
<a name="l00393"></a>00393   <span class="comment">/*                                                                       */</span>
<a name="l00394"></a>00394   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00395"></a>00395   gray_init_cells( <a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">RAS_ARG_</a> <span class="keywordtype">void</span>*  buffer,
<a name="l00396"></a>00396                    <span class="keywordtype">long</span>            byte_size )
<a name="l00397"></a>00397   {
<a name="l00398"></a>00398     ras.<a class="code" href="struct_t_worker__.html#a42f739d61a410947666aa88c374ddfdd">buffer</a>      = buffer;
<a name="l00399"></a>00399     ras.<a class="code" href="struct_t_worker__.html#a4d741143905671f7c65794020b9dc555">buffer_size</a> = byte_size;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     ras.<a class="code" href="struct_t_worker__.html#a0392f5e32f211c88712518ecf1c38bb2">ycells</a>      = (PCell*) buffer;
<a name="l00402"></a>00402     ras.<a class="code" href="struct_t_worker__.html#a089f0962c5ada881137d1e0af513ed1e">cells</a>       = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00403"></a>00403     ras.<a class="code" href="struct_t_worker__.html#af981fd29b780b01490707307527ee160">max_cells</a>   = 0;
<a name="l00404"></a>00404     ras.<a class="code" href="struct_t_worker__.html#af2565e836b65311cad38b51caec64dfe">num_cells</a>   = 0;
<a name="l00405"></a>00405     ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>        = 0;
<a name="l00406"></a>00406     ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a>       = 0;
<a name="l00407"></a>00407     ras.<a class="code" href="struct_t_worker__.html#acbf1d08171d29ce1f71651171323c321">invalid</a>     = 1;
<a name="l00408"></a>00408   }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   <span class="comment">/*************************************************************************/</span>
<a name="l00412"></a>00412   <span class="comment">/*                                                                       */</span>
<a name="l00413"></a>00413   <span class="comment">/* Compute the outline bounding box.                                     */</span>
<a name="l00414"></a>00414   <span class="comment">/*                                                                       */</span>
<a name="l00415"></a>00415   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00416"></a>00416   gray_compute_cbox( <a class="code" href="ftgrays_8c.html#a1523f79d603e23dfea98f6f5a2dcd8b4">RAS_ARG</a> )
<a name="l00417"></a>00417   {
<a name="l00418"></a>00418     <a class="code" href="struct_f_t___outline__.html">FT_Outline</a>*  outline = &amp;ras.<a class="code" href="struct_t_worker__.html#a943f8085950441ac728a25bc49327601">outline</a>;
<a name="l00419"></a>00419     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*   vec     = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a4871896a2f38bdab947e30a7cf6bca04">points</a>;
<a name="l00420"></a>00420     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*   limit   = vec + outline-&gt;<a class="code" href="struct_f_t___outline__.html#a7ebcf3c33231af88655534d1ac02b66e">n_points</a>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keywordflow">if</span> ( outline-&gt;<a class="code" href="struct_f_t___outline__.html#a7ebcf3c33231af88655534d1ac02b66e">n_points</a> &lt;= 0 )
<a name="l00424"></a>00424     {
<a name="l00425"></a>00425       ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> = ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> = 0;
<a name="l00426"></a>00426       ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> = ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> = 0;
<a name="l00427"></a>00427       <span class="keywordflow">return</span>;
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> = ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> = vec-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l00431"></a>00431     ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> = ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> = vec-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     vec++;
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="keywordflow">for</span> ( ; vec &lt; limit; vec++ )
<a name="l00436"></a>00436     {
<a name="l00437"></a>00437       <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  x = vec-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l00438"></a>00438       <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  y = vec-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 
<a name="l00441"></a>00441       <span class="keywordflow">if</span> ( x &lt; ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> ) ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> = x;
<a name="l00442"></a>00442       <span class="keywordflow">if</span> ( x &gt; ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> ) ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> = x;
<a name="l00443"></a>00443       <span class="keywordflow">if</span> ( y &lt; ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> ) ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> = y;
<a name="l00444"></a>00444       <span class="keywordflow">if</span> ( y &gt; ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> ) ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> = y;
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447     <span class="comment">/* truncate the bounding box to integer pixels */</span>
<a name="l00448"></a>00448     ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> = ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> &gt;&gt; 6;
<a name="l00449"></a>00449     ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> = ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> &gt;&gt; 6;
<a name="l00450"></a>00450     ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> = ( ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> + 63 ) &gt;&gt; 6;
<a name="l00451"></a>00451     ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> = ( ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> + 63 ) &gt;&gt; 6;
<a name="l00452"></a>00452   }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 
<a name="l00455"></a>00455   <span class="comment">/*************************************************************************/</span>
<a name="l00456"></a>00456   <span class="comment">/*                                                                       */</span>
<a name="l00457"></a>00457   <span class="comment">/* Record the current cell in the table.                                 */</span>
<a name="l00458"></a>00458   <span class="comment">/*                                                                       */</span>
<a name="l00459"></a>00459   <span class="keyword">static</span> PCell
<a name="l00460"></a>00460   gray_find_cell( <a class="code" href="ftgrays_8c.html#a1523f79d603e23dfea98f6f5a2dcd8b4">RAS_ARG</a> )
<a name="l00461"></a>00461   {
<a name="l00462"></a>00462     PCell  *pcell, cell;
<a name="l00463"></a>00463     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    x = ras.<a class="code" href="struct_t_worker__.html#a264dfa510cdffa4511132c2cab2d4204">ex</a>;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     <span class="keywordflow">if</span> ( x &gt; ras.<a class="code" href="struct_t_worker__.html#afdf6647ea98e47e0adb9948c2d16f03c">count_ex</a> )
<a name="l00467"></a>00467       x = ras.<a class="code" href="struct_t_worker__.html#afdf6647ea98e47e0adb9948c2d16f03c">count_ex</a>;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     pcell = &amp;ras.<a class="code" href="struct_t_worker__.html#a0392f5e32f211c88712518ecf1c38bb2">ycells</a>[ras.<a class="code" href="struct_t_worker__.html#a9a20ecec5a49a4591ad83f797e85ad8d">ey</a>];
<a name="l00470"></a>00470     <span class="keywordflow">for</span> (;;)
<a name="l00471"></a>00471     {
<a name="l00472"></a>00472       cell = *pcell;
<a name="l00473"></a>00473       <span class="keywordflow">if</span> ( cell == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || cell-&gt;<a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a> &gt; x )
<a name="l00474"></a>00474         <span class="keywordflow">break</span>;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476       <span class="keywordflow">if</span> ( cell-&gt;<a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a> == x )
<a name="l00477"></a>00477         <span class="keywordflow">goto</span> Exit;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479       pcell = &amp;cell-&gt;<a class="code" href="struct_t_cell__.html#a2b668ed32d6a79702931eb7f78f4b2d6">next</a>;
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#af2565e836b65311cad38b51caec64dfe">num_cells</a> &gt;= ras.<a class="code" href="struct_t_worker__.html#af981fd29b780b01490707307527ee160">max_cells</a> )
<a name="l00483"></a>00483       <a class="code" href="ftstdlib_8h.html#a5a5bcdc06f1f7716f5a7d11360962f3b">ft_longjmp</a>( ras.<a class="code" href="struct_t_worker__.html#a6196d62ea93584ca6fcb88a7e282e872">jump_buffer</a>, 1 );
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     cell        = ras.<a class="code" href="struct_t_worker__.html#a089f0962c5ada881137d1e0af513ed1e">cells</a> + ras.<a class="code" href="struct_t_worker__.html#af2565e836b65311cad38b51caec64dfe">num_cells</a>++;
<a name="l00486"></a>00486     cell-&gt;<a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a>     = x;
<a name="l00487"></a>00487     cell-&gt;<a class="code" href="struct_t_cell__.html#af7ad708f810a148a0303bb851f82fe7b">area</a>  = 0;
<a name="l00488"></a>00488     cell-&gt;<a class="code" href="struct_t_cell__.html#a28686cf9daed2749bd5a6efda14a9843">cover</a> = 0;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     cell-&gt;<a class="code" href="struct_t_cell__.html#a2b668ed32d6a79702931eb7f78f4b2d6">next</a>  = *pcell;
<a name="l00491"></a>00491     *pcell      = cell;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493   Exit:
<a name="l00494"></a>00494     <span class="keywordflow">return</span> cell;
<a name="l00495"></a>00495   }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 
<a name="l00498"></a>00498   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00499"></a>00499   gray_record_cell( <a class="code" href="ftgrays_8c.html#a1523f79d603e23dfea98f6f5a2dcd8b4">RAS_ARG</a> )
<a name="l00500"></a>00500   {
<a name="l00501"></a>00501     <span class="keywordflow">if</span> ( !ras.<a class="code" href="struct_t_worker__.html#acbf1d08171d29ce1f71651171323c321">invalid</a> &amp;&amp; ( ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a> | ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a> ) )
<a name="l00502"></a>00502     {
<a name="l00503"></a>00503       PCell  cell = gray_find_cell( <a class="code" href="ftgrays_8c.html#a71d83a981d5845ee2392a85c2369311a">RAS_VAR</a> );
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 
<a name="l00506"></a>00506       cell-&gt;<a class="code" href="struct_t_cell__.html#af7ad708f810a148a0303bb851f82fe7b">area</a>  += ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>;
<a name="l00507"></a>00507       cell-&gt;<a class="code" href="struct_t_cell__.html#a28686cf9daed2749bd5a6efda14a9843">cover</a> += ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a>;
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509   }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512   <span class="comment">/*************************************************************************/</span>
<a name="l00513"></a>00513   <span class="comment">/*                                                                       */</span>
<a name="l00514"></a>00514   <span class="comment">/* Set the current cell to a new position.                               */</span>
<a name="l00515"></a>00515   <span class="comment">/*                                                                       */</span>
<a name="l00516"></a>00516   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00517"></a>00517   gray_set_cell( <a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">RAS_ARG_</a> <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  ex,
<a name="l00518"></a>00518                           <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  ey )
<a name="l00519"></a>00519   {
<a name="l00520"></a>00520     <span class="comment">/* Move the cell pointer to a new position.  We set the `invalid&#39;      */</span>
<a name="l00521"></a>00521     <span class="comment">/* flag to indicate that the cell isn&#39;t part of those we&#39;re interested */</span>
<a name="l00522"></a>00522     <span class="comment">/* in during the render phase.  This means that:                       */</span>
<a name="l00523"></a>00523     <span class="comment">/*                                                                     */</span>
<a name="l00524"></a>00524     <span class="comment">/* . the new vertical position must be within min_ey..max_ey-1.        */</span>
<a name="l00525"></a>00525     <span class="comment">/* . the new horizontal position must be strictly less than max_ex     */</span>
<a name="l00526"></a>00526     <span class="comment">/*                                                                     */</span>
<a name="l00527"></a>00527     <span class="comment">/* Note that if a cell is to the left of the clipping region, it is    */</span>
<a name="l00528"></a>00528     <span class="comment">/* actually set to the (min_ex-1) horizontal position.                 */</span>
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     <span class="comment">/* All cells that are on the left of the clipping region go to the */</span>
<a name="l00531"></a>00531     <span class="comment">/* min_ex - 1 horizontal position.                                 */</span>
<a name="l00532"></a>00532     ey -= ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a>;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="keywordflow">if</span> ( ex &gt; ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> )
<a name="l00535"></a>00535       ex = ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a>;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     ex -= ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a>;
<a name="l00538"></a>00538     <span class="keywordflow">if</span> ( ex &lt; 0 )
<a name="l00539"></a>00539       ex = -1;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     <span class="comment">/* are we moving to a different cell ? */</span>
<a name="l00542"></a>00542     <span class="keywordflow">if</span> ( ex != ras.<a class="code" href="struct_t_worker__.html#a264dfa510cdffa4511132c2cab2d4204">ex</a> || ey != ras.<a class="code" href="struct_t_worker__.html#a9a20ecec5a49a4591ad83f797e85ad8d">ey</a> )
<a name="l00543"></a>00543     {
<a name="l00544"></a>00544       <span class="comment">/* record the current one if it is valid */</span>
<a name="l00545"></a>00545       <span class="keywordflow">if</span> ( !ras.<a class="code" href="struct_t_worker__.html#acbf1d08171d29ce1f71651171323c321">invalid</a> )
<a name="l00546"></a>00546         gray_record_cell( <a class="code" href="ftgrays_8c.html#a71d83a981d5845ee2392a85c2369311a">RAS_VAR</a> );
<a name="l00547"></a>00547 
<a name="l00548"></a>00548       ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>  = 0;
<a name="l00549"></a>00549       ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a> = 0;
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     ras.<a class="code" href="struct_t_worker__.html#a264dfa510cdffa4511132c2cab2d4204">ex</a>      = ex;
<a name="l00553"></a>00553     ras.<a class="code" href="struct_t_worker__.html#a9a20ecec5a49a4591ad83f797e85ad8d">ey</a>      = ey;
<a name="l00554"></a>00554     ras.<a class="code" href="struct_t_worker__.html#acbf1d08171d29ce1f71651171323c321">invalid</a> = ( (unsigned)ey &gt;= (<span class="keywordtype">unsigned</span>)ras.<a class="code" href="struct_t_worker__.html#a56f5fc2f91c85196c24ebec1e48c0322">count_ey</a> ||
<a name="l00555"></a>00555                               ex &gt;= ras.<a class="code" href="struct_t_worker__.html#afdf6647ea98e47e0adb9948c2d16f03c">count_ex</a>           );
<a name="l00556"></a>00556   }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   <span class="comment">/*************************************************************************/</span>
<a name="l00560"></a>00560   <span class="comment">/*                                                                       */</span>
<a name="l00561"></a>00561   <span class="comment">/* Start a new contour at a given cell.                                  */</span>
<a name="l00562"></a>00562   <span class="comment">/*                                                                       */</span>
<a name="l00563"></a>00563   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00564"></a>00564   gray_start_cell( <a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">RAS_ARG_</a> <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  ex,
<a name="l00565"></a>00565                             <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  ey )
<a name="l00566"></a>00566   {
<a name="l00567"></a>00567     <span class="keywordflow">if</span> ( ex &gt; ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> )
<a name="l00568"></a>00568       ex = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> );
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="keywordflow">if</span> ( ex &lt; ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> )
<a name="l00571"></a>00571       ex = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> - 1 );
<a name="l00572"></a>00572 
<a name="l00573"></a>00573     ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>    = 0;
<a name="l00574"></a>00574     ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a>   = 0;
<a name="l00575"></a>00575     ras.<a class="code" href="struct_t_worker__.html#a264dfa510cdffa4511132c2cab2d4204">ex</a>      = ex - ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a>;
<a name="l00576"></a>00576     ras.<a class="code" href="struct_t_worker__.html#a9a20ecec5a49a4591ad83f797e85ad8d">ey</a>      = ey - ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a>;
<a name="l00577"></a>00577     ras.<a class="code" href="struct_t_worker__.html#a6bdaa6192fac756a7a3bf8556474893e">last_ey</a> = <a class="code" href="ftgrays_8c.html#ad063c772cf2b01dffd373c556829559a">SUBPIXELS</a>( ey );
<a name="l00578"></a>00578     ras.<a class="code" href="struct_t_worker__.html#acbf1d08171d29ce1f71651171323c321">invalid</a> = 0;
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     gray_set_cell( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ex, ey );
<a name="l00581"></a>00581   }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 
<a name="l00584"></a>00584   <span class="comment">/*************************************************************************/</span>
<a name="l00585"></a>00585   <span class="comment">/*                                                                       */</span>
<a name="l00586"></a>00586   <span class="comment">/* Render a scanline as one or more cells.                               */</span>
<a name="l00587"></a>00587   <span class="comment">/*                                                                       */</span>
<a name="l00588"></a>00588   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00589"></a>00589   gray_render_scanline( <a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">RAS_ARG_</a> <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  ey,
<a name="l00590"></a>00590                                  <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    x1,
<a name="l00591"></a>00591                                  <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  y1,
<a name="l00592"></a>00592                                  <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    x2,
<a name="l00593"></a>00593                                  <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  y2 )
<a name="l00594"></a>00594   {
<a name="l00595"></a>00595     <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  ex1, ex2, fx1, fx2, delta, mod, lift, rem;
<a name="l00596"></a>00596     <span class="keywordtype">long</span>    p, first, dx;
<a name="l00597"></a>00597     <span class="keywordtype">int</span>     incr;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     dx = x2 - x1;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     ex1 = <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( x1 );
<a name="l00603"></a>00603     ex2 = <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( x2 );
<a name="l00604"></a>00604     fx1 = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( x1 - <a class="code" href="ftgrays_8c.html#ad063c772cf2b01dffd373c556829559a">SUBPIXELS</a>( ex1 ) );
<a name="l00605"></a>00605     fx2 = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( x2 - <a class="code" href="ftgrays_8c.html#ad063c772cf2b01dffd373c556829559a">SUBPIXELS</a>( ex2 ) );
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="comment">/* trivial case.  Happens often */</span>
<a name="l00608"></a>00608     <span class="keywordflow">if</span> ( y1 == y2 )
<a name="l00609"></a>00609     {
<a name="l00610"></a>00610       gray_set_cell( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ex2, ey );
<a name="l00611"></a>00611       <span class="keywordflow">return</span>;
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="comment">/* everything is located in a single cell.  That is easy! */</span>
<a name="l00615"></a>00615     <span class="comment">/*                                                        */</span>
<a name="l00616"></a>00616     <span class="keywordflow">if</span> ( ex1 == ex2 )
<a name="l00617"></a>00617     {
<a name="l00618"></a>00618       delta      = y2 - y1;
<a name="l00619"></a>00619       ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>  += (<a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>)(( fx1 + fx2 ) * delta);
<a name="l00620"></a>00620       ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a> += delta;
<a name="l00621"></a>00621       <span class="keywordflow">return</span>;
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     <span class="comment">/* ok, we&#39;ll have to render a run of adjacent cells on the same */</span>
<a name="l00625"></a>00625     <span class="comment">/* scanline...                                                  */</span>
<a name="l00626"></a>00626     <span class="comment">/*                                                              */</span>
<a name="l00627"></a>00627     p     = ( <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> - fx1 ) * ( y2 - y1 );
<a name="l00628"></a>00628     first = <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a>;
<a name="l00629"></a>00629     incr  = 1;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="keywordflow">if</span> ( dx &lt; 0 )
<a name="l00632"></a>00632     {
<a name="l00633"></a>00633       p     = fx1 * ( y2 - y1 );
<a name="l00634"></a>00634       first = 0;
<a name="l00635"></a>00635       incr  = -1;
<a name="l00636"></a>00636       dx    = -dx;
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     delta = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( p / dx );
<a name="l00640"></a>00640     mod   = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( p % dx );
<a name="l00641"></a>00641     <span class="keywordflow">if</span> ( mod &lt; 0 )
<a name="l00642"></a>00642     {
<a name="l00643"></a>00643       delta--;
<a name="l00644"></a>00644       mod += (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)dx;
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>  += (<a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>)(( fx1 + first ) * delta);
<a name="l00648"></a>00648     ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a> += delta;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     ex1 += incr;
<a name="l00651"></a>00651     gray_set_cell( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ex1, ey );
<a name="l00652"></a>00652     y1  += delta;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     <span class="keywordflow">if</span> ( ex1 != ex2 )
<a name="l00655"></a>00655     {
<a name="l00656"></a>00656       p    = <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> * ( y2 - y1 + delta );
<a name="l00657"></a>00657       lift = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( p / dx );
<a name="l00658"></a>00658       rem  = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( p % dx );
<a name="l00659"></a>00659       <span class="keywordflow">if</span> ( rem &lt; 0 )
<a name="l00660"></a>00660       {
<a name="l00661"></a>00661         lift--;
<a name="l00662"></a>00662         rem += (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)dx;
<a name="l00663"></a>00663       }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665       mod -= (int)dx;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667       <span class="keywordflow">while</span> ( ex1 != ex2 )
<a name="l00668"></a>00668       {
<a name="l00669"></a>00669         delta = lift;
<a name="l00670"></a>00670         mod  += rem;
<a name="l00671"></a>00671         <span class="keywordflow">if</span> ( mod &gt;= 0 )
<a name="l00672"></a>00672         {
<a name="l00673"></a>00673           mod -= (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)dx;
<a name="l00674"></a>00674           delta++;
<a name="l00675"></a>00675         }
<a name="l00676"></a>00676 
<a name="l00677"></a>00677         ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>  += (<a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>)(<a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> * delta);
<a name="l00678"></a>00678         ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a> += delta;
<a name="l00679"></a>00679         y1        += delta;
<a name="l00680"></a>00680         ex1       += incr;
<a name="l00681"></a>00681         gray_set_cell( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ex1, ey );
<a name="l00682"></a>00682       }
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685     delta      = y2 - y1;
<a name="l00686"></a>00686     ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>  += (<a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>)(( fx2 + <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> - first ) * delta);
<a name="l00687"></a>00687     ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a> += delta;
<a name="l00688"></a>00688   }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690 
<a name="l00691"></a>00691   <span class="comment">/*************************************************************************/</span>
<a name="l00692"></a>00692   <span class="comment">/*                                                                       */</span>
<a name="l00693"></a>00693   <span class="comment">/* Render a given line as a series of scanlines.                         */</span>
<a name="l00694"></a>00694   <span class="comment">/*                                                                       */</span>
<a name="l00695"></a>00695   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00696"></a>00696   gray_render_line( <a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">RAS_ARG_</a> <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  to_x,
<a name="l00697"></a>00697                              <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  to_y )
<a name="l00698"></a>00698   {
<a name="l00699"></a>00699     <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  ey1, ey2, fy1, fy2, mod;
<a name="l00700"></a>00700     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    dx, dy, x, x2;
<a name="l00701"></a>00701     <span class="keywordtype">long</span>    p, first;
<a name="l00702"></a>00702     <span class="keywordtype">int</span>     delta, rem, lift, incr;
<a name="l00703"></a>00703 
<a name="l00704"></a>00704 
<a name="l00705"></a>00705     ey1 = <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( ras.<a class="code" href="struct_t_worker__.html#a6bdaa6192fac756a7a3bf8556474893e">last_ey</a> );
<a name="l00706"></a>00706     ey2 = <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( to_y );     <span class="comment">/* if (ey2 &gt;= ras.max_ey) ey2 = ras.max_ey-1; */</span>
<a name="l00707"></a>00707     fy1 = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a> - ras.<a class="code" href="struct_t_worker__.html#a6bdaa6192fac756a7a3bf8556474893e">last_ey</a> );
<a name="l00708"></a>00708     fy2 = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( to_y - <a class="code" href="ftgrays_8c.html#ad063c772cf2b01dffd373c556829559a">SUBPIXELS</a>( ey2 ) );
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     dx = to_x - ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a>;
<a name="l00711"></a>00711     dy = to_y - ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a>;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713     <span class="comment">/* XXX: we should do something about the trivial case where dx == 0, */</span>
<a name="l00714"></a>00714     <span class="comment">/*      as it happens very often!                                    */</span>
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="comment">/* perform vertical clipping */</span>
<a name="l00717"></a>00717     {
<a name="l00718"></a>00718       <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  <a class="code" href="al_main_8h.html#abb702d8b501669a23aa0ab3b281b9384">min</a>, <a class="code" href="al_main_8h.html#ac39d9cef6a5e030ba8d9e11121054268">max</a>;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720 
<a name="l00721"></a>00721       min = ey1;
<a name="l00722"></a>00722       max = ey2;
<a name="l00723"></a>00723       <span class="keywordflow">if</span> ( ey1 &gt; ey2 )
<a name="l00724"></a>00724       {
<a name="l00725"></a>00725         min = ey2;
<a name="l00726"></a>00726         max = ey1;
<a name="l00727"></a>00727       }
<a name="l00728"></a>00728       <span class="keywordflow">if</span> ( min &gt;= ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> || max &lt; ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> )
<a name="l00729"></a>00729         <span class="keywordflow">goto</span> End;
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     <span class="comment">/* everything is on a single scanline */</span>
<a name="l00733"></a>00733     <span class="keywordflow">if</span> ( ey1 == ey2 )
<a name="l00734"></a>00734     {
<a name="l00735"></a>00735       gray_render_scanline( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ey1, ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a>, fy1, to_x, fy2 );
<a name="l00736"></a>00736       <span class="keywordflow">goto</span> End;
<a name="l00737"></a>00737     }
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     <span class="comment">/* vertical line - avoid calling gray_render_scanline */</span>
<a name="l00740"></a>00740     incr = 1;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742     <span class="keywordflow">if</span> ( dx == 0 )
<a name="l00743"></a>00743     {
<a name="l00744"></a>00744       <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  ex     = <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> );
<a name="l00745"></a>00745       <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  two_fx = (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( ( ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> - <a class="code" href="ftgrays_8c.html#ad063c772cf2b01dffd373c556829559a">SUBPIXELS</a>( ex ) ) &lt;&lt; 1 );
<a name="l00746"></a>00746       <a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>   area;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 
<a name="l00749"></a>00749       first = <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a>;
<a name="l00750"></a>00750       <span class="keywordflow">if</span> ( dy &lt; 0 )
<a name="l00751"></a>00751       {
<a name="l00752"></a>00752         first = 0;
<a name="l00753"></a>00753         incr  = -1;
<a name="l00754"></a>00754       }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756       delta      = (int)( first - fy1 );
<a name="l00757"></a>00757       ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>  += (<a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>)two_fx * delta;
<a name="l00758"></a>00758       ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a> += delta;
<a name="l00759"></a>00759       ey1       += incr;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761       gray_set_cell( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ex, ey1 );
<a name="l00762"></a>00762 
<a name="l00763"></a>00763       delta = (int)( first + first - <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> );
<a name="l00764"></a>00764       area  = (<a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>)two_fx * delta;
<a name="l00765"></a>00765       <span class="keywordflow">while</span> ( ey1 != ey2 )
<a name="l00766"></a>00766       {
<a name="l00767"></a>00767         ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>  += area;
<a name="l00768"></a>00768         ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a> += delta;
<a name="l00769"></a>00769         ey1       += incr;
<a name="l00770"></a>00770 
<a name="l00771"></a>00771         gray_set_cell( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ex, ey1 );
<a name="l00772"></a>00772       }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774       delta      = (int)( fy2 - <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> + first );
<a name="l00775"></a>00775       ras.<a class="code" href="struct_t_worker__.html#a071fefe9f3cce335af82a5d71a6b9524">area</a>  += (<a class="code" href="ftgrays_8c.html#a426627dd9f50703df18f99d9849830bc">TArea</a>)two_fx * delta;
<a name="l00776"></a>00776       ras.<a class="code" href="struct_t_worker__.html#a2e69120210aa214cc73f9c78942ec478">cover</a> += delta;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778       <span class="keywordflow">goto</span> End;
<a name="l00779"></a>00779     }
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     <span class="comment">/* ok, we have to render several scanlines */</span>
<a name="l00782"></a>00782     p     = ( <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> - fy1 ) * dx;
<a name="l00783"></a>00783     first = <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a>;
<a name="l00784"></a>00784     incr  = 1;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786     <span class="keywordflow">if</span> ( dy &lt; 0 )
<a name="l00787"></a>00787     {
<a name="l00788"></a>00788       p     = fy1 * dx;
<a name="l00789"></a>00789       first = 0;
<a name="l00790"></a>00790       incr  = -1;
<a name="l00791"></a>00791       dy    = -dy;
<a name="l00792"></a>00792     }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794     delta = (int)( p / dy );
<a name="l00795"></a>00795     mod   = (int)( p % dy );
<a name="l00796"></a>00796     <span class="keywordflow">if</span> ( mod &lt; 0 )
<a name="l00797"></a>00797     {
<a name="l00798"></a>00798       delta--;
<a name="l00799"></a>00799       mod += (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)dy;
<a name="l00800"></a>00800     }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802     x = ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> + delta;
<a name="l00803"></a>00803     gray_render_scanline( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ey1, ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a>, fy1, x, (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)first );
<a name="l00804"></a>00804 
<a name="l00805"></a>00805     ey1 += incr;
<a name="l00806"></a>00806     gray_set_cell( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( x ), ey1 );
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <span class="keywordflow">if</span> ( ey1 != ey2 )
<a name="l00809"></a>00809     {
<a name="l00810"></a>00810       p     = <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> * dx;
<a name="l00811"></a>00811       lift  = (int)( p / dy );
<a name="l00812"></a>00812       rem   = (int)( p % dy );
<a name="l00813"></a>00813       <span class="keywordflow">if</span> ( rem &lt; 0 )
<a name="l00814"></a>00814       {
<a name="l00815"></a>00815         lift--;
<a name="l00816"></a>00816         rem += (int)dy;
<a name="l00817"></a>00817       }
<a name="l00818"></a>00818       mod -= (int)dy;
<a name="l00819"></a>00819 
<a name="l00820"></a>00820       <span class="keywordflow">while</span> ( ey1 != ey2 )
<a name="l00821"></a>00821       {
<a name="l00822"></a>00822         delta = lift;
<a name="l00823"></a>00823         mod  += rem;
<a name="l00824"></a>00824         <span class="keywordflow">if</span> ( mod &gt;= 0 )
<a name="l00825"></a>00825         {
<a name="l00826"></a>00826           mod -= (int)dy;
<a name="l00827"></a>00827           delta++;
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829 
<a name="l00830"></a>00830         x2 = x + delta;
<a name="l00831"></a>00831         gray_render_scanline( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ey1, x,
<a name="l00832"></a>00832                                        (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> - first ), x2,
<a name="l00833"></a>00833                                        (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)first );
<a name="l00834"></a>00834         x = x2;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836         ey1 += incr;
<a name="l00837"></a>00837         gray_set_cell( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( x ), ey1 );
<a name="l00838"></a>00838       }
<a name="l00839"></a>00839     }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841     gray_render_scanline( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> ey1, x,
<a name="l00842"></a>00842                                    (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)( <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> - first ), to_x,
<a name="l00843"></a>00843                                    fy2 );
<a name="l00844"></a>00844 
<a name="l00845"></a>00845   End:
<a name="l00846"></a>00846     ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a>       = to_x;
<a name="l00847"></a>00847     ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a>       = to_y;
<a name="l00848"></a>00848     ras.<a class="code" href="struct_t_worker__.html#a6bdaa6192fac756a7a3bf8556474893e">last_ey</a> = <a class="code" href="ftgrays_8c.html#ad063c772cf2b01dffd373c556829559a">SUBPIXELS</a>( ey2 );
<a name="l00849"></a>00849   }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851 
<a name="l00852"></a>00852   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00853"></a>00853   gray_split_conic( <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  base )
<a name="l00854"></a>00854   {
<a name="l00855"></a>00855     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  a, b;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857 
<a name="l00858"></a>00858     base[4].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = base[2].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l00859"></a>00859     b = base[1].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l00860"></a>00860     a = base[3].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = ( base[2].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> + b ) / 2;
<a name="l00861"></a>00861     b = base[1].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = ( base[0].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> + b ) / 2;
<a name="l00862"></a>00862     base[2].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = ( a + b ) / 2;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     base[4].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = base[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00865"></a>00865     b = base[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00866"></a>00866     a = base[3].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = ( base[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> + b ) / 2;
<a name="l00867"></a>00867     b = base[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = ( base[0].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> + b ) / 2;
<a name="l00868"></a>00868     base[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = ( a + b ) / 2;
<a name="l00869"></a>00869   }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 
<a name="l00872"></a>00872   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00873"></a>00873   gray_render_conic( <a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">RAS_ARG_</a> <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  control,
<a name="l00874"></a>00874                               <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  to )
<a name="l00875"></a>00875   {
<a name="l00876"></a>00876     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>        dx, dy;
<a name="l00877"></a>00877     <span class="keywordtype">int</span>         top, level;
<a name="l00878"></a>00878     <span class="keywordtype">int</span>*        levels;
<a name="l00879"></a>00879     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  arc;
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 
<a name="l00882"></a>00882     dx = <a class="code" href="ftgrays_8c.html#a8da23e0751f5a82c45414bbd2389d326">DOWNSCALE</a>( ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> ) + to-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> - ( control-&gt;x &lt;&lt; 1 );
<a name="l00883"></a>00883     <span class="keywordflow">if</span> ( dx &lt; 0 )
<a name="l00884"></a>00884       dx = -dx;
<a name="l00885"></a>00885     dy = <a class="code" href="ftgrays_8c.html#a8da23e0751f5a82c45414bbd2389d326">DOWNSCALE</a>( ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a> ) + to-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> - ( control-&gt;y &lt;&lt; 1 );
<a name="l00886"></a>00886     <span class="keywordflow">if</span> ( dy &lt; 0 )
<a name="l00887"></a>00887       dy = -dy;
<a name="l00888"></a>00888     <span class="keywordflow">if</span> ( dx &lt; dy )
<a name="l00889"></a>00889       dx = dy;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891     level = 1;
<a name="l00892"></a>00892     dx = dx / ras.<a class="code" href="struct_t_worker__.html#aeedfb86fae2d26779aae3b04e767c44f">conic_level</a>;
<a name="l00893"></a>00893     <span class="keywordflow">while</span> ( dx &gt; 0 )
<a name="l00894"></a>00894     {
<a name="l00895"></a>00895       dx &gt;&gt;= 2;
<a name="l00896"></a>00896       level++;
<a name="l00897"></a>00897     }
<a name="l00898"></a>00898 
<a name="l00899"></a>00899     <span class="comment">/* a shortcut to speed things up */</span>
<a name="l00900"></a>00900     <span class="keywordflow">if</span> ( level &lt;= 1 )
<a name="l00901"></a>00901     {
<a name="l00902"></a>00902       <span class="comment">/* we compute the mid-point directly in order to avoid */</span>
<a name="l00903"></a>00903       <span class="comment">/* calling gray_split_conic()                          */</span>
<a name="l00904"></a>00904       <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  to_x, to_y, mid_x, mid_y;
<a name="l00905"></a>00905 
<a name="l00906"></a>00906 
<a name="l00907"></a>00907       to_x  = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l00908"></a>00908       to_y  = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l00909"></a>00909       mid_x = ( ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> + to_x + 2 * <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control-&gt;x ) ) / 4;
<a name="l00910"></a>00910       mid_y = ( ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a> + to_y + 2 * <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control-&gt;y ) ) / 4;
<a name="l00911"></a>00911 
<a name="l00912"></a>00912       gray_render_line( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> mid_x, mid_y );
<a name="l00913"></a>00913       gray_render_line( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> to_x, to_y );
<a name="l00914"></a>00914 
<a name="l00915"></a>00915       <span class="keywordflow">return</span>;
<a name="l00916"></a>00916     }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     arc       = ras.<a class="code" href="struct_t_worker__.html#a1d2860e47c0b917d4ed9596cb7cf9484">bez_stack</a>;
<a name="l00919"></a>00919     levels    = ras.<a class="code" href="struct_t_worker__.html#af10c5bacba83e3abf8234a9e4b4cb792">lev_stack</a>;
<a name="l00920"></a>00920     top       = 0;
<a name="l00921"></a>00921     levels[0] = level;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     arc[0].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l00924"></a>00924     arc[0].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l00925"></a>00925     arc[1].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control-&gt;x );
<a name="l00926"></a>00926     arc[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control-&gt;y );
<a name="l00927"></a>00927     arc[2].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a>;
<a name="l00928"></a>00928     arc[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a>;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930     <span class="keywordflow">while</span> ( top &gt;= 0 )
<a name="l00931"></a>00931     {
<a name="l00932"></a>00932       level = levels[top];
<a name="l00933"></a>00933       <span class="keywordflow">if</span> ( level &gt; 1 )
<a name="l00934"></a>00934       {
<a name="l00935"></a>00935         <span class="comment">/* check that the arc crosses the current band */</span>
<a name="l00936"></a>00936         <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  <a class="code" href="al_main_8h.html#abb702d8b501669a23aa0ab3b281b9384">min</a>, <a class="code" href="al_main_8h.html#ac39d9cef6a5e030ba8d9e11121054268">max</a>, y;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 
<a name="l00939"></a>00939         min = max = arc[0].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941         y = arc[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00942"></a>00942         <span class="keywordflow">if</span> ( y &lt; min ) min = y;
<a name="l00943"></a>00943         <span class="keywordflow">if</span> ( y &gt; max ) max = y;
<a name="l00944"></a>00944 
<a name="l00945"></a>00945         y = arc[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00946"></a>00946         <span class="keywordflow">if</span> ( y &lt; min ) min = y;
<a name="l00947"></a>00947         <span class="keywordflow">if</span> ( y &gt; max ) max = y;
<a name="l00948"></a>00948 
<a name="l00949"></a>00949         <span class="keywordflow">if</span> ( <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( min ) &gt;= ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> || <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( max ) &lt; ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> )
<a name="l00950"></a>00950           <span class="keywordflow">goto</span> Draw;
<a name="l00951"></a>00951 
<a name="l00952"></a>00952         gray_split_conic( arc );
<a name="l00953"></a>00953         arc += 2;
<a name="l00954"></a>00954         top++;
<a name="l00955"></a>00955         levels[top] = levels[top - 1] = level - 1;
<a name="l00956"></a>00956         <span class="keywordflow">continue</span>;
<a name="l00957"></a>00957       }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959     Draw:
<a name="l00960"></a>00960       {
<a name="l00961"></a>00961         <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  to_x, to_y, mid_x, mid_y;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 
<a name="l00964"></a>00964         to_x  = arc[0].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l00965"></a>00965         to_y  = arc[0].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00966"></a>00966         mid_x = ( ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> + to_x + 2 * arc[1].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> ) / 4;
<a name="l00967"></a>00967         mid_y = ( ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a> + to_y + 2 * arc[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> ) / 4;
<a name="l00968"></a>00968 
<a name="l00969"></a>00969         gray_render_line( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> mid_x, mid_y );
<a name="l00970"></a>00970         gray_render_line( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> to_x, to_y );
<a name="l00971"></a>00971 
<a name="l00972"></a>00972         top--;
<a name="l00973"></a>00973         arc -= 2;
<a name="l00974"></a>00974       }
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="keywordflow">return</span>;
<a name="l00978"></a>00978   }
<a name="l00979"></a>00979 
<a name="l00980"></a>00980 
<a name="l00981"></a>00981   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00982"></a>00982   gray_split_cubic( <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  base )
<a name="l00983"></a>00983   {
<a name="l00984"></a>00984     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  a, b, c, d;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 
<a name="l00987"></a>00987     base[6].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = base[3].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l00988"></a>00988     c = base[1].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l00989"></a>00989     d = base[2].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l00990"></a>00990     base[1].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = a = ( base[0].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> + c ) / 2;
<a name="l00991"></a>00991     base[5].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = b = ( base[3].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> + d ) / 2;
<a name="l00992"></a>00992     c = ( c + d ) / 2;
<a name="l00993"></a>00993     base[2].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = a = ( a + c ) / 2;
<a name="l00994"></a>00994     base[4].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = b = ( b + c ) / 2;
<a name="l00995"></a>00995     base[3].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = ( a + b ) / 2;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997     base[6].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = base[3].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00998"></a>00998     c = base[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l00999"></a>00999     d = base[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01000"></a>01000     base[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = a = ( base[0].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> + c ) / 2;
<a name="l01001"></a>01001     base[5].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = b = ( base[3].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> + d ) / 2;
<a name="l01002"></a>01002     c = ( c + d ) / 2;
<a name="l01003"></a>01003     base[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = a = ( a + c ) / 2;
<a name="l01004"></a>01004     base[4].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = b = ( b + c ) / 2;
<a name="l01005"></a>01005     base[3].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = ( a + b ) / 2;
<a name="l01006"></a>01006   }
<a name="l01007"></a>01007 
<a name="l01008"></a>01008 
<a name="l01009"></a>01009   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01010"></a>01010   gray_render_cubic( <a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">RAS_ARG_</a> <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  control1,
<a name="l01011"></a>01011                               <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  control2,
<a name="l01012"></a>01012                               <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  to )
<a name="l01013"></a>01013   {
<a name="l01014"></a>01014     <span class="keywordtype">int</span>         top, level;
<a name="l01015"></a>01015     <span class="keywordtype">int</span>*        levels;
<a name="l01016"></a>01016     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  arc;
<a name="l01017"></a>01017     <span class="keywordtype">int</span>         mid_x = ( <a class="code" href="ftgrays_8c.html#a8da23e0751f5a82c45414bbd2389d326">DOWNSCALE</a>( ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> ) + to-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> +
<a name="l01018"></a>01018                           3 * (control1-&gt;x + control2-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> ) ) / 8;
<a name="l01019"></a>01019     <span class="keywordtype">int</span>         mid_y = ( <a class="code" href="ftgrays_8c.html#a8da23e0751f5a82c45414bbd2389d326">DOWNSCALE</a>( ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a> ) + to-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> +
<a name="l01020"></a>01020                           3 * (control1-&gt;y + control2-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> ) ) / 8;
<a name="l01021"></a>01021     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>        dx = <a class="code" href="ftgrays_8c.html#a8da23e0751f5a82c45414bbd2389d326">DOWNSCALE</a>( ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> ) + to-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> - ( mid_x &lt;&lt; 1 );
<a name="l01022"></a>01022     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>        dy = <a class="code" href="ftgrays_8c.html#a8da23e0751f5a82c45414bbd2389d326">DOWNSCALE</a>( ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a> ) + to-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> - ( mid_y &lt;&lt; 1 );
<a name="l01023"></a>01023 
<a name="l01024"></a>01024 
<a name="l01025"></a>01025     <span class="keywordflow">if</span> ( dx &lt; 0 )
<a name="l01026"></a>01026       dx = -dx;
<a name="l01027"></a>01027     <span class="keywordflow">if</span> ( dy &lt; 0 )
<a name="l01028"></a>01028       dy = -dy;
<a name="l01029"></a>01029     <span class="keywordflow">if</span> ( dx &lt; dy )
<a name="l01030"></a>01030       dx = dy;
<a name="l01031"></a>01031 
<a name="l01032"></a>01032     level = 1;
<a name="l01033"></a>01033     dx /= ras.<a class="code" href="struct_t_worker__.html#ace9a8b37b9118308ec5c74c2716ae228">cubic_level</a>;
<a name="l01034"></a>01034     <span class="keywordflow">while</span> ( dx &gt; 0 )
<a name="l01035"></a>01035     {
<a name="l01036"></a>01036       dx &gt;&gt;= 2;
<a name="l01037"></a>01037       level++;
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039 
<a name="l01040"></a>01040     <span class="keywordflow">if</span> ( level &lt;= 1 )
<a name="l01041"></a>01041     {
<a name="l01042"></a>01042       <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  to_x, to_y;
<a name="l01043"></a>01043 
<a name="l01044"></a>01044 
<a name="l01045"></a>01045       to_x  = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01046"></a>01046       to_y  = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01047"></a>01047 
<a name="l01048"></a>01048       <span class="comment">/* Recalculation of midpoint is needed only if */</span>
<a name="l01049"></a>01049       <span class="comment">/* UPSCALE and DOWNSCALE have any effect.      */</span>
<a name="l01050"></a>01050 
<a name="l01051"></a>01051 <span class="preprocessor">#if ( PIXEL_BITS != 6 )</span>
<a name="l01052"></a>01052 <span class="preprocessor"></span>      mid_x = ( ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> + to_x +
<a name="l01053"></a>01053                 3 * <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control1-&gt;x + control2-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> ) ) / 8;
<a name="l01054"></a>01054       mid_y = ( ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a> + to_y +
<a name="l01055"></a>01055                 3 * <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control1-&gt;y + control2-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> ) ) / 8;
<a name="l01056"></a>01056 <span class="preprocessor">#endif</span>
<a name="l01057"></a>01057 <span class="preprocessor"></span>
<a name="l01058"></a>01058       gray_render_line( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> mid_x, mid_y );
<a name="l01059"></a>01059       gray_render_line( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> to_x, to_y );
<a name="l01060"></a>01060 
<a name="l01061"></a>01061       <span class="keywordflow">return</span>;
<a name="l01062"></a>01062     }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064     arc      = ras.<a class="code" href="struct_t_worker__.html#a1d2860e47c0b917d4ed9596cb7cf9484">bez_stack</a>;
<a name="l01065"></a>01065     arc[0].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01066"></a>01066     arc[0].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01067"></a>01067     arc[1].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control2-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01068"></a>01068     arc[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control2-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01069"></a>01069     arc[2].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control1-&gt;x );
<a name="l01070"></a>01070     arc[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( control1-&gt;y );
<a name="l01071"></a>01071     arc[3].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a>;
<a name="l01072"></a>01072     arc[3].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a>;
<a name="l01073"></a>01073 
<a name="l01074"></a>01074     levels    = ras.<a class="code" href="struct_t_worker__.html#af10c5bacba83e3abf8234a9e4b4cb792">lev_stack</a>;
<a name="l01075"></a>01075     top       = 0;
<a name="l01076"></a>01076     levels[0] = level;
<a name="l01077"></a>01077 
<a name="l01078"></a>01078     <span class="keywordflow">while</span> ( top &gt;= 0 )
<a name="l01079"></a>01079     {
<a name="l01080"></a>01080       level = levels[top];
<a name="l01081"></a>01081       <span class="keywordflow">if</span> ( level &gt; 1 )
<a name="l01082"></a>01082       {
<a name="l01083"></a>01083         <span class="comment">/* check that the arc crosses the current band */</span>
<a name="l01084"></a>01084         <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  <a class="code" href="al_main_8h.html#abb702d8b501669a23aa0ab3b281b9384">min</a>, <a class="code" href="al_main_8h.html#ac39d9cef6a5e030ba8d9e11121054268">max</a>, y;
<a name="l01085"></a>01085 
<a name="l01086"></a>01086 
<a name="l01087"></a>01087         min = max = arc[0].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01088"></a>01088         y = arc[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01089"></a>01089         <span class="keywordflow">if</span> ( y &lt; min ) min = y;
<a name="l01090"></a>01090         <span class="keywordflow">if</span> ( y &gt; max ) max = y;
<a name="l01091"></a>01091         y = arc[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01092"></a>01092         <span class="keywordflow">if</span> ( y &lt; min ) min = y;
<a name="l01093"></a>01093         <span class="keywordflow">if</span> ( y &gt; max ) max = y;
<a name="l01094"></a>01094         y = arc[3].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01095"></a>01095         <span class="keywordflow">if</span> ( y &lt; min ) min = y;
<a name="l01096"></a>01096         <span class="keywordflow">if</span> ( y &gt; max ) max = y;
<a name="l01097"></a>01097         <span class="keywordflow">if</span> ( <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( min ) &gt;= ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> || <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( max ) &lt; 0 )
<a name="l01098"></a>01098           <span class="keywordflow">goto</span> Draw;
<a name="l01099"></a>01099         gray_split_cubic( arc );
<a name="l01100"></a>01100         arc += 3;
<a name="l01101"></a>01101         top ++;
<a name="l01102"></a>01102         levels[top] = levels[top - 1] = level - 1;
<a name="l01103"></a>01103         <span class="keywordflow">continue</span>;
<a name="l01104"></a>01104       }
<a name="l01105"></a>01105 
<a name="l01106"></a>01106     Draw:
<a name="l01107"></a>01107       {
<a name="l01108"></a>01108         <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  to_x, to_y;
<a name="l01109"></a>01109 
<a name="l01110"></a>01110 
<a name="l01111"></a>01111         to_x  = arc[0].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l01112"></a>01112         to_y  = arc[0].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01113"></a>01113         mid_x = ( ras.<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> + to_x + 3 * ( arc[1].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> + arc[2].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> ) ) / 8;
<a name="l01114"></a>01114         mid_y = ( ras.<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a> + to_y + 3 * ( arc[1].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> + arc[2].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> ) ) / 8;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116         gray_render_line( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> mid_x, mid_y );
<a name="l01117"></a>01117         gray_render_line( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> to_x, to_y );
<a name="l01118"></a>01118         top --;
<a name="l01119"></a>01119         arc -= 3;
<a name="l01120"></a>01120       }
<a name="l01121"></a>01121     }
<a name="l01122"></a>01122 
<a name="l01123"></a>01123     <span class="keywordflow">return</span>;
<a name="l01124"></a>01124   }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 
<a name="l01128"></a>01128   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01129"></a>01129   gray_move_to( <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  to,
<a name="l01130"></a>01130                 PWorker           worker )
<a name="l01131"></a>01131   {
<a name="l01132"></a>01132     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  x, y;
<a name="l01133"></a>01133 
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <span class="comment">/* record current cell, if any */</span>
<a name="l01136"></a>01136     gray_record_cell( <a class="code" href="ftgrays_8c.html#a71d83a981d5845ee2392a85c2369311a">RAS_VAR</a> );
<a name="l01137"></a>01137 
<a name="l01138"></a>01138     <span class="comment">/* start to a new position */</span>
<a name="l01139"></a>01139     x = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01140"></a>01140     y = <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     gray_start_cell( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( x ), <a class="code" href="ftgrays_8c.html#a2f76c7f0d1d2b7f4abfbcbe4013be53f">TRUNC</a>( y ) );
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     worker-&gt;<a class="code" href="struct_t_worker__.html#a88ef84d434087340d5109efdbba146e5">x</a> = x;
<a name="l01145"></a>01145     worker-&gt;<a class="code" href="struct_t_worker__.html#ab6948dda8bb627efb48a037e6b87e159">y</a> = y;
<a name="l01146"></a>01146     <span class="keywordflow">return</span> 0;
<a name="l01147"></a>01147   }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149 
<a name="l01150"></a>01150   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01151"></a>01151   gray_line_to( <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  to,
<a name="l01152"></a>01152                 PWorker           worker )
<a name="l01153"></a>01153   {
<a name="l01154"></a>01154     gray_render_line( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> ), <a class="code" href="ftgrays_8c.html#a1bf10b64962f047ca5cd3297effce5c8">UPSCALE</a>( to-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> ) );
<a name="l01155"></a>01155     <span class="keywordflow">return</span> 0;
<a name="l01156"></a>01156   }
<a name="l01157"></a>01157 
<a name="l01158"></a>01158 
<a name="l01159"></a>01159   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01160"></a>01160   gray_conic_to( <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  control,
<a name="l01161"></a>01161                  <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  to,
<a name="l01162"></a>01162                  PWorker           worker )
<a name="l01163"></a>01163   {
<a name="l01164"></a>01164     gray_render_conic( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> control, to );
<a name="l01165"></a>01165     <span class="keywordflow">return</span> 0;
<a name="l01166"></a>01166   }
<a name="l01167"></a>01167 
<a name="l01168"></a>01168 
<a name="l01169"></a>01169   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01170"></a>01170   gray_cubic_to( <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  control1,
<a name="l01171"></a>01171                  <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  control2,
<a name="l01172"></a>01172                  <span class="keyword">const</span> <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  to,
<a name="l01173"></a>01173                  PWorker           worker )
<a name="l01174"></a>01174   {
<a name="l01175"></a>01175     gray_render_cubic( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> control1, control2, to );
<a name="l01176"></a>01176     <span class="keywordflow">return</span> 0;
<a name="l01177"></a>01177   }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 
<a name="l01180"></a>01180   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01181"></a>01181   gray_render_span( <span class="keywordtype">int</span>             y,
<a name="l01182"></a>01182                     <span class="keywordtype">int</span>             count,
<a name="l01183"></a>01183                     <span class="keyword">const</span> <a class="code" href="struct_f_t___span__.html">FT_Span</a>*  spans,
<a name="l01184"></a>01184                     PWorker         worker )
<a name="l01185"></a>01185   {
<a name="l01186"></a>01186     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*  p;
<a name="l01187"></a>01187     <a class="code" href="struct_f_t___bitmap__.html">FT_Bitmap</a>*      map = &amp;worker-&gt;<a class="code" href="struct_t_worker__.html#a7bc261f8cce875cf8c78aad7386e8884">target</a>;
<a name="l01188"></a>01188 
<a name="l01189"></a>01189 
<a name="l01190"></a>01190     <span class="comment">/* first of all, compute the scanline offset */</span>
<a name="l01191"></a>01191     p = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)map-&gt;<a class="code" href="struct_f_t___bitmap__.html#a76439b1d3c13b81ca506108cd1623284">buffer</a> - y * map-&gt;<a class="code" href="struct_f_t___bitmap__.html#afdee595846e1188c7a76d0cec9d85cf2">pitch</a>;
<a name="l01192"></a>01192     if ( map-&gt;<a class="code" href="struct_f_t___bitmap__.html#afdee595846e1188c7a76d0cec9d85cf2">pitch</a> &gt;= 0 )
<a name="l01193"></a>01193       p += (unsigned)( ( map-&gt;<a class="code" href="struct_f_t___bitmap__.html#a1b6bb20b30fe087e3fc87a0eb37730c0">rows</a> - 1 ) * map-&gt;<a class="code" href="struct_f_t___bitmap__.html#afdee595846e1188c7a76d0cec9d85cf2">pitch</a> );
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="keywordflow">for</span> ( ; count &gt; 0; count--, spans++ )
<a name="l01196"></a>01196     {
<a name="l01197"></a>01197       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  coverage = spans-&gt;<a class="code" href="struct_f_t___span__.html#a70f9c9e0e8d3f0b38adee03a508ae214">coverage</a>;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199 
<a name="l01200"></a>01200       <span class="keywordflow">if</span> ( coverage )
<a name="l01201"></a>01201       {
<a name="l01202"></a>01202         <span class="comment">/* For small-spans it is faster to do it by ourselves than</span>
<a name="l01203"></a>01203 <span class="comment">         * calling `memset&#39;.  This is mainly due to the cost of the</span>
<a name="l01204"></a>01204 <span class="comment">         * function call.</span>
<a name="l01205"></a>01205 <span class="comment">         */</span>
<a name="l01206"></a>01206         <span class="keywordflow">if</span> ( spans-&gt;<a class="code" href="struct_f_t___span__.html#a939c84317f25a97d0ba01704591a4d38">len</a> &gt;= 8 )
<a name="l01207"></a>01207           <a class="code" href="ftgrays_8c.html#a6475871875685d4e791a1d0f3780744e">FT_MEM_SET</a>( p + spans-&gt;<a class="code" href="struct_f_t___span__.html#a7f7235a404c66398b49c50fa09691ba5">x</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)coverage, spans-&gt;<a class="code" href="struct_f_t___span__.html#a939c84317f25a97d0ba01704591a4d38">len</a> );
<a name="l01208"></a>01208         <span class="keywordflow">else</span>
<a name="l01209"></a>01209         {
<a name="l01210"></a>01210           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*  q = p + spans-&gt;<a class="code" href="struct_f_t___span__.html#a7f7235a404c66398b49c50fa09691ba5">x</a>;
<a name="l01211"></a>01211 
<a name="l01212"></a>01212 
<a name="l01213"></a>01213           <span class="keywordflow">switch</span> ( spans-&gt;<a class="code" href="struct_f_t___span__.html#a939c84317f25a97d0ba01704591a4d38">len</a> )
<a name="l01214"></a>01214           {
<a name="l01215"></a>01215           <span class="keywordflow">case</span> 7: *q++ = (<span class="keywordtype">unsigned</span> char)coverage;
<a name="l01216"></a>01216           <span class="keywordflow">case</span> 6: *q++ = (<span class="keywordtype">unsigned</span> char)coverage;
<a name="l01217"></a>01217           <span class="keywordflow">case</span> 5: *q++ = (<span class="keywordtype">unsigned</span> char)coverage;
<a name="l01218"></a>01218           <span class="keywordflow">case</span> 4: *q++ = (<span class="keywordtype">unsigned</span> char)coverage;
<a name="l01219"></a>01219           <span class="keywordflow">case</span> 3: *q++ = (<span class="keywordtype">unsigned</span> char)coverage;
<a name="l01220"></a>01220           <span class="keywordflow">case</span> 2: *q++ = (<span class="keywordtype">unsigned</span> char)coverage;
<a name="l01221"></a>01221           <span class="keywordflow">case</span> 1: *q   = (<span class="keywordtype">unsigned</span> char)coverage;
<a name="l01222"></a>01222           <span class="keywordflow">default</span>:
<a name="l01223"></a>01223             ;
<a name="l01224"></a>01224           }
<a name="l01225"></a>01225         }
<a name="l01226"></a>01226       }
<a name="l01227"></a>01227     }
<a name="l01228"></a>01228   }
<a name="l01229"></a>01229 
<a name="l01230"></a>01230 
<a name="l01231"></a>01231   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01232"></a>01232   gray_hline( <a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">RAS_ARG_</a> <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  x,
<a name="l01233"></a>01233                        <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  y,
<a name="l01234"></a>01234                        <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>    area,
<a name="l01235"></a>01235                        <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  acount )
<a name="l01236"></a>01236   {
<a name="l01237"></a>01237     <a class="code" href="struct_f_t___span__.html">FT_Span</a>*  span;
<a name="l01238"></a>01238     <span class="keywordtype">int</span>       count;
<a name="l01239"></a>01239     <span class="keywordtype">int</span>       coverage;
<a name="l01240"></a>01240 
<a name="l01241"></a>01241 
<a name="l01242"></a>01242     <span class="comment">/* compute the coverage line&#39;s coverage, depending on the    */</span>
<a name="l01243"></a>01243     <span class="comment">/* outline fill rule                                         */</span>
<a name="l01244"></a>01244     <span class="comment">/*                                                           */</span>
<a name="l01245"></a>01245     <span class="comment">/* the coverage percentage is area/(PIXEL_BITS*PIXEL_BITS*2) */</span>
<a name="l01246"></a>01246     <span class="comment">/*                                                           */</span>
<a name="l01247"></a>01247     coverage = (int)( area &gt;&gt; ( <a class="code" href="ftgrays_8c.html#a8059c4d10c45379712a990807796c73e">PIXEL_BITS</a> * 2 + 1 - 8 ) );
<a name="l01248"></a>01248                                                     <span class="comment">/* use range 0..256 */</span>
<a name="l01249"></a>01249     <span class="keywordflow">if</span> ( coverage &lt; 0 )
<a name="l01250"></a>01250       coverage = -coverage;
<a name="l01251"></a>01251 
<a name="l01252"></a>01252     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a943f8085950441ac728a25bc49327601">outline</a>.<a class="code" href="struct_f_t___outline__.html#a149765f0be0eab4fc82410cf853964bf">flags</a> &amp; <a class="code" href="ftimage_8h.html#a4efa7b75e501ea7e8f299649336a201d">FT_OUTLINE_EVEN_ODD_FILL</a> )
<a name="l01253"></a>01253     {
<a name="l01254"></a>01254       coverage &amp;= 511;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256       <span class="keywordflow">if</span> ( coverage &gt; 256 )
<a name="l01257"></a>01257         coverage = 512 - coverage;
<a name="l01258"></a>01258       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( coverage == 256 )
<a name="l01259"></a>01259         coverage = 255;
<a name="l01260"></a>01260     }
<a name="l01261"></a>01261     <span class="keywordflow">else</span>
<a name="l01262"></a>01262     {
<a name="l01263"></a>01263       <span class="comment">/* normal non-zero winding rule */</span>
<a name="l01264"></a>01264       <span class="keywordflow">if</span> ( coverage &gt;= 256 )
<a name="l01265"></a>01265         coverage = 255;
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268     y += (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a>;
<a name="l01269"></a>01269     x += (<a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>)ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a>;
<a name="l01270"></a>01270 
<a name="l01271"></a>01271     <span class="comment">/* FT_Span.x is a 16-bit short, so limit our coordinates appropriately */</span>
<a name="l01272"></a>01272     <span class="keywordflow">if</span> ( x &gt;= 32767 )
<a name="l01273"></a>01273       x = 32767;
<a name="l01274"></a>01274 
<a name="l01275"></a>01275     <span class="comment">/* FT_Span.y is an integer, so limit our coordinates appropriately */</span>
<a name="l01276"></a>01276     <span class="keywordflow">if</span> ( y &gt;= <a class="code" href="ftstdlib_8h.html#ae008eb221da7e475a8bdf67c067b5369">FT_INT_MAX</a> )
<a name="l01277"></a>01277       y = <a class="code" href="ftstdlib_8h.html#ae008eb221da7e475a8bdf67c067b5369">FT_INT_MAX</a>;
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     <span class="keywordflow">if</span> ( coverage )
<a name="l01280"></a>01280     {
<a name="l01281"></a>01281       <span class="comment">/* see whether we can add this span to the current list */</span>
<a name="l01282"></a>01282       count = ras.<a class="code" href="struct_t_worker__.html#aaf76891630160804f0cef7dd89b635e0">num_gray_spans</a>;
<a name="l01283"></a>01283       span  = ras.<a class="code" href="struct_t_worker__.html#ac51cde9a5cf6ff2c17f28450632beec0">gray_spans</a> + count - 1;
<a name="l01284"></a>01284       <span class="keywordflow">if</span> ( count &gt; 0                          &amp;&amp;
<a name="l01285"></a>01285            ras.<a class="code" href="struct_t_worker__.html#a70859f8f020cdd79f9c4636191dadb3b">span_y</a> == y                    &amp;&amp;
<a name="l01286"></a>01286            (<span class="keywordtype">int</span>)span-&gt;<a class="code" href="struct_f_t___span__.html#a7f7235a404c66398b49c50fa09691ba5">x</a> + span-&gt;<a class="code" href="struct_f_t___span__.html#a939c84317f25a97d0ba01704591a4d38">len</a> == (int)x &amp;&amp;
<a name="l01287"></a>01287            span-&gt;<a class="code" href="struct_f_t___span__.html#a70f9c9e0e8d3f0b38adee03a508ae214">coverage</a> == coverage         )
<a name="l01288"></a>01288       {
<a name="l01289"></a>01289         span-&gt;<a class="code" href="struct_f_t___span__.html#a939c84317f25a97d0ba01704591a4d38">len</a> = (<span class="keywordtype">unsigned</span> short)( span-&gt;<a class="code" href="struct_f_t___span__.html#a939c84317f25a97d0ba01704591a4d38">len</a> + acount );
<a name="l01290"></a>01290         <span class="keywordflow">return</span>;
<a name="l01291"></a>01291       }
<a name="l01292"></a>01292 
<a name="l01293"></a>01293       <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a70859f8f020cdd79f9c4636191dadb3b">span_y</a> != y || count &gt;= <a class="code" href="ftgrays_8c.html#afa494e5252ce5c5cbda6a931cf3ef8fa">FT_MAX_GRAY_SPANS</a> )
<a name="l01294"></a>01294       {
<a name="l01295"></a>01295         <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a65f7b375e13f82384dd56bef7451cd39">render_span</a> &amp;&amp; count &gt; 0 )
<a name="l01296"></a>01296           ras.<a class="code" href="struct_t_worker__.html#a65f7b375e13f82384dd56bef7451cd39">render_span</a>( ras.<a class="code" href="struct_t_worker__.html#a70859f8f020cdd79f9c4636191dadb3b">span_y</a>, count, ras.<a class="code" href="struct_t_worker__.html#ac51cde9a5cf6ff2c17f28450632beec0">gray_spans</a>,
<a name="l01297"></a>01297                            ras.<a class="code" href="struct_t_worker__.html#a9163ea80b63aee1e18f5b4c111584ec8">render_span_data</a> );
<a name="l01298"></a>01298 
<a name="l01299"></a>01299 <span class="preprocessor">#ifdef FT_DEBUG_LEVEL_TRACE</span>
<a name="l01300"></a>01300 <span class="preprocessor"></span>
<a name="l01301"></a>01301         <span class="keywordflow">if</span> ( count &gt; 0 )
<a name="l01302"></a>01302         {
<a name="l01303"></a>01303           <span class="keywordtype">int</span>  <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l01304"></a>01304 
<a name="l01305"></a>01305 
<a name="l01306"></a>01306           <a class="code" href="ftdebug_8h.html#a949e7d3b1c748d889a33dd99ec21c535">FT_TRACE7</a>(( <span class="stringliteral">&quot;y = %3d &quot;</span>, ras.<a class="code" href="struct_t_worker__.html#a70859f8f020cdd79f9c4636191dadb3b">span_y</a> ));
<a name="l01307"></a>01307           span = ras.<a class="code" href="struct_t_worker__.html#ac51cde9a5cf6ff2c17f28450632beec0">gray_spans</a>;
<a name="l01308"></a>01308           <span class="keywordflow">for</span> ( n = 0; n &lt; count; n++, span++ )
<a name="l01309"></a>01309             <a class="code" href="ftdebug_8h.html#a949e7d3b1c748d889a33dd99ec21c535">FT_TRACE7</a>(( <span class="stringliteral">&quot;[%d..%d]:%02x &quot;</span>,
<a name="l01310"></a>01310                         span-&gt;<a class="code" href="struct_f_t___span__.html#a7f7235a404c66398b49c50fa09691ba5">x</a>, span-&gt;<a class="code" href="struct_f_t___span__.html#a7f7235a404c66398b49c50fa09691ba5">x</a> + span-&gt;<a class="code" href="struct_f_t___span__.html#a939c84317f25a97d0ba01704591a4d38">len</a> - 1, span-&gt;<a class="code" href="struct_f_t___span__.html#a70f9c9e0e8d3f0b38adee03a508ae214">coverage</a> ));
<a name="l01311"></a>01311           <a class="code" href="ftdebug_8h.html#a949e7d3b1c748d889a33dd99ec21c535">FT_TRACE7</a>(( <span class="stringliteral">&quot;\n&quot;</span> ));
<a name="l01312"></a>01312         }
<a name="l01313"></a>01313 
<a name="l01314"></a>01314 <span class="preprocessor">#endif </span><span class="comment">/* FT_DEBUG_LEVEL_TRACE */</span>
<a name="l01315"></a>01315 
<a name="l01316"></a>01316         ras.<a class="code" href="struct_t_worker__.html#aaf76891630160804f0cef7dd89b635e0">num_gray_spans</a> = 0;
<a name="l01317"></a>01317         ras.<a class="code" href="struct_t_worker__.html#a70859f8f020cdd79f9c4636191dadb3b">span_y</a>         = (int)y;
<a name="l01318"></a>01318 
<a name="l01319"></a>01319         count = 0;
<a name="l01320"></a>01320         span  = ras.<a class="code" href="struct_t_worker__.html#ac51cde9a5cf6ff2c17f28450632beec0">gray_spans</a>;
<a name="l01321"></a>01321       }
<a name="l01322"></a>01322       <span class="keywordflow">else</span>
<a name="l01323"></a>01323         span++;
<a name="l01324"></a>01324 
<a name="l01325"></a>01325       <span class="comment">/* add a gray span to the current list */</span>
<a name="l01326"></a>01326       span-&gt;<a class="code" href="struct_f_t___span__.html#a7f7235a404c66398b49c50fa09691ba5">x</a>        = (short)x;
<a name="l01327"></a>01327       span-&gt;<a class="code" href="struct_f_t___span__.html#a939c84317f25a97d0ba01704591a4d38">len</a>      = (<span class="keywordtype">unsigned</span> short)acount;
<a name="l01328"></a>01328       span-&gt;<a class="code" href="struct_f_t___span__.html#a70f9c9e0e8d3f0b38adee03a508ae214">coverage</a> = (<span class="keywordtype">unsigned</span> char)coverage;
<a name="l01329"></a>01329 
<a name="l01330"></a>01330       ras.<a class="code" href="struct_t_worker__.html#aaf76891630160804f0cef7dd89b635e0">num_gray_spans</a>++;
<a name="l01331"></a>01331     }
<a name="l01332"></a>01332   }
<a name="l01333"></a>01333 
<a name="l01334"></a>01334 
<a name="l01335"></a>01335 <span class="preprocessor">#ifdef FT_DEBUG_LEVEL_TRACE</span>
<a name="l01336"></a>01336 <span class="preprocessor"></span>
<a name="l01337"></a>01337   <span class="comment">/* to be called while in the debugger --                                */</span>
<a name="l01338"></a>01338   <span class="comment">/* this function causes a compiler warning since it is unused otherwise */</span>
<a name="l01339"></a>01339   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01340"></a>01340   gray_dump_cells( <a class="code" href="ftgrays_8c.html#a1523f79d603e23dfea98f6f5a2dcd8b4">RAS_ARG</a> )
<a name="l01341"></a>01341   {
<a name="l01342"></a>01342     <span class="keywordtype">int</span>  yindex;
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 
<a name="l01345"></a>01345     <span class="keywordflow">for</span> ( yindex = 0; yindex &lt; ras.<a class="code" href="struct_t_worker__.html#a2ddb5a24054498746886e38916e0c82d">ycount</a>; yindex++ )
<a name="l01346"></a>01346     {
<a name="l01347"></a>01347       PCell  cell;
<a name="l01348"></a>01348 
<a name="l01349"></a>01349 
<a name="l01350"></a>01350       printf( <span class="stringliteral">&quot;%3d:&quot;</span>, yindex );
<a name="l01351"></a>01351 
<a name="l01352"></a>01352       <span class="keywordflow">for</span> ( cell = ras.<a class="code" href="struct_t_worker__.html#a0392f5e32f211c88712518ecf1c38bb2">ycells</a>[yindex]; cell != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; cell = cell-&gt;<a class="code" href="struct_t_cell__.html#a2b668ed32d6a79702931eb7f78f4b2d6">next</a> )
<a name="l01353"></a>01353         printf( <span class="stringliteral">&quot; (%3ld, c:%4ld, a:%6d)&quot;</span>, cell-&gt;<a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a>, cell-&gt;<a class="code" href="struct_t_cell__.html#a28686cf9daed2749bd5a6efda14a9843">cover</a>, cell-&gt;<a class="code" href="struct_t_cell__.html#af7ad708f810a148a0303bb851f82fe7b">area</a> );
<a name="l01354"></a>01354       printf( <span class="stringliteral">&quot;\n&quot;</span> );
<a name="l01355"></a>01355     }
<a name="l01356"></a>01356   }
<a name="l01357"></a>01357 
<a name="l01358"></a>01358 <span class="preprocessor">#endif </span><span class="comment">/* FT_DEBUG_LEVEL_TRACE */</span>
<a name="l01359"></a>01359 
<a name="l01360"></a>01360 
<a name="l01361"></a>01361   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01362"></a>01362   gray_sweep( <a class="code" href="ftgrays_8c.html#a9c77c553ff959b54b9a5603be74b9b71">RAS_ARG_</a> <span class="keyword">const</span> <a class="code" href="struct_f_t___bitmap__.html">FT_Bitmap</a>*  target )
<a name="l01363"></a>01363   {
<a name="l01364"></a>01364     <span class="keywordtype">int</span>  yindex;
<a name="l01365"></a>01365 
<a name="l01366"></a>01366     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( target );
<a name="l01367"></a>01367 
<a name="l01368"></a>01368 
<a name="l01369"></a>01369     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#af2565e836b65311cad38b51caec64dfe">num_cells</a> == 0 )
<a name="l01370"></a>01370       <span class="keywordflow">return</span>;
<a name="l01371"></a>01371 
<a name="l01372"></a>01372     ras.<a class="code" href="struct_t_worker__.html#aaf76891630160804f0cef7dd89b635e0">num_gray_spans</a> = 0;
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     <a class="code" href="ftdebug_8h.html#a949e7d3b1c748d889a33dd99ec21c535">FT_TRACE7</a>(( <span class="stringliteral">&quot;gray_sweep: start\n&quot;</span> ));
<a name="l01375"></a>01375 
<a name="l01376"></a>01376     <span class="keywordflow">for</span> ( yindex = 0; yindex &lt; ras.<a class="code" href="struct_t_worker__.html#a2ddb5a24054498746886e38916e0c82d">ycount</a>; yindex++ )
<a name="l01377"></a>01377     {
<a name="l01378"></a>01378       PCell   cell  = ras.<a class="code" href="struct_t_worker__.html#a0392f5e32f211c88712518ecf1c38bb2">ycells</a>[yindex];
<a name="l01379"></a>01379       <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  cover = 0;
<a name="l01380"></a>01380       <a class="code" href="ftgrays_8c.html#aedba3912d7d74a308b8e9bab59d0b9ec">TCoord</a>  x     = 0;
<a name="l01381"></a>01381 
<a name="l01382"></a>01382 
<a name="l01383"></a>01383       <span class="keywordflow">for</span> ( ; cell != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; cell = cell-&gt;<a class="code" href="struct_t_cell__.html#a2b668ed32d6a79702931eb7f78f4b2d6">next</a> )
<a name="l01384"></a>01384       {
<a name="l01385"></a>01385         <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  area;
<a name="l01386"></a>01386 
<a name="l01387"></a>01387 
<a name="l01388"></a>01388         <span class="keywordflow">if</span> ( cell-&gt;<a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a> &gt; x &amp;&amp; cover != 0 )
<a name="l01389"></a>01389           gray_hline( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> x, yindex, cover * ( <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> * 2 ),
<a name="l01390"></a>01390                       cell-&gt;<a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a> - x );
<a name="l01391"></a>01391 
<a name="l01392"></a>01392         cover += cell-&gt;<a class="code" href="struct_t_cell__.html#a28686cf9daed2749bd5a6efda14a9843">cover</a>;
<a name="l01393"></a>01393         area   = cover * ( <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> * 2 ) - cell-&gt;<a class="code" href="struct_t_cell__.html#af7ad708f810a148a0303bb851f82fe7b">area</a>;
<a name="l01394"></a>01394 
<a name="l01395"></a>01395         if ( area != 0 &amp;&amp; cell-&gt;<a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a> &gt;= 0 )
<a name="l01396"></a>01396           gray_hline( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> cell-&gt;<a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a>, yindex, area, 1 );
<a name="l01397"></a>01397 
<a name="l01398"></a>01398         x = cell-&gt;<a class="code" href="struct_t_cell__.html#a3abdaea7ea20fd5206bbc3ffbb8fefe0">x</a> + 1;
<a name="l01399"></a>01399       }
<a name="l01400"></a>01400 
<a name="l01401"></a>01401       <span class="keywordflow">if</span> ( cover != 0 )
<a name="l01402"></a>01402         gray_hline( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> x, yindex, cover * ( <a class="code" href="ftgrays_8c.html#af680ca0d156c218b737a090e71344a06">ONE_PIXEL</a> * 2 ),
<a name="l01403"></a>01403                     ras.<a class="code" href="struct_t_worker__.html#afdf6647ea98e47e0adb9948c2d16f03c">count_ex</a> - x );
<a name="l01404"></a>01404     }
<a name="l01405"></a>01405 
<a name="l01406"></a>01406     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a65f7b375e13f82384dd56bef7451cd39">render_span</a> &amp;&amp; ras.<a class="code" href="struct_t_worker__.html#aaf76891630160804f0cef7dd89b635e0">num_gray_spans</a> &gt; 0 )
<a name="l01407"></a>01407       ras.<a class="code" href="struct_t_worker__.html#a65f7b375e13f82384dd56bef7451cd39">render_span</a>( ras.<a class="code" href="struct_t_worker__.html#a70859f8f020cdd79f9c4636191dadb3b">span_y</a>, ras.<a class="code" href="struct_t_worker__.html#aaf76891630160804f0cef7dd89b635e0">num_gray_spans</a>,
<a name="l01408"></a>01408                        ras.<a class="code" href="struct_t_worker__.html#ac51cde9a5cf6ff2c17f28450632beec0">gray_spans</a>, ras.<a class="code" href="struct_t_worker__.html#a9163ea80b63aee1e18f5b4c111584ec8">render_span_data</a> );
<a name="l01409"></a>01409 
<a name="l01410"></a>01410     <a class="code" href="ftdebug_8h.html#a949e7d3b1c748d889a33dd99ec21c535">FT_TRACE7</a>(( <span class="stringliteral">&quot;gray_sweep: end\n&quot;</span> ));
<a name="l01411"></a>01411   }
<a name="l01412"></a>01412 
<a name="l01413"></a>01413 
<a name="l01414"></a>01414 <span class="preprocessor">#ifdef _STANDALONE_</span>
<a name="l01415"></a>01415 <span class="preprocessor"></span>
<a name="l01416"></a>01416   <span class="comment">/*************************************************************************/</span>
<a name="l01417"></a>01417   <span class="comment">/*                                                                       */</span>
<a name="l01418"></a>01418   <span class="comment">/*  The following function should only compile in stand-alone mode,      */</span>
<a name="l01419"></a>01419   <span class="comment">/*  i.e., when building this component without the rest of FreeType.     */</span>
<a name="l01420"></a>01420   <span class="comment">/*                                                                       */</span>
<a name="l01421"></a>01421   <span class="comment">/*************************************************************************/</span>
<a name="l01422"></a>01422 
<a name="l01423"></a>01423   <span class="comment">/*************************************************************************/</span>
<a name="l01424"></a>01424   <span class="comment">/*                                                                       */</span>
<a name="l01425"></a>01425   <span class="comment">/* &lt;Function&gt;                                                            */</span>
<a name="l01426"></a>01426   <span class="comment">/*    FT_Outline_Decompose                                               */</span>
<a name="l01427"></a>01427   <span class="comment">/*                                                                       */</span>
<a name="l01428"></a>01428   <span class="comment">/* &lt;Description&gt;                                                         */</span>
<a name="l01429"></a>01429   <span class="comment">/*    Walk over an outline&#39;s structure to decompose it into individual   */</span>
<a name="l01430"></a>01430   <span class="comment">/*    segments and Bzier arcs.  This function is also able to emit      */</span>
<a name="l01431"></a>01431   <span class="comment">/*    `move to&#39; and `close to&#39; operations to indicate the start and end  */</span>
<a name="l01432"></a>01432   <span class="comment">/*    of new contours in the outline.                                    */</span>
<a name="l01433"></a>01433   <span class="comment">/*                                                                       */</span>
<a name="l01434"></a>01434   <span class="comment">/* &lt;Input&gt;                                                               */</span>
<a name="l01435"></a>01435   <span class="comment">/*    outline        :: A pointer to the source target.                  */</span>
<a name="l01436"></a>01436   <span class="comment">/*                                                                       */</span>
<a name="l01437"></a>01437   <span class="comment">/*    func_interface :: A table of `emitters&#39;, i.e., function pointers   */</span>
<a name="l01438"></a>01438   <span class="comment">/*                      called during decomposition to indicate path     */</span>
<a name="l01439"></a>01439   <span class="comment">/*                      operations.                                      */</span>
<a name="l01440"></a>01440   <span class="comment">/*                                                                       */</span>
<a name="l01441"></a>01441   <span class="comment">/* &lt;InOut&gt;                                                               */</span>
<a name="l01442"></a>01442   <span class="comment">/*    user           :: A typeless pointer which is passed to each       */</span>
<a name="l01443"></a>01443   <span class="comment">/*                      emitter during the decomposition.  It can be     */</span>
<a name="l01444"></a>01444   <span class="comment">/*                      used to store the state during the               */</span>
<a name="l01445"></a>01445   <span class="comment">/*                      decomposition.                                   */</span>
<a name="l01446"></a>01446   <span class="comment">/*                                                                       */</span>
<a name="l01447"></a>01447   <span class="comment">/* &lt;Return&gt;                                                              */</span>
<a name="l01448"></a>01448   <span class="comment">/*    Error code.  0 means success.                                      */</span>
<a name="l01449"></a>01449   <span class="comment">/*                                                                       */</span>
<a name="l01450"></a>01450   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01451"></a>01451   <a class="code" href="ftoutln_8h.html#ad709fe2b765060ec3fcec30113d4afff">FT_Outline_Decompose</a>( <span class="keyword">const</span> <a class="code" href="struct_f_t___outline__.html">FT_Outline</a>*        outline,
<a name="l01452"></a>01452                         <span class="keyword">const</span> <a class="code" href="struct_f_t___outline___funcs__.html">FT_Outline_Funcs</a>*  func_interface,
<a name="l01453"></a>01453                         <span class="keywordtype">void</span>*                    user )
<a name="l01454"></a>01454   {
<a name="l01455"></a>01455 <span class="preprocessor">#undef SCALED</span>
<a name="l01456"></a>01456 <span class="preprocessor"></span><span class="preprocessor">#define SCALED( x )  ( ( (x) &lt;&lt; shift ) - delta )</span>
<a name="l01457"></a>01457 <span class="preprocessor"></span>
<a name="l01458"></a>01458     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>   v_last;
<a name="l01459"></a>01459     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>   v_control;
<a name="l01460"></a>01460     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>   v_start;
<a name="l01461"></a>01461 
<a name="l01462"></a>01462     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  point;
<a name="l01463"></a>01463     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  limit;
<a name="l01464"></a>01464     <span class="keywordtype">char</span>*       tags;
<a name="l01465"></a>01465 
<a name="l01466"></a>01466     <span class="keywordtype">int</span>         error;
<a name="l01467"></a>01467 
<a name="l01468"></a>01468     <span class="keywordtype">int</span>   <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;         <span class="comment">/* index of contour in outline     */</span>
<a name="l01469"></a>01469     <span class="keywordtype">int</span>   first;     <span class="comment">/* index of first point in contour */</span>
<a name="l01470"></a>01470     <span class="keywordtype">char</span>  tag;       <span class="comment">/* current point&#39;s state           */</span>
<a name="l01471"></a>01471 
<a name="l01472"></a>01472     <span class="keywordtype">int</span>   shift;
<a name="l01473"></a>01473     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  delta;
<a name="l01474"></a>01474 
<a name="l01475"></a>01475 
<a name="l01476"></a>01476     <span class="keywordflow">if</span> ( !outline || !func_interface )
<a name="l01477"></a>01477       <span class="keywordflow">return</span> <a class="code" href="ftgrays_8c.html#a42c64a7abfcdf753c14851925bd7da0f">ErrRaster_Invalid_Argument</a>;
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     shift = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#a540c246669b21b86cb405b3d9019cfda">shift</a>;
<a name="l01480"></a>01480     delta = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#a3c3121398b3ff564b4f3fd5b2a318e5e">delta</a>;
<a name="l01481"></a>01481     first = 0;
<a name="l01482"></a>01482 
<a name="l01483"></a>01483     <span class="keywordflow">for</span> ( n = 0; n &lt; outline-&gt;<a class="code" href="struct_f_t___outline__.html#a0313ba9c2c51f10e6b7d7ef97bd946e2">n_contours</a>; n++ )
<a name="l01484"></a>01484     {
<a name="l01485"></a>01485       <span class="keywordtype">int</span>  last;  <span class="comment">/* index of last point in contour */</span>
<a name="l01486"></a>01486 
<a name="l01487"></a>01487 
<a name="l01488"></a>01488       <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;FT_Outline_Decompose: Outline %d\n&quot;</span>, n ));
<a name="l01489"></a>01489 
<a name="l01490"></a>01490       last  = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a218fdea14003061142ac1045ac50affa">contours</a>[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>];
<a name="l01491"></a>01491       <span class="keywordflow">if</span> ( last &lt; 0 )
<a name="l01492"></a>01492         <span class="keywordflow">goto</span> Invalid_Outline;
<a name="l01493"></a>01493       limit = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a4871896a2f38bdab947e30a7cf6bca04">points</a> + last;
<a name="l01494"></a>01494 
<a name="l01495"></a>01495       v_start   = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a4871896a2f38bdab947e30a7cf6bca04">points</a>[first];
<a name="l01496"></a>01496       v_start.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( v_start.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01497"></a>01497       v_start.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( v_start.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01498"></a>01498 
<a name="l01499"></a>01499       v_last   = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a4871896a2f38bdab947e30a7cf6bca04">points</a>[last];
<a name="l01500"></a>01500       v_last.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( v_last.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01501"></a>01501       v_last.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( v_last.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01502"></a>01502 
<a name="l01503"></a>01503       v_control = v_start;
<a name="l01504"></a>01504 
<a name="l01505"></a>01505       point = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a4871896a2f38bdab947e30a7cf6bca04">points</a> + first;
<a name="l01506"></a>01506       tags  = outline-&gt;<a class="code" href="struct_f_t___outline__.html#ac84ca66907361e1f49ec11c14720087a">tags</a>   + first;
<a name="l01507"></a>01507       tag   = <a class="code" href="ftimage_8h.html#a87ccc09e7aaa99f75a5e7f5360ad6e47">FT_CURVE_TAG</a>( tags[0] );
<a name="l01508"></a>01508 
<a name="l01509"></a>01509       <span class="comment">/* A contour cannot start with a cubic control point! */</span>
<a name="l01510"></a>01510       <span class="keywordflow">if</span> ( tag == <a class="code" href="ftimage_8h.html#a031f7941800d809c561e39bc10935b18">FT_CURVE_TAG_CUBIC</a> )
<a name="l01511"></a>01511         <span class="keywordflow">goto</span> Invalid_Outline;
<a name="l01512"></a>01512 
<a name="l01513"></a>01513       <span class="comment">/* check first point to determine origin */</span>
<a name="l01514"></a>01514       <span class="keywordflow">if</span> ( tag == <a class="code" href="ftimage_8h.html#a4083b94d7eb1e27dce067c38faa040ba">FT_CURVE_TAG_CONIC</a> )
<a name="l01515"></a>01515       {
<a name="l01516"></a>01516         <span class="comment">/* first point is conic control.  Yes, this happens. */</span>
<a name="l01517"></a>01517         <span class="keywordflow">if</span> ( <a class="code" href="ftimage_8h.html#a87ccc09e7aaa99f75a5e7f5360ad6e47">FT_CURVE_TAG</a>( outline-&gt;<a class="code" href="struct_f_t___outline__.html#ac84ca66907361e1f49ec11c14720087a">tags</a>[last] ) == <a class="code" href="ftimage_8h.html#a967f934e5e5e1ee1fe4291d23959aa9c">FT_CURVE_TAG_ON</a> )
<a name="l01518"></a>01518         {
<a name="l01519"></a>01519           <span class="comment">/* start at last point if it is on the curve */</span>
<a name="l01520"></a>01520           v_start = v_last;
<a name="l01521"></a>01521           limit--;
<a name="l01522"></a>01522         }
<a name="l01523"></a>01523         <span class="keywordflow">else</span>
<a name="l01524"></a>01524         {
<a name="l01525"></a>01525           <span class="comment">/* if both first and last points are conic,         */</span>
<a name="l01526"></a>01526           <span class="comment">/* start at their middle and record its position    */</span>
<a name="l01527"></a>01527           <span class="comment">/* for closure                                      */</span>
<a name="l01528"></a>01528           v_start.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = ( v_start.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> + v_last.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> ) / 2;
<a name="l01529"></a>01529           v_start.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = ( v_start.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> + v_last.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> ) / 2;
<a name="l01530"></a>01530 
<a name="l01531"></a>01531           v_last = v_start;
<a name="l01532"></a>01532         }
<a name="l01533"></a>01533         point--;
<a name="l01534"></a>01534         tags--;
<a name="l01535"></a>01535       }
<a name="l01536"></a>01536 
<a name="l01537"></a>01537       <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  move to (%.2f, %.2f)\n&quot;</span>,
<a name="l01538"></a>01538                   v_start.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, v_start.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0 ));
<a name="l01539"></a>01539       error = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#abd53463a59a1ae2c6998e619c2ab6a65">move_to</a>( &amp;v_start, user );
<a name="l01540"></a>01540       <span class="keywordflow">if</span> ( error )
<a name="l01541"></a>01541         <span class="keywordflow">goto</span> Exit;
<a name="l01542"></a>01542 
<a name="l01543"></a>01543       <span class="keywordflow">while</span> ( point &lt; limit )
<a name="l01544"></a>01544       {
<a name="l01545"></a>01545         point++;
<a name="l01546"></a>01546         tags++;
<a name="l01547"></a>01547 
<a name="l01548"></a>01548         tag = <a class="code" href="ftimage_8h.html#a87ccc09e7aaa99f75a5e7f5360ad6e47">FT_CURVE_TAG</a>( tags[0] );
<a name="l01549"></a>01549         <span class="keywordflow">switch</span> ( tag )
<a name="l01550"></a>01550         {
<a name="l01551"></a>01551         <span class="keywordflow">case</span> <a class="code" href="ftimage_8h.html#a967f934e5e5e1ee1fe4291d23959aa9c">FT_CURVE_TAG_ON</a>:  <span class="comment">/* emit a single line_to */</span>
<a name="l01552"></a>01552           {
<a name="l01553"></a>01553             <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>  vec;
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 
<a name="l01556"></a>01556             vec.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01557"></a>01557             vec.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01558"></a>01558 
<a name="l01559"></a>01559             <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  line to (%.2f, %.2f)\n&quot;</span>,
<a name="l01560"></a>01560                         vec.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, vec.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0 ));
<a name="l01561"></a>01561             error = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#a876fc8ca7541786cd3c4ec3806f88360">line_to</a>( &amp;vec, user );
<a name="l01562"></a>01562             <span class="keywordflow">if</span> ( error )
<a name="l01563"></a>01563               <span class="keywordflow">goto</span> Exit;
<a name="l01564"></a>01564             <span class="keywordflow">continue</span>;
<a name="l01565"></a>01565           }
<a name="l01566"></a>01566 
<a name="l01567"></a>01567         <span class="keywordflow">case</span> <a class="code" href="ftimage_8h.html#a4083b94d7eb1e27dce067c38faa040ba">FT_CURVE_TAG_CONIC</a>:  <span class="comment">/* consume conic arcs */</span>
<a name="l01568"></a>01568           v_control.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01569"></a>01569           v_control.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01570"></a>01570 
<a name="l01571"></a>01571         Do_Conic:
<a name="l01572"></a>01572           <span class="keywordflow">if</span> ( point &lt; limit )
<a name="l01573"></a>01573           {
<a name="l01574"></a>01574             <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>  vec;
<a name="l01575"></a>01575             <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>  v_middle;
<a name="l01576"></a>01576 
<a name="l01577"></a>01577 
<a name="l01578"></a>01578             point++;
<a name="l01579"></a>01579             tags++;
<a name="l01580"></a>01580             tag = <a class="code" href="ftimage_8h.html#a87ccc09e7aaa99f75a5e7f5360ad6e47">FT_CURVE_TAG</a>( tags[0] );
<a name="l01581"></a>01581 
<a name="l01582"></a>01582             vec.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01583"></a>01583             vec.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01584"></a>01584 
<a name="l01585"></a>01585             <span class="keywordflow">if</span> ( tag == <a class="code" href="ftimage_8h.html#a967f934e5e5e1ee1fe4291d23959aa9c">FT_CURVE_TAG_ON</a> )
<a name="l01586"></a>01586             {
<a name="l01587"></a>01587               <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  conic to (%.2f, %.2f)&quot;</span>
<a name="l01588"></a>01588                           <span class="stringliteral">&quot; with control (%.2f, %.2f)\n&quot;</span>,
<a name="l01589"></a>01589                           vec.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, vec.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0,
<a name="l01590"></a>01590                           v_control.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, v_control.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0 ));
<a name="l01591"></a>01591               error = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#a09681f5a64189066d3fba3cf398a135b">conic_to</a>( &amp;v_control, &amp;vec, user );
<a name="l01592"></a>01592               <span class="keywordflow">if</span> ( error )
<a name="l01593"></a>01593                 <span class="keywordflow">goto</span> Exit;
<a name="l01594"></a>01594               <span class="keywordflow">continue</span>;
<a name="l01595"></a>01595             }
<a name="l01596"></a>01596 
<a name="l01597"></a>01597             <span class="keywordflow">if</span> ( tag != <a class="code" href="ftimage_8h.html#a4083b94d7eb1e27dce067c38faa040ba">FT_CURVE_TAG_CONIC</a> )
<a name="l01598"></a>01598               <span class="keywordflow">goto</span> Invalid_Outline;
<a name="l01599"></a>01599 
<a name="l01600"></a>01600             v_middle.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = ( v_control.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> + vec.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> ) / 2;
<a name="l01601"></a>01601             v_middle.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = ( v_control.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> + vec.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> ) / 2;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603             <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  conic to (%.2f, %.2f)&quot;</span>
<a name="l01604"></a>01604                         <span class="stringliteral">&quot; with control (%.2f, %.2f)\n&quot;</span>,
<a name="l01605"></a>01605                         v_middle.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, v_middle.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0,
<a name="l01606"></a>01606                         v_control.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, v_control.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0 ));
<a name="l01607"></a>01607             error = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#a09681f5a64189066d3fba3cf398a135b">conic_to</a>( &amp;v_control, &amp;v_middle, user );
<a name="l01608"></a>01608             <span class="keywordflow">if</span> ( error )
<a name="l01609"></a>01609               <span class="keywordflow">goto</span> Exit;
<a name="l01610"></a>01610 
<a name="l01611"></a>01611             v_control = vec;
<a name="l01612"></a>01612             <span class="keywordflow">goto</span> Do_Conic;
<a name="l01613"></a>01613           }
<a name="l01614"></a>01614 
<a name="l01615"></a>01615           <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  conic to (%.2f, %.2f)&quot;</span>
<a name="l01616"></a>01616                       <span class="stringliteral">&quot; with control (%.2f, %.2f)\n&quot;</span>,
<a name="l01617"></a>01617                       v_start.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, v_start.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0,
<a name="l01618"></a>01618                       v_control.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, v_control.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0 ));
<a name="l01619"></a>01619           error = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#a09681f5a64189066d3fba3cf398a135b">conic_to</a>( &amp;v_control, &amp;v_start, user );
<a name="l01620"></a>01620           <span class="keywordflow">goto</span> Close;
<a name="l01621"></a>01621 
<a name="l01622"></a>01622         <span class="keywordflow">default</span>:  <span class="comment">/* FT_CURVE_TAG_CUBIC */</span>
<a name="l01623"></a>01623           {
<a name="l01624"></a>01624             <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>  vec1, vec2;
<a name="l01625"></a>01625 
<a name="l01626"></a>01626 
<a name="l01627"></a>01627             <span class="keywordflow">if</span> ( point + 1 &gt; limit                             ||
<a name="l01628"></a>01628                  <a class="code" href="ftimage_8h.html#a87ccc09e7aaa99f75a5e7f5360ad6e47">FT_CURVE_TAG</a>( tags[1] ) != <a class="code" href="ftimage_8h.html#a031f7941800d809c561e39bc10935b18">FT_CURVE_TAG_CUBIC</a> )
<a name="l01629"></a>01629               <span class="keywordflow">goto</span> Invalid_Outline;
<a name="l01630"></a>01630 
<a name="l01631"></a>01631             point += 2;
<a name="l01632"></a>01632             tags  += 2;
<a name="l01633"></a>01633 
<a name="l01634"></a>01634             vec1.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point[-2].x );
<a name="l01635"></a>01635             vec1.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point[-2].y );
<a name="l01636"></a>01636 
<a name="l01637"></a>01637             vec2.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point[-1].x );
<a name="l01638"></a>01638             vec2.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point[-1].y );
<a name="l01639"></a>01639 
<a name="l01640"></a>01640             <span class="keywordflow">if</span> ( point &lt;= limit )
<a name="l01641"></a>01641             {
<a name="l01642"></a>01642               <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>  vec;
<a name="l01643"></a>01643 
<a name="l01644"></a>01644 
<a name="l01645"></a>01645               vec.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> );
<a name="l01646"></a>01646               vec.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = <a class="code" href="ftoutln_8c.html#aa3355c3bbfb75450fa0574e56756b493">SCALED</a>( point-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> );
<a name="l01647"></a>01647 
<a name="l01648"></a>01648               <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  cubic to (%.2f, %.2f)&quot;</span>
<a name="l01649"></a>01649                           <span class="stringliteral">&quot; with controls (%.2f, %.2f) and (%.2f, %.2f)\n&quot;</span>,
<a name="l01650"></a>01650                           vec.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, vec.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0,
<a name="l01651"></a>01651                           vec1.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, vec1.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0,
<a name="l01652"></a>01652                           vec2.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, vec2.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0 ));
<a name="l01653"></a>01653               error = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#aa3e0c1bacb181a5f43c104ab7f72cfda">cubic_to</a>( &amp;vec1, &amp;vec2, &amp;vec, user );
<a name="l01654"></a>01654               <span class="keywordflow">if</span> ( error )
<a name="l01655"></a>01655                 <span class="keywordflow">goto</span> Exit;
<a name="l01656"></a>01656               <span class="keywordflow">continue</span>;
<a name="l01657"></a>01657             }
<a name="l01658"></a>01658 
<a name="l01659"></a>01659             <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  cubic to (%.2f, %.2f)&quot;</span>
<a name="l01660"></a>01660                         <span class="stringliteral">&quot; with controls (%.2f, %.2f) and (%.2f, %.2f)\n&quot;</span>,
<a name="l01661"></a>01661                         v_start.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, v_start.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0,
<a name="l01662"></a>01662                         vec1.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, vec1.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0,
<a name="l01663"></a>01663                         vec2.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, vec2.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0 ));
<a name="l01664"></a>01664             error = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#aa3e0c1bacb181a5f43c104ab7f72cfda">cubic_to</a>( &amp;vec1, &amp;vec2, &amp;v_start, user );
<a name="l01665"></a>01665             <span class="keywordflow">goto</span> Close;
<a name="l01666"></a>01666           }
<a name="l01667"></a>01667         }
<a name="l01668"></a>01668       }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670       <span class="comment">/* close the contour with a line segment */</span>
<a name="l01671"></a>01671       <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  line to (%.2f, %.2f)\n&quot;</span>,
<a name="l01672"></a>01672                   v_start.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> / 64.0, v_start.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> / 64.0 ));
<a name="l01673"></a>01673       error = func_interface-&gt;<a class="code" href="struct_f_t___outline___funcs__.html#a876fc8ca7541786cd3c4ec3806f88360">line_to</a>( &amp;v_start, user );
<a name="l01674"></a>01674 
<a name="l01675"></a>01675    Close:
<a name="l01676"></a>01676       <span class="keywordflow">if</span> ( error )
<a name="l01677"></a>01677         <span class="keywordflow">goto</span> Exit;
<a name="l01678"></a>01678 
<a name="l01679"></a>01679       first = last + 1;
<a name="l01680"></a>01680     }
<a name="l01681"></a>01681 
<a name="l01682"></a>01682     <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;FT_Outline_Decompose: Done\n&quot;</span>, n ));
<a name="l01683"></a>01683     <span class="keywordflow">return</span> 0;
<a name="l01684"></a>01684 
<a name="l01685"></a>01685   Exit:
<a name="l01686"></a>01686     <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;FT_Outline_Decompose: Error %d\n&quot;</span>, error ));
<a name="l01687"></a>01687     <span class="keywordflow">return</span> error;
<a name="l01688"></a>01688 
<a name="l01689"></a>01689   Invalid_Outline:
<a name="l01690"></a>01690     <span class="keywordflow">return</span> <a class="code" href="ftgrays_8c.html#ae5a591c1fc2df77dbf1c713d3cfb28be">ErrRaster_Invalid_Outline</a>;
<a name="l01691"></a>01691   }
<a name="l01692"></a>01692 
<a name="l01693"></a>01693 <span class="preprocessor">#endif </span><span class="comment">/* _STANDALONE_ */</span>
<a name="l01694"></a>01694 
<a name="l01695"></a>01695 
<a name="l01696"></a>01696   <span class="keyword">typedef</span> <span class="keyword">struct  </span><a class="code" href="struct_t_band__.html">TBand_</a>
<a name="l01697"></a>01697   {
<a name="l01698"></a><a class="code" href="struct_t_band__.html#a2f326abab8493478336ef1b0acf117b8">01698</a>     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  <a class="code" href="struct_t_band__.html#a2f326abab8493478336ef1b0acf117b8">min</a>, <a class="code" href="struct_t_band__.html#a3d355eb923ab1288b8033faef6bfe68d">max</a>;
<a name="l01699"></a>01699 
<a name="l01700"></a>01700   } <a class="code" href="ftraster_8c.html#a1fb0d2cea102d459b49cdacfbf76602d">TBand</a>;
<a name="l01701"></a>01701 
<a name="l01702"></a><a class="code" href="ftgrays_8c.html#a80f385d317df403ecdea99ec8f173081">01702</a>     <a class="code" href="ftobjs_8h.html#aa361f41604685cfe68f86b4d9fc63f19">FT_DEFINE_OUTLINE_FUNCS</a>(func_interface,
<a name="l01703"></a>01703       (<a class="code" href="ftimage_8h.html#ae5c15ee22f5ae04acc40ebc08b2c384b">FT_Outline_MoveTo_Func</a>) gray_move_to,
<a name="l01704"></a>01704       (<a class="code" href="ftimage_8h.html#a77419f525bb73211cc997081290367d0">FT_Outline_LineTo_Func</a>) gray_line_to,
<a name="l01705"></a>01705       (<a class="code" href="ftimage_8h.html#a95a8dd2e9f3fb3da159807606d3e46a2">FT_Outline_ConicTo_Func</a>)gray_conic_to,
<a name="l01706"></a>01706       (<a class="code" href="ftimage_8h.html#a67500fd20d9d06ae0baa123b28f4a35e">FT_Outline_CubicTo_Func</a>)gray_cubic_to,
<a name="l01707"></a>01707       0,
<a name="l01708"></a>01708       0
<a name="l01709"></a>01709     )
<a name="l01710"></a>01710 
<a name="l01711"></a>01711   static <span class="keywordtype">int</span>
<a name="l01712"></a>01712   gray_convert_glyph_inner( <a class="code" href="ftgrays_8c.html#a1523f79d603e23dfea98f6f5a2dcd8b4">RAS_ARG</a> )
<a name="l01713"></a>01713   {
<a name="l01714"></a>01714 
<a name="l01715"></a>01715     <span class="keyword">volatile</span> <span class="keywordtype">int</span>  error = 0;
<a name="l01716"></a>01716 
<a name="l01717"></a>01717 <span class="preprocessor">#ifdef FT_CONFIG_OPTION_PIC</span>
<a name="l01718"></a>01718 <span class="preprocessor"></span>      <a class="code" href="struct_f_t___outline___funcs__.html">FT_Outline_Funcs</a> func_interface;
<a name="l01719"></a>01719       Init_Class_func_interface(&amp;func_interface);
<a name="l01720"></a>01720 <span class="preprocessor">#endif</span>
<a name="l01721"></a>01721 <span class="preprocessor"></span>
<a name="l01722"></a>01722     <span class="keywordflow">if</span> ( <a class="code" href="ftstdlib_8h.html#ac2967c7b589c37c120131efe1c619e32">ft_setjmp</a>( ras.<a class="code" href="struct_t_worker__.html#a6196d62ea93584ca6fcb88a7e282e872">jump_buffer</a> ) == 0 )
<a name="l01723"></a>01723     {
<a name="l01724"></a>01724       error = <a class="code" href="ftoutln_8h.html#ad709fe2b765060ec3fcec30113d4afff">FT_Outline_Decompose</a>( &amp;ras.<a class="code" href="struct_t_worker__.html#a943f8085950441ac728a25bc49327601">outline</a>, &amp;func_interface, &amp;ras );
<a name="l01725"></a>01725       gray_record_cell( <a class="code" href="ftgrays_8c.html#a71d83a981d5845ee2392a85c2369311a">RAS_VAR</a> );
<a name="l01726"></a>01726     }
<a name="l01727"></a>01727     <span class="keywordflow">else</span>
<a name="l01728"></a>01728       error = <a class="code" href="ftgrays_8c.html#a1c119fbb760129ad7e98b7102e5dca5a">ErrRaster_Memory_Overflow</a>;
<a name="l01729"></a>01729 
<a name="l01730"></a>01730     <span class="keywordflow">return</span> error;
<a name="l01731"></a>01731   }
<a name="l01732"></a>01732 
<a name="l01733"></a>01733 
<a name="l01734"></a>01734   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01735"></a>01735   gray_convert_glyph( <a class="code" href="ftgrays_8c.html#a1523f79d603e23dfea98f6f5a2dcd8b4">RAS_ARG</a> )
<a name="l01736"></a>01736   {
<a name="l01737"></a>01737     <a class="code" href="struct_t_band__.html">TBand</a>            bands[40];
<a name="l01738"></a>01738     <a class="code" href="struct_t_band__.html">TBand</a>* <span class="keyword">volatile</span>  band;
<a name="l01739"></a>01739     <span class="keywordtype">int</span> <span class="keyword">volatile</span>     <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>, num_bands;
<a name="l01740"></a>01740     <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a> <span class="keyword">volatile</span>    <a class="code" href="al_main_8h.html#abb702d8b501669a23aa0ab3b281b9384">min</a>, <a class="code" href="al_main_8h.html#ac39d9cef6a5e030ba8d9e11121054268">max</a>, max_y;
<a name="l01741"></a>01741     <a class="code" href="struct_f_t___b_box__.html">FT_BBox</a>*         clip;
<a name="l01742"></a>01742 
<a name="l01743"></a>01743 
<a name="l01744"></a>01744     <span class="comment">/* Set up state in the raster object */</span>
<a name="l01745"></a>01745     gray_compute_cbox( <a class="code" href="ftgrays_8c.html#a71d83a981d5845ee2392a85c2369311a">RAS_VAR</a> );
<a name="l01746"></a>01746 
<a name="l01747"></a>01747     <span class="comment">/* clip to target bitmap, exit if nothing to do */</span>
<a name="l01748"></a>01748     clip = &amp;ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>;
<a name="l01749"></a>01749 
<a name="l01750"></a>01750     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> &lt;= clip-&gt;<a class="code" href="struct_f_t___b_box__.html#a1f2a5d0565d496c1d41e43d018f45add">xMin</a> || ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> &gt;= clip-&gt;<a class="code" href="struct_f_t___b_box__.html#ac6da5c44f4cb7b97eef1f438eb69c0ec">xMax</a> ||
<a name="l01751"></a>01751          ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> &lt;= clip-&gt;<a class="code" href="struct_f_t___b_box__.html#a959ca1d5bc1c5338da0d85c8e7135f4e">yMin</a> || ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> &gt;= clip-&gt;<a class="code" href="struct_f_t___b_box__.html#a77084921589f386a8a593ae1f25b1569">yMax</a> )
<a name="l01752"></a>01752       <span class="keywordflow">return</span> 0;
<a name="l01753"></a>01753 
<a name="l01754"></a>01754     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> &lt; clip-&gt;<a class="code" href="struct_f_t___b_box__.html#a1f2a5d0565d496c1d41e43d018f45add">xMin</a> ) ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a> = clip-&gt;<a class="code" href="struct_f_t___b_box__.html#a1f2a5d0565d496c1d41e43d018f45add">xMin</a>;
<a name="l01755"></a>01755     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> &lt; clip-&gt;<a class="code" href="struct_f_t___b_box__.html#a959ca1d5bc1c5338da0d85c8e7135f4e">yMin</a> ) ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> = clip-&gt;<a class="code" href="struct_f_t___b_box__.html#a959ca1d5bc1c5338da0d85c8e7135f4e">yMin</a>;
<a name="l01756"></a>01756 
<a name="l01757"></a>01757     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> &gt; clip-&gt;<a class="code" href="struct_f_t___b_box__.html#ac6da5c44f4cb7b97eef1f438eb69c0ec">xMax</a> ) ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> = clip-&gt;<a class="code" href="struct_f_t___b_box__.html#ac6da5c44f4cb7b97eef1f438eb69c0ec">xMax</a>;
<a name="l01758"></a>01758     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> &gt; clip-&gt;<a class="code" href="struct_f_t___b_box__.html#a77084921589f386a8a593ae1f25b1569">yMax</a> ) ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> = clip-&gt;<a class="code" href="struct_f_t___b_box__.html#a77084921589f386a8a593ae1f25b1569">yMax</a>;
<a name="l01759"></a>01759 
<a name="l01760"></a>01760     ras.<a class="code" href="struct_t_worker__.html#afdf6647ea98e47e0adb9948c2d16f03c">count_ex</a> = ras.<a class="code" href="struct_t_worker__.html#a029d023589c4d32343c517ec1efe2394">max_ex</a> - ras.<a class="code" href="struct_t_worker__.html#a648afc997b727a3bbaaaa035b7a599cb">min_ex</a>;
<a name="l01761"></a>01761     ras.<a class="code" href="struct_t_worker__.html#a56f5fc2f91c85196c24ebec1e48c0322">count_ey</a> = ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> - ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a>;
<a name="l01762"></a>01762 
<a name="l01763"></a>01763     <span class="comment">/* simple heuristic used to speed up the bezier decomposition -- see */</span>
<a name="l01764"></a>01764     <span class="comment">/* the code in gray_render_conic() and gray_render_cubic() for more  */</span>
<a name="l01765"></a>01765     <span class="comment">/* details                                                           */</span>
<a name="l01766"></a>01766     ras.<a class="code" href="struct_t_worker__.html#aeedfb86fae2d26779aae3b04e767c44f">conic_level</a> = 32;
<a name="l01767"></a>01767     ras.<a class="code" href="struct_t_worker__.html#ace9a8b37b9118308ec5c74c2716ae228">cubic_level</a> = 16;
<a name="l01768"></a>01768 
<a name="l01769"></a>01769     {
<a name="l01770"></a>01770       <span class="keywordtype">int</span>  level = 0;
<a name="l01771"></a>01771 
<a name="l01772"></a>01772 
<a name="l01773"></a>01773       <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#afdf6647ea98e47e0adb9948c2d16f03c">count_ex</a> &gt; 24 || ras.<a class="code" href="struct_t_worker__.html#a56f5fc2f91c85196c24ebec1e48c0322">count_ey</a> &gt; 24 )
<a name="l01774"></a>01774         level++;
<a name="l01775"></a>01775       <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#afdf6647ea98e47e0adb9948c2d16f03c">count_ex</a> &gt; 120 || ras.<a class="code" href="struct_t_worker__.html#a56f5fc2f91c85196c24ebec1e48c0322">count_ey</a> &gt; 120 )
<a name="l01776"></a>01776         level++;
<a name="l01777"></a>01777 
<a name="l01778"></a>01778       ras.<a class="code" href="struct_t_worker__.html#aeedfb86fae2d26779aae3b04e767c44f">conic_level</a> &lt;&lt;= level;
<a name="l01779"></a>01779       ras.<a class="code" href="struct_t_worker__.html#ace9a8b37b9118308ec5c74c2716ae228">cubic_level</a> &lt;&lt;= level;
<a name="l01780"></a>01780     }
<a name="l01781"></a>01781 
<a name="l01782"></a>01782     <span class="comment">/* set up vertical bands */</span>
<a name="l01783"></a>01783     num_bands = (int)( ( ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a> - ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a> ) / ras.<a class="code" href="struct_t_worker__.html#af286ee860140e2d0abd1650600bc8586">band_size</a> );
<a name="l01784"></a>01784     <span class="keywordflow">if</span> ( num_bands == 0 )
<a name="l01785"></a>01785       num_bands = 1;
<a name="l01786"></a>01786     <span class="keywordflow">if</span> ( num_bands &gt;= 39 )
<a name="l01787"></a>01787       num_bands = 39;
<a name="l01788"></a>01788 
<a name="l01789"></a>01789     ras.<a class="code" href="struct_t_worker__.html#a140a65d0a3a36eacc379eb5385da094d">band_shoot</a> = 0;
<a name="l01790"></a>01790 
<a name="l01791"></a>01791     min   = ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a>;
<a name="l01792"></a>01792     max_y = ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a>;
<a name="l01793"></a>01793 
<a name="l01794"></a>01794     <span class="keywordflow">for</span> ( n = 0; n &lt; num_bands; n++, min = <a class="code" href="al_main_8h.html#ac39d9cef6a5e030ba8d9e11121054268">max</a> )
<a name="l01795"></a>01795     {
<a name="l01796"></a>01796       max = min + ras.<a class="code" href="struct_t_worker__.html#af286ee860140e2d0abd1650600bc8586">band_size</a>;
<a name="l01797"></a>01797       <span class="keywordflow">if</span> ( n == num_bands - 1 || max &gt; max_y )
<a name="l01798"></a>01798         max = max_y;
<a name="l01799"></a>01799 
<a name="l01800"></a>01800       bands[0].<a class="code" href="struct_t_band__.html#a2f326abab8493478336ef1b0acf117b8">min</a> = <a class="code" href="al_main_8h.html#abb702d8b501669a23aa0ab3b281b9384">min</a>;
<a name="l01801"></a>01801       bands[0].<a class="code" href="struct_t_band__.html#a3d355eb923ab1288b8033faef6bfe68d">max</a> = <a class="code" href="al_main_8h.html#ac39d9cef6a5e030ba8d9e11121054268">max</a>;
<a name="l01802"></a>01802       band         = bands;
<a name="l01803"></a>01803 
<a name="l01804"></a>01804       <span class="keywordflow">while</span> ( band &gt;= bands )
<a name="l01805"></a>01805       {
<a name="l01806"></a>01806         <a class="code" href="ftgrays_8c.html#a2624a0fe448cb84f03e7de75510cdb6c">TPos</a>  bottom, top, middle;
<a name="l01807"></a>01807         <span class="keywordtype">int</span>   error;
<a name="l01808"></a>01808 
<a name="l01809"></a>01809         {
<a name="l01810"></a>01810           PCell  cells_max;
<a name="l01811"></a>01811           <span class="keywordtype">int</span>    yindex;
<a name="l01812"></a>01812           <span class="keywordtype">long</span>   cell_start, cell_end, cell_mod;
<a name="l01813"></a>01813 
<a name="l01814"></a>01814 
<a name="l01815"></a>01815           ras.<a class="code" href="struct_t_worker__.html#a0392f5e32f211c88712518ecf1c38bb2">ycells</a> = (PCell*)ras.<a class="code" href="struct_t_worker__.html#a42f739d61a410947666aa88c374ddfdd">buffer</a>;
<a name="l01816"></a>01816           ras.<a class="code" href="struct_t_worker__.html#a2ddb5a24054498746886e38916e0c82d">ycount</a> = band-&gt;<a class="code" href="struct_t_band__.html#a3d355eb923ab1288b8033faef6bfe68d">max</a> - band-&gt;<a class="code" href="struct_t_band__.html#a2f326abab8493478336ef1b0acf117b8">min</a>;
<a name="l01817"></a>01817 
<a name="l01818"></a>01818           cell_start = <a class="code" href="afmodule_8c.html#a3491b7a4c35805e0432b6b382117c13b">sizeof</a> ( PCell ) * ras.<a class="code" href="struct_t_worker__.html#a2ddb5a24054498746886e38916e0c82d">ycount</a>;
<a name="l01819"></a>01819           cell_mod   = cell_start % <span class="keyword">sizeof</span> ( <a class="code" href="ftgrays_8c.html#adffe80f61398f3d06a05e4531ab12876">TCell</a> );
<a name="l01820"></a>01820           <span class="keywordflow">if</span> ( cell_mod &gt; 0 )
<a name="l01821"></a>01821             cell_start += <span class="keyword">sizeof</span> ( <a class="code" href="ftgrays_8c.html#adffe80f61398f3d06a05e4531ab12876">TCell</a> ) - cell_mod;
<a name="l01822"></a>01822 
<a name="l01823"></a>01823           cell_end  = ras.<a class="code" href="struct_t_worker__.html#a4d741143905671f7c65794020b9dc555">buffer_size</a>;
<a name="l01824"></a>01824           cell_end -= cell_end % <span class="keyword">sizeof</span>( <a class="code" href="ftgrays_8c.html#adffe80f61398f3d06a05e4531ab12876">TCell</a> );
<a name="l01825"></a>01825 
<a name="l01826"></a>01826           cells_max = (<a class="code" href="ftgrays_8c.html#aa5dea8fee85f1a98fa52257da9c389c1">PCell</a>)( (<span class="keywordtype">char</span>*)ras.<a class="code" href="struct_t_worker__.html#a42f739d61a410947666aa88c374ddfdd">buffer</a> + cell_end );
<a name="l01827"></a>01827           ras.<a class="code" href="struct_t_worker__.html#a089f0962c5ada881137d1e0af513ed1e">cells</a> = (<a class="code" href="ftgrays_8c.html#aa5dea8fee85f1a98fa52257da9c389c1">PCell</a>)( (<span class="keywordtype">char</span>*)ras.<a class="code" href="struct_t_worker__.html#a42f739d61a410947666aa88c374ddfdd">buffer</a> + cell_start );
<a name="l01828"></a>01828           <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a089f0962c5ada881137d1e0af513ed1e">cells</a> &gt;= cells_max )
<a name="l01829"></a>01829             <span class="keywordflow">goto</span> ReduceBands;
<a name="l01830"></a>01830 
<a name="l01831"></a>01831           ras.<a class="code" href="struct_t_worker__.html#af981fd29b780b01490707307527ee160">max_cells</a> = cells_max - ras.<a class="code" href="struct_t_worker__.html#a089f0962c5ada881137d1e0af513ed1e">cells</a>;
<a name="l01832"></a>01832           <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#af981fd29b780b01490707307527ee160">max_cells</a> &lt; 2 )
<a name="l01833"></a>01833             <span class="keywordflow">goto</span> ReduceBands;
<a name="l01834"></a>01834 
<a name="l01835"></a>01835           <span class="keywordflow">for</span> ( yindex = 0; yindex &lt; ras.<a class="code" href="struct_t_worker__.html#a2ddb5a24054498746886e38916e0c82d">ycount</a>; yindex++ )
<a name="l01836"></a>01836             ras.<a class="code" href="struct_t_worker__.html#a0392f5e32f211c88712518ecf1c38bb2">ycells</a>[yindex] = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01837"></a>01837         }
<a name="l01838"></a>01838 
<a name="l01839"></a>01839         ras.<a class="code" href="struct_t_worker__.html#af2565e836b65311cad38b51caec64dfe">num_cells</a> = 0;
<a name="l01840"></a>01840         ras.<a class="code" href="struct_t_worker__.html#acbf1d08171d29ce1f71651171323c321">invalid</a>   = 1;
<a name="l01841"></a>01841         ras.<a class="code" href="struct_t_worker__.html#a4b92f70d92d1b5a1eaea6a46ddbec369">min_ey</a>    = band-&gt;<a class="code" href="struct_t_band__.html#a2f326abab8493478336ef1b0acf117b8">min</a>;
<a name="l01842"></a>01842         ras.<a class="code" href="struct_t_worker__.html#a35e4ece28efba28097390118f02c7d57">max_ey</a>    = band-&gt;<a class="code" href="struct_t_band__.html#a3d355eb923ab1288b8033faef6bfe68d">max</a>;
<a name="l01843"></a>01843         ras.<a class="code" href="struct_t_worker__.html#a56f5fc2f91c85196c24ebec1e48c0322">count_ey</a>  = band-&gt;<a class="code" href="struct_t_band__.html#a3d355eb923ab1288b8033faef6bfe68d">max</a> - band-&gt;<a class="code" href="struct_t_band__.html#a2f326abab8493478336ef1b0acf117b8">min</a>;
<a name="l01844"></a>01844 
<a name="l01845"></a>01845         error = gray_convert_glyph_inner( <a class="code" href="ftgrays_8c.html#a71d83a981d5845ee2392a85c2369311a">RAS_VAR</a> );
<a name="l01846"></a>01846 
<a name="l01847"></a>01847         <span class="keywordflow">if</span> ( !error )
<a name="l01848"></a>01848         {
<a name="l01849"></a>01849           gray_sweep( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> &amp;ras.<a class="code" href="struct_t_worker__.html#a7bc261f8cce875cf8c78aad7386e8884">target</a> );
<a name="l01850"></a>01850           band--;
<a name="l01851"></a>01851           <span class="keywordflow">continue</span>;
<a name="l01852"></a>01852         }
<a name="l01853"></a>01853         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( error != <a class="code" href="ftgrays_8c.html#a1c119fbb760129ad7e98b7102e5dca5a">ErrRaster_Memory_Overflow</a> )
<a name="l01854"></a>01854           <span class="keywordflow">return</span> 1;
<a name="l01855"></a>01855 
<a name="l01856"></a>01856       ReduceBands:
<a name="l01857"></a>01857         <span class="comment">/* render pool overflow; we will reduce the render band by half */</span>
<a name="l01858"></a>01858         bottom = band-&gt;<a class="code" href="struct_t_band__.html#a2f326abab8493478336ef1b0acf117b8">min</a>;
<a name="l01859"></a>01859         top    = band-&gt;<a class="code" href="struct_t_band__.html#a3d355eb923ab1288b8033faef6bfe68d">max</a>;
<a name="l01860"></a>01860         middle = bottom + ( ( top - bottom ) &gt;&gt; 1 );
<a name="l01861"></a>01861 
<a name="l01862"></a>01862         <span class="comment">/* This is too complex for a single scanline; there must */</span>
<a name="l01863"></a>01863         <span class="comment">/* be some problems.                                     */</span>
<a name="l01864"></a>01864         <span class="keywordflow">if</span> ( middle == bottom )
<a name="l01865"></a>01865         {
<a name="l01866"></a>01866 <span class="preprocessor">#ifdef FT_DEBUG_LEVEL_TRACE</span>
<a name="l01867"></a>01867 <span class="preprocessor"></span>          <a class="code" href="ftdebug_8h.html#a949e7d3b1c748d889a33dd99ec21c535">FT_TRACE7</a>(( <span class="stringliteral">&quot;gray_convert_glyph: rotten glyph\n&quot;</span> ));
<a name="l01868"></a>01868 <span class="preprocessor">#endif</span>
<a name="l01869"></a>01869 <span class="preprocessor"></span>          <span class="keywordflow">return</span> 1;
<a name="l01870"></a>01870         }
<a name="l01871"></a>01871 
<a name="l01872"></a>01872         <span class="keywordflow">if</span> ( bottom-top &gt;= ras.<a class="code" href="struct_t_worker__.html#af286ee860140e2d0abd1650600bc8586">band_size</a> )
<a name="l01873"></a>01873           ras.<a class="code" href="struct_t_worker__.html#a140a65d0a3a36eacc379eb5385da094d">band_shoot</a>++;
<a name="l01874"></a>01874 
<a name="l01875"></a>01875         band[1].<a class="code" href="struct_t_band__.html#a2f326abab8493478336ef1b0acf117b8">min</a> = bottom;
<a name="l01876"></a>01876         band[1].<a class="code" href="struct_t_band__.html#a3d355eb923ab1288b8033faef6bfe68d">max</a> = middle;
<a name="l01877"></a>01877         band[0].<a class="code" href="struct_t_band__.html#a2f326abab8493478336ef1b0acf117b8">min</a> = middle;
<a name="l01878"></a>01878         band[0].<a class="code" href="struct_t_band__.html#a3d355eb923ab1288b8033faef6bfe68d">max</a> = top;
<a name="l01879"></a>01879         band++;
<a name="l01880"></a>01880       }
<a name="l01881"></a>01881     }
<a name="l01882"></a>01882 
<a name="l01883"></a>01883     <span class="keywordflow">if</span> ( ras.<a class="code" href="struct_t_worker__.html#a140a65d0a3a36eacc379eb5385da094d">band_shoot</a> &gt; 8 &amp;&amp; ras.<a class="code" href="struct_t_worker__.html#af286ee860140e2d0abd1650600bc8586">band_size</a> &gt; 16 )
<a name="l01884"></a>01884       ras.<a class="code" href="struct_t_worker__.html#af286ee860140e2d0abd1650600bc8586">band_size</a> = ras.<a class="code" href="struct_t_worker__.html#af286ee860140e2d0abd1650600bc8586">band_size</a> / 2;
<a name="l01885"></a>01885 
<a name="l01886"></a>01886     <span class="keywordflow">return</span> 0;
<a name="l01887"></a>01887   }
<a name="l01888"></a>01888 
<a name="l01889"></a>01889 
<a name="l01890"></a>01890   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01891"></a>01891   gray_raster_render( PRaster                  raster,
<a name="l01892"></a>01892                       <span class="keyword">const</span> <a class="code" href="struct_f_t___raster___params__.html">FT_Raster_Params</a>*  params )
<a name="l01893"></a>01893   {
<a name="l01894"></a>01894     <span class="keyword">const</span> <a class="code" href="struct_f_t___outline__.html">FT_Outline</a>*  outline    = (<span class="keyword">const</span> <a class="code" href="struct_f_t___outline__.html">FT_Outline</a>*)params-&gt;<a class="code" href="struct_f_t___raster___params__.html#a9be95865384791b018f7a9665a062ee5">source</a>;
<a name="l01895"></a>01895     <span class="keyword">const</span> <a class="code" href="struct_f_t___bitmap__.html">FT_Bitmap</a>*   target_map = params-&gt;<a class="code" href="struct_f_t___raster___params__.html#a2ba8941740db23ec91302aa9bd154da3">target</a>;
<a name="l01896"></a>01896     PWorker            worker;
<a name="l01897"></a>01897 
<a name="l01898"></a>01898 
<a name="l01899"></a>01899     if ( !raster || !raster-&gt;<a class="code" href="struct_t_raster__.html#a4e6299014a5ade13d17063a911d4f122">buffer</a> || !raster-&gt;<a class="code" href="struct_t_raster__.html#a1b800cee545f7cc1bd5a168de13f580b">buffer_size</a> )
<a name="l01900"></a>01900       <span class="keywordflow">return</span> <a class="code" href="ftgrays_8c.html#a42c64a7abfcdf753c14851925bd7da0f">ErrRaster_Invalid_Argument</a>;
<a name="l01901"></a>01901 
<a name="l01902"></a>01902     <span class="keywordflow">if</span> ( !outline )
<a name="l01903"></a>01903       <span class="keywordflow">return</span> <a class="code" href="ftgrays_8c.html#ae5a591c1fc2df77dbf1c713d3cfb28be">ErrRaster_Invalid_Outline</a>;
<a name="l01904"></a>01904 
<a name="l01905"></a>01905     <span class="comment">/* return immediately if the outline is empty */</span>
<a name="l01906"></a>01906     <span class="keywordflow">if</span> ( outline-&gt;<a class="code" href="struct_f_t___outline__.html#a7ebcf3c33231af88655534d1ac02b66e">n_points</a> == 0 || outline-&gt;<a class="code" href="struct_f_t___outline__.html#a0313ba9c2c51f10e6b7d7ef97bd946e2">n_contours</a> &lt;= 0 )
<a name="l01907"></a>01907       <span class="keywordflow">return</span> 0;
<a name="l01908"></a>01908 
<a name="l01909"></a>01909     <span class="keywordflow">if</span> ( !outline-&gt;<a class="code" href="struct_f_t___outline__.html#a218fdea14003061142ac1045ac50affa">contours</a> || !outline-&gt;<a class="code" href="struct_f_t___outline__.html#a4871896a2f38bdab947e30a7cf6bca04">points</a> )
<a name="l01910"></a>01910       <span class="keywordflow">return</span> <a class="code" href="ftgrays_8c.html#ae5a591c1fc2df77dbf1c713d3cfb28be">ErrRaster_Invalid_Outline</a>;
<a name="l01911"></a>01911 
<a name="l01912"></a>01912     <span class="keywordflow">if</span> ( outline-&gt;<a class="code" href="struct_f_t___outline__.html#a7ebcf3c33231af88655534d1ac02b66e">n_points</a> !=
<a name="l01913"></a>01913            outline-&gt;<a class="code" href="struct_f_t___outline__.html#a218fdea14003061142ac1045ac50affa">contours</a>[outline-&gt;<a class="code" href="struct_f_t___outline__.html#a0313ba9c2c51f10e6b7d7ef97bd946e2">n_contours</a> - 1] + 1 )
<a name="l01914"></a>01914       <span class="keywordflow">return</span> <a class="code" href="ftgrays_8c.html#ae5a591c1fc2df77dbf1c713d3cfb28be">ErrRaster_Invalid_Outline</a>;
<a name="l01915"></a>01915 
<a name="l01916"></a>01916     worker = raster-&gt;<a class="code" href="struct_t_raster__.html#abad968ddaa0f88d709352aaf4d3ad614">worker</a>;
<a name="l01917"></a>01917 
<a name="l01918"></a>01918     <span class="comment">/* if direct mode is not set, we must have a target bitmap */</span>
<a name="l01919"></a>01919     <span class="keywordflow">if</span> ( !( params-&gt;<a class="code" href="struct_f_t___raster___params__.html#a1a28ab69b8296b4378886d1a2b57d333">flags</a> &amp; <a class="code" href="ftimage_8h.html#a83b26348efb1b92915c4927e8a87cb4c">FT_RASTER_FLAG_DIRECT</a> ) )
<a name="l01920"></a>01920     {
<a name="l01921"></a>01921       <span class="keywordflow">if</span> ( !target_map )
<a name="l01922"></a>01922         <span class="keywordflow">return</span> <a class="code" href="ftgrays_8c.html#a42c64a7abfcdf753c14851925bd7da0f">ErrRaster_Invalid_Argument</a>;
<a name="l01923"></a>01923 
<a name="l01924"></a>01924       <span class="comment">/* nothing to do */</span>
<a name="l01925"></a>01925       <span class="keywordflow">if</span> ( !target_map-&gt;width || !target_map-&gt;rows )
<a name="l01926"></a>01926         <span class="keywordflow">return</span> 0;
<a name="l01927"></a>01927 
<a name="l01928"></a>01928       <span class="keywordflow">if</span> ( !target_map-&gt;buffer )
<a name="l01929"></a>01929         <span class="keywordflow">return</span> <a class="code" href="ftgrays_8c.html#a42c64a7abfcdf753c14851925bd7da0f">ErrRaster_Invalid_Argument</a>;
<a name="l01930"></a>01930     }
<a name="l01931"></a>01931 
<a name="l01932"></a>01932     <span class="comment">/* this version does not support monochrome rendering */</span>
<a name="l01933"></a>01933     <span class="keywordflow">if</span> ( !( params-&gt;<a class="code" href="struct_f_t___raster___params__.html#a1a28ab69b8296b4378886d1a2b57d333">flags</a> &amp; <a class="code" href="ftimage_8h.html#a13000ad084c4cb1d878a179aba9763ee">FT_RASTER_FLAG_AA</a> ) )
<a name="l01934"></a>01934       <span class="keywordflow">return</span> <a class="code" href="ftgrays_8c.html#a82ee96034fc68f34601fe16538ce8c3a">ErrRaster_Invalid_Mode</a>;
<a name="l01935"></a>01935 
<a name="l01936"></a>01936     <span class="comment">/* compute clipping box */</span>
<a name="l01937"></a>01937     <span class="keywordflow">if</span> ( !( params-&gt;<a class="code" href="struct_f_t___raster___params__.html#a1a28ab69b8296b4378886d1a2b57d333">flags</a> &amp; <a class="code" href="ftimage_8h.html#a83b26348efb1b92915c4927e8a87cb4c">FT_RASTER_FLAG_DIRECT</a> ) )
<a name="l01938"></a>01938     {
<a name="l01939"></a>01939       <span class="comment">/* compute clip box from target pixmap */</span>
<a name="l01940"></a>01940       ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>.<a class="code" href="struct_f_t___b_box__.html#a1f2a5d0565d496c1d41e43d018f45add">xMin</a> = 0;
<a name="l01941"></a>01941       ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>.<a class="code" href="struct_f_t___b_box__.html#a959ca1d5bc1c5338da0d85c8e7135f4e">yMin</a> = 0;
<a name="l01942"></a>01942       ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>.<a class="code" href="struct_f_t___b_box__.html#ac6da5c44f4cb7b97eef1f438eb69c0ec">xMax</a> = target_map-&gt;width;
<a name="l01943"></a>01943       ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>.<a class="code" href="struct_f_t___b_box__.html#a77084921589f386a8a593ae1f25b1569">yMax</a> = target_map-&gt;rows;
<a name="l01944"></a>01944     }
<a name="l01945"></a>01945     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( params-&gt;<a class="code" href="struct_f_t___raster___params__.html#a1a28ab69b8296b4378886d1a2b57d333">flags</a> &amp; <a class="code" href="ftimage_8h.html#a680cffd057eb1375459fe576791f2b7f">FT_RASTER_FLAG_CLIP</a> )
<a name="l01946"></a>01946       ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a> = params-&gt;<a class="code" href="struct_f_t___raster___params__.html#ab32f75f19d9cacb20e410886c055e306">clip_box</a>;
<a name="l01947"></a>01947     <span class="keywordflow">else</span>
<a name="l01948"></a>01948     {
<a name="l01949"></a>01949       ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>.<a class="code" href="struct_f_t___b_box__.html#a1f2a5d0565d496c1d41e43d018f45add">xMin</a> = -32768L;
<a name="l01950"></a>01950       ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>.<a class="code" href="struct_f_t___b_box__.html#a959ca1d5bc1c5338da0d85c8e7135f4e">yMin</a> = -32768L;
<a name="l01951"></a>01951       ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>.<a class="code" href="struct_f_t___b_box__.html#ac6da5c44f4cb7b97eef1f438eb69c0ec">xMax</a> =  32767L;
<a name="l01952"></a>01952       ras.<a class="code" href="struct_t_worker__.html#afa2a6854110f6e51eecd82eb27da89e9">clip_box</a>.<a class="code" href="struct_f_t___b_box__.html#a77084921589f386a8a593ae1f25b1569">yMax</a> =  32767L;
<a name="l01953"></a>01953     }
<a name="l01954"></a>01954 
<a name="l01955"></a>01955     gray_init_cells( <a class="code" href="ftgrays_8c.html#a80198cd327d489815412c9aa2e4b93c6">RAS_VAR_</a> raster-&gt;<a class="code" href="struct_t_raster__.html#a4e6299014a5ade13d17063a911d4f122">buffer</a>, raster-&gt;<a class="code" href="struct_t_raster__.html#a1b800cee545f7cc1bd5a168de13f580b">buffer_size</a> );
<a name="l01956"></a>01956 
<a name="l01957"></a>01957     ras.<a class="code" href="struct_t_worker__.html#a943f8085950441ac728a25bc49327601">outline</a>        = *outline;
<a name="l01958"></a>01958     ras.<a class="code" href="struct_t_worker__.html#af2565e836b65311cad38b51caec64dfe">num_cells</a>      = 0;
<a name="l01959"></a>01959     ras.<a class="code" href="struct_t_worker__.html#acbf1d08171d29ce1f71651171323c321">invalid</a>        = 1;
<a name="l01960"></a>01960     ras.<a class="code" href="struct_t_worker__.html#af286ee860140e2d0abd1650600bc8586">band_size</a>      = raster-&gt;<a class="code" href="struct_t_raster__.html#acb7d271e9f9f6346d0642c3f8300032c">band_size</a>;
<a name="l01961"></a>01961     ras.<a class="code" href="struct_t_worker__.html#aaf76891630160804f0cef7dd89b635e0">num_gray_spans</a> = 0;
<a name="l01962"></a>01962 
<a name="l01963"></a>01963     <span class="keywordflow">if</span> ( params-&gt;<a class="code" href="struct_f_t___raster___params__.html#a1a28ab69b8296b4378886d1a2b57d333">flags</a> &amp; <a class="code" href="ftimage_8h.html#a83b26348efb1b92915c4927e8a87cb4c">FT_RASTER_FLAG_DIRECT</a> )
<a name="l01964"></a>01964     {
<a name="l01965"></a>01965       ras.<a class="code" href="struct_t_worker__.html#a65f7b375e13f82384dd56bef7451cd39">render_span</a>      = (<a class="code" href="ftimage_8h.html#a27308127a1ced75fcb7c2af04a858a54">FT_Raster_Span_Func</a>)params-&gt;<a class="code" href="struct_f_t___raster___params__.html#a456191f1944775933e3d9d36c8632c35">gray_spans</a>;
<a name="l01966"></a>01966       ras.<a class="code" href="struct_t_worker__.html#a9163ea80b63aee1e18f5b4c111584ec8">render_span_data</a> = params-&gt;<a class="code" href="struct_f_t___raster___params__.html#af78bac59f93c989840bbcbcbefd77c55">user</a>;
<a name="l01967"></a>01967     }
<a name="l01968"></a>01968     <span class="keywordflow">else</span>
<a name="l01969"></a>01969     {
<a name="l01970"></a>01970       ras.<a class="code" href="struct_t_worker__.html#a7bc261f8cce875cf8c78aad7386e8884">target</a>           = *target_map;
<a name="l01971"></a>01971       ras.<a class="code" href="struct_t_worker__.html#a65f7b375e13f82384dd56bef7451cd39">render_span</a>      = (<a class="code" href="ftimage_8h.html#a27308127a1ced75fcb7c2af04a858a54">FT_Raster_Span_Func</a>)gray_render_span;
<a name="l01972"></a>01972       ras.<a class="code" href="struct_t_worker__.html#a9163ea80b63aee1e18f5b4c111584ec8">render_span_data</a> = &amp;<a class="code" href="ftgrays_8c.html#a8e181e0a2fa64bf35d8f9e6994fb1c60">ras</a>;
<a name="l01973"></a>01973     }
<a name="l01974"></a>01974 
<a name="l01975"></a>01975     <span class="keywordflow">return</span> gray_convert_glyph( <a class="code" href="ftgrays_8c.html#a71d83a981d5845ee2392a85c2369311a">RAS_VAR</a> );
<a name="l01976"></a>01976   }
<a name="l01977"></a>01977 
<a name="l01978"></a>01978 
<a name="l01979"></a>01979   <span class="comment">/**** RASTER OBJECT CREATION: In stand-alone mode, we simply use *****/</span>
<a name="l01980"></a>01980   <span class="comment">/****                         a static object.                   *****/</span>
<a name="l01981"></a>01981 
<a name="l01982"></a>01982 <span class="preprocessor">#ifdef _STANDALONE_</span>
<a name="l01983"></a>01983 <span class="preprocessor"></span>
<a name="l01984"></a>01984   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01985"></a>01985   gray_raster_new( <span class="keywordtype">void</span>*       memory,
<a name="l01986"></a>01986                    <a class="code" href="ftimage_8h.html#a6774d2eb4bf030daf319aa6b56347431">FT_Raster</a>*  araster )
<a name="l01987"></a>01987   {
<a name="l01988"></a>01988     <span class="keyword">static</span> <a class="code" href="struct_t_raster__.html">TRaster</a>  the_raster;
<a name="l01989"></a>01989 
<a name="l01990"></a>01990     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( memory );
<a name="l01991"></a>01991 
<a name="l01992"></a>01992 
<a name="l01993"></a>01993     *araster = (<a class="code" href="ftimage_8h.html#a6774d2eb4bf030daf319aa6b56347431">FT_Raster</a>)&amp;the_raster;
<a name="l01994"></a>01994     <a class="code" href="ftgrays_8c.html#ad04dbb2871d7219281966386fffaf909">FT_MEM_ZERO</a>( &amp;the_raster, <span class="keyword">sizeof</span> ( the_raster ) );
<a name="l01995"></a>01995 
<a name="l01996"></a>01996     <span class="keywordflow">return</span> 0;
<a name="l01997"></a>01997   }
<a name="l01998"></a>01998 
<a name="l01999"></a>01999 
<a name="l02000"></a>02000   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02001"></a>02001   gray_raster_done( <a class="code" href="ftimage_8h.html#a6774d2eb4bf030daf319aa6b56347431">FT_Raster</a>  raster )
<a name="l02002"></a>02002   {
<a name="l02003"></a>02003     <span class="comment">/* nothing */</span>
<a name="l02004"></a>02004     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( raster );
<a name="l02005"></a>02005   }
<a name="l02006"></a>02006 
<a name="l02007"></a>02007 <span class="preprocessor">#else </span><span class="comment">/* !_STANDALONE_ */</span>
<a name="l02008"></a>02008 
<a name="l02009"></a>02009   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02010"></a>02010   gray_raster_new( <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>   memory,
<a name="l02011"></a>02011                    <a class="code" href="ftimage_8h.html#a6774d2eb4bf030daf319aa6b56347431">FT_Raster</a>*  araster )
<a name="l02012"></a>02012   {
<a name="l02013"></a>02013     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>  error;
<a name="l02014"></a>02014     PRaster   raster = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02015"></a>02015 
<a name="l02016"></a>02016 
<a name="l02017"></a>02017     *araster = 0;
<a name="l02018"></a>02018     <span class="keywordflow">if</span> ( !<a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( raster, <span class="keyword">sizeof</span> ( <a class="code" href="struct_t_raster__.html">TRaster</a> ) ) )
<a name="l02019"></a>02019     {
<a name="l02020"></a>02020       raster-&gt;<a class="code" href="struct_t_raster__.html#ac0245d05777969f7138e28eeb50a2324">memory</a> = memory;
<a name="l02021"></a>02021       *araster = (<a class="code" href="ftimage_8h.html#a6774d2eb4bf030daf319aa6b56347431">FT_Raster</a>)raster;
<a name="l02022"></a>02022     }
<a name="l02023"></a>02023 
<a name="l02024"></a>02024     <span class="keywordflow">return</span> error;
<a name="l02025"></a>02025   }
<a name="l02026"></a>02026 
<a name="l02027"></a>02027 
<a name="l02028"></a>02028   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02029"></a>02029   gray_raster_done( <a class="code" href="ftimage_8h.html#a6774d2eb4bf030daf319aa6b56347431">FT_Raster</a>  raster )
<a name="l02030"></a>02030   {
<a name="l02031"></a>02031     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = (<a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>)((PRaster)raster)-&gt;memory;
<a name="l02032"></a>02032 
<a name="l02033"></a>02033 
<a name="l02034"></a>02034     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( raster );
<a name="l02035"></a>02035   }
<a name="l02036"></a>02036 
<a name="l02037"></a>02037 <span class="preprocessor">#endif </span><span class="comment">/* !_STANDALONE_ */</span>
<a name="l02038"></a>02038 
<a name="l02039"></a>02039 
<a name="l02040"></a>02040   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02041"></a>02041   gray_raster_reset( <a class="code" href="ftimage_8h.html#a6774d2eb4bf030daf319aa6b56347431">FT_Raster</a>  raster,
<a name="l02042"></a>02042                      <span class="keywordtype">char</span>*      pool_base,
<a name="l02043"></a>02043                      <span class="keywordtype">long</span>       pool_size )
<a name="l02044"></a>02044   {
<a name="l02045"></a>02045     PRaster  rast = (<a class="code" href="ftraster_8c.html#acd4c2764c8a7a1a44c0e794af9db83e7">PRaster</a>)raster;
<a name="l02046"></a>02046 
<a name="l02047"></a>02047 
<a name="l02048"></a>02048     <span class="keywordflow">if</span> ( raster )
<a name="l02049"></a>02049     {
<a name="l02050"></a>02050       <span class="keywordflow">if</span> ( pool_base &amp;&amp; pool_size &gt;= (<span class="keywordtype">long</span>)<span class="keyword">sizeof</span> ( <a class="code" href="ftraster_8c.html#a2084f2281045ebbb173b4350ab0199b5">TWorker</a> ) + 2048 )
<a name="l02051"></a>02051       {
<a name="l02052"></a>02052         PWorker  worker = (<a class="code" href="ftraster_8c.html#a26d77f35fd799cf8597356e8e1351040">PWorker</a>)pool_base;
<a name="l02053"></a>02053 
<a name="l02054"></a>02054 
<a name="l02055"></a>02055         rast-&gt;<a class="code" href="struct_t_raster__.html#abad968ddaa0f88d709352aaf4d3ad614">worker</a>      = worker;
<a name="l02056"></a>02056         rast-&gt;<a class="code" href="struct_t_raster__.html#a4e6299014a5ade13d17063a911d4f122">buffer</a>      = pool_base +
<a name="l02057"></a>02057                               ( ( <span class="keyword">sizeof</span> ( <a class="code" href="ftraster_8c.html#a2084f2281045ebbb173b4350ab0199b5">TWorker</a> ) + <span class="keyword">sizeof</span> ( <a class="code" href="struct_t_cell__.html">TCell</a> ) - 1 ) &amp;
<a name="l02058"></a>02058                                 ~( <span class="keyword">sizeof</span> ( <a class="code" href="struct_t_cell__.html">TCell</a> ) - 1 ) );
<a name="l02059"></a>02059         rast-&gt;<a class="code" href="struct_t_raster__.html#a1b800cee545f7cc1bd5a168de13f580b">buffer_size</a> = (long)( ( pool_base + pool_size ) -
<a name="l02060"></a>02060                                     (<span class="keywordtype">char</span>*)rast-&gt;<a class="code" href="struct_t_raster__.html#a4e6299014a5ade13d17063a911d4f122">buffer</a> ) &amp;
<a name="l02061"></a>02061                                       ~( <span class="keyword">sizeof</span> ( <a class="code" href="ftgrays_8c.html#adffe80f61398f3d06a05e4531ab12876">TCell</a> ) - 1 );
<a name="l02062"></a>02062         rast-&gt;<a class="code" href="struct_t_raster__.html#acb7d271e9f9f6346d0642c3f8300032c">band_size</a>   = (int)( rast-&gt;<a class="code" href="struct_t_raster__.html#a1b800cee545f7cc1bd5a168de13f580b">buffer_size</a> /
<a name="l02063"></a>02063                                      ( <a class="code" href="afmodule_8c.html#a3491b7a4c35805e0432b6b382117c13b">sizeof</a> ( <a class="code" href="struct_t_cell__.html">TCell</a> ) * 8 ) );
<a name="l02064"></a>02064       }
<a name="l02065"></a>02065       <span class="keywordflow">else</span>
<a name="l02066"></a>02066       {
<a name="l02067"></a>02067         rast-&gt;<a class="code" href="struct_t_raster__.html#a4e6299014a5ade13d17063a911d4f122">buffer</a>      = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02068"></a>02068         rast-&gt;<a class="code" href="struct_t_raster__.html#a1b800cee545f7cc1bd5a168de13f580b">buffer_size</a> = 0;
<a name="l02069"></a>02069         rast-&gt;<a class="code" href="struct_t_raster__.html#abad968ddaa0f88d709352aaf4d3ad614">worker</a>      = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02070"></a>02070       }
<a name="l02071"></a>02071     }
<a name="l02072"></a>02072   }
<a name="l02073"></a>02073 
<a name="l02074"></a>02074 
<a name="l02075"></a>02075   <a class="code" href="ftobjs_8h.html#ab0e10a55f5f509562086266168e360ee">FT_DEFINE_RASTER_FUNCS</a>(ft_grays_raster,
<a name="l02076"></a>02076     <a class="code" href="ftrend1_8c.html#acd452025c8ee5551f3623ffb06c208e7">FT_GLYPH_FORMAT_OUTLINE</a>,
<a name="l02077"></a>02077 
<a name="l02078"></a>02078     (<a class="code" href="ftimage_8h.html#ab50a467c3e9e8313c31c14f1e694af34">FT_Raster_New_Func</a>)     gray_raster_new,
<a name="l02079"></a>02079     (<a class="code" href="ftimage_8h.html#a7af295aa684d0354fced2dc791a4de89">FT_Raster_Reset_Func</a>)   gray_raster_reset,
<a name="l02080"></a>02080     (<a class="code" href="ftimage_8h.html#ad86623a6850838c7fec54f4f622c2744">FT_Raster_Set_Mode_Func</a>)0,
<a name="l02081"></a>02081     (<a class="code" href="ftimage_8h.html#a469b1d3125d0032b8c66df3179832657">FT_Raster_Render_Func</a>)  gray_raster_render,
<a name="l02082"></a>02082     (<a class="code" href="ftimage_8h.html#af3fbba4618478eb180ed0ac2ed09e8d6">FT_Raster_Done_Func</a>)    gray_raster_done
<a name="l02083"></a>02083   )
<a name="l02084"></a>02084 
<a name="l02085"></a>02085 
<a name="l02086"></a>02086 <span class="comment">/* END */</span>
<a name="l02087"></a>02087 
<a name="l02088"></a>02088 
<a name="l02089"></a>02089 <span class="comment">/* Local Variables: */</span>
<a name="l02090"></a>02090 <span class="comment">/* coding: utf-8    */</span>
<a name="l02091"></a>02091 <span class="comment">/* End:             */</span>
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ftgrays_8c.html">ftgrays.c</a>      </li>

    <li class="footer">Generated on Tue Mar 13 2012 11:44:04 for ARK2D by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
