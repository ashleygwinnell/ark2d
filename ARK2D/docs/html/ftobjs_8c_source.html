<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ARK2D: src/ARK2D/vendor/android/freetype/jni/src/base/ftobjs.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ARK2D
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ftobjs_8c.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">src/ARK2D/vendor/android/freetype/jni/src/base/ftobjs.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ftobjs_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************/</span>
<a name="l00002"></a>00002 <span class="comment">/*                                                                         */</span>
<a name="l00003"></a>00003 <span class="comment">/*  ftobjs.c                                                               */</span>
<a name="l00004"></a>00004 <span class="comment">/*                                                                         */</span>
<a name="l00005"></a>00005 <span class="comment">/*    The FreeType private base classes (body).                            */</span>
<a name="l00006"></a>00006 <span class="comment">/*                                                                         */</span>
<a name="l00007"></a>00007 <span class="comment">/*  Copyright 1996-2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009,   */</span>
<a name="l00008"></a>00008 <span class="comment">/*            2010 by                                                      */</span>
<a name="l00009"></a>00009 <span class="comment">/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<a name="l00010"></a>00010 <span class="comment">/*                                                                         */</span>
<a name="l00011"></a>00011 <span class="comment">/*  This file is part of the FreeType project, and may only be used,       */</span>
<a name="l00012"></a>00012 <span class="comment">/*  modified, and distributed under the terms of the FreeType project      */</span>
<a name="l00013"></a>00013 <span class="comment">/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<a name="l00014"></a>00014 <span class="comment">/*  this file you indicate that you have read the license and              */</span>
<a name="l00015"></a>00015 <span class="comment">/*  understand and accept it fully.                                        */</span>
<a name="l00016"></a>00016 <span class="comment">/*                                                                         */</span>
<a name="l00017"></a>00017 <span class="comment">/***************************************************************************/</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;<a class="code" href="ft2build_8h.html">ft2build.h</a>&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include FT_LIST_H</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#include FT_OUTLINE_H</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#include FT_INTERNAL_VALIDATE_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#include FT_INTERNAL_OBJECTS_H</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#include FT_INTERNAL_DEBUG_H</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#include FT_INTERNAL_RFORK_H</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#include FT_INTERNAL_STREAM_H</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#include FT_INTERNAL_SFNT_H    </span><span class="comment">/* for SFNT_Load_Table_Func */</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include FT_TRUETYPE_TABLES_H</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span><span class="preprocessor">#include FT_TRUETYPE_TAGS_H</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#include FT_TRUETYPE_IDS_H</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="preprocessor">#include FT_SERVICE_SFNT_H</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#include FT_SERVICE_POSTSCRIPT_NAME_H</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#include FT_SERVICE_GLYPH_DICT_H</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#include FT_SERVICE_TT_CMAP_H</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#include FT_SERVICE_KERNING_H</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#include FT_SERVICE_TRUETYPE_ENGINE_H</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#ifdef FT_CONFIG_OPTION_MAC_FONTS</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="ftbase_8h.html">ftbase.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a><a class="code" href="ftobjs_8c.html#a5a76d57a214bdac4b7d17efce6dd8cf9">00044</a> <span class="preprocessor">#define GRID_FIT_METRICS</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a00f9e6a0ddd7bc55f79b2f4b5b867266">FT_Pointer</a> )
<a name="l00048"></a><a class="code" href="ftobjs_8c.html#aec9a5aefeef799ff91ad8adf228242ab">00048</a>   <a class="code" href="ftserv_8h.html#aec9a5aefeef799ff91ad8adf228242ab">ft_service_list_lookup</a>( <a class="code" href="struct_f_t___service_desc_rec__.html">FT_ServiceDesc</a>  service_descriptors,
<a name="l00049"></a>00049                           <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span>*     service_id )
<a name="l00050"></a>00050   {
<a name="l00051"></a>00051     <a class="code" href="fttypes_8h.html#a00f9e6a0ddd7bc55f79b2f4b5b867266">FT_Pointer</a>      <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00052"></a>00052     <a class="code" href="struct_f_t___service_desc_rec__.html">FT_ServiceDesc</a>  desc   = service_descriptors;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055     <span class="keywordflow">if</span> ( desc &amp;&amp; service_id )
<a name="l00056"></a>00056     {
<a name="l00057"></a>00057       <span class="keywordflow">for</span> ( ; desc-&gt;<a class="code" href="struct_f_t___service_desc_rec__.html#ab706270db01e1398233571f10bd249d4">serv_id</a> != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; desc++ )
<a name="l00058"></a>00058       {
<a name="l00059"></a>00059         <span class="keywordflow">if</span> ( <a class="code" href="ftstdlib_8h.html#a6b4c8a4f84eee3fe618812761ae78adb">ft_strcmp</a>( desc-&gt;<a class="code" href="struct_f_t___service_desc_rec__.html#ab706270db01e1398233571f10bd249d4">serv_id</a>, service_id ) == 0 )
<a name="l00060"></a>00060         {
<a name="l00061"></a>00061           result = (<a class="code" href="fttypes_8h.html#a00f9e6a0ddd7bc55f79b2f4b5b867266">FT_Pointer</a>)desc-&gt;<a class="code" href="struct_f_t___service_desc_rec__.html#aa597a33a2b0d099ec32882dc6aa38d59">serv_data</a>;
<a name="l00062"></a>00062           <span class="keywordflow">break</span>;
<a name="l00063"></a>00063         }
<a name="l00064"></a>00064       }
<a name="l00065"></a>00065     }
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l00068"></a>00068   }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l00072"></a><a class="code" href="ftobjs_8c.html#a6042da97a44e287d5d99b459aae11ea0">00072</a>   <a class="code" href="ftvalid_8h.html#a6042da97a44e287d5d99b459aae11ea0">ft_validator_init</a>( <a class="code" href="ftvalid_8h.html#ab9ceda164f3e9d44345b2199b1d7838a">FT_Validator</a>        valid,
<a name="l00073"></a>00073                      <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*      base,
<a name="l00074"></a>00074                      <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*      limit,
<a name="l00075"></a>00075                      <a class="code" href="ftvalid_8h.html#a43709eb091f99dc7ae5f68f83cf2d670">FT_ValidationLevel</a>  level )
<a name="l00076"></a>00076   {
<a name="l00077"></a>00077     valid-&gt;base  = base;
<a name="l00078"></a>00078     valid-&gt;limit = limit;
<a name="l00079"></a>00079     valid-&gt;level = level;
<a name="l00080"></a>00080     valid-&gt;error = FT_Err_Ok;
<a name="l00081"></a>00081   }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a> )
<a name="l00085"></a><a class="code" href="ftobjs_8c.html#a40b463141ddaf56437d42b1f9b7894ef">00085</a>   <a class="code" href="ftvalid_8h.html#a40b463141ddaf56437d42b1f9b7894ef">ft_validator_run</a>( <a class="code" href="ftvalid_8h.html#ab9ceda164f3e9d44345b2199b1d7838a">FT_Validator</a>  valid )
<a name="l00086"></a>00086   {
<a name="l00087"></a>00087     <span class="comment">/* This function doesn&#39;t work!  None should call it. */</span>
<a name="l00088"></a>00088     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( valid );
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keywordflow">return</span> -1;
<a name="l00091"></a>00091   }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 
<a name="l00094"></a>00094   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l00095"></a><a class="code" href="ftobjs_8c.html#a9504bbbfc7751a25a39d1330f92655b3">00095</a>   <a class="code" href="ftvalid_8h.html#a9504bbbfc7751a25a39d1330f92655b3">ft_validator_error</a>( <a class="code" href="ftvalid_8h.html#ab9ceda164f3e9d44345b2199b1d7838a">FT_Validator</a>  valid,
<a name="l00096"></a>00096                       <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>      error )
<a name="l00097"></a>00097   {
<a name="l00098"></a>00098     <span class="comment">/* since the cast below also disables the compiler&#39;s */</span>
<a name="l00099"></a>00099     <span class="comment">/* type check, we introduce a dummy variable, which  */</span>
<a name="l00100"></a>00100     <span class="comment">/* will be optimized away                            */</span>
<a name="l00101"></a>00101     <span class="keyword">volatile</span> <a class="code" href="ftstdlib_8h.html#a4c13ff957e7b63737a04c178c5b0fd86">ft_jmp_buf</a>* jump_buffer = &amp;valid-&gt;jump_buffer;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     valid-&gt;error = error;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <span class="comment">/* throw away volatileness; use `jump_buffer&#39; or the  */</span>
<a name="l00107"></a>00107     <span class="comment">/* compiler may warn about an unused local variable   */</span>
<a name="l00108"></a>00108     <a class="code" href="ftstdlib_8h.html#a5a5bcdc06f1f7716f5a7d11360962f3b">ft_longjmp</a>( *(<a class="code" href="ftstdlib_8h.html#a4c13ff957e7b63737a04c178c5b0fd86">ft_jmp_buf</a>*) jump_buffer, 1 );
<a name="l00109"></a>00109   }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 
<a name="l00112"></a>00112   <span class="comment">/*************************************************************************/</span>
<a name="l00113"></a>00113   <span class="comment">/*************************************************************************/</span>
<a name="l00114"></a>00114   <span class="comment">/*************************************************************************/</span>
<a name="l00115"></a>00115   <span class="comment">/****                                                                 ****/</span>
<a name="l00116"></a>00116   <span class="comment">/****                                                                 ****/</span>
<a name="l00117"></a>00117   <span class="comment">/****                           S T R E A M                           ****/</span>
<a name="l00118"></a>00118   <span class="comment">/****                                                                 ****/</span>
<a name="l00119"></a>00119   <span class="comment">/****                                                                 ****/</span>
<a name="l00120"></a>00120   <span class="comment">/*************************************************************************/</span>
<a name="l00121"></a>00121   <span class="comment">/*************************************************************************/</span>
<a name="l00122"></a>00122   <span class="comment">/*************************************************************************/</span>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="comment">/* create a new input stream from an FT_Open_Args structure */</span>
<a name="l00126"></a>00126   <span class="comment">/*                                                          */</span>
<a name="l00127"></a>00127   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l00128"></a><a class="code" href="ftobjs_8c.html#ab33e9c576d1ce3850acacddcdfea8692">00128</a>   <a class="code" href="ftstream_8h.html#ab33e9c576d1ce3850acacddcdfea8692">FT_Stream_New</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>           library,
<a name="l00129"></a>00129                  <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>*  args,
<a name="l00130"></a>00130                  <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>           *astream )
<a name="l00131"></a>00131   {
<a name="l00132"></a>00132     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l00133"></a>00133     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory;
<a name="l00134"></a>00134     <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>  stream;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     *astream = 0;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="keywordflow">if</span> ( !library )
<a name="l00140"></a>00140       <span class="keywordflow">return</span> FT_Err_Invalid_Library_Handle;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <span class="keywordflow">if</span> ( !args )
<a name="l00143"></a>00143       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     memory = library-&gt;<a class="code" href="struct_f_t___stream_rec__.html#a51e2be0d80d70b532aae3face5461e7e">memory</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a313d8de417ea0d1c5fcc7d348397a642">FT_NEW</a>( stream ) )
<a name="l00148"></a>00148       <span class="keywordflow">goto</span> Exit;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     stream-&gt;<a class="code" href="struct_f_t___stream_rec__.html#a51e2be0d80d70b532aae3face5461e7e">memory</a> = memory;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="keywordflow">if</span> ( args-&gt;flags &amp; <a class="code" href="freetype_8h.html#a837da9c40d77ad29705b240d406e828c">FT_OPEN_MEMORY</a> )
<a name="l00153"></a>00153     {
<a name="l00154"></a>00154       <span class="comment">/* create a memory-based stream */</span>
<a name="l00155"></a>00155       <a class="code" href="ftstream_8h.html#adef0df22d5202d491bd9c8a93fb4bffd">FT_Stream_OpenMemory</a>( stream,
<a name="l00156"></a>00156                             (<span class="keyword">const</span> <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*)args-&gt;memory_base,
<a name="l00157"></a>00157                             args-&gt;memory_size );
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( args-&gt;flags &amp; <a class="code" href="freetype_8h.html#a22ee89452169a0faf9f1ad797499e4bc">FT_OPEN_PATHNAME</a> )
<a name="l00160"></a>00160     {
<a name="l00161"></a>00161       <span class="comment">/* create a normal system stream */</span>
<a name="l00162"></a>00162       error = <a class="code" href="ftstream_8h.html#a80669a3b6fb4d8ad8187866fc3db25aa">FT_Stream_Open</a>( stream, args-&gt;<a class="code" href="struct_f_t___stream_rec__.html#afd75c5de5ed78c484a200a7e97ef5a41">pathname</a> );
<a name="l00163"></a>00163       stream-&gt;<a class="code" href="struct_f_t___stream_rec__.html#afd75c5de5ed78c484a200a7e97ef5a41">pathname</a>.<a class="code" href="union_f_t___stream_desc__.html#a410ed102dc377fb9a5b9c950c3f863dc">pointer</a> = args-&gt;pathname;
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( args-&gt;flags &amp; <a class="code" href="freetype_8h.html#aedfb4f733ac38dfa5859d83660f31bc2">FT_OPEN_STREAM</a> ) &amp;&amp; args-&gt;stream )
<a name="l00166"></a>00166     {
<a name="l00167"></a>00167       <span class="comment">/* use an existing, user-provided stream */</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169       <span class="comment">/* in this case, we do not need to allocate a new stream object */</span>
<a name="l00170"></a>00170       <span class="comment">/* since the caller is responsible for closing it himself       */</span>
<a name="l00171"></a>00171       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( stream );
<a name="l00172"></a>00172       stream = args-&gt;stream;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174     <span class="keywordflow">else</span>
<a name="l00175"></a>00175       error = FT_Err_Invalid_Argument;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     <span class="keywordflow">if</span> ( error )
<a name="l00178"></a>00178       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( stream );
<a name="l00179"></a>00179     <span class="keywordflow">else</span>
<a name="l00180"></a>00180       stream-&gt;<a class="code" href="struct_f_t___stream_rec__.html#a51e2be0d80d70b532aae3face5461e7e">memory</a> = memory;  <span class="comment">/* just to be certain */</span>
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     *astream = stream;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   Exit:
<a name="l00185"></a>00185     <span class="keywordflow">return</span> error;
<a name="l00186"></a>00186   }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l00190"></a><a class="code" href="ftobjs_8c.html#ac2619fbc2d12358691456bf1bf312710">00190</a>   <a class="code" href="ftstream_8h.html#ac2619fbc2d12358691456bf1bf312710">FT_Stream_Free</a>( <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>  stream,
<a name="l00191"></a>00191                   <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     external )
<a name="l00192"></a>00192   {
<a name="l00193"></a>00193     <span class="keywordflow">if</span> ( stream )
<a name="l00194"></a>00194     {
<a name="l00195"></a>00195       <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = stream-&gt;memory;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00198"></a>00198       <a class="code" href="ftstream_8h.html#a593fa53a196798f63d80b7bfc25a1e7a">FT_Stream_Close</a>( stream );
<a name="l00199"></a>00199 
<a name="l00200"></a>00200       <span class="keywordflow">if</span> ( !external )
<a name="l00201"></a>00201         <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( stream );
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <span class="comment">/*************************************************************************/</span>
<a name="l00207"></a>00207   <span class="comment">/*                                                                       */</span>
<a name="l00208"></a>00208   <span class="comment">/* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<a name="l00209"></a>00209   <span class="comment">/* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<a name="l00210"></a>00210   <span class="comment">/* messages during execution.                                            */</span>
<a name="l00211"></a>00211   <span class="comment">/*                                                                       */</span>
<a name="l00212"></a>00212 <span class="preprocessor">#undef  FT_COMPONENT</span>
<a name="l00213"></a><a class="code" href="ftobjs_8c.html#a9c208ea57bc9a5fcbfc81a6106d28f3a">00213</a> <span class="preprocessor"></span><span class="preprocessor">#define FT_COMPONENT  trace_objs</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span>
<a name="l00215"></a>00215 
<a name="l00216"></a>00216   <span class="comment">/*************************************************************************/</span>
<a name="l00217"></a>00217   <span class="comment">/*************************************************************************/</span>
<a name="l00218"></a>00218   <span class="comment">/*************************************************************************/</span>
<a name="l00219"></a>00219   <span class="comment">/****                                                                 ****/</span>
<a name="l00220"></a>00220   <span class="comment">/****                                                                 ****/</span>
<a name="l00221"></a>00221   <span class="comment">/****               FACE, SIZE &amp; GLYPH SLOT OBJECTS                   ****/</span>
<a name="l00222"></a>00222   <span class="comment">/****                                                                 ****/</span>
<a name="l00223"></a>00223   <span class="comment">/****                                                                 ****/</span>
<a name="l00224"></a>00224   <span class="comment">/*************************************************************************/</span>
<a name="l00225"></a>00225   <span class="comment">/*************************************************************************/</span>
<a name="l00226"></a>00226   <span class="comment">/*************************************************************************/</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l00230"></a>00230   ft_glyphslot_init( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot )
<a name="l00231"></a>00231   {
<a name="l00232"></a>00232     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>         driver   = slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a0f5dbaf7d539bf2d92ecdff740342b04">face</a>-&gt;<a class="code" href="struct_f_t___face_rec__.html#a011b62fcffdd6dc421c9ab3286d4c9fa">driver</a>;
<a name="l00233"></a>00233     <a class="code" href="struct_f_t___driver___class_rec__.html">FT_Driver_Class</a>   clazz    = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>;
<a name="l00234"></a>00234     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>         memory   = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>;
<a name="l00235"></a>00235     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>          error    = FT_Err_Ok;
<a name="l00236"></a>00236     <a class="code" href="struct_f_t___slot___internal_rec__.html">FT_Slot_Internal</a>  <span class="keyword">internal</span> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a5415bcbf70efb3aae7a6b77040e21e91">library</a> = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#ac3d04fbdc2988bf9a39f4ad6d3cb4b5f">library</a>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a313d8de417ea0d1c5fcc7d348397a642">FT_NEW</a>( <span class="keyword">internal</span> ) )
<a name="l00242"></a>00242       <span class="keywordflow">goto</span> Exit;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a91731fd527eeab1d1acf3e1aea4bea84">internal</a> = <span class="keyword">internal</span>;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a2f1d4f391a7a5ef53ee949ea82939685">FT_DRIVER_USES_OUTLINES</a>( driver ) )
<a name="l00247"></a>00247       error = <a class="code" href="ftgloadr_8h.html#ad9956ad2ed4b3dfc8da30f4e3e274a49">FT_GlyphLoader_New</a>( memory, &amp;internal-&gt;loader );
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="keywordflow">if</span> ( !error &amp;&amp; clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#ae4e1d4ec7bdbdee0b4a5f8fc8f113d30">init_slot</a> )
<a name="l00250"></a>00250       error = clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#ae4e1d4ec7bdbdee0b4a5f8fc8f113d30">init_slot</a>( slot );
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   Exit:
<a name="l00253"></a>00253     <span class="keywordflow">return</span> error;
<a name="l00254"></a>00254   }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l00258"></a><a class="code" href="ftobjs_8c.html#a52d02a8004f8bd4afb3f8d9734dc0937">00258</a>   <a class="code" href="ftobjs_8h.html#a52d02a8004f8bd4afb3f8d9734dc0937">ft_glyphslot_free_bitmap</a>( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot )
<a name="l00259"></a>00259   {
<a name="l00260"></a>00260     <span class="keywordflow">if</span> ( slot-&gt;internal &amp;&amp; ( slot-&gt;internal-&gt;flags &amp; <a class="code" href="ftobjs_8h.html#abca6a142bf605350abbe1a4f48527a47">FT_GLYPH_OWN_BITMAP</a> ) )
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262       <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = <a class="code" href="ftobjs_8h.html#a901bd8bdda45194f96f942684bc02510">FT_FACE_MEMORY</a>( slot-&gt;face );
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 
<a name="l00265"></a>00265       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( slot-&gt;bitmap.buffer );
<a name="l00266"></a>00266       slot-&gt;internal-&gt;flags &amp;= ~<a class="code" href="ftobjs_8h.html#abca6a142bf605350abbe1a4f48527a47">FT_GLYPH_OWN_BITMAP</a>;
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268     <span class="keywordflow">else</span>
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270       <span class="comment">/* assume that the bitmap buffer was stolen or not */</span>
<a name="l00271"></a>00271       <span class="comment">/* allocated from the heap                         */</span>
<a name="l00272"></a>00272       slot-&gt;bitmap.buffer = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274   }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l00278"></a><a class="code" href="ftobjs_8c.html#af346be9cfe3378c90b13241a80daea8d">00278</a>   <a class="code" href="ftobjs_8h.html#af346be9cfe3378c90b13241a80daea8d">ft_glyphslot_set_bitmap</a>( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot,
<a name="l00279"></a>00279                            <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*      buffer )
<a name="l00280"></a>00280   {
<a name="l00281"></a>00281     <a class="code" href="ftobjs_8h.html#a52d02a8004f8bd4afb3f8d9734dc0937">ft_glyphslot_free_bitmap</a>( slot );
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     slot-&gt;bitmap.buffer = buffer;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <a class="code" href="ftdebug_8h.html#a0edcd80581eabc970a562c5d284d5e7e">FT_ASSERT</a>( (slot-&gt;internal-&gt;flags &amp; <a class="code" href="ftobjs_8h.html#abca6a142bf605350abbe1a4f48527a47">FT_GLYPH_OWN_BITMAP</a>) == 0 );
<a name="l00286"></a>00286   }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l00290"></a><a class="code" href="ftobjs_8c.html#ae581f823ef9302fd3755a34230d798b0">00290</a>   <a class="code" href="ftobjs_8h.html#ae581f823ef9302fd3755a34230d798b0">ft_glyphslot_alloc_bitmap</a>( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot,
<a name="l00291"></a>00291                              <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>      <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a> )
<a name="l00292"></a>00292   {
<a name="l00293"></a>00293     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = <a class="code" href="ftobjs_8h.html#a901bd8bdda45194f96f942684bc02510">FT_FACE_MEMORY</a>( slot-&gt;face );
<a name="l00294"></a>00294     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="keywordflow">if</span> ( slot-&gt;internal-&gt;flags &amp; <a class="code" href="ftobjs_8h.html#abca6a142bf605350abbe1a4f48527a47">FT_GLYPH_OWN_BITMAP</a> )
<a name="l00298"></a>00298       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( slot-&gt;bitmap.buffer );
<a name="l00299"></a>00299     <span class="keywordflow">else</span>
<a name="l00300"></a>00300       slot-&gt;internal-&gt;flags |= <a class="code" href="ftobjs_8h.html#abca6a142bf605350abbe1a4f48527a47">FT_GLYPH_OWN_BITMAP</a>;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     (void)<a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( slot-&gt;bitmap.buffer, size );
<a name="l00303"></a>00303     <span class="keywordflow">return</span> error;
<a name="l00304"></a>00304   }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00308"></a>00308   ft_glyphslot_clear( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot )
<a name="l00309"></a>00309   {
<a name="l00310"></a>00310     <span class="comment">/* free bitmap if needed */</span>
<a name="l00311"></a>00311     <a class="code" href="ftobjs_8h.html#a52d02a8004f8bd4afb3f8d9734dc0937">ft_glyphslot_free_bitmap</a>( slot );
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="comment">/* clear all public fields in the glyph slot */</span>
<a name="l00314"></a>00314     <a class="code" href="ftmemory_8h.html#a88db9f3d12c144b9f450c80ec62dc4fc">FT_ZERO</a>( &amp;slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#abe1ba307281c06a232f50e34c061ce7b">metrics</a> );
<a name="l00315"></a>00315     <a class="code" href="ftmemory_8h.html#a88db9f3d12c144b9f450c80ec62dc4fc">FT_ZERO</a>( &amp;slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a8e46dd5d808079bdcba68056d6476d8d">outline</a> );
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a8c50199e30b763b8e2a645af04a1f293">bitmap</a>.<a class="code" href="struct_f_t___bitmap__.html#a7b5e6252dd91a3809fe80ebbeb6720eb">width</a>      = 0;
<a name="l00318"></a>00318     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a8c50199e30b763b8e2a645af04a1f293">bitmap</a>.<a class="code" href="struct_f_t___bitmap__.html#a1b6bb20b30fe087e3fc87a0eb37730c0">rows</a>       = 0;
<a name="l00319"></a>00319     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a8c50199e30b763b8e2a645af04a1f293">bitmap</a>.<a class="code" href="struct_f_t___bitmap__.html#afdee595846e1188c7a76d0cec9d85cf2">pitch</a>      = 0;
<a name="l00320"></a>00320     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a8c50199e30b763b8e2a645af04a1f293">bitmap</a>.<a class="code" href="struct_f_t___bitmap__.html#a5cc5e0fe42a93a86e16706ad52e087a2">pixel_mode</a> = 0;
<a name="l00321"></a>00321     <span class="comment">/* `slot-&gt;bitmap.buffer&#39; has been handled by ft_glyphslot_free_bitmap */</span>
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a7e47f0471336ac68e3c72312a3349dc4">bitmap_left</a>   = 0;
<a name="l00324"></a>00324     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a0c150c0fb007e49fe4b9db6a69df53b7">bitmap_top</a>    = 0;
<a name="l00325"></a>00325     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a5753b48d7165b08f106de3ad7c12bdd7">num_subglyphs</a> = 0;
<a name="l00326"></a>00326     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a295f5a3108399c4c0703e6ee2f88cc67">subglyphs</a>     = 0;
<a name="l00327"></a>00327     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a2af67814d985bcdfcffdf7e8a36ebbdf">control_data</a>  = 0;
<a name="l00328"></a>00328     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a7a088255cb09abe42f19f650f48b6b3f">control_len</a>   = 0;
<a name="l00329"></a>00329     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#ad0c5ab51842f178ba571bab2874f1bdb">other</a>         = 0;
<a name="l00330"></a>00330     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#afcd35188ff4c3d5cbb518602d05b2807">format</a>        = FT_GLYPH_FORMAT_NONE;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a9d0ba6b09729d4f009ef380e267607c3">linearHoriAdvance</a> = 0;
<a name="l00333"></a>00333     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#abc10f58c3d859e46694515956aa4a1e8">linearVertAdvance</a> = 0;
<a name="l00334"></a>00334     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a7d0d8c2eda28e38541e953186ecab89a">lsb_delta</a>         = 0;
<a name="l00335"></a>00335     slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a2ca5f5e7b92df3aee4584949fa6a2a1c">rsb_delta</a>         = 0;
<a name="l00336"></a>00336   }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 
<a name="l00339"></a>00339   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00340"></a>00340   ft_glyphslot_done( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot )
<a name="l00341"></a>00341   {
<a name="l00342"></a>00342     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>        driver = slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a0f5dbaf7d539bf2d92ecdff740342b04">face</a>-&gt;<a class="code" href="struct_f_t___face_rec__.html#a011b62fcffdd6dc421c9ab3286d4c9fa">driver</a>;
<a name="l00343"></a>00343     <a class="code" href="struct_f_t___driver___class_rec__.html">FT_Driver_Class</a>  clazz  = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>;
<a name="l00344"></a>00344     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>        memory = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a548a343f5921f5d341142bf3743c42d4">done_slot</a> )
<a name="l00348"></a>00348       clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a548a343f5921f5d341142bf3743c42d4">done_slot</a>( slot );
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="comment">/* free bitmap buffer if needed */</span>
<a name="l00351"></a>00351     <a class="code" href="ftobjs_8h.html#a52d02a8004f8bd4afb3f8d9734dc0937">ft_glyphslot_free_bitmap</a>( slot );
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="comment">/* slot-&gt;internal might be NULL in out-of-memory situations */</span>
<a name="l00354"></a>00354     <span class="keywordflow">if</span> ( slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a91731fd527eeab1d1acf3e1aea4bea84">internal</a> )
<a name="l00355"></a>00355     {
<a name="l00356"></a>00356       <span class="comment">/* free glyph loader */</span>
<a name="l00357"></a>00357       <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a2f1d4f391a7a5ef53ee949ea82939685">FT_DRIVER_USES_OUTLINES</a>( driver ) )
<a name="l00358"></a>00358       {
<a name="l00359"></a>00359         <a class="code" href="ftgloadr_8h.html#a920c9ede2b8f63e3dd25f51daee360ab">FT_GlyphLoader_Done</a>( slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a91731fd527eeab1d1acf3e1aea4bea84">internal</a>-&gt;<a class="code" href="struct_f_t___slot___internal_rec__.html#ac57f8c939f667938ab9f986088c15d8f">loader</a> );
<a name="l00360"></a>00360         slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a91731fd527eeab1d1acf3e1aea4bea84">internal</a>-&gt;<a class="code" href="struct_f_t___slot___internal_rec__.html#ac57f8c939f667938ab9f986088c15d8f">loader</a> = 0;
<a name="l00361"></a>00361       }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a91731fd527eeab1d1acf3e1aea4bea84">internal</a> );
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365   }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 
<a name="l00368"></a>00368   <span class="comment">/* documentation is in ftobjs.h */</span>
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l00371"></a><a class="code" href="ftobjs_8c.html#a6b8a7296866810c4feff8dc562e55c4c">00371</a>   <a class="code" href="ftobjs_8h.html#a6b8a7296866810c4feff8dc562e55c4c">FT_New_GlyphSlot</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>        face,
<a name="l00372"></a>00372                     <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  *aslot )
<a name="l00373"></a>00373   {
<a name="l00374"></a>00374     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>         error;
<a name="l00375"></a>00375     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>        driver;
<a name="l00376"></a>00376     <a class="code" href="struct_f_t___driver___class_rec__.html">FT_Driver_Class</a>  clazz;
<a name="l00377"></a>00377     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>        memory;
<a name="l00378"></a>00378     <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>     slot;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <span class="keywordflow">if</span> ( !face || !face-&gt;driver )
<a name="l00382"></a>00382       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     driver = face-&gt;driver;
<a name="l00385"></a>00385     clazz  = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>;
<a name="l00386"></a>00386     memory = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <a class="code" href="ftdebug_8h.html#ad7e98818b876c5493b441d7516bf34a0">FT_TRACE4</a>(( <span class="stringliteral">&quot;FT_New_GlyphSlot: Creating new slot object\n&quot;</span> ));
<a name="l00389"></a>00389     <span class="keywordflow">if</span> ( !<a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( slot, clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#adcce7eb86dd7c763b622818cfcde99a6">slot_object_size</a> ) )
<a name="l00390"></a>00390     {
<a name="l00391"></a>00391       slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a0f5dbaf7d539bf2d92ecdff740342b04">face</a> = face;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393       error = ft_glyphslot_init( slot );
<a name="l00394"></a>00394       <span class="keywordflow">if</span> ( error )
<a name="l00395"></a>00395       {
<a name="l00396"></a>00396         ft_glyphslot_done( slot );
<a name="l00397"></a>00397         <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( slot );
<a name="l00398"></a>00398         <span class="keywordflow">goto</span> Exit;
<a name="l00399"></a>00399       }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401       slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#af339309df5ebe70dfa62a9f4f8838440">next</a>  = face-&gt;glyph;
<a name="l00402"></a>00402       face-&gt;glyph = slot;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404       <span class="keywordflow">if</span> ( aslot )
<a name="l00405"></a>00405         *aslot = slot;
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( aslot )
<a name="l00408"></a>00408       *aslot = 0;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   Exit:
<a name="l00412"></a>00412     <a class="code" href="ftdebug_8h.html#ad7e98818b876c5493b441d7516bf34a0">FT_TRACE4</a>(( <span class="stringliteral">&quot;FT_New_GlyphSlot: Return %d\n&quot;</span>, error ));
<a name="l00413"></a>00413     <span class="keywordflow">return</span> error;
<a name="l00414"></a>00414   }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 
<a name="l00417"></a>00417   <span class="comment">/* documentation is in ftobjs.h */</span>
<a name="l00418"></a>00418 
<a name="l00419"></a>00419   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l00420"></a><a class="code" href="ftobjs_8c.html#ad0c3fbaead98eb3dc1e8dec850691b8e">00420</a>   <a class="code" href="ftobjs_8h.html#ad0c3fbaead98eb3dc1e8dec850691b8e">FT_Done_GlyphSlot</a>( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot )
<a name="l00421"></a>00421   {
<a name="l00422"></a>00422     <span class="keywordflow">if</span> ( slot )
<a name="l00423"></a>00423     {
<a name="l00424"></a>00424       <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>     driver = slot-&gt;face-&gt;driver;
<a name="l00425"></a>00425       <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>     memory = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>;
<a name="l00426"></a>00426       <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  prev;
<a name="l00427"></a>00427       <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  cur;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 
<a name="l00430"></a>00430       <span class="comment">/* Remove slot from its parent face&#39;s list */</span>
<a name="l00431"></a>00431       prev = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00432"></a>00432       cur  = slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a0f5dbaf7d539bf2d92ecdff740342b04">face</a>-&gt;<a class="code" href="struct_f_t___face_rec__.html#aea701e6584693e684acf300edb28d8f6">glyph</a>;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434       <span class="keywordflow">while</span> ( cur )
<a name="l00435"></a>00435       {
<a name="l00436"></a>00436         <span class="keywordflow">if</span> ( cur == slot )
<a name="l00437"></a>00437         {
<a name="l00438"></a>00438           <span class="keywordflow">if</span> ( !prev )
<a name="l00439"></a>00439             slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a0f5dbaf7d539bf2d92ecdff740342b04">face</a>-&gt;<a class="code" href="struct_f_t___face_rec__.html#aea701e6584693e684acf300edb28d8f6">glyph</a> = cur-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#af339309df5ebe70dfa62a9f4f8838440">next</a>;
<a name="l00440"></a>00440           <span class="keywordflow">else</span>
<a name="l00441"></a>00441             prev-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#af339309df5ebe70dfa62a9f4f8838440">next</a> = cur-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#af339309df5ebe70dfa62a9f4f8838440">next</a>;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443           ft_glyphslot_done( slot );
<a name="l00444"></a>00444           <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( slot );
<a name="l00445"></a>00445           <span class="keywordflow">break</span>;
<a name="l00446"></a>00446         }
<a name="l00447"></a>00447         prev = cur;
<a name="l00448"></a>00448         cur  = cur-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#af339309df5ebe70dfa62a9f4f8838440">next</a>;
<a name="l00449"></a>00449       }
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451   }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 
<a name="l00454"></a>00454   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l00455"></a>00455 
<a name="l00456"></a>00456   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <span class="keywordtype">void</span> )
<a name="l00457"></a><a class="code" href="ftobjs_8c.html#a0b6b8de9867c8f91918847861d43ede8">00457</a>   <a class="code" href="freetype_8h.html#a0b6b8de9867c8f91918847861d43ede8">FT_Set_Transform</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>     face,
<a name="l00458"></a>00458                     <a class="code" href="struct_f_t___matrix__.html">FT_Matrix</a>*  matrix,
<a name="l00459"></a>00459                     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  delta )
<a name="l00460"></a>00460   {
<a name="l00461"></a>00461     <a class="code" href="struct_f_t___face___internal_rec__.html">FT_Face_Internal</a>  <span class="keyword">internal</span>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="keywordflow">if</span> ( !face )
<a name="l00465"></a>00465       <span class="keywordflow">return</span>;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <span class="keyword">internal</span> = face-&gt;internal;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <span class="keyword">internal</span>-&gt;<a class="code" href="struct_f_t___face___internal_rec__.html#a2495aced35040e1b7c2bc0afcd7a920d">transform_flags</a> = 0;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="keywordflow">if</span> ( !matrix )
<a name="l00472"></a>00472     {
<a name="l00473"></a>00473       <span class="keyword">internal</span>-&gt;transform_matrix.xx = 0x10000L;
<a name="l00474"></a>00474       <span class="keyword">internal</span>-&gt;transform_matrix.xy = 0;
<a name="l00475"></a>00475       <span class="keyword">internal</span>-&gt;transform_matrix.yx = 0;
<a name="l00476"></a>00476       <span class="keyword">internal</span>-&gt;transform_matrix.yy = 0x10000L;
<a name="l00477"></a>00477       matrix = &amp;<span class="keyword">internal</span>-&gt;transform_matrix;
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479     <span class="keywordflow">else</span>
<a name="l00480"></a>00480       <span class="keyword">internal</span>-&gt;transform_matrix = *matrix;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="comment">/* set transform_flags bit flag 0 if `matrix&#39; isn&#39;t the identity */</span>
<a name="l00483"></a>00483     <span class="keywordflow">if</span> ( ( matrix-&gt;xy | matrix-&gt;yx ) ||
<a name="l00484"></a>00484          matrix-&gt;xx != 0x10000L      ||
<a name="l00485"></a>00485          matrix-&gt;yy != 0x10000L      )
<a name="l00486"></a>00486       <span class="keyword">internal</span>-&gt;transform_flags |= 1;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <span class="keywordflow">if</span> ( !delta )
<a name="l00489"></a>00489     {
<a name="l00490"></a>00490       <span class="keyword">internal</span>-&gt;transform_delta.x = 0;
<a name="l00491"></a>00491       <span class="keyword">internal</span>-&gt;transform_delta.y = 0;
<a name="l00492"></a>00492       delta = &amp;<span class="keyword">internal</span>-&gt;transform_delta;
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494     <span class="keywordflow">else</span>
<a name="l00495"></a>00495       <span class="keyword">internal</span>-&gt;transform_delta = *delta;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="comment">/* set transform_flags bit flag 1 if `delta&#39; isn&#39;t the null vector */</span>
<a name="l00498"></a>00498     <span class="keywordflow">if</span> ( delta-&gt;x | delta-&gt;y )
<a name="l00499"></a>00499       <span class="keyword">internal</span>-&gt;transform_flags |= 2;
<a name="l00500"></a>00500   }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <span class="keyword">static</span> <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>
<a name="l00504"></a>00504   ft_lookup_glyph_renderer( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot );
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 <span class="preprocessor">#ifdef GRID_FIT_METRICS</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00509"></a>00509   ft_glyphslot_grid_fit_metrics( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot,
<a name="l00510"></a>00510                                  <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>       vertical )
<a name="l00511"></a>00511   {
<a name="l00512"></a>00512     <a class="code" href="freetype_8h.html#aba844698c24c1c12727c60a6fc0a9b3d">FT_Glyph_Metrics</a>*  <a class="code" href="fterrdef_8h.html#a5b089f80b4f1f749dfb33220373bde32">metrics</a> = &amp;slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#abe1ba307281c06a232f50e34c061ce7b">metrics</a>;
<a name="l00513"></a>00513     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>             right, bottom;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <span class="keywordflow">if</span> ( vertical )
<a name="l00517"></a>00517     {
<a name="l00518"></a>00518       metrics-&gt;horiBearingX = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( metrics-&gt;horiBearingX );
<a name="l00519"></a>00519       metrics-&gt;horiBearingY = <a class="code" href="ftobjs_8h.html#a026611252cfb0918ade2d44996fac3e1">FT_PIX_CEIL</a> ( metrics-&gt;horiBearingY );
<a name="l00520"></a>00520 
<a name="l00521"></a>00521       right  = <a class="code" href="ftobjs_8h.html#a026611252cfb0918ade2d44996fac3e1">FT_PIX_CEIL</a>( metrics-&gt;vertBearingX + metrics-&gt;width );
<a name="l00522"></a>00522       bottom = <a class="code" href="ftobjs_8h.html#a026611252cfb0918ade2d44996fac3e1">FT_PIX_CEIL</a>( metrics-&gt;vertBearingY + metrics-&gt;height );
<a name="l00523"></a>00523 
<a name="l00524"></a>00524       metrics-&gt;vertBearingX = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( metrics-&gt;vertBearingX );
<a name="l00525"></a>00525       metrics-&gt;vertBearingY = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( metrics-&gt;vertBearingY );
<a name="l00526"></a>00526 
<a name="l00527"></a>00527       metrics-&gt;width  = right - metrics-&gt;vertBearingX;
<a name="l00528"></a>00528       metrics-&gt;height = bottom - metrics-&gt;vertBearingY;
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530     <span class="keywordflow">else</span>
<a name="l00531"></a>00531     {
<a name="l00532"></a>00532       metrics-&gt;vertBearingX = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( metrics-&gt;vertBearingX );
<a name="l00533"></a>00533       metrics-&gt;vertBearingY = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( metrics-&gt;vertBearingY );
<a name="l00534"></a>00534 
<a name="l00535"></a>00535       right  = <a class="code" href="ftobjs_8h.html#a026611252cfb0918ade2d44996fac3e1">FT_PIX_CEIL</a> ( metrics-&gt;horiBearingX + metrics-&gt;width );
<a name="l00536"></a>00536       bottom = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( metrics-&gt;horiBearingY - metrics-&gt;height );
<a name="l00537"></a>00537 
<a name="l00538"></a>00538       metrics-&gt;horiBearingX = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( metrics-&gt;horiBearingX );
<a name="l00539"></a>00539       metrics-&gt;horiBearingY = <a class="code" href="ftobjs_8h.html#a026611252cfb0918ade2d44996fac3e1">FT_PIX_CEIL</a> ( metrics-&gt;horiBearingY );
<a name="l00540"></a>00540 
<a name="l00541"></a>00541       metrics-&gt;width  = right - metrics-&gt;horiBearingX;
<a name="l00542"></a>00542       metrics-&gt;height = metrics-&gt;horiBearingY - bottom;
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     metrics-&gt;horiAdvance = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( metrics-&gt;horiAdvance );
<a name="l00546"></a>00546     metrics-&gt;vertAdvance = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( metrics-&gt;vertAdvance );
<a name="l00547"></a>00547   }
<a name="l00548"></a>00548 <span class="preprocessor">#endif </span><span class="comment">/* GRID_FIT_METRICS */</span>
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 
<a name="l00551"></a>00551   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l00552"></a>00552 
<a name="l00553"></a>00553   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l00554"></a><a class="code" href="ftobjs_8c.html#a01806ddba7989d0ad132e3318301e72d">00554</a>   <a class="code" href="freetype_8h.html#a01806ddba7989d0ad132e3318301e72d">FT_Load_Glyph</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l00555"></a>00555                  <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>   glyph_index,
<a name="l00556"></a>00556                  FT_Int32  load_flags )
<a name="l00557"></a>00557   {
<a name="l00558"></a>00558     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>      error;
<a name="l00559"></a>00559     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>     driver;
<a name="l00560"></a>00560     <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot;
<a name="l00561"></a>00561     <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>    library;
<a name="l00562"></a>00562     <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>       autohint = <a class="code" href="ftobjs_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00563"></a>00563     <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>     hinter;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="keywordflow">if</span> ( !face || !face-&gt;size || !face-&gt;glyph )
<a name="l00567"></a>00567       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     <span class="comment">/* The validity test for `glyph_index&#39; is performed by the */</span>
<a name="l00570"></a>00570     <span class="comment">/* font drivers.                                           */</span>
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     slot = face-&gt;glyph;
<a name="l00573"></a>00573     ft_glyphslot_clear( slot );
<a name="l00574"></a>00574 
<a name="l00575"></a>00575     driver  = face-&gt;driver;
<a name="l00576"></a>00576     library = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#ac3d04fbdc2988bf9a39f4ad6d3cb4b5f">library</a>;
<a name="l00577"></a>00577     hinter  = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#ae608b33b223905d4d70b782ed7ec8c78">auto_hinter</a>;
<a name="l00578"></a>00578 
<a name="l00579"></a>00579     <span class="comment">/* resolve load flags dependencies */</span>
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="keywordflow">if</span> ( load_flags &amp; <a class="code" href="freetype_8h.html#a2a12be302a988f3412a5191db419c5e2">FT_LOAD_NO_RECURSE</a> )
<a name="l00582"></a>00582       load_flags |= <a class="code" href="freetype_8h.html#a1ae5e2e14c90bb98bde52e5412a8f23f">FT_LOAD_NO_SCALE</a>         |
<a name="l00583"></a>00583                     <a class="code" href="freetype_8h.html#a17fa1a3bfac1bada36473de23a4458a1">FT_LOAD_IGNORE_TRANSFORM</a>;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="keywordflow">if</span> ( load_flags &amp; <a class="code" href="freetype_8h.html#a1ae5e2e14c90bb98bde52e5412a8f23f">FT_LOAD_NO_SCALE</a> )
<a name="l00586"></a>00586     {
<a name="l00587"></a>00587       load_flags |= <a class="code" href="freetype_8h.html#a4d3657db8d87688e93601201d0524e38">FT_LOAD_NO_HINTING</a> |
<a name="l00588"></a>00588                     <a class="code" href="freetype_8h.html#a0b68fe1c2c21b9ca3be6853ad44460df">FT_LOAD_NO_BITMAP</a>;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590       load_flags &amp;= ~<a class="code" href="freetype_8h.html#a0151cfe710837b05d545dafe99933ba9">FT_LOAD_RENDER</a>;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <span class="comment">/*</span>
<a name="l00594"></a>00594 <span class="comment">     * Determine whether we need to auto-hint or not.</span>
<a name="l00595"></a>00595 <span class="comment">     * The general rules are:</span>
<a name="l00596"></a>00596 <span class="comment">     *</span>
<a name="l00597"></a>00597 <span class="comment">     * - Do only auto-hinting if we have a hinter module, a scalable font</span>
<a name="l00598"></a>00598 <span class="comment">     *   format dealing with outlines, and no transforms except simple</span>
<a name="l00599"></a>00599 <span class="comment">     *   slants and/or rotations by integer multiples of 90 degrees.</span>
<a name="l00600"></a>00600 <span class="comment">     *</span>
<a name="l00601"></a>00601 <span class="comment">     * - Then, auto-hint if FT_LOAD_FORCE_AUTOHINT is set or if we don&#39;t</span>
<a name="l00602"></a>00602 <span class="comment">     *   have a native font hinter.</span>
<a name="l00603"></a>00603 <span class="comment">     *</span>
<a name="l00604"></a>00604 <span class="comment">     * - Otherwise, auto-hint for LIGHT hinting mode.</span>
<a name="l00605"></a>00605 <span class="comment">     *</span>
<a name="l00606"></a>00606 <span class="comment">     * - Exception: The font is `tricky&#39; and requires the native hinter to</span>
<a name="l00607"></a>00607 <span class="comment">     *   load properly.</span>
<a name="l00608"></a>00608 <span class="comment">     */</span>
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     <span class="keywordflow">if</span> ( hinter                                           &amp;&amp;
<a name="l00611"></a>00611          !( load_flags &amp; <a class="code" href="freetype_8h.html#a4d3657db8d87688e93601201d0524e38">FT_LOAD_NO_HINTING</a> )             &amp;&amp;
<a name="l00612"></a>00612          !( load_flags &amp; <a class="code" href="freetype_8h.html#ab68e871823d2167024a92bd488941938">FT_LOAD_NO_AUTOHINT</a> )            &amp;&amp;
<a name="l00613"></a>00613          <a class="code" href="ftobjs_8h.html#a06ec00af511015596d4bcb23a121c5ef">FT_DRIVER_IS_SCALABLE</a>( driver )                  &amp;&amp;
<a name="l00614"></a>00614          <a class="code" href="ftobjs_8h.html#a2f1d4f391a7a5ef53ee949ea82939685">FT_DRIVER_USES_OUTLINES</a>( driver )                &amp;&amp;
<a name="l00615"></a>00615          !<a class="code" href="freetype_8h.html#ac422750a96071a57625cc0429147364b">FT_IS_TRICKY</a>( face )                            &amp;&amp;
<a name="l00616"></a>00616          ( ( face-&gt;internal-&gt;transform_matrix.yx == 0 &amp;&amp;
<a name="l00617"></a>00617              face-&gt;internal-&gt;transform_matrix.xx != 0 ) ||
<a name="l00618"></a>00618            ( face-&gt;internal-&gt;transform_matrix.xx == 0 &amp;&amp;
<a name="l00619"></a>00619              face-&gt;internal-&gt;transform_matrix.yx != 0 ) ) )
<a name="l00620"></a>00620     {
<a name="l00621"></a>00621       <span class="keywordflow">if</span> ( ( load_flags &amp; <a class="code" href="freetype_8h.html#a63f6789f8fee0232e4b1178d22909059">FT_LOAD_FORCE_AUTOHINT</a> ) ||
<a name="l00622"></a>00622            !<a class="code" href="ftobjs_8h.html#a06994aabbc57892c6fc0c9a1395aac06">FT_DRIVER_HAS_HINTER</a>( driver )         )
<a name="l00623"></a>00623         autohint = <a class="code" href="ftobjs_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00624"></a>00624       <span class="keywordflow">else</span>
<a name="l00625"></a>00625       {
<a name="l00626"></a>00626         <a class="code" href="freetype_8h.html#aaa0488bc4d2c5f0a6f4311ddee8edfb7">FT_Render_Mode</a>  mode = <a class="code" href="freetype_8h.html#a05f580caefdad5475992b61231f3b357">FT_LOAD_TARGET_MODE</a>( load_flags );
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         <span class="keywordflow">if</span> ( mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba5b3b4a74eb40bff744348e7d6c69170f">FT_RENDER_MODE_LIGHT</a>             ||
<a name="l00630"></a>00630              face-&gt;internal-&gt;ignore_unpatented_hinter )
<a name="l00631"></a>00631           autohint = <a class="code" href="ftobjs_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00632"></a>00632       }
<a name="l00633"></a>00633     }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635     <span class="keywordflow">if</span> ( autohint )
<a name="l00636"></a>00636     {
<a name="l00637"></a>00637       <a class="code" href="struct_f_t___auto_hinter___service_rec__.html">FT_AutoHinter_Service</a>  hinting;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 
<a name="l00640"></a>00640       <span class="comment">/* try to load embedded bitmaps first if available            */</span>
<a name="l00641"></a>00641       <span class="comment">/*                                                            */</span>
<a name="l00642"></a>00642       <span class="comment">/* XXX: This is really a temporary hack that should disappear */</span>
<a name="l00643"></a>00643       <span class="comment">/*      promptly with FreeType 2.1!                           */</span>
<a name="l00644"></a>00644       <span class="comment">/*                                                            */</span>
<a name="l00645"></a>00645       <span class="keywordflow">if</span> ( <a class="code" href="freetype_8h.html#a5e7fe61c802f7cb7f8fddf929e3f50e3">FT_HAS_FIXED_SIZES</a>( face )             &amp;&amp;
<a name="l00646"></a>00646           ( load_flags &amp; <a class="code" href="freetype_8h.html#a0b68fe1c2c21b9ca3be6853ad44460df">FT_LOAD_NO_BITMAP</a> ) == 0 )
<a name="l00647"></a>00647       {
<a name="l00648"></a>00648         error = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a49dbd71e64094d4d825b8b8d51dd4e47">load_glyph</a>( slot, face-&gt;size,
<a name="l00649"></a>00649                                            glyph_index,
<a name="l00650"></a>00650                                            load_flags | <a class="code" href="freetype_8h.html#a08089e78fe58c63141461da290f369aa">FT_LOAD_SBITS_ONLY</a> );
<a name="l00651"></a>00651 
<a name="l00652"></a>00652         <span class="keywordflow">if</span> ( !error &amp;&amp; slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#afcd35188ff4c3d5cbb518602d05b2807">format</a> == FT_GLYPH_FORMAT_BITMAP )
<a name="l00653"></a>00653           <span class="keywordflow">goto</span> Load_Ok;
<a name="l00654"></a>00654       }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656       {
<a name="l00657"></a>00657         <a class="code" href="struct_f_t___face___internal_rec__.html">FT_Face_Internal</a>  <span class="keyword">internal</span>        = face-&gt;internal;
<a name="l00658"></a>00658         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>            transform_flags = <span class="keyword">internal</span>-&gt;<a class="code" href="struct_f_t___face___internal_rec__.html#a2495aced35040e1b7c2bc0afcd7a920d">transform_flags</a>;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 
<a name="l00661"></a>00661         <span class="comment">/* since the auto-hinter calls FT_Load_Glyph by itself, */</span>
<a name="l00662"></a>00662         <span class="comment">/* make sure that glyphs aren&#39;t transformed             */</span>
<a name="l00663"></a>00663         <span class="keyword">internal</span>-&gt;transform_flags = 0;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665         <span class="comment">/* load auto-hinted outline */</span>
<a name="l00666"></a>00666         hinting = (<a class="code" href="autohint_8h.html#af838f95d6b00c1eb17e15c8a77bae9be">FT_AutoHinter_Service</a>)hinter-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>-&gt;<a class="code" href="struct_f_t___module___class__.html#a320168f227e2d268691429ac0c6b2900">module_interface</a>;
<a name="l00667"></a>00667 
<a name="l00668"></a>00668         error   = hinting-&gt;<a class="code" href="struct_f_t___auto_hinter___service_rec__.html#ad36efe39469959626744ebdd04a04031">load_glyph</a>( (<a class="code" href="autohint_8h.html#a9277b7b6326ea2e0bf5d42e9f5a73a53">FT_AutoHinter</a>)hinter,
<a name="l00669"></a>00669                                        slot, face-&gt;size,
<a name="l00670"></a>00670                                        glyph_index, load_flags );
<a name="l00671"></a>00671 
<a name="l00672"></a>00672         <span class="keyword">internal</span>-&gt;transform_flags = transform_flags;
<a name="l00673"></a>00673       }
<a name="l00674"></a>00674     }
<a name="l00675"></a>00675     <span class="keywordflow">else</span>
<a name="l00676"></a>00676     {
<a name="l00677"></a>00677       error = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a49dbd71e64094d4d825b8b8d51dd4e47">load_glyph</a>( slot,
<a name="l00678"></a>00678                                          face-&gt;size,
<a name="l00679"></a>00679                                          glyph_index,
<a name="l00680"></a>00680                                          load_flags );
<a name="l00681"></a>00681       <span class="keywordflow">if</span> ( error )
<a name="l00682"></a>00682         <span class="keywordflow">goto</span> Exit;
<a name="l00683"></a>00683 
<a name="l00684"></a>00684       <span class="keywordflow">if</span> ( slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#afcd35188ff4c3d5cbb518602d05b2807">format</a> == <a class="code" href="ftrend1_8c.html#acd452025c8ee5551f3623ffb06c208e7">FT_GLYPH_FORMAT_OUTLINE</a> )
<a name="l00685"></a>00685       {
<a name="l00686"></a>00686         <span class="comment">/* check that the loaded outline is correct */</span>
<a name="l00687"></a>00687         error = <a class="code" href="ftoutln_8h.html#a163a3f538ff84fb340c799ccfbade5e3">FT_Outline_Check</a>( &amp;slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a8e46dd5d808079bdcba68056d6476d8d">outline</a> );
<a name="l00688"></a>00688         <span class="keywordflow">if</span> ( error )
<a name="l00689"></a>00689           <span class="keywordflow">goto</span> Exit;
<a name="l00690"></a>00690 
<a name="l00691"></a>00691 <span class="preprocessor">#ifdef GRID_FIT_METRICS</span>
<a name="l00692"></a>00692 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( !( load_flags &amp; FT_LOAD_NO_HINTING ) )
<a name="l00693"></a>00693           ft_glyphslot_grid_fit_metrics( slot,
<a name="l00694"></a>00694               <a class="code" href="fttypes_8h.html#adf712510036d534403cbddf4f18c2083">FT_BOOL</a>( load_flags &amp; <a class="code" href="freetype_8h.html#a01ce88a8e449ed2ef6ecf6f83c59b5c1">FT_LOAD_VERTICAL_LAYOUT</a> ) );
<a name="l00695"></a>00695 <span class="preprocessor">#endif</span>
<a name="l00696"></a>00696 <span class="preprocessor"></span>      }
<a name="l00697"></a>00697     }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   Load_Ok:
<a name="l00700"></a>00700     <span class="comment">/* compute the advance */</span>
<a name="l00701"></a>00701     <span class="keywordflow">if</span> ( load_flags &amp; <a class="code" href="freetype_8h.html#a01ce88a8e449ed2ef6ecf6f83c59b5c1">FT_LOAD_VERTICAL_LAYOUT</a> )
<a name="l00702"></a>00702     {
<a name="l00703"></a>00703       slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a09779d1a4781ea029382e92c01048c6a">advance</a>.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = 0;
<a name="l00704"></a>00704       slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a09779d1a4781ea029382e92c01048c6a">advance</a>.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#abe1ba307281c06a232f50e34c061ce7b">metrics</a>.vertAdvance;
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706     <span class="keywordflow">else</span>
<a name="l00707"></a>00707     {
<a name="l00708"></a>00708       slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a09779d1a4781ea029382e92c01048c6a">advance</a>.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#abe1ba307281c06a232f50e34c061ce7b">metrics</a>.horiAdvance;
<a name="l00709"></a>00709       slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a09779d1a4781ea029382e92c01048c6a">advance</a>.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = 0;
<a name="l00710"></a>00710     }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712     <span class="comment">/* compute the linear advance in 16.16 pixels */</span>
<a name="l00713"></a>00713     <span class="keywordflow">if</span> ( ( load_flags &amp; <a class="code" href="freetype_8h.html#acb21d35c27bf78255a7c23dbb48961e9">FT_LOAD_LINEAR_DESIGN</a> ) == 0 &amp;&amp;
<a name="l00714"></a>00714          ( <a class="code" href="freetype_8h.html#a6974c80eab523906685030b0298141b1">FT_IS_SCALABLE</a>( face ) )                  )
<a name="l00715"></a>00715     {
<a name="l00716"></a>00716       <a class="code" href="struct_f_t___size___metrics__.html">FT_Size_Metrics</a>*  metrics = &amp;face-&gt;size-&gt;metrics;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 
<a name="l00719"></a>00719       <span class="comment">/* it&#39;s tricky! */</span>
<a name="l00720"></a>00720       slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a9d0ba6b09729d4f009ef380e267607c3">linearHoriAdvance</a> = <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a9d0ba6b09729d4f009ef380e267607c3">linearHoriAdvance</a>,
<a name="l00721"></a>00721                                            metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a>, 64 );
<a name="l00722"></a>00722 
<a name="l00723"></a>00723       slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#abc10f58c3d859e46694515956aa4a1e8">linearVertAdvance</a> = <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#abc10f58c3d859e46694515956aa4a1e8">linearVertAdvance</a>,
<a name="l00724"></a>00724                                            metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a>, 64 );
<a name="l00725"></a>00725     }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727     <span class="keywordflow">if</span> ( ( load_flags &amp; <a class="code" href="freetype_8h.html#a17fa1a3bfac1bada36473de23a4458a1">FT_LOAD_IGNORE_TRANSFORM</a> ) == 0 )
<a name="l00728"></a>00728     {
<a name="l00729"></a>00729       <a class="code" href="struct_f_t___face___internal_rec__.html">FT_Face_Internal</a>  <span class="keyword">internal</span> = face-&gt;internal;
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 
<a name="l00732"></a>00732       <span class="comment">/* now, transform the glyph image if needed */</span>
<a name="l00733"></a>00733       <span class="keywordflow">if</span> ( internal-&gt;transform_flags )
<a name="l00734"></a>00734       {
<a name="l00735"></a>00735         <span class="comment">/* get renderer */</span>
<a name="l00736"></a>00736         <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>  renderer = ft_lookup_glyph_renderer( slot );
<a name="l00737"></a>00737 
<a name="l00738"></a>00738 
<a name="l00739"></a>00739         <span class="keywordflow">if</span> ( renderer )
<a name="l00740"></a>00740           error = renderer-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a2b13c0a776ea7f589f41f576f9c4e8ad">clazz</a>-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a2aef09ecdabacf5628ef29fb3d179def">transform_glyph</a>(
<a name="l00741"></a>00741                                      renderer, slot,
<a name="l00742"></a>00742                                      &amp;internal-&gt;transform_matrix,
<a name="l00743"></a>00743                                      &amp;internal-&gt;transform_delta );
<a name="l00744"></a>00744         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#afcd35188ff4c3d5cbb518602d05b2807">format</a> == <a class="code" href="ftrend1_8c.html#acd452025c8ee5551f3623ffb06c208e7">FT_GLYPH_FORMAT_OUTLINE</a> )
<a name="l00745"></a>00745         {
<a name="l00746"></a>00746           <span class="comment">/* apply `standard&#39; transformation if no renderer is available */</span>
<a name="l00747"></a>00747           <span class="keywordflow">if</span> ( &amp;internal-&gt;transform_matrix )
<a name="l00748"></a>00748             <a class="code" href="ftoutln_8h.html#ad68e1aa2ec264b97eb1b13f24049e132">FT_Outline_Transform</a>( &amp;slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a8e46dd5d808079bdcba68056d6476d8d">outline</a>,
<a name="l00749"></a>00749                                   &amp;internal-&gt;transform_matrix );
<a name="l00750"></a>00750 
<a name="l00751"></a>00751           <span class="keywordflow">if</span> ( &amp;internal-&gt;transform_delta )
<a name="l00752"></a>00752             <a class="code" href="ftoutln_8h.html#a4f1241539872e9237b7d5c6dcf9183e7">FT_Outline_Translate</a>( &amp;slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a8e46dd5d808079bdcba68056d6476d8d">outline</a>,
<a name="l00753"></a>00753                                   internal-&gt;transform_delta.x,
<a name="l00754"></a>00754                                   internal-&gt;transform_delta.y );
<a name="l00755"></a>00755         }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757         <span class="comment">/* transform advance */</span>
<a name="l00758"></a>00758         <a class="code" href="freetype_8h.html#a0cc0411657caad5063e918205d7194db">FT_Vector_Transform</a>( &amp;slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a09779d1a4781ea029382e92c01048c6a">advance</a>, &amp;internal-&gt;transform_matrix );
<a name="l00759"></a>00759       }
<a name="l00760"></a>00760     }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  x advance: %d\n&quot;</span> , slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a09779d1a4781ea029382e92c01048c6a">advance</a>.<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> ));
<a name="l00763"></a>00763     <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  y advance: %d\n&quot;</span> , slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a09779d1a4781ea029382e92c01048c6a">advance</a>.<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> ));
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  linear x advance: %d\n&quot;</span> , slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a9d0ba6b09729d4f009ef380e267607c3">linearHoriAdvance</a> ));
<a name="l00766"></a>00766     <a class="code" href="ftdebug_8h.html#a31421bde1b6252c99fc76764c22d9a48">FT_TRACE5</a>(( <span class="stringliteral">&quot;  linear y advance: %d\n&quot;</span> , slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#abc10f58c3d859e46694515956aa4a1e8">linearVertAdvance</a> ));
<a name="l00767"></a>00767 
<a name="l00768"></a>00768     <span class="comment">/* do we need to render the image now? */</span>
<a name="l00769"></a>00769     <span class="keywordflow">if</span> ( !error                                    &amp;&amp;
<a name="l00770"></a>00770          slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#afcd35188ff4c3d5cbb518602d05b2807">format</a> != FT_GLYPH_FORMAT_BITMAP    &amp;&amp;
<a name="l00771"></a>00771          slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#afcd35188ff4c3d5cbb518602d05b2807">format</a> != FT_GLYPH_FORMAT_COMPOSITE &amp;&amp;
<a name="l00772"></a>00772          load_flags &amp; <a class="code" href="freetype_8h.html#a0151cfe710837b05d545dafe99933ba9">FT_LOAD_RENDER</a> )
<a name="l00773"></a>00773     {
<a name="l00774"></a>00774       <a class="code" href="freetype_8h.html#aaa0488bc4d2c5f0a6f4311ddee8edfb7">FT_Render_Mode</a>  mode = <a class="code" href="freetype_8h.html#a05f580caefdad5475992b61231f3b357">FT_LOAD_TARGET_MODE</a>( load_flags );
<a name="l00775"></a>00775 
<a name="l00776"></a>00776 
<a name="l00777"></a>00777       <span class="keywordflow">if</span> ( mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba33d5620a2c09624a042f9f222b28e197">FT_RENDER_MODE_NORMAL</a>      &amp;&amp;
<a name="l00778"></a>00778            (load_flags &amp; <a class="code" href="freetype_8h.html#a69eec6a6db16fc011e2881e7cbb3ed48">FT_LOAD_MONOCHROME</a> ) )
<a name="l00779"></a>00779         mode = <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba2fad77b660130c90b38b873901f55b08">FT_RENDER_MODE_MONO</a>;
<a name="l00780"></a>00780 
<a name="l00781"></a>00781       error = <a class="code" href="freetype_8h.html#ab463acb65581abb6dd4a70a33b5f435f">FT_Render_Glyph</a>( slot, mode );
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784   Exit:
<a name="l00785"></a>00785     <span class="keywordflow">return</span> error;
<a name="l00786"></a>00786   }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 
<a name="l00789"></a>00789   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l00790"></a>00790 
<a name="l00791"></a>00791   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l00792"></a><a class="code" href="ftobjs_8c.html#aeea4c9699584228c2244e4f6d9f09380">00792</a>   <a class="code" href="freetype_8h.html#aeea4c9699584228c2244e4f6d9f09380">FT_Load_Char</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l00793"></a>00793                 <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  char_code,
<a name="l00794"></a>00794                 FT_Int32  load_flags )
<a name="l00795"></a>00795   {
<a name="l00796"></a>00796     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  glyph_index;
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 
<a name="l00799"></a>00799     <span class="keywordflow">if</span> ( !face )
<a name="l00800"></a>00800       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802     glyph_index = (<a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>)char_code;
<a name="l00803"></a>00803     <span class="keywordflow">if</span> ( face-&gt;charmap )
<a name="l00804"></a>00804       glyph_index = <a class="code" href="freetype_8h.html#a529192ba5290936f21b63f257bf42bdd">FT_Get_Char_Index</a>( face, char_code );
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <span class="keywordflow">return</span> <a class="code" href="freetype_8h.html#a01806ddba7989d0ad132e3318301e72d">FT_Load_Glyph</a>( face, glyph_index, load_flags );
<a name="l00807"></a>00807   }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 
<a name="l00810"></a>00810   <span class="comment">/* destructor for sizes list */</span>
<a name="l00811"></a>00811   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00812"></a>00812   destroy_size( <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory,
<a name="l00813"></a>00813                 <a class="code" href="struct_f_t___size_rec__.html">FT_Size</a>    <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a>,
<a name="l00814"></a>00814                 <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>  driver )
<a name="l00815"></a>00815   {
<a name="l00816"></a>00816     <span class="comment">/* finalize client-specific data */</span>
<a name="l00817"></a>00817     <span class="keywordflow">if</span> ( size-&gt;<a class="code" href="struct_f_t___size_rec__.html#aa24520b093a9b4ba9ff388bfe7b9491d">generic</a>.<a class="code" href="struct_f_t___generic__.html#a20fce8de90cc9e3876935817247b9ccc">finalizer</a> )
<a name="l00818"></a>00818       size-&gt;<a class="code" href="struct_f_t___size_rec__.html#aa24520b093a9b4ba9ff388bfe7b9491d">generic</a>.<a class="code" href="struct_f_t___generic__.html#a20fce8de90cc9e3876935817247b9ccc">finalizer</a>( size );
<a name="l00819"></a>00819 
<a name="l00820"></a>00820     <span class="comment">/* finalize format-specific stuff */</span>
<a name="l00821"></a>00821     <span class="keywordflow">if</span> ( driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a5c96f627816a089b27bcff09f22dd1a6">done_size</a> )
<a name="l00822"></a>00822       driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a5c96f627816a089b27bcff09f22dd1a6">done_size</a>( size );
<a name="l00823"></a>00823 
<a name="l00824"></a>00824     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( size-&gt;<a class="code" href="struct_f_t___size_rec__.html#a236c47ea3138e485c29b0d7baa5cf3b6">internal</a> );
<a name="l00825"></a>00825     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( size );
<a name="l00826"></a>00826   }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 
<a name="l00829"></a>00829   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00830"></a>00830   ft_cmap_done_internal( <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>  cmap );
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 
<a name="l00833"></a>00833   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00834"></a>00834   destroy_charmaps( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    face,
<a name="l00835"></a>00835                     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory )
<a name="l00836"></a>00836   {
<a name="l00837"></a>00837     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     <span class="keywordflow">if</span> ( !face )
<a name="l00841"></a>00841       <span class="keywordflow">return</span>;
<a name="l00842"></a>00842 
<a name="l00843"></a>00843     <span class="keywordflow">for</span> ( n = 0; n &lt; face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>; n++ )
<a name="l00844"></a>00844     {
<a name="l00845"></a>00845       <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>  cmap = <a class="code" href="ftobjs_8h.html#ab0954b1eab39629f00cf75f3e1ccc86d">FT_CMAP</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>[n] );
<a name="l00846"></a>00846 
<a name="l00847"></a>00847 
<a name="l00848"></a>00848       ft_cmap_done_internal( cmap );
<a name="l00849"></a>00849 
<a name="l00850"></a>00850       face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>] = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852 
<a name="l00853"></a>00853     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a> );
<a name="l00854"></a>00854     face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a> = 0;
<a name="l00855"></a>00855   }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857 
<a name="l00858"></a>00858   <span class="comment">/* destructor for faces list */</span>
<a name="l00859"></a>00859   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00860"></a>00860   destroy_face( <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory,
<a name="l00861"></a>00861                 <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    face,
<a name="l00862"></a>00862                 <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>  driver )
<a name="l00863"></a>00863   {
<a name="l00864"></a>00864     <a class="code" href="struct_f_t___driver___class_rec__.html">FT_Driver_Class</a>  clazz = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>;
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <span class="comment">/* discard auto-hinting data */</span>
<a name="l00868"></a>00868     <span class="keywordflow">if</span> ( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a34ba9b1367f1b2d13676043b8da3ea73">autohint</a>.<a class="code" href="struct_f_t___generic__.html#a20fce8de90cc9e3876935817247b9ccc">finalizer</a> )
<a name="l00869"></a>00869       face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a34ba9b1367f1b2d13676043b8da3ea73">autohint</a>.<a class="code" href="struct_f_t___generic__.html#a20fce8de90cc9e3876935817247b9ccc">finalizer</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a34ba9b1367f1b2d13676043b8da3ea73">autohint</a>.<a class="code" href="struct_f_t___generic__.html#af0bf8b983254b662f293e9a20505e27e">data</a> );
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <span class="comment">/* Discard glyph slots for this face.                           */</span>
<a name="l00872"></a>00872     <span class="comment">/* Beware!  FT_Done_GlyphSlot() changes the field `face-&gt;glyph&#39; */</span>
<a name="l00873"></a>00873     <span class="keywordflow">while</span> ( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aea701e6584693e684acf300edb28d8f6">glyph</a> )
<a name="l00874"></a>00874       <a class="code" href="ftobjs_8h.html#ad0c3fbaead98eb3dc1e8dec850691b8e">FT_Done_GlyphSlot</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aea701e6584693e684acf300edb28d8f6">glyph</a> );
<a name="l00875"></a>00875 
<a name="l00876"></a>00876     <span class="comment">/* discard all sizes for this face */</span>
<a name="l00877"></a>00877     <a class="code" href="ftlist_8h.html#a92d979834e296ad88eb5c61ef5d6eefb">FT_List_Finalize</a>( &amp;face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a47504203e02bfba59c802c35cb4009ed">sizes_list</a>,
<a name="l00878"></a>00878                       (<a class="code" href="ftlist_8h.html#a752c9db8720e82f13dea9813b4e446c5">FT_List_Destructor</a>)destroy_size,
<a name="l00879"></a>00879                       memory,
<a name="l00880"></a>00880                       driver );
<a name="l00881"></a>00881     face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a212d116864a5d81e80b176f9b846cd08">size</a> = 0;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883     <span class="comment">/* now discard client data */</span>
<a name="l00884"></a>00884     <span class="keywordflow">if</span> ( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aaba29e9164f9c283348c8991f088a114">generic</a>.<a class="code" href="struct_f_t___generic__.html#a20fce8de90cc9e3876935817247b9ccc">finalizer</a> )
<a name="l00885"></a>00885       face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aaba29e9164f9c283348c8991f088a114">generic</a>.<a class="code" href="struct_f_t___generic__.html#a20fce8de90cc9e3876935817247b9ccc">finalizer</a>( face );
<a name="l00886"></a>00886 
<a name="l00887"></a>00887     <span class="comment">/* discard charmaps */</span>
<a name="l00888"></a>00888     destroy_charmaps( face, memory );
<a name="l00889"></a>00889 
<a name="l00890"></a>00890     <span class="comment">/* finalize format-specific stuff */</span>
<a name="l00891"></a>00891     <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a7d37afe63f914ae28ed02c960e4d5642">done_face</a> )
<a name="l00892"></a>00892       clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a7d37afe63f914ae28ed02c960e4d5642">done_face</a>( face );
<a name="l00893"></a>00893 
<a name="l00894"></a>00894     <span class="comment">/* close the stream for this face if needed */</span>
<a name="l00895"></a>00895     <a class="code" href="ftstream_8h.html#ac2619fbc2d12358691456bf1bf312710">FT_Stream_Free</a>(
<a name="l00896"></a>00896       face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a831d5da25cd0fe2a783d2a73f467de55">stream</a>,
<a name="l00897"></a>00897       ( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#af1596857ebc9f8eac4c4b51c8f3ffd31">face_flags</a> &amp; <a class="code" href="freetype_8h.html#a88935459cedd8fb94de90b54b61b5340">FT_FACE_FLAG_EXTERNAL_STREAM</a> ) != 0 );
<a name="l00898"></a>00898 
<a name="l00899"></a>00899     face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a831d5da25cd0fe2a783d2a73f467de55">stream</a> = 0;
<a name="l00900"></a>00900 
<a name="l00901"></a>00901     <span class="comment">/* get rid of it */</span>
<a name="l00902"></a>00902     <span class="keywordflow">if</span> ( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aed9a1267cddcbe790f0591471c886537">internal</a> )
<a name="l00903"></a>00903     {
<a name="l00904"></a>00904       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aed9a1267cddcbe790f0591471c886537">internal</a> );
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( face );
<a name="l00907"></a>00907   }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909 
<a name="l00910"></a>00910   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00911"></a>00911   Destroy_Driver( <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>  driver )
<a name="l00912"></a>00912   {
<a name="l00913"></a>00913     <a class="code" href="ftlist_8h.html#a92d979834e296ad88eb5c61ef5d6eefb">FT_List_Finalize</a>( &amp;driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a2602170e3ecde21a764dc32417aaa002">faces_list</a>,
<a name="l00914"></a>00914                       (<a class="code" href="ftlist_8h.html#a752c9db8720e82f13dea9813b4e446c5">FT_List_Destructor</a>)destroy_face,
<a name="l00915"></a>00915                       driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>,
<a name="l00916"></a>00916                       driver );
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     <span class="comment">/* check whether we need to drop the driver&#39;s glyph loader */</span>
<a name="l00919"></a>00919     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a2f1d4f391a7a5ef53ee949ea82939685">FT_DRIVER_USES_OUTLINES</a>( driver ) )
<a name="l00920"></a>00920       <a class="code" href="ftgloadr_8h.html#a920c9ede2b8f63e3dd25f51daee360ab">FT_GlyphLoader_Done</a>( driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#ac28e7adbc14ee82c2b7710d0ee5541e2">glyph_loader</a> );
<a name="l00921"></a>00921   }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 
<a name="l00924"></a>00924   <span class="comment">/*************************************************************************/</span>
<a name="l00925"></a>00925   <span class="comment">/*                                                                       */</span>
<a name="l00926"></a>00926   <span class="comment">/* &lt;Function&gt;                                                            */</span>
<a name="l00927"></a>00927   <span class="comment">/*    find_unicode_charmap                                               */</span>
<a name="l00928"></a>00928   <span class="comment">/*                                                                       */</span>
<a name="l00929"></a>00929   <span class="comment">/* &lt;Description&gt;                                                         */</span>
<a name="l00930"></a>00930   <span class="comment">/*    This function finds a Unicode charmap, if there is one.            */</span>
<a name="l00931"></a>00931   <span class="comment">/*    And if there is more than one, it tries to favour the more         */</span>
<a name="l00932"></a>00932   <span class="comment">/*    extensive one, i.e., one that supports UCS-4 against those which   */</span>
<a name="l00933"></a>00933   <span class="comment">/*    are limited to the BMP (said UCS-2 encoding.)                      */</span>
<a name="l00934"></a>00934   <span class="comment">/*                                                                       */</span>
<a name="l00935"></a>00935   <span class="comment">/*    This function is called from open_face() (just below), and also    */</span>
<a name="l00936"></a>00936   <span class="comment">/*    from FT_Select_Charmap( ..., FT_ENCODING_UNICODE ).                */</span>
<a name="l00937"></a>00937   <span class="comment">/*                                                                       */</span>
<a name="l00938"></a>00938   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l00939"></a>00939   find_unicode_charmap( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>  face )
<a name="l00940"></a>00940   {
<a name="l00941"></a>00941     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>*  first;
<a name="l00942"></a>00942     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>*  cur;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     <span class="comment">/* caller should have already checked that `face&#39; is valid */</span>
<a name="l00946"></a>00946     <a class="code" href="ftdebug_8h.html#a0edcd80581eabc970a562c5d284d5e7e">FT_ASSERT</a>( face );
<a name="l00947"></a>00947 
<a name="l00948"></a>00948     first = face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>;
<a name="l00949"></a>00949 
<a name="l00950"></a>00950     <span class="keywordflow">if</span> ( !first )
<a name="l00951"></a>00951       <span class="keywordflow">return</span> FT_Err_Invalid_CharMap_Handle;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     <span class="comment">/*</span>
<a name="l00954"></a>00954 <span class="comment">     *  The original TrueType specification(s) only specified charmap</span>
<a name="l00955"></a>00955 <span class="comment">     *  formats that are capable of mapping 8 or 16 bit character codes to</span>
<a name="l00956"></a>00956 <span class="comment">     *  glyph indices.</span>
<a name="l00957"></a>00957 <span class="comment">     *</span>
<a name="l00958"></a>00958 <span class="comment">     *  However, recent updates to the Apple and OpenType specifications</span>
<a name="l00959"></a>00959 <span class="comment">     *  introduced new formats that are capable of mapping 32-bit character</span>
<a name="l00960"></a>00960 <span class="comment">     *  codes as well.  And these are already used on some fonts, mainly to</span>
<a name="l00961"></a>00961 <span class="comment">     *  map non-BMP Asian ideographs as defined in Unicode.</span>
<a name="l00962"></a>00962 <span class="comment">     *</span>
<a name="l00963"></a>00963 <span class="comment">     *  For compatibility purposes, these fonts generally come with</span>
<a name="l00964"></a>00964 <span class="comment">     *  *several* Unicode charmaps:</span>
<a name="l00965"></a>00965 <span class="comment">     *</span>
<a name="l00966"></a>00966 <span class="comment">     *   - One of them in the &quot;old&quot; 16-bit format, that cannot access</span>
<a name="l00967"></a>00967 <span class="comment">     *     all glyphs in the font.</span>
<a name="l00968"></a>00968 <span class="comment">     *</span>
<a name="l00969"></a>00969 <span class="comment">     *   - Another one in the &quot;new&quot; 32-bit format, that can access all</span>
<a name="l00970"></a>00970 <span class="comment">     *     the glyphs.</span>
<a name="l00971"></a>00971 <span class="comment">     *</span>
<a name="l00972"></a>00972 <span class="comment">     *  This function has been written to always favor a 32-bit charmap</span>
<a name="l00973"></a>00973 <span class="comment">     *  when found.  Otherwise, a 16-bit one is returned when found.</span>
<a name="l00974"></a>00974 <span class="comment">     */</span>
<a name="l00975"></a>00975 
<a name="l00976"></a>00976     <span class="comment">/* Since the `interesting&#39; table, with IDs (3,10), is normally the */</span>
<a name="l00977"></a>00977     <span class="comment">/* last one, we loop backwards.  This loses with type1 fonts with  */</span>
<a name="l00978"></a>00978     <span class="comment">/* non-BMP characters (&lt;.0001%), this wins with .ttf with non-BMP  */</span>
<a name="l00979"></a>00979     <span class="comment">/* chars (.01% ?), and this is the same about 99.99% of the time!  */</span>
<a name="l00980"></a>00980 
<a name="l00981"></a>00981     cur = first + face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>;  <span class="comment">/* points after the last one */</span>
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <span class="keywordflow">for</span> ( ; --cur &gt;= first; )
<a name="l00984"></a>00984     {
<a name="l00985"></a>00985       <span class="keywordflow">if</span> ( cur[0]-&gt;encoding == FT_ENCODING_UNICODE )
<a name="l00986"></a>00986       {
<a name="l00987"></a>00987         <span class="comment">/* XXX If some new encodings to represent UCS-4 are added, */</span>
<a name="l00988"></a>00988         <span class="comment">/*     they should be added here.                          */</span>
<a name="l00989"></a>00989         <span class="keywordflow">if</span> ( ( cur[0]-&gt;platform_id == <a class="code" href="ttnameid_8h.html#a6b1b0a297b0ac708100de794cbb02834">TT_PLATFORM_MICROSOFT</a> &amp;&amp;
<a name="l00990"></a>00990                cur[0]-&gt;encoding_id == <a class="code" href="ttnameid_8h.html#aa024bb6034874a7112c7873e021a42d5">TT_MS_ID_UCS_4</a>        )     ||
<a name="l00991"></a>00991              ( cur[0]-&gt;platform_id == <a class="code" href="ttnameid_8h.html#ab7533366079ef468dbb0f8bc3888c2e2">TT_PLATFORM_APPLE_UNICODE</a> &amp;&amp;
<a name="l00992"></a>00992                cur[0]-&gt;encoding_id == <a class="code" href="ttnameid_8h.html#a74609519efea3b0551d0f374ac24d28b">TT_APPLE_ID_UNICODE_32</a>    ) )
<a name="l00993"></a>00993         {
<a name="l00994"></a>00994 <span class="preprocessor">#ifdef FT_MAX_CHARMAP_CACHEABLE</span>
<a name="l00995"></a>00995 <span class="preprocessor"></span>          <span class="keywordflow">if</span> ( cur - first &gt; <a class="code" href="ftoption_8h.html#ad83d239e848a53ce9ff244ccfeb5e408">FT_MAX_CHARMAP_CACHEABLE</a> )
<a name="l00996"></a>00996           {
<a name="l00997"></a>00997             <a class="code" href="ftdebug_8h.html#a311092b5a8fece0a17cfb5b2d874e25d">FT_ERROR</a>(( <span class="stringliteral">&quot;find_unicode_charmap: UCS-4 cmap is found &quot;</span>
<a name="l00998"></a>00998                        <span class="stringliteral">&quot;at too late position (%d)\n&quot;</span>, cur - first ));
<a name="l00999"></a>00999             <span class="keywordflow">continue</span>;
<a name="l01000"></a>01000           }
<a name="l01001"></a>01001 <span class="preprocessor">#endif</span>
<a name="l01002"></a>01002 <span class="preprocessor"></span>          face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aca87d50488a5a1489741e8c13414c268">charmap</a> = cur[0];
<a name="l01003"></a>01003           <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l01004"></a>01004         }
<a name="l01005"></a>01005       }
<a name="l01006"></a>01006     }
<a name="l01007"></a>01007 
<a name="l01008"></a>01008     <span class="comment">/* We do not have any UCS-4 charmap.                */</span>
<a name="l01009"></a>01009     <span class="comment">/* Do the loop again and search for UCS-2 charmaps. */</span>
<a name="l01010"></a>01010     cur = first + face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012     <span class="keywordflow">for</span> ( ; --cur &gt;= first; )
<a name="l01013"></a>01013     {
<a name="l01014"></a>01014       <span class="keywordflow">if</span> ( cur[0]-&gt;encoding == FT_ENCODING_UNICODE )
<a name="l01015"></a>01015       {
<a name="l01016"></a>01016 <span class="preprocessor">#ifdef FT_MAX_CHARMAP_CACHEABLE</span>
<a name="l01017"></a>01017 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( cur - first &gt; <a class="code" href="ftoption_8h.html#ad83d239e848a53ce9ff244ccfeb5e408">FT_MAX_CHARMAP_CACHEABLE</a> )
<a name="l01018"></a>01018         {
<a name="l01019"></a>01019           <a class="code" href="ftdebug_8h.html#a311092b5a8fece0a17cfb5b2d874e25d">FT_ERROR</a>(( <span class="stringliteral">&quot;find_unicode_charmap: UCS-2 cmap is found &quot;</span>
<a name="l01020"></a>01020                      <span class="stringliteral">&quot;at too late position (%d)\n&quot;</span>, cur - first ));
<a name="l01021"></a>01021           <span class="keywordflow">continue</span>;
<a name="l01022"></a>01022         }
<a name="l01023"></a>01023 <span class="preprocessor">#endif</span>
<a name="l01024"></a>01024 <span class="preprocessor"></span>        face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aca87d50488a5a1489741e8c13414c268">charmap</a> = cur[0];
<a name="l01025"></a>01025         <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l01026"></a>01026       }
<a name="l01027"></a>01027     }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029     <span class="keywordflow">return</span> FT_Err_Invalid_CharMap_Handle;
<a name="l01030"></a>01030   }
<a name="l01031"></a>01031 
<a name="l01032"></a>01032 
<a name="l01033"></a>01033   <span class="comment">/*************************************************************************/</span>
<a name="l01034"></a>01034   <span class="comment">/*                                                                       */</span>
<a name="l01035"></a>01035   <span class="comment">/* &lt;Function&gt;                                                            */</span>
<a name="l01036"></a>01036   <span class="comment">/*    find_variant_selector_charmap                                      */</span>
<a name="l01037"></a>01037   <span class="comment">/*                                                                       */</span>
<a name="l01038"></a>01038   <span class="comment">/* &lt;Description&gt;                                                         */</span>
<a name="l01039"></a>01039   <span class="comment">/*    This function finds the variant selector charmap, if there is one. */</span>
<a name="l01040"></a>01040   <span class="comment">/*    There can only be one (platform=0, specific=5, format=14).         */</span>
<a name="l01041"></a>01041   <span class="comment">/*                                                                       */</span>
<a name="l01042"></a>01042   <span class="keyword">static</span> <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>
<a name="l01043"></a>01043   find_variant_selector_charmap( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>  face )
<a name="l01044"></a>01044   {
<a name="l01045"></a>01045     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>*  first;
<a name="l01046"></a>01046     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>*  end;
<a name="l01047"></a>01047     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>*  cur;
<a name="l01048"></a>01048 
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     <span class="comment">/* caller should have already checked that `face&#39; is valid */</span>
<a name="l01051"></a>01051     <a class="code" href="ftdebug_8h.html#a0edcd80581eabc970a562c5d284d5e7e">FT_ASSERT</a>( face );
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     first = face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055     <span class="keywordflow">if</span> ( !first )
<a name="l01056"></a>01056       <span class="keywordflow">return</span> <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058     end = first + face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>;  <span class="comment">/* points after the last one */</span>
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="keywordflow">for</span> ( cur = first; cur &lt; end; ++cur )
<a name="l01061"></a>01061     {
<a name="l01062"></a>01062       <span class="keywordflow">if</span> ( cur[0]-&gt;platform_id == <a class="code" href="ttnameid_8h.html#ab7533366079ef468dbb0f8bc3888c2e2">TT_PLATFORM_APPLE_UNICODE</a>    &amp;&amp;
<a name="l01063"></a>01063            cur[0]-&gt;encoding_id == <a class="code" href="ttnameid_8h.html#ac31743996ec675791ddbb49ab8588622">TT_APPLE_ID_VARIANT_SELECTOR</a> &amp;&amp;
<a name="l01064"></a>01064            <a class="code" href="tttables_8h.html#a9a4db80b4f71d00e28474cbfcf968614">FT_Get_CMap_Format</a>( cur[0] ) == 14                  )
<a name="l01065"></a>01065 <span class="preprocessor">#ifdef FT_MAX_CHARMAP_CACHEABLE</span>
<a name="l01066"></a>01066 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( cur - first &gt; <a class="code" href="ftoption_8h.html#ad83d239e848a53ce9ff244ccfeb5e408">FT_MAX_CHARMAP_CACHEABLE</a> )
<a name="l01067"></a>01067         {
<a name="l01068"></a>01068           <a class="code" href="ftdebug_8h.html#a311092b5a8fece0a17cfb5b2d874e25d">FT_ERROR</a>(( <span class="stringliteral">&quot;find_unicode_charmap: UVS cmap is found &quot;</span>
<a name="l01069"></a>01069                      <span class="stringliteral">&quot;at too late position (%d)\n&quot;</span>, cur - first ));
<a name="l01070"></a>01070           <span class="keywordflow">continue</span>;
<a name="l01071"></a>01071         }
<a name="l01072"></a>01072 <span class="preprocessor">#endif</span>
<a name="l01073"></a>01073 <span class="preprocessor"></span>        <span class="keywordflow">return</span> cur[0];
<a name="l01074"></a>01074     }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076     <span class="keywordflow">return</span> <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01077"></a>01077   }
<a name="l01078"></a>01078 
<a name="l01079"></a>01079 
<a name="l01080"></a>01080   <span class="comment">/*************************************************************************/</span>
<a name="l01081"></a>01081   <span class="comment">/*                                                                       */</span>
<a name="l01082"></a>01082   <span class="comment">/* &lt;Function&gt;                                                            */</span>
<a name="l01083"></a>01083   <span class="comment">/*    open_face                                                          */</span>
<a name="l01084"></a>01084   <span class="comment">/*                                                                       */</span>
<a name="l01085"></a>01085   <span class="comment">/* &lt;Description&gt;                                                         */</span>
<a name="l01086"></a>01086   <span class="comment">/*    This function does some work for FT_Open_Face().                   */</span>
<a name="l01087"></a>01087   <span class="comment">/*                                                                       */</span>
<a name="l01088"></a>01088   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01089"></a>01089   open_face( <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>      driver,
<a name="l01090"></a>01090              <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>      stream,
<a name="l01091"></a>01091              <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>        face_index,
<a name="l01092"></a>01092              <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>         num_params,
<a name="l01093"></a>01093              <a class="code" href="struct_f_t___parameter__.html">FT_Parameter</a>*  params,
<a name="l01094"></a>01094              <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>       *aface )
<a name="l01095"></a>01095   {
<a name="l01096"></a>01096     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>         memory;
<a name="l01097"></a>01097     <a class="code" href="struct_f_t___driver___class_rec__.html">FT_Driver_Class</a>   clazz;
<a name="l01098"></a>01098     <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>           face = 0;
<a name="l01099"></a>01099     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>          error, error2;
<a name="l01100"></a>01100     <a class="code" href="struct_f_t___face___internal_rec__.html">FT_Face_Internal</a>  <span class="keyword">internal</span> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01101"></a>01101 
<a name="l01102"></a>01102 
<a name="l01103"></a>01103     clazz  = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>;
<a name="l01104"></a>01104     memory = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106     <span class="comment">/* allocate the face object and perform basic initialization */</span>
<a name="l01107"></a>01107     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( face, clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a194fc6fbae019e9c109c65328e57e44f">face_object_size</a> ) )
<a name="l01108"></a>01108       <span class="keywordflow">goto</span> Fail;
<a name="l01109"></a>01109 
<a name="l01110"></a>01110     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a313d8de417ea0d1c5fcc7d348397a642">FT_NEW</a>( <span class="keyword">internal</span> ) )
<a name="l01111"></a>01111       <span class="keywordflow">goto</span> Fail;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113     face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aed9a1267cddcbe790f0591471c886537">internal</a> = <span class="keyword">internal</span>;
<a name="l01114"></a>01114 
<a name="l01115"></a>01115     face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a011b62fcffdd6dc421c9ab3286d4c9fa">driver</a>   = driver;
<a name="l01116"></a>01116     face-&gt;<a class="code" href="struct_f_t___face_rec__.html#af269b241bfc2f570d485ab03fc0261b2">memory</a>   = memory;
<a name="l01117"></a>01117     face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a831d5da25cd0fe2a783d2a73f467de55">stream</a>   = stream;
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="preprocessor">#ifdef FT_CONFIG_OPTION_INCREMENTAL</span>
<a name="l01120"></a>01120 <span class="preprocessor"></span>    {
<a name="l01121"></a>01121       <span class="keywordtype">int</span>  i;
<a name="l01122"></a>01122 
<a name="l01123"></a>01123 
<a name="l01124"></a>01124       face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aed9a1267cddcbe790f0591471c886537">internal</a>-&gt;incremental_interface = 0;
<a name="l01125"></a>01125       <span class="keywordflow">for</span> ( i = 0; i &lt; num_params &amp;&amp; !face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aed9a1267cddcbe790f0591471c886537">internal</a>-&gt;incremental_interface;
<a name="l01126"></a>01126             i++ )
<a name="l01127"></a>01127         <span class="keywordflow">if</span> ( params[i].tag == <a class="code" href="ftincrem_8h.html#a3d6a330a57d3d52a7ca4a404c83e40ba">FT_PARAM_TAG_INCREMENTAL</a> )
<a name="l01128"></a>01128           face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aed9a1267cddcbe790f0591471c886537">internal</a>-&gt;incremental_interface =
<a name="l01129"></a>01129             (<a class="code" href="ftincrem_8h.html#aa5fc31202d43808d021640ea7f0068a3">FT_Incremental_Interface</a>)params[i].data;
<a name="l01130"></a>01130     }
<a name="l01131"></a>01131 <span class="preprocessor">#endif</span>
<a name="l01132"></a>01132 <span class="preprocessor"></span>
<a name="l01133"></a>01133     <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a68e94aeae3e78ed5984c29189c64df9a">init_face</a> )
<a name="l01134"></a>01134       error = clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a68e94aeae3e78ed5984c29189c64df9a">init_face</a>( stream,
<a name="l01135"></a>01135                                 face,
<a name="l01136"></a>01136                                 (<a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>)face_index,
<a name="l01137"></a>01137                                 num_params,
<a name="l01138"></a>01138                                 params );
<a name="l01139"></a>01139     <span class="keywordflow">if</span> ( error )
<a name="l01140"></a>01140       <span class="keywordflow">goto</span> Fail;
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <span class="comment">/* select Unicode charmap by default */</span>
<a name="l01143"></a>01143     error2 = find_unicode_charmap( face );
<a name="l01144"></a>01144 
<a name="l01145"></a>01145     <span class="comment">/* if no Unicode charmap can be found, FT_Err_Invalid_CharMap_Handle */</span>
<a name="l01146"></a>01146     <span class="comment">/* is returned.                                                      */</span>
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     <span class="comment">/* no error should happen, but we want to play safe */</span>
<a name="l01149"></a>01149     <span class="keywordflow">if</span> ( error2 &amp;&amp; error2 != FT_Err_Invalid_CharMap_Handle )
<a name="l01150"></a>01150     {
<a name="l01151"></a>01151       error = error2;
<a name="l01152"></a>01152       <span class="keywordflow">goto</span> Fail;
<a name="l01153"></a>01153     }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155     *aface = face;
<a name="l01156"></a>01156 
<a name="l01157"></a>01157   Fail:
<a name="l01158"></a>01158     <span class="keywordflow">if</span> ( error )
<a name="l01159"></a>01159     {
<a name="l01160"></a>01160       destroy_charmaps( face, memory );
<a name="l01161"></a>01161       <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a7d37afe63f914ae28ed02c960e4d5642">done_face</a> )
<a name="l01162"></a>01162         clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a7d37afe63f914ae28ed02c960e4d5642">done_face</a>( face );
<a name="l01163"></a>01163       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( <span class="keyword">internal</span> );
<a name="l01164"></a>01164       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( face );
<a name="l01165"></a>01165       *aface = 0;
<a name="l01166"></a>01166     }
<a name="l01167"></a>01167 
<a name="l01168"></a>01168     <span class="keywordflow">return</span> error;
<a name="l01169"></a>01169   }
<a name="l01170"></a>01170 
<a name="l01171"></a>01171 
<a name="l01172"></a>01172   <span class="comment">/* there&#39;s a Mac-specific extended implementation of FT_New_Face() */</span>
<a name="l01173"></a>01173   <span class="comment">/* in src/base/ftmac.c                                             */</span>
<a name="l01174"></a>01174 
<a name="l01175"></a>01175 <span class="preprocessor">#if !defined( FT_MACINTOSH ) || defined( DARWIN_NO_CARBON )</span>
<a name="l01176"></a>01176 <span class="preprocessor"></span>
<a name="l01177"></a>01177   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l01178"></a>01178 
<a name="l01179"></a>01179   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l01180"></a><a class="code" href="ftobjs_8c.html#a549a19bbea568f3a6d60207f1b787070">01180</a>   <a class="code" href="freetype_8h.html#a148792cfd6f1b3735d53bf3baf5d336c">FT_New_Face</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>   library,
<a name="l01181"></a>01181                <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span>*  pathname,
<a name="l01182"></a>01182                <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>      face_index,
<a name="l01183"></a>01183                <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>     *aface )
<a name="l01184"></a>01184   {
<a name="l01185"></a>01185     <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>  args;
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     <span class="comment">/* test for valid `library&#39; and `aface&#39; delayed to FT_Open_Face() */</span>
<a name="l01189"></a>01189     <span class="keywordflow">if</span> ( !pathname )
<a name="l01190"></a>01190       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l01191"></a>01191 
<a name="l01192"></a>01192     args.<a class="code" href="struct_f_t___open___args__.html#a2e3e6b9284fe8b4d9833e247a19181fa">flags</a>    = <a class="code" href="freetype_8h.html#a22ee89452169a0faf9f1ad797499e4bc">FT_OPEN_PATHNAME</a>;
<a name="l01193"></a>01193     args.<a class="code" href="struct_f_t___open___args__.html#aea3d454d9fd9bb7434aad07e651d027b">pathname</a> = (<span class="keywordtype">char</span>*)pathname;
<a name="l01194"></a>01194     args.<a class="code" href="struct_f_t___open___args__.html#ae1e6444bf0c21b323ce6cbe8bc475b2b">stream</a>   = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01195"></a>01195 
<a name="l01196"></a>01196     <span class="keywordflow">return</span> <a class="code" href="freetype_8h.html#a3bdf12232d495ca7d4d40f47b4bc157c">FT_Open_Face</a>( library, &amp;args, face_index, aface );
<a name="l01197"></a>01197   }
<a name="l01198"></a>01198 
<a name="l01199"></a>01199 <span class="preprocessor">#endif  </span><span class="comment">/* defined( FT_MACINTOSH ) &amp;&amp; !defined( DARWIN_NO_CARBON ) */</span>
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 
<a name="l01202"></a>01202   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l01203"></a>01203 
<a name="l01204"></a>01204   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l01205"></a><a class="code" href="ftobjs_8c.html#ae9bce7676556ee5611ecbaf370023a86">01205</a>   <a class="code" href="freetype_8h.html#ae9bce7676556ee5611ecbaf370023a86">FT_New_Memory_Face</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>      library,
<a name="l01206"></a>01206                       <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*  file_base,
<a name="l01207"></a>01207                       <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>         file_size,
<a name="l01208"></a>01208                       <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>         face_index,
<a name="l01209"></a>01209                       <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>        *aface )
<a name="l01210"></a>01210   {
<a name="l01211"></a>01211     <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>  args;
<a name="l01212"></a>01212 
<a name="l01213"></a>01213 
<a name="l01214"></a>01214     <span class="comment">/* test for valid `library&#39; and `face&#39; delayed to FT_Open_Face() */</span>
<a name="l01215"></a>01215     <span class="keywordflow">if</span> ( !file_base )
<a name="l01216"></a>01216       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l01217"></a>01217 
<a name="l01218"></a>01218     args.<a class="code" href="struct_f_t___open___args__.html#a2e3e6b9284fe8b4d9833e247a19181fa">flags</a>       = <a class="code" href="freetype_8h.html#a837da9c40d77ad29705b240d406e828c">FT_OPEN_MEMORY</a>;
<a name="l01219"></a>01219     args.<a class="code" href="struct_f_t___open___args__.html#a1231da51bc58922096b3bc603bb2ffb0">memory_base</a> = file_base;
<a name="l01220"></a>01220     args.<a class="code" href="struct_f_t___open___args__.html#a87f0bb2f257abe94c93a79e0de3525da">memory_size</a> = file_size;
<a name="l01221"></a>01221     args.<a class="code" href="struct_f_t___open___args__.html#ae1e6444bf0c21b323ce6cbe8bc475b2b">stream</a>      = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223     <span class="keywordflow">return</span> <a class="code" href="freetype_8h.html#a3bdf12232d495ca7d4d40f47b4bc157c">FT_Open_Face</a>( library, &amp;args, face_index, aface );
<a name="l01224"></a>01224   }
<a name="l01225"></a>01225 
<a name="l01226"></a>01226 
<a name="l01227"></a>01227 <span class="preprocessor">#ifdef FT_CONFIG_OPTION_MAC_FONTS</span>
<a name="l01228"></a>01228 <span class="preprocessor"></span>
<a name="l01229"></a>01229   <span class="comment">/* The behavior here is very similar to that in base/ftmac.c, but it     */</span>
<a name="l01230"></a>01230   <span class="comment">/* is designed to work on non-mac systems, so no mac specific calls.     */</span>
<a name="l01231"></a>01231   <span class="comment">/*                                                                       */</span>
<a name="l01232"></a>01232   <span class="comment">/* We look at the file and determine if it is a mac dfont file or a mac  */</span>
<a name="l01233"></a>01233   <span class="comment">/* resource file, or a macbinary file containing a mac resource file.    */</span>
<a name="l01234"></a>01234   <span class="comment">/*                                                                       */</span>
<a name="l01235"></a>01235   <span class="comment">/* Unlike ftmac I&#39;m not going to look at a `FOND&#39;.  I don&#39;t really see   */</span>
<a name="l01236"></a>01236   <span class="comment">/* the point, especially since there may be multiple `FOND&#39; resources.   */</span>
<a name="l01237"></a>01237   <span class="comment">/* Instead I&#39;ll just look for `sfnt&#39; and `POST&#39; resources, ordered as    */</span>
<a name="l01238"></a>01238   <span class="comment">/* they occur in the file.                                               */</span>
<a name="l01239"></a>01239   <span class="comment">/*                                                                       */</span>
<a name="l01240"></a>01240   <span class="comment">/* Note that multiple `POST&#39; resources do not mean multiple postscript   */</span>
<a name="l01241"></a>01241   <span class="comment">/* fonts; they all get jammed together to make what is essentially a     */</span>
<a name="l01242"></a>01242   <span class="comment">/* pfb file.                                                             */</span>
<a name="l01243"></a>01243   <span class="comment">/*                                                                       */</span>
<a name="l01244"></a>01244   <span class="comment">/* We aren&#39;t interested in `NFNT&#39; or `FONT&#39; bitmap resources.            */</span>
<a name="l01245"></a>01245   <span class="comment">/*                                                                       */</span>
<a name="l01246"></a>01246   <span class="comment">/* As soon as we get an `sfnt&#39; load it into memory and pass it off to    */</span>
<a name="l01247"></a>01247   <span class="comment">/* FT_Open_Face.                                                         */</span>
<a name="l01248"></a>01248   <span class="comment">/*                                                                       */</span>
<a name="l01249"></a>01249   <span class="comment">/* If we have a (set of) `POST&#39; resources, massage them into a (memory)  */</span>
<a name="l01250"></a>01250   <span class="comment">/* pfb file and pass that to FT_Open_Face.  (As with ftmac.c I&#39;m not     */</span>
<a name="l01251"></a>01251   <span class="comment">/* going to try to save the kerning info.  After all that lives in the   */</span>
<a name="l01252"></a>01252   <span class="comment">/* `FOND&#39; which isn&#39;t in the file containing the `POST&#39; resources so     */</span>
<a name="l01253"></a>01253   <span class="comment">/* we don&#39;t really have access to it.                                    */</span>
<a name="l01254"></a>01254 
<a name="l01255"></a>01255 
<a name="l01256"></a>01256   <span class="comment">/* Finalizer for a memory stream; gets called by FT_Done_Face(). */</span>
<a name="l01257"></a>01257   <span class="comment">/* It frees the memory it uses.                                  */</span>
<a name="l01258"></a>01258   <span class="comment">/* From ftmac.c.                                                 */</span>
<a name="l01259"></a>01259   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01260"></a>01260   memory_stream_close( <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>  stream )
<a name="l01261"></a>01261   {
<a name="l01262"></a>01262     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = stream-&gt;<a class="code" href="struct_f_t___stream_rec__.html#a51e2be0d80d70b532aae3face5461e7e">memory</a>;
<a name="l01263"></a>01263 
<a name="l01264"></a>01264 
<a name="l01265"></a>01265     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( stream-&gt;<a class="code" href="struct_f_t___stream_rec__.html#a7b406cb9a60c5a8b4bd8d04b7a23cfee">base</a> );
<a name="l01266"></a>01266 
<a name="l01267"></a>01267     stream-&gt;<a class="code" href="struct_f_t___stream_rec__.html#ab00e3cf802c950d0ca5a022a06953123">size</a>  = 0;
<a name="l01268"></a>01268     stream-&gt;<a class="code" href="struct_f_t___stream_rec__.html#a7b406cb9a60c5a8b4bd8d04b7a23cfee">base</a>  = 0;
<a name="l01269"></a>01269     stream-&gt;<a class="code" href="struct_f_t___stream_rec__.html#a7d7c7a1d7de8f580d7ad66efe89defa9">close</a> = 0;
<a name="l01270"></a>01270   }
<a name="l01271"></a>01271 
<a name="l01272"></a>01272 
<a name="l01273"></a>01273   <span class="comment">/* Create a new memory stream from a buffer and a size. */</span>
<a name="l01274"></a>01274   <span class="comment">/* From ftmac.c.                                        */</span>
<a name="l01275"></a>01275   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01276"></a>01276   new_memory_stream( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>           library,
<a name="l01277"></a>01277                      <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*             base,
<a name="l01278"></a>01278                      <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>             size,
<a name="l01279"></a>01279                      <a class="code" href="ftsystem_8h.html#a24013c9d02cdde7d9de6b80c958d8795">FT_Stream_CloseFunc</a>  close,
<a name="l01280"></a>01280                      <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>           *astream )
<a name="l01281"></a>01281   {
<a name="l01282"></a>01282     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l01283"></a>01283     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory;
<a name="l01284"></a>01284     <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>  stream;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286 
<a name="l01287"></a>01287     <span class="keywordflow">if</span> ( !library )
<a name="l01288"></a>01288       <span class="keywordflow">return</span> FT_Err_Invalid_Library_Handle;
<a name="l01289"></a>01289 
<a name="l01290"></a>01290     <span class="keywordflow">if</span> ( !base )
<a name="l01291"></a>01291       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l01292"></a>01292 
<a name="l01293"></a>01293     *astream = 0;
<a name="l01294"></a>01294     memory = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#afe392b83bc018b1b1fb25459f68a5861">memory</a>;
<a name="l01295"></a>01295     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a313d8de417ea0d1c5fcc7d348397a642">FT_NEW</a>( stream ) )
<a name="l01296"></a>01296       <span class="keywordflow">goto</span> Exit;
<a name="l01297"></a>01297 
<a name="l01298"></a>01298     <a class="code" href="ftstream_8h.html#adef0df22d5202d491bd9c8a93fb4bffd">FT_Stream_OpenMemory</a>( stream, base, size );
<a name="l01299"></a>01299 
<a name="l01300"></a>01300     stream-&gt;<a class="code" href="struct_f_t___stream_rec__.html#a7d7c7a1d7de8f580d7ad66efe89defa9">close</a> = close;
<a name="l01301"></a>01301 
<a name="l01302"></a>01302     *astream = stream;
<a name="l01303"></a>01303 
<a name="l01304"></a>01304   Exit:
<a name="l01305"></a>01305     <span class="keywordflow">return</span> error;
<a name="l01306"></a>01306   }
<a name="l01307"></a>01307 
<a name="l01308"></a>01308 
<a name="l01309"></a>01309   <span class="comment">/* Create a new FT_Face given a buffer and a driver name. */</span>
<a name="l01310"></a>01310   <span class="comment">/* from ftmac.c */</span>
<a name="l01311"></a>01311   <a class="code" href="ftconfig_8h.html#a065cda933183dff5dc368794eefa7c93">FT_LOCAL_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l01312"></a>01312   <a class="code" href="ftbase_8h.html#adf5d108c93f392827f7493865a9f4a41">open_face_from_buffer</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>   library,
<a name="l01313"></a>01313                          <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*     base,
<a name="l01314"></a>01314                          <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>     size,
<a name="l01315"></a>01315                          <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>      face_index,
<a name="l01316"></a>01316                          <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span>*  driver_name,
<a name="l01317"></a>01317                          <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>     *aface )
<a name="l01318"></a>01318   {
<a name="l01319"></a>01319     <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>  args;
<a name="l01320"></a>01320     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>      error;
<a name="l01321"></a>01321     <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>     stream = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01322"></a>01322     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>     memory = library-&gt;memory;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324 
<a name="l01325"></a>01325     error = new_memory_stream( library,
<a name="l01326"></a>01326                                base,
<a name="l01327"></a>01327                                size,
<a name="l01328"></a>01328                                memory_stream_close,
<a name="l01329"></a>01329                                &amp;stream );
<a name="l01330"></a>01330     <span class="keywordflow">if</span> ( error )
<a name="l01331"></a>01331     {
<a name="l01332"></a>01332       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( base );
<a name="l01333"></a>01333       <span class="keywordflow">return</span> error;
<a name="l01334"></a>01334     }
<a name="l01335"></a>01335 
<a name="l01336"></a>01336     args.<a class="code" href="struct_f_t___open___args__.html#a2e3e6b9284fe8b4d9833e247a19181fa">flags</a> = <a class="code" href="freetype_8h.html#aedfb4f733ac38dfa5859d83660f31bc2">FT_OPEN_STREAM</a>;
<a name="l01337"></a>01337     args.<a class="code" href="struct_f_t___open___args__.html#ae1e6444bf0c21b323ce6cbe8bc475b2b">stream</a> = stream;
<a name="l01338"></a>01338     <span class="keywordflow">if</span> ( driver_name )
<a name="l01339"></a>01339     {
<a name="l01340"></a>01340       args.<a class="code" href="struct_f_t___open___args__.html#a2e3e6b9284fe8b4d9833e247a19181fa">flags</a> = args.<a class="code" href="struct_f_t___open___args__.html#a2e3e6b9284fe8b4d9833e247a19181fa">flags</a> | <a class="code" href="freetype_8h.html#a58749d3bf1d7d908af3e17366c8e8969">FT_OPEN_DRIVER</a>;
<a name="l01341"></a>01341       args.<a class="code" href="struct_f_t___open___args__.html#a7c01bd7e34a440c3e89141ee521e2646">driver</a> = <a class="code" href="ftmodapi_8h.html#a9aae78d37c4eadf2cd3c702ab138d3d1">FT_Get_Module</a>( library, driver_name );
<a name="l01342"></a>01342     }
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 <span class="preprocessor">#ifdef FT_MACINTOSH</span>
<a name="l01345"></a>01345 <span class="preprocessor"></span>    <span class="comment">/* At this point, face_index has served its purpose;      */</span>
<a name="l01346"></a>01346     <span class="comment">/* whoever calls this function has already used it to     */</span>
<a name="l01347"></a>01347     <span class="comment">/* locate the correct font data.  We should not propagate */</span>
<a name="l01348"></a>01348     <span class="comment">/* this index to FT_Open_Face() (unless it is negative).  */</span>
<a name="l01349"></a>01349 
<a name="l01350"></a>01350     <span class="keywordflow">if</span> ( face_index &gt; 0 )
<a name="l01351"></a>01351       face_index = 0;
<a name="l01352"></a>01352 <span class="preprocessor">#endif</span>
<a name="l01353"></a>01353 <span class="preprocessor"></span>
<a name="l01354"></a>01354     error = <a class="code" href="freetype_8h.html#a3bdf12232d495ca7d4d40f47b4bc157c">FT_Open_Face</a>( library, &amp;args, face_index, aface );
<a name="l01355"></a>01355 
<a name="l01356"></a>01356     <span class="keywordflow">if</span> ( error == FT_Err_Ok )
<a name="l01357"></a>01357       (*aface)-&gt;face_flags &amp;= ~<a class="code" href="freetype_8h.html#a88935459cedd8fb94de90b54b61b5340">FT_FACE_FLAG_EXTERNAL_STREAM</a>;
<a name="l01358"></a>01358     <span class="keywordflow">else</span>
<a name="l01359"></a>01359 <span class="preprocessor">#ifdef FT_MACINTOSH</span>
<a name="l01360"></a>01360 <span class="preprocessor"></span>      <a class="code" href="ftstream_8h.html#ac2619fbc2d12358691456bf1bf312710">FT_Stream_Free</a>( stream, 0 );
<a name="l01361"></a>01361 <span class="preprocessor">#else</span>
<a name="l01362"></a>01362 <span class="preprocessor"></span>    {
<a name="l01363"></a>01363       <a class="code" href="ftstream_8h.html#a593fa53a196798f63d80b7bfc25a1e7a">FT_Stream_Close</a>( stream );
<a name="l01364"></a>01364       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( stream );
<a name="l01365"></a>01365     }
<a name="l01366"></a>01366 <span class="preprocessor">#endif</span>
<a name="l01367"></a>01367 <span class="preprocessor"></span>
<a name="l01368"></a>01368     <span class="keywordflow">return</span> error;
<a name="l01369"></a>01369   }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371 
<a name="l01372"></a>01372   <span class="comment">/* Look up `TYP1&#39; or `CID &#39; table from sfnt table directory.       */</span>
<a name="l01373"></a>01373   <span class="comment">/* `offset&#39; and `length&#39; must exclude the binary header in tables. */</span>
<a name="l01374"></a>01374 
<a name="l01375"></a>01375   <span class="comment">/* Type 1 and CID-keyed font drivers should recognize sfnt-wrapped */</span>
<a name="l01376"></a>01376   <span class="comment">/* format too.  Here, since we can&#39;t expect that the TrueType font */</span>
<a name="l01377"></a>01377   <span class="comment">/* driver is loaded unconditially, we must parse the font by       */</span>
<a name="l01378"></a>01378   <span class="comment">/* ourselves.  We are only interested in the name of the table and */</span>
<a name="l01379"></a>01379   <span class="comment">/* the offset.                                                     */</span>
<a name="l01380"></a>01380 
<a name="l01381"></a>01381   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01382"></a>01382   ft_lookup_PS_in_sfnt_stream( <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>  stream,
<a name="l01383"></a>01383                                <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    face_index,
<a name="l01384"></a>01384                                <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>*  offset,
<a name="l01385"></a>01385                                <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>*  length,
<a name="l01386"></a>01386                                <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>*   is_sfnt_cid )
<a name="l01387"></a>01387   {
<a name="l01388"></a>01388     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l01389"></a>01389     <a class="code" href="fttypes_8h.html#a937f6c17cf5ffd09086d8610c37b9f58">FT_UShort</a>  numTables;
<a name="l01390"></a>01390     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    pstable_index;
<a name="l01391"></a>01391     <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>   tag;
<a name="l01392"></a>01392     <span class="keywordtype">int</span>        i;
<a name="l01393"></a>01393 
<a name="l01394"></a>01394 
<a name="l01395"></a>01395     *offset = 0;
<a name="l01396"></a>01396     *length = 0;
<a name="l01397"></a>01397     *is_sfnt_cid = <a class="code" href="ftobjs_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01398"></a>01398 
<a name="l01399"></a>01399     <span class="comment">/* TODO: support for sfnt-wrapped PS/CID in TTC format */</span>
<a name="l01400"></a>01400 
<a name="l01401"></a>01401     <span class="comment">/* version check for &#39;typ1&#39; (should be ignored?) */</span>
<a name="l01402"></a>01402     <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#a4010e009439b0e0393aff9cfb90e1ab6">FT_READ_ULONG</a>( tag ) )
<a name="l01403"></a>01403       <span class="keywordflow">return</span> error;
<a name="l01404"></a>01404     <span class="keywordflow">if</span> ( tag != <a class="code" href="tttags_8h.html#a7fbb3f0a456b2d6bae9b1dc9cb4c8845">TTAG_typ1</a> )
<a name="l01405"></a>01405       <span class="keywordflow">return</span> FT_Err_Unknown_File_Format;
<a name="l01406"></a>01406 
<a name="l01407"></a>01407     <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#a1144011013161a44608a85afb891c329">FT_READ_USHORT</a>( numTables ) )
<a name="l01408"></a>01408       <span class="keywordflow">return</span> error;
<a name="l01409"></a>01409     <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#aadca1eb5ef2cfaad959969a1384e06c2">FT_STREAM_SKIP</a>( 2 * 3 ) ) <span class="comment">/* skip binary search header */</span>
<a name="l01410"></a>01410       <span class="keywordflow">return</span> error;
<a name="l01411"></a>01411 
<a name="l01412"></a>01412     pstable_index = -1;
<a name="l01413"></a>01413     *is_sfnt_cid  = <a class="code" href="ftobjs_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01414"></a>01414 
<a name="l01415"></a>01415     <span class="keywordflow">for</span> ( i = 0; i &lt; numTables; i++ )
<a name="l01416"></a>01416     {
<a name="l01417"></a>01417       <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#a4010e009439b0e0393aff9cfb90e1ab6">FT_READ_ULONG</a>( tag )     || <a class="code" href="ftstream_8h.html#aadca1eb5ef2cfaad959969a1384e06c2">FT_STREAM_SKIP</a>( 4 )      ||
<a name="l01418"></a>01418            <a class="code" href="ftstream_8h.html#a4010e009439b0e0393aff9cfb90e1ab6">FT_READ_ULONG</a>( *offset ) || <a class="code" href="ftstream_8h.html#a4010e009439b0e0393aff9cfb90e1ab6">FT_READ_ULONG</a>( *length ) )
<a name="l01419"></a>01419         <span class="keywordflow">return</span> error;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421       <span class="keywordflow">if</span> ( tag == <a class="code" href="tttags_8h.html#a3fb2363dcca2cbb72ae32ca6faa1c227">TTAG_CID</a> )
<a name="l01422"></a>01422       {
<a name="l01423"></a>01423         pstable_index++;
<a name="l01424"></a>01424         *offset += 22;
<a name="l01425"></a>01425         *length -= 22;
<a name="l01426"></a>01426         *is_sfnt_cid = <a class="code" href="ftobjs_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01427"></a>01427         <span class="keywordflow">if</span> ( face_index &lt; 0 )
<a name="l01428"></a>01428           <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l01429"></a>01429       }
<a name="l01430"></a>01430       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( tag == <a class="code" href="tttags_8h.html#a719dcbae370578a545cdbe08c7fc37e9">TTAG_TYP1</a> )
<a name="l01431"></a>01431       {
<a name="l01432"></a>01432         pstable_index++;
<a name="l01433"></a>01433         *offset += 24;
<a name="l01434"></a>01434         *length -= 24;
<a name="l01435"></a>01435         *is_sfnt_cid = <a class="code" href="ftobjs_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01436"></a>01436         <span class="keywordflow">if</span> ( face_index &lt; 0 )
<a name="l01437"></a>01437           <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l01438"></a>01438       }
<a name="l01439"></a>01439       <span class="keywordflow">if</span> ( face_index &gt;= 0 &amp;&amp; pstable_index == face_index )
<a name="l01440"></a>01440         <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l01441"></a>01441     }
<a name="l01442"></a>01442     <span class="keywordflow">return</span> FT_Err_Table_Missing;
<a name="l01443"></a>01443   }
<a name="l01444"></a>01444 
<a name="l01445"></a>01445 
<a name="l01446"></a>01446   <a class="code" href="ftconfig_8h.html#a065cda933183dff5dc368794eefa7c93">FT_LOCAL_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l01447"></a>01447   <a class="code" href="ftbase_8h.html#ae2e7aa383c4d947df388f6e2c9cd8be9">open_face_PS_from_sfnt_stream</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>     library,
<a name="l01448"></a>01448                                  <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>      stream,
<a name="l01449"></a>01449                                  <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>        face_index,
<a name="l01450"></a>01450                                  <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>         num_params,
<a name="l01451"></a>01451                                  <a class="code" href="struct_f_t___parameter__.html">FT_Parameter</a>  *params,
<a name="l01452"></a>01452                                  <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>       *aface )
<a name="l01453"></a>01453   {
<a name="l01454"></a>01454     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l01455"></a>01455     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = library-&gt;memory;
<a name="l01456"></a>01456     <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>   offset, length;
<a name="l01457"></a>01457     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    pos;
<a name="l01458"></a>01458     <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>    is_sfnt_cid;
<a name="l01459"></a>01459     <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*   sfnt_ps;
<a name="l01460"></a>01460 
<a name="l01461"></a>01461     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( num_params );
<a name="l01462"></a>01462     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( params );
<a name="l01463"></a>01463 
<a name="l01464"></a>01464 
<a name="l01465"></a>01465     pos = <a class="code" href="ftstream_8h.html#aa779880df754b097a9f92f45d648ab42">FT_Stream_Pos</a>( stream );
<a name="l01466"></a>01466 
<a name="l01467"></a>01467     error = ft_lookup_PS_in_sfnt_stream( stream,
<a name="l01468"></a>01468                                          face_index,
<a name="l01469"></a>01469                                          &amp;offset,
<a name="l01470"></a>01470                                          &amp;length,
<a name="l01471"></a>01471                                          &amp;is_sfnt_cid );
<a name="l01472"></a>01472     <span class="keywordflow">if</span> ( error )
<a name="l01473"></a>01473       <span class="keywordflow">goto</span> Exit;
<a name="l01474"></a>01474 
<a name="l01475"></a>01475     <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#adaaeed4eea8beadd5ae9a5493b340890">FT_Stream_Seek</a>( stream, pos + offset ) )
<a name="l01476"></a>01476       <span class="keywordflow">goto</span> Exit;
<a name="l01477"></a>01477 
<a name="l01478"></a>01478     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( sfnt_ps, (<a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>)length ) )
<a name="l01479"></a>01479       <span class="keywordflow">goto</span> Exit;
<a name="l01480"></a>01480 
<a name="l01481"></a>01481     error = <a class="code" href="ftstream_8h.html#ab3efa470f29a814a6e99d51f62fa005a">FT_Stream_Read</a>( stream, (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a> *)sfnt_ps, length );
<a name="l01482"></a>01482     <span class="keywordflow">if</span> ( error )
<a name="l01483"></a>01483       <span class="keywordflow">goto</span> Exit;
<a name="l01484"></a>01484 
<a name="l01485"></a>01485     error = <a class="code" href="ftbase_8h.html#adf5d108c93f392827f7493865a9f4a41">open_face_from_buffer</a>( library,
<a name="l01486"></a>01486                                    sfnt_ps,
<a name="l01487"></a>01487                                    length,
<a name="l01488"></a>01488                                    face_index &lt; 0 ? face_index : 0,
<a name="l01489"></a>01489                                    is_sfnt_cid ? <span class="stringliteral">&quot;cid&quot;</span> : <span class="stringliteral">&quot;type1&quot;</span>,
<a name="l01490"></a>01490                                    aface );
<a name="l01491"></a>01491   Exit:
<a name="l01492"></a>01492     {
<a name="l01493"></a>01493       <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>  error1;
<a name="l01494"></a>01494 
<a name="l01495"></a>01495 
<a name="l01496"></a>01496       <span class="keywordflow">if</span> ( error == FT_Err_Unknown_File_Format )
<a name="l01497"></a>01497       {
<a name="l01498"></a>01498         error1 = <a class="code" href="ftstream_8h.html#adaaeed4eea8beadd5ae9a5493b340890">FT_Stream_Seek</a>( stream, pos );
<a name="l01499"></a>01499         <span class="keywordflow">if</span> ( error1 )
<a name="l01500"></a>01500           <span class="keywordflow">return</span> error1;
<a name="l01501"></a>01501       }
<a name="l01502"></a>01502 
<a name="l01503"></a>01503       <span class="keywordflow">return</span> error;
<a name="l01504"></a>01504     }
<a name="l01505"></a>01505   }
<a name="l01506"></a>01506 
<a name="l01507"></a>01507 
<a name="l01508"></a>01508 <span class="preprocessor">#if !defined( FT_MACINTOSH ) || defined( DARWIN_NO_CARBON )</span>
<a name="l01509"></a>01509 <span class="preprocessor"></span>
<a name="l01510"></a>01510   <span class="comment">/* The resource header says we&#39;ve got resource_cnt `POST&#39; (type1) */</span>
<a name="l01511"></a>01511   <span class="comment">/* resources in this file.  They all need to be coalesced into    */</span>
<a name="l01512"></a>01512   <span class="comment">/* one lump which gets passed on to the type1 driver.             */</span>
<a name="l01513"></a>01513   <span class="comment">/* Here can be only one PostScript font in a file so face_index   */</span>
<a name="l01514"></a>01514   <span class="comment">/* must be 0 (or -1).                                             */</span>
<a name="l01515"></a>01515   <span class="comment">/*                                                                */</span>
<a name="l01516"></a>01516   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01517"></a>01517   Mac_Read_POST_Resource( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library,
<a name="l01518"></a>01518                           <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>   stream,
<a name="l01519"></a>01519                           <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    *offsets,
<a name="l01520"></a>01520                           <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>     resource_cnt,
<a name="l01521"></a>01521                           <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>     face_index,
<a name="l01522"></a>01522                           <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    *aface )
<a name="l01523"></a>01523   {
<a name="l01524"></a>01524     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error  = FT_Err_Cannot_Open_Resource;
<a name="l01525"></a>01525     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#afe392b83bc018b1b1fb25459f68a5861">memory</a>;
<a name="l01526"></a>01526     <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*   pfb_data;
<a name="l01527"></a>01527     <span class="keywordtype">int</span>        i, <a class="code" href="jsonmain_8cpp.html#a7d01331eabfecd9e518fcbe3b70d6851">type</a>, flags;
<a name="l01528"></a>01528     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    len;
<a name="l01529"></a>01529     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    pfb_len, pfb_pos, pfb_lenpos;
<a name="l01530"></a>01530     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    rlen, temp;
<a name="l01531"></a>01531 
<a name="l01532"></a>01532 
<a name="l01533"></a>01533     <span class="keywordflow">if</span> ( face_index == -1 )
<a name="l01534"></a>01534       face_index = 0;
<a name="l01535"></a>01535     <span class="keywordflow">if</span> ( face_index != 0 )
<a name="l01536"></a>01536       <span class="keywordflow">return</span> error;
<a name="l01537"></a>01537 
<a name="l01538"></a>01538     <span class="comment">/* Find the length of all the POST resources, concatenated.  Assume */</span>
<a name="l01539"></a>01539     <span class="comment">/* worst case (each resource in its own section).                   */</span>
<a name="l01540"></a>01540     pfb_len = 0;
<a name="l01541"></a>01541     <span class="keywordflow">for</span> ( i = 0; i &lt; resource_cnt; ++i )
<a name="l01542"></a>01542     {
<a name="l01543"></a>01543       error = <a class="code" href="ftstream_8h.html#adaaeed4eea8beadd5ae9a5493b340890">FT_Stream_Seek</a>( stream, offsets[i] );
<a name="l01544"></a>01544       <span class="keywordflow">if</span> ( error )
<a name="l01545"></a>01545         <span class="keywordflow">goto</span> Exit;
<a name="l01546"></a>01546       <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#a4afa9453f279dd9217e796023a2799f1">FT_READ_LONG</a>( temp ) )
<a name="l01547"></a>01547         <span class="keywordflow">goto</span> Exit;
<a name="l01548"></a>01548       pfb_len += temp + 6;
<a name="l01549"></a>01549     }
<a name="l01550"></a>01550 
<a name="l01551"></a>01551     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( pfb_data, (<a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>)pfb_len + 2 ) )
<a name="l01552"></a>01552       <span class="keywordflow">goto</span> Exit;
<a name="l01553"></a>01553 
<a name="l01554"></a>01554     pfb_data[0] = 0x80;
<a name="l01555"></a>01555     pfb_data[1] = 1;            <span class="comment">/* Ascii section */</span>
<a name="l01556"></a>01556     pfb_data[2] = 0;            <span class="comment">/* 4-byte length, fill in later */</span>
<a name="l01557"></a>01557     pfb_data[3] = 0;
<a name="l01558"></a>01558     pfb_data[4] = 0;
<a name="l01559"></a>01559     pfb_data[5] = 0;
<a name="l01560"></a>01560     pfb_pos     = 6;
<a name="l01561"></a>01561     pfb_lenpos  = 2;
<a name="l01562"></a>01562 
<a name="l01563"></a>01563     len = 0;
<a name="l01564"></a>01564     type = 1;
<a name="l01565"></a>01565     <span class="keywordflow">for</span> ( i = 0; i &lt; resource_cnt; ++i )
<a name="l01566"></a>01566     {
<a name="l01567"></a>01567       error = <a class="code" href="ftstream_8h.html#adaaeed4eea8beadd5ae9a5493b340890">FT_Stream_Seek</a>( stream, offsets[i] );
<a name="l01568"></a>01568       <span class="keywordflow">if</span> ( error )
<a name="l01569"></a>01569         <span class="keywordflow">goto</span> Exit2;
<a name="l01570"></a>01570       <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#a4afa9453f279dd9217e796023a2799f1">FT_READ_LONG</a>( rlen ) )
<a name="l01571"></a>01571         <span class="keywordflow">goto</span> Exit;
<a name="l01572"></a>01572       <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#a1144011013161a44608a85afb891c329">FT_READ_USHORT</a>( flags ) )
<a name="l01573"></a>01573         <span class="keywordflow">goto</span> Exit;
<a name="l01574"></a>01574       <a class="code" href="ftdebug_8h.html#a9ff2b46b2097d26afa62871cddccdaad">FT_TRACE3</a>(( <span class="stringliteral">&quot;POST fragment[%d]: offsets=0x%08x, rlen=0x%08x, flags=0x%04x\n&quot;</span>,
<a name="l01575"></a>01575                    i, offsets[i], rlen, flags ));
<a name="l01576"></a>01576 
<a name="l01577"></a>01577       <span class="comment">/* postpone the check of rlen longer than buffer until FT_Stream_Read() */</span>
<a name="l01578"></a>01578       <span class="keywordflow">if</span> ( ( flags &gt;&gt; 8 ) == 0 )        <span class="comment">/* Comment, should not be loaded */</span>
<a name="l01579"></a>01579         <span class="keywordflow">continue</span>;
<a name="l01580"></a>01580 
<a name="l01581"></a>01581       <span class="comment">/* the flags are part of the resource, so rlen &gt;= 2.  */</span>
<a name="l01582"></a>01582       <span class="comment">/* but some fonts declare rlen = 0 for empty fragment */</span>
<a name="l01583"></a>01583       <span class="keywordflow">if</span> ( rlen &gt; 2 )
<a name="l01584"></a>01584         rlen -= 2;
<a name="l01585"></a>01585       <span class="keywordflow">else</span>
<a name="l01586"></a>01586         rlen = 0;
<a name="l01587"></a>01587 
<a name="l01588"></a>01588       <span class="keywordflow">if</span> ( ( flags &gt;&gt; 8 ) == type )
<a name="l01589"></a>01589         len += rlen;
<a name="l01590"></a>01590       <span class="keywordflow">else</span>
<a name="l01591"></a>01591       {
<a name="l01592"></a>01592         <span class="keywordflow">if</span> ( pfb_lenpos + 3 &gt; pfb_len + 2 )
<a name="l01593"></a>01593           <span class="keywordflow">goto</span> Exit2;
<a name="l01594"></a>01594         pfb_data[pfb_lenpos    ] = (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>)( len );
<a name="l01595"></a>01595         pfb_data[pfb_lenpos + 1] = (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>)( len &gt;&gt; 8 );
<a name="l01596"></a>01596         pfb_data[pfb_lenpos + 2] = (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>)( len &gt;&gt; 16 );
<a name="l01597"></a>01597         pfb_data[pfb_lenpos + 3] = (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>)( len &gt;&gt; 24 );
<a name="l01598"></a>01598 
<a name="l01599"></a>01599         <span class="keywordflow">if</span> ( ( flags &gt;&gt; 8 ) == 5 )      <span class="comment">/* End of font mark */</span>
<a name="l01600"></a>01600           <span class="keywordflow">break</span>;
<a name="l01601"></a>01601 
<a name="l01602"></a>01602         <span class="keywordflow">if</span> ( pfb_pos + 6 &gt; pfb_len + 2 )
<a name="l01603"></a>01603           <span class="keywordflow">goto</span> Exit2;
<a name="l01604"></a>01604         pfb_data[pfb_pos++] = 0x80;
<a name="l01605"></a>01605 
<a name="l01606"></a>01606         type = flags &gt;&gt; 8;
<a name="l01607"></a>01607         len = rlen;
<a name="l01608"></a>01608 
<a name="l01609"></a>01609         pfb_data[pfb_pos++] = (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>)type;
<a name="l01610"></a>01610         pfb_lenpos          = pfb_pos;
<a name="l01611"></a>01611         pfb_data[pfb_pos++] = 0;        <span class="comment">/* 4-byte length, fill in later */</span>
<a name="l01612"></a>01612         pfb_data[pfb_pos++] = 0;
<a name="l01613"></a>01613         pfb_data[pfb_pos++] = 0;
<a name="l01614"></a>01614         pfb_data[pfb_pos++] = 0;
<a name="l01615"></a>01615       }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617       error = FT_Err_Cannot_Open_Resource;
<a name="l01618"></a>01618       <span class="keywordflow">if</span> ( pfb_pos &gt; pfb_len || pfb_pos + rlen &gt; pfb_len )
<a name="l01619"></a>01619         <span class="keywordflow">goto</span> Exit2;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621       error = <a class="code" href="ftstream_8h.html#ab3efa470f29a814a6e99d51f62fa005a">FT_Stream_Read</a>( stream, (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a> *)pfb_data + pfb_pos, rlen );
<a name="l01622"></a>01622       <span class="keywordflow">if</span> ( error )
<a name="l01623"></a>01623         <span class="keywordflow">goto</span> Exit2;
<a name="l01624"></a>01624       pfb_pos += rlen;
<a name="l01625"></a>01625     }
<a name="l01626"></a>01626 
<a name="l01627"></a>01627     <span class="keywordflow">if</span> ( pfb_pos + 2 &gt; pfb_len + 2 )
<a name="l01628"></a>01628       <span class="keywordflow">goto</span> Exit2;
<a name="l01629"></a>01629     pfb_data[pfb_pos++] = 0x80;
<a name="l01630"></a>01630     pfb_data[pfb_pos++] = 3;
<a name="l01631"></a>01631 
<a name="l01632"></a>01632     <span class="keywordflow">if</span> ( pfb_lenpos + 3 &gt; pfb_len + 2 )
<a name="l01633"></a>01633       <span class="keywordflow">goto</span> Exit2;
<a name="l01634"></a>01634     pfb_data[pfb_lenpos    ] = (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>)( len );
<a name="l01635"></a>01635     pfb_data[pfb_lenpos + 1] = (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>)( len &gt;&gt; 8 );
<a name="l01636"></a>01636     pfb_data[pfb_lenpos + 2] = (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>)( len &gt;&gt; 16 );
<a name="l01637"></a>01637     pfb_data[pfb_lenpos + 3] = (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>)( len &gt;&gt; 24 );
<a name="l01638"></a>01638 
<a name="l01639"></a>01639     <span class="keywordflow">return</span> <a class="code" href="ftbase_8h.html#adf5d108c93f392827f7493865a9f4a41">open_face_from_buffer</a>( library,
<a name="l01640"></a>01640                                   pfb_data,
<a name="l01641"></a>01641                                   pfb_pos,
<a name="l01642"></a>01642                                   face_index,
<a name="l01643"></a>01643                                   <span class="stringliteral">&quot;type1&quot;</span>,
<a name="l01644"></a>01644                                   aface );
<a name="l01645"></a>01645 
<a name="l01646"></a>01646   Exit2:
<a name="l01647"></a>01647     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( pfb_data );
<a name="l01648"></a>01648 
<a name="l01649"></a>01649   Exit:
<a name="l01650"></a>01650     <span class="keywordflow">return</span> error;
<a name="l01651"></a>01651   }
<a name="l01652"></a>01652 
<a name="l01653"></a>01653 
<a name="l01654"></a>01654   <span class="comment">/* The resource header says we&#39;ve got resource_cnt `sfnt&#39;      */</span>
<a name="l01655"></a>01655   <span class="comment">/* (TrueType/OpenType) resources in this file.  Look through   */</span>
<a name="l01656"></a>01656   <span class="comment">/* them for the one indicated by face_index, load it into mem, */</span>
<a name="l01657"></a>01657   <span class="comment">/* pass it on the the truetype driver and return it.           */</span>
<a name="l01658"></a>01658   <span class="comment">/*                                                             */</span>
<a name="l01659"></a>01659   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01660"></a>01660   Mac_Read_sfnt_Resource( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library,
<a name="l01661"></a>01661                           <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>   stream,
<a name="l01662"></a>01662                           <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    *offsets,
<a name="l01663"></a>01663                           <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>     resource_cnt,
<a name="l01664"></a>01664                           <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>     face_index,
<a name="l01665"></a>01665                           <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    *aface )
<a name="l01666"></a>01666   {
<a name="l01667"></a>01667     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#afe392b83bc018b1b1fb25459f68a5861">memory</a>;
<a name="l01668"></a>01668     <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*   sfnt_data;
<a name="l01669"></a>01669     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l01670"></a>01670     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    flag_offset;
<a name="l01671"></a>01671     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    rlen;
<a name="l01672"></a>01672     <span class="keywordtype">int</span>        is_cff;
<a name="l01673"></a>01673     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    face_index_in_resource = 0;
<a name="l01674"></a>01674 
<a name="l01675"></a>01675 
<a name="l01676"></a>01676     <span class="keywordflow">if</span> ( face_index == -1 )
<a name="l01677"></a>01677       face_index = 0;
<a name="l01678"></a>01678     <span class="keywordflow">if</span> ( face_index &gt;= resource_cnt )
<a name="l01679"></a>01679       <span class="keywordflow">return</span> FT_Err_Cannot_Open_Resource;
<a name="l01680"></a>01680 
<a name="l01681"></a>01681     flag_offset = offsets[face_index];
<a name="l01682"></a>01682     error = <a class="code" href="ftstream_8h.html#adaaeed4eea8beadd5ae9a5493b340890">FT_Stream_Seek</a>( stream, flag_offset );
<a name="l01683"></a>01683     <span class="keywordflow">if</span> ( error )
<a name="l01684"></a>01684       <span class="keywordflow">goto</span> Exit;
<a name="l01685"></a>01685 
<a name="l01686"></a>01686     <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#a4afa9453f279dd9217e796023a2799f1">FT_READ_LONG</a>( rlen ) )
<a name="l01687"></a>01687       <span class="keywordflow">goto</span> Exit;
<a name="l01688"></a>01688     <span class="keywordflow">if</span> ( rlen == -1 )
<a name="l01689"></a>01689       <span class="keywordflow">return</span> FT_Err_Cannot_Open_Resource;
<a name="l01690"></a>01690 
<a name="l01691"></a>01691     error = <a class="code" href="ftbase_8h.html#ae2e7aa383c4d947df388f6e2c9cd8be9">open_face_PS_from_sfnt_stream</a>( library,
<a name="l01692"></a>01692                                            stream,
<a name="l01693"></a>01693                                            face_index,
<a name="l01694"></a>01694                                            0, <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l01695"></a>01695                                            aface );
<a name="l01696"></a>01696     <span class="keywordflow">if</span> ( !error )
<a name="l01697"></a>01697       <span class="keywordflow">goto</span> Exit;
<a name="l01698"></a>01698 
<a name="l01699"></a>01699     <span class="comment">/* rewind sfnt stream before open_face_PS_from_sfnt_stream() */</span>
<a name="l01700"></a>01700     <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#adaaeed4eea8beadd5ae9a5493b340890">FT_Stream_Seek</a>( stream, flag_offset + 4 ) )
<a name="l01701"></a>01701       <span class="keywordflow">goto</span> Exit;
<a name="l01702"></a>01702 
<a name="l01703"></a>01703     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( sfnt_data, (<a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>)rlen ) )
<a name="l01704"></a>01704       <span class="keywordflow">return</span> error;
<a name="l01705"></a>01705     error = <a class="code" href="ftstream_8h.html#ab3efa470f29a814a6e99d51f62fa005a">FT_Stream_Read</a>( stream, (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a> *)sfnt_data, rlen );
<a name="l01706"></a>01706     <span class="keywordflow">if</span> ( error )
<a name="l01707"></a>01707       <span class="keywordflow">goto</span> Exit;
<a name="l01708"></a>01708 
<a name="l01709"></a>01709     is_cff = rlen &gt; 4 &amp;&amp; !<a class="code" href="ftstdlib_8h.html#a472a9d41583c5334151534ba3d33ad21">ft_memcmp</a>( sfnt_data, <span class="stringliteral">&quot;OTTO&quot;</span>, 4 );
<a name="l01710"></a>01710     error = <a class="code" href="ftbase_8h.html#adf5d108c93f392827f7493865a9f4a41">open_face_from_buffer</a>( library,
<a name="l01711"></a>01711                                    sfnt_data,
<a name="l01712"></a>01712                                    rlen,
<a name="l01713"></a>01713                                    face_index_in_resource,
<a name="l01714"></a>01714                                    is_cff ? <span class="stringliteral">&quot;cff&quot;</span> : <span class="stringliteral">&quot;truetype&quot;</span>,
<a name="l01715"></a>01715                                    aface );
<a name="l01716"></a>01716 
<a name="l01717"></a>01717   Exit:
<a name="l01718"></a>01718     <span class="keywordflow">return</span> error;
<a name="l01719"></a>01719   }
<a name="l01720"></a>01720 
<a name="l01721"></a>01721 
<a name="l01722"></a>01722   <span class="comment">/* Check for a valid resource fork header, or a valid dfont    */</span>
<a name="l01723"></a>01723   <span class="comment">/* header.  In a resource fork the first 16 bytes are repeated */</span>
<a name="l01724"></a>01724   <span class="comment">/* at the location specified by bytes 4-7.  In a dfont bytes   */</span>
<a name="l01725"></a>01725   <span class="comment">/* 4-7 point to 16 bytes of zeroes instead.                    */</span>
<a name="l01726"></a>01726   <span class="comment">/*                                                             */</span>
<a name="l01727"></a>01727   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01728"></a>01728   IsMacResource( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library,
<a name="l01729"></a>01729                  <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>   stream,
<a name="l01730"></a>01730                  <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>     resource_offset,
<a name="l01731"></a>01731                  <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>     face_index,
<a name="l01732"></a>01732                  <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    *aface )
<a name="l01733"></a>01733   {
<a name="l01734"></a>01734     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#afe392b83bc018b1b1fb25459f68a5861">memory</a>;
<a name="l01735"></a>01735     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l01736"></a>01736     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    map_offset, rdara_pos;
<a name="l01737"></a>01737     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    *data_offsets;
<a name="l01738"></a>01738     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    count;
<a name="l01739"></a>01739 
<a name="l01740"></a>01740 
<a name="l01741"></a>01741     error = <a class="code" href="ftrfork_8h.html#a7ab196be3a237c4dca8d2cde79ef08ca">FT_Raccess_Get_HeaderInfo</a>( library, stream, resource_offset,
<a name="l01742"></a>01742                                        &amp;map_offset, &amp;rdara_pos );
<a name="l01743"></a>01743     <span class="keywordflow">if</span> ( error )
<a name="l01744"></a>01744       <span class="keywordflow">return</span> error;
<a name="l01745"></a>01745 
<a name="l01746"></a>01746     error = <a class="code" href="ftrfork_8h.html#aabd20bd058f8043a29be60a3046b66ec">FT_Raccess_Get_DataOffsets</a>( library, stream,
<a name="l01747"></a>01747                                         map_offset, rdara_pos,
<a name="l01748"></a>01748                                         <a class="code" href="tttags_8h.html#af90b07f9116aafa547812c20d76c36c2">TTAG_POST</a>,
<a name="l01749"></a>01749                                         &amp;data_offsets, &amp;count );
<a name="l01750"></a>01750     <span class="keywordflow">if</span> ( !error )
<a name="l01751"></a>01751     {
<a name="l01752"></a>01752       error = Mac_Read_POST_Resource( library, stream, data_offsets, count,
<a name="l01753"></a>01753                                       face_index, aface );
<a name="l01754"></a>01754       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( data_offsets );
<a name="l01755"></a>01755       <span class="comment">/* POST exists in an LWFN providing a single face */</span>
<a name="l01756"></a>01756       <span class="keywordflow">if</span> ( !error )
<a name="l01757"></a>01757         (*aface)-&gt;num_faces = 1;
<a name="l01758"></a>01758       <span class="keywordflow">return</span> error;
<a name="l01759"></a>01759     }
<a name="l01760"></a>01760 
<a name="l01761"></a>01761     error = <a class="code" href="ftrfork_8h.html#aabd20bd058f8043a29be60a3046b66ec">FT_Raccess_Get_DataOffsets</a>( library, stream,
<a name="l01762"></a>01762                                         map_offset, rdara_pos,
<a name="l01763"></a>01763                                         <a class="code" href="tttags_8h.html#a749234c473a43c7d9a9db68a847bfaeb">TTAG_sfnt</a>,
<a name="l01764"></a>01764                                         &amp;data_offsets, &amp;count );
<a name="l01765"></a>01765     <span class="keywordflow">if</span> ( !error )
<a name="l01766"></a>01766     {
<a name="l01767"></a>01767       <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>  face_index_internal = face_index % count;
<a name="l01768"></a>01768 
<a name="l01769"></a>01769 
<a name="l01770"></a>01770       error = Mac_Read_sfnt_Resource( library, stream, data_offsets, count,
<a name="l01771"></a>01771                                       face_index_internal, aface );
<a name="l01772"></a>01772       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( data_offsets );
<a name="l01773"></a>01773       <span class="keywordflow">if</span> ( !error )
<a name="l01774"></a>01774         (*aface)-&gt;num_faces = count;
<a name="l01775"></a>01775     }
<a name="l01776"></a>01776 
<a name="l01777"></a>01777     <span class="keywordflow">return</span> error;
<a name="l01778"></a>01778   }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780 
<a name="l01781"></a>01781   <span class="comment">/* Check for a valid macbinary header, and if we find one   */</span>
<a name="l01782"></a>01782   <span class="comment">/* check that the (flattened) resource fork in it is valid. */</span>
<a name="l01783"></a>01783   <span class="comment">/*                                                          */</span>
<a name="l01784"></a>01784   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01785"></a>01785   IsMacBinary( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library,
<a name="l01786"></a>01786                <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>   stream,
<a name="l01787"></a>01787                <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>     face_index,
<a name="l01788"></a>01788                <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    *aface )
<a name="l01789"></a>01789   {
<a name="l01790"></a>01790     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  header[128];
<a name="l01791"></a>01791     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>       error;
<a name="l01792"></a>01792     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>        dlen, offset;
<a name="l01793"></a>01793 
<a name="l01794"></a>01794 
<a name="l01795"></a>01795     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> == stream )
<a name="l01796"></a>01796       <span class="keywordflow">return</span> FT_Err_Invalid_Stream_Operation;
<a name="l01797"></a>01797 
<a name="l01798"></a>01798     error = <a class="code" href="ftstream_8h.html#adaaeed4eea8beadd5ae9a5493b340890">FT_Stream_Seek</a>( stream, 0 );
<a name="l01799"></a>01799     <span class="keywordflow">if</span> ( error )
<a name="l01800"></a>01800       <span class="keywordflow">goto</span> Exit;
<a name="l01801"></a>01801 
<a name="l01802"></a>01802     error = <a class="code" href="ftstream_8h.html#ab3efa470f29a814a6e99d51f62fa005a">FT_Stream_Read</a>( stream, (<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*)header, 128 );
<a name="l01803"></a>01803     <span class="keywordflow">if</span> ( error )
<a name="l01804"></a>01804       <span class="keywordflow">goto</span> Exit;
<a name="l01805"></a>01805 
<a name="l01806"></a>01806     <span class="keywordflow">if</span> (            header[ 0] !=  0 ||
<a name="l01807"></a>01807                     header[74] !=  0 ||
<a name="l01808"></a>01808                     header[82] !=  0 ||
<a name="l01809"></a>01809                     header[ 1] ==  0 ||
<a name="l01810"></a>01810                     header[ 1] &gt;  33 ||
<a name="l01811"></a>01811                     header[63] !=  0 ||
<a name="l01812"></a>01812          header[2 + header[1]] !=  0 )
<a name="l01813"></a>01813       <span class="keywordflow">return</span> FT_Err_Unknown_File_Format;
<a name="l01814"></a>01814 
<a name="l01815"></a>01815     dlen = ( header[0x53] &lt;&lt; 24 ) |
<a name="l01816"></a>01816            ( header[0x54] &lt;&lt; 16 ) |
<a name="l01817"></a>01817            ( header[0x55] &lt;&lt;  8 ) |
<a name="l01818"></a>01818              header[0x56];
<a name="l01819"></a>01819 <span class="preprocessor">#if 0</span>
<a name="l01820"></a>01820 <span class="preprocessor"></span>    rlen = ( header[0x57] &lt;&lt; 24 ) |
<a name="l01821"></a>01821            ( header[0x58] &lt;&lt; 16 ) |
<a name="l01822"></a>01822            ( header[0x59] &lt;&lt;  8 ) |
<a name="l01823"></a>01823              header[0x5a];
<a name="l01824"></a>01824 <span class="preprocessor">#endif </span><span class="comment">/* 0 */</span>
<a name="l01825"></a>01825     offset = 128 + ( ( dlen + 127 ) &amp; ~127 );
<a name="l01826"></a>01826 
<a name="l01827"></a>01827     <span class="keywordflow">return</span> IsMacResource( library, stream, offset, face_index, aface );
<a name="l01828"></a>01828 
<a name="l01829"></a>01829   Exit:
<a name="l01830"></a>01830     <span class="keywordflow">return</span> error;
<a name="l01831"></a>01831   }
<a name="l01832"></a>01832 
<a name="l01833"></a>01833 
<a name="l01834"></a>01834   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01835"></a>01835   load_face_in_embedded_rfork( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>           library,
<a name="l01836"></a>01836                                <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>            stream,
<a name="l01837"></a>01837                                <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>              face_index,
<a name="l01838"></a>01838                                <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>             *aface,
<a name="l01839"></a>01839                                <span class="keyword">const</span> <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>  *args )
<a name="l01840"></a>01840   {
<a name="l01841"></a>01841 
<a name="l01842"></a>01842 <span class="preprocessor">#undef  FT_COMPONENT</span>
<a name="l01843"></a>01843 <span class="preprocessor"></span><span class="preprocessor">#define FT_COMPONENT  trace_raccess</span>
<a name="l01844"></a>01844 <span class="preprocessor"></span>
<a name="l01845"></a>01845     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#afe392b83bc018b1b1fb25459f68a5861">memory</a>;
<a name="l01846"></a>01846     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error  = FT_Err_Unknown_File_Format;
<a name="l01847"></a>01847     <span class="keywordtype">int</span>        i;
<a name="l01848"></a>01848 
<a name="l01849"></a>01849     <span class="keywordtype">char</span> *     file_names[<a class="code" href="ftrfork_8h.html#a82d22e239187d650de719ed758f76163">FT_RACCESS_N_RULES</a>];
<a name="l01850"></a>01850     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    offsets[<a class="code" href="ftrfork_8h.html#a82d22e239187d650de719ed758f76163">FT_RACCESS_N_RULES</a>];
<a name="l01851"></a>01851     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   errors[<a class="code" href="ftrfork_8h.html#a82d22e239187d650de719ed758f76163">FT_RACCESS_N_RULES</a>];
<a name="l01852"></a>01852 
<a name="l01853"></a>01853     <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>  args2;
<a name="l01854"></a>01854     <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>     stream2 = 0;
<a name="l01855"></a>01855 
<a name="l01856"></a>01856 
<a name="l01857"></a>01857     <a class="code" href="ftrfork_8h.html#a586950696c34eee1e576563c24208bf4">FT_Raccess_Guess</a>( library, stream,
<a name="l01858"></a>01858                       args-&gt;<a class="code" href="struct_f_t___open___args__.html#aea3d454d9fd9bb7434aad07e651d027b">pathname</a>, file_names, offsets, errors );
<a name="l01859"></a>01859 
<a name="l01860"></a>01860     <span class="keywordflow">for</span> ( i = 0; i &lt; <a class="code" href="ftrfork_8h.html#a82d22e239187d650de719ed758f76163">FT_RACCESS_N_RULES</a>; i++ )
<a name="l01861"></a>01861     {
<a name="l01862"></a>01862       <span class="keywordflow">if</span> ( errors[i] )
<a name="l01863"></a>01863       {
<a name="l01864"></a>01864         <a class="code" href="ftdebug_8h.html#a9ff2b46b2097d26afa62871cddccdaad">FT_TRACE3</a>(( <span class="stringliteral">&quot;Error[%d] has occurred in rule %d\n&quot;</span>, errors[i], i ));
<a name="l01865"></a>01865         <span class="keywordflow">continue</span>;
<a name="l01866"></a>01866       }
<a name="l01867"></a>01867 
<a name="l01868"></a>01868       args2.<a class="code" href="struct_f_t___open___args__.html#a2e3e6b9284fe8b4d9833e247a19181fa">flags</a>    = <a class="code" href="freetype_8h.html#a22ee89452169a0faf9f1ad797499e4bc">FT_OPEN_PATHNAME</a>;
<a name="l01869"></a>01869       args2.<a class="code" href="struct_f_t___open___args__.html#aea3d454d9fd9bb7434aad07e651d027b">pathname</a> = file_names[i] ? file_names[i] : args-&gt;<a class="code" href="struct_f_t___open___args__.html#aea3d454d9fd9bb7434aad07e651d027b">pathname</a>;
<a name="l01870"></a>01870 
<a name="l01871"></a>01871       <a class="code" href="ftdebug_8h.html#a9ff2b46b2097d26afa62871cddccdaad">FT_TRACE3</a>(( <span class="stringliteral">&quot;Try rule %d: %s (offset=%d) ...&quot;</span>,
<a name="l01872"></a>01872                   i, args2.<a class="code" href="struct_f_t___open___args__.html#aea3d454d9fd9bb7434aad07e651d027b">pathname</a>, offsets[i] ));
<a name="l01873"></a>01873 
<a name="l01874"></a>01874       error = <a class="code" href="ftstream_8h.html#ab33e9c576d1ce3850acacddcdfea8692">FT_Stream_New</a>( library, &amp;args2, &amp;stream2 );
<a name="l01875"></a>01875       <span class="keywordflow">if</span> ( error )
<a name="l01876"></a>01876       {
<a name="l01877"></a>01877         <a class="code" href="ftdebug_8h.html#a9ff2b46b2097d26afa62871cddccdaad">FT_TRACE3</a>(( <span class="stringliteral">&quot;failed\n&quot;</span> ));
<a name="l01878"></a>01878         <span class="keywordflow">continue</span>;
<a name="l01879"></a>01879       }
<a name="l01880"></a>01880 
<a name="l01881"></a>01881       error = IsMacResource( library, stream2, offsets[i],
<a name="l01882"></a>01882                              face_index, aface );
<a name="l01883"></a>01883       <a class="code" href="ftstream_8h.html#ac2619fbc2d12358691456bf1bf312710">FT_Stream_Free</a>( stream2, 0 );
<a name="l01884"></a>01884 
<a name="l01885"></a>01885       <a class="code" href="ftdebug_8h.html#a9ff2b46b2097d26afa62871cddccdaad">FT_TRACE3</a>(( <span class="stringliteral">&quot;%s\n&quot;</span>, error ? <span class="stringliteral">&quot;failed&quot;</span>: <span class="stringliteral">&quot;successful&quot;</span> ));
<a name="l01886"></a>01886 
<a name="l01887"></a>01887       <span class="keywordflow">if</span> ( !error )
<a name="l01888"></a>01888           <span class="keywordflow">break</span>;
<a name="l01889"></a>01889     }
<a name="l01890"></a>01890 
<a name="l01891"></a>01891     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ftrfork_8h.html#a82d22e239187d650de719ed758f76163">FT_RACCESS_N_RULES</a>; i++)
<a name="l01892"></a>01892     {
<a name="l01893"></a>01893       <span class="keywordflow">if</span> ( file_names[i] )
<a name="l01894"></a>01894         <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( file_names[i] );
<a name="l01895"></a>01895     }
<a name="l01896"></a>01896 
<a name="l01897"></a>01897     <span class="comment">/* Caller (load_mac_face) requires FT_Err_Unknown_File_Format. */</span>
<a name="l01898"></a>01898     <span class="keywordflow">if</span> ( error )
<a name="l01899"></a>01899       error = FT_Err_Unknown_File_Format;
<a name="l01900"></a>01900 
<a name="l01901"></a>01901     <span class="keywordflow">return</span> error;
<a name="l01902"></a>01902 
<a name="l01903"></a>01903 <span class="preprocessor">#undef  FT_COMPONENT</span>
<a name="l01904"></a>01904 <span class="preprocessor"></span><span class="preprocessor">#define FT_COMPONENT  trace_objs</span>
<a name="l01905"></a>01905 <span class="preprocessor"></span>
<a name="l01906"></a>01906   }
<a name="l01907"></a>01907 
<a name="l01908"></a>01908 
<a name="l01909"></a>01909   <span class="comment">/* Check for some macintosh formats without Carbon framework.    */</span>
<a name="l01910"></a>01910   <span class="comment">/* Is this a macbinary file?  If so look at the resource fork.   */</span>
<a name="l01911"></a>01911   <span class="comment">/* Is this a mac dfont file?                                     */</span>
<a name="l01912"></a>01912   <span class="comment">/* Is this an old style resource fork? (in data)                 */</span>
<a name="l01913"></a>01913   <span class="comment">/* Else call load_face_in_embedded_rfork to try extra rules      */</span>
<a name="l01914"></a>01914   <span class="comment">/* (defined in `ftrfork.c&#39;).                                     */</span>
<a name="l01915"></a>01915   <span class="comment">/*                                                               */</span>
<a name="l01916"></a>01916   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01917"></a>01917   load_mac_face( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>           library,
<a name="l01918"></a>01918                  <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>            stream,
<a name="l01919"></a>01919                  <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>              face_index,
<a name="l01920"></a>01920                  <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>             *aface,
<a name="l01921"></a>01921                  <span class="keyword">const</span> <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>  *args )
<a name="l01922"></a>01922   {
<a name="l01923"></a>01923     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> error;
<a name="l01924"></a>01924     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( args );
<a name="l01925"></a>01925 
<a name="l01926"></a>01926 
<a name="l01927"></a>01927     error = IsMacBinary( library, stream, face_index, aface );
<a name="l01928"></a>01928     <span class="keywordflow">if</span> ( <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) == FT_Err_Unknown_File_Format )
<a name="l01929"></a>01929     {
<a name="l01930"></a>01930 
<a name="l01931"></a>01931 <span class="preprocessor">#undef  FT_COMPONENT</span>
<a name="l01932"></a>01932 <span class="preprocessor"></span><span class="preprocessor">#define FT_COMPONENT  trace_raccess</span>
<a name="l01933"></a>01933 <span class="preprocessor"></span>
<a name="l01934"></a>01934       <a class="code" href="ftdebug_8h.html#a9ff2b46b2097d26afa62871cddccdaad">FT_TRACE3</a>(( <span class="stringliteral">&quot;Try as dfont: %s ...&quot;</span>, args-&gt;<a class="code" href="struct_f_t___open___args__.html#aea3d454d9fd9bb7434aad07e651d027b">pathname</a> ));
<a name="l01935"></a>01935 
<a name="l01936"></a>01936       error = IsMacResource( library, stream, 0, face_index, aface );
<a name="l01937"></a>01937 
<a name="l01938"></a>01938       <a class="code" href="ftdebug_8h.html#a9ff2b46b2097d26afa62871cddccdaad">FT_TRACE3</a>(( <span class="stringliteral">&quot;%s\n&quot;</span>, error ? <span class="stringliteral">&quot;failed&quot;</span> : <span class="stringliteral">&quot;successful&quot;</span> ));
<a name="l01939"></a>01939 
<a name="l01940"></a>01940 <span class="preprocessor">#undef  FT_COMPONENT</span>
<a name="l01941"></a>01941 <span class="preprocessor"></span><span class="preprocessor">#define FT_COMPONENT  trace_objs</span>
<a name="l01942"></a>01942 <span class="preprocessor"></span>
<a name="l01943"></a>01943     }
<a name="l01944"></a>01944 
<a name="l01945"></a>01945     <span class="keywordflow">if</span> ( ( <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) == FT_Err_Unknown_File_Format      ||
<a name="l01946"></a>01946            <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) == FT_Err_Invalid_Stream_Operation ) &amp;&amp;
<a name="l01947"></a>01947          ( args-&gt;<a class="code" href="struct_f_t___open___args__.html#a2e3e6b9284fe8b4d9833e247a19181fa">flags</a> &amp; <a class="code" href="freetype_8h.html#a22ee89452169a0faf9f1ad797499e4bc">FT_OPEN_PATHNAME</a> )                            )
<a name="l01948"></a>01948       error = load_face_in_embedded_rfork( library, stream,
<a name="l01949"></a>01949                                            face_index, aface, args );
<a name="l01950"></a>01950     <span class="keywordflow">return</span> error;
<a name="l01951"></a>01951   }
<a name="l01952"></a>01952 <span class="preprocessor">#endif</span>
<a name="l01953"></a>01953 <span class="preprocessor"></span>
<a name="l01954"></a>01954 <span class="preprocessor">#endif  </span><span class="comment">/* !FT_MACINTOSH &amp;&amp; FT_CONFIG_OPTION_MAC_FONTS */</span>
<a name="l01955"></a>01955 
<a name="l01956"></a>01956 
<a name="l01957"></a>01957   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l01958"></a>01958 
<a name="l01959"></a>01959   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l01960"></a><a class="code" href="ftobjs_8c.html#a3bdf12232d495ca7d4d40f47b4bc157c">01960</a>   <a class="code" href="freetype_8h.html#a3bdf12232d495ca7d4d40f47b4bc157c">FT_Open_Face</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>           library,
<a name="l01961"></a>01961                 <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>*  args,
<a name="l01962"></a>01962                 <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>              face_index,
<a name="l01963"></a>01963                 <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>             *aface )
<a name="l01964"></a>01964   {
<a name="l01965"></a>01965     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>     error;
<a name="l01966"></a>01966     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>    driver;
<a name="l01967"></a>01967     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>    memory;
<a name="l01968"></a>01968     <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>    stream = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01969"></a>01969     <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>      face   = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01970"></a>01970     <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>  node   = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01971"></a>01971     <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>      external_stream;
<a name="l01972"></a>01972     <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>*   cur;
<a name="l01973"></a>01973     <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>*   limit;
<a name="l01974"></a>01974 
<a name="l01975"></a>01975 
<a name="l01976"></a>01976     <span class="comment">/* test for valid `library&#39; delayed to */</span>
<a name="l01977"></a>01977     <span class="comment">/* FT_Stream_New()                     */</span>
<a name="l01978"></a>01978 
<a name="l01979"></a>01979     <span class="keywordflow">if</span> ( ( !aface &amp;&amp; face_index &gt;= 0 ) || !args )
<a name="l01980"></a>01980       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l01981"></a>01981 
<a name="l01982"></a>01982     external_stream = <a class="code" href="fttypes_8h.html#adf712510036d534403cbddf4f18c2083">FT_BOOL</a>( ( args-&gt;flags &amp; <a class="code" href="freetype_8h.html#aedfb4f733ac38dfa5859d83660f31bc2">FT_OPEN_STREAM</a> ) &amp;&amp;
<a name="l01983"></a>01983                                args-&gt;stream                     );
<a name="l01984"></a>01984 
<a name="l01985"></a>01985     <span class="comment">/* create input stream */</span>
<a name="l01986"></a>01986     error = <a class="code" href="ftstream_8h.html#ab33e9c576d1ce3850acacddcdfea8692">FT_Stream_New</a>( library, args, &amp;stream );
<a name="l01987"></a>01987     <span class="keywordflow">if</span> ( error )
<a name="l01988"></a>01988       <span class="keywordflow">goto</span> Fail3;
<a name="l01989"></a>01989 
<a name="l01990"></a>01990     memory = library-&gt;memory;
<a name="l01991"></a>01991 
<a name="l01992"></a>01992     <span class="comment">/* If the font driver is specified in the `args&#39; structure, use */</span>
<a name="l01993"></a>01993     <span class="comment">/* it.  Otherwise, we scan the list of registered drivers.      */</span>
<a name="l01994"></a>01994     <span class="keywordflow">if</span> ( ( args-&gt;flags &amp; <a class="code" href="freetype_8h.html#a58749d3bf1d7d908af3e17366c8e8969">FT_OPEN_DRIVER</a> ) &amp;&amp; args-&gt;driver )
<a name="l01995"></a>01995     {
<a name="l01996"></a>01996       driver = <a class="code" href="ftobjs_8h.html#aab06464ead266dda6098288ce9e1d8f2">FT_DRIVER</a>( args-&gt;driver );
<a name="l01997"></a>01997 
<a name="l01998"></a>01998       <span class="comment">/* not all modules are drivers, so check... */</span>
<a name="l01999"></a>01999       <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#ac2d44d2f213d2a8cde5eccbb2f413e17">FT_MODULE_IS_DRIVER</a>( driver ) )
<a name="l02000"></a>02000       {
<a name="l02001"></a>02001         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>         num_params = 0;
<a name="l02002"></a>02002         <a class="code" href="struct_f_t___parameter__.html">FT_Parameter</a>*  params     = 0;
<a name="l02003"></a>02003 
<a name="l02004"></a>02004 
<a name="l02005"></a>02005         <span class="keywordflow">if</span> ( args-&gt;flags &amp; <a class="code" href="freetype_8h.html#a35c680ebd15f4bf28d5b974e47eed715">FT_OPEN_PARAMS</a> )
<a name="l02006"></a>02006         {
<a name="l02007"></a>02007           num_params = args-&gt;num_params;
<a name="l02008"></a>02008           params     = args-&gt;params;
<a name="l02009"></a>02009         }
<a name="l02010"></a>02010 
<a name="l02011"></a>02011         error = open_face( driver, stream, face_index,
<a name="l02012"></a>02012                            num_params, params, &amp;face );
<a name="l02013"></a>02013         <span class="keywordflow">if</span> ( !error )
<a name="l02014"></a>02014           <span class="keywordflow">goto</span> Success;
<a name="l02015"></a>02015       }
<a name="l02016"></a>02016       <span class="keywordflow">else</span>
<a name="l02017"></a>02017         error = FT_Err_Invalid_Handle;
<a name="l02018"></a>02018 
<a name="l02019"></a>02019       <a class="code" href="ftstream_8h.html#ac2619fbc2d12358691456bf1bf312710">FT_Stream_Free</a>( stream, external_stream );
<a name="l02020"></a>02020       <span class="keywordflow">goto</span> Fail;
<a name="l02021"></a>02021     }
<a name="l02022"></a>02022     <span class="keywordflow">else</span>
<a name="l02023"></a>02023     {
<a name="l02024"></a>02024       <span class="comment">/* check each font driver for an appropriate format */</span>
<a name="l02025"></a>02025       cur   = library-&gt;modules;
<a name="l02026"></a>02026       limit = cur + library-&gt;num_modules;
<a name="l02027"></a>02027 
<a name="l02028"></a>02028 
<a name="l02029"></a>02029       <span class="keywordflow">for</span> ( ; cur &lt; limit; cur++ )
<a name="l02030"></a>02030       {
<a name="l02031"></a>02031         <span class="comment">/* not all modules are font drivers, so check... */</span>
<a name="l02032"></a>02032         <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#ac2d44d2f213d2a8cde5eccbb2f413e17">FT_MODULE_IS_DRIVER</a>( cur[0] ) )
<a name="l02033"></a>02033         {
<a name="l02034"></a>02034           <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>         num_params = 0;
<a name="l02035"></a>02035           <a class="code" href="struct_f_t___parameter__.html">FT_Parameter</a>*  params     = 0;
<a name="l02036"></a>02036 
<a name="l02037"></a>02037 
<a name="l02038"></a>02038           driver = <a class="code" href="ftobjs_8h.html#aab06464ead266dda6098288ce9e1d8f2">FT_DRIVER</a>( cur[0] );
<a name="l02039"></a>02039 
<a name="l02040"></a>02040           <span class="keywordflow">if</span> ( args-&gt;flags &amp; <a class="code" href="freetype_8h.html#a35c680ebd15f4bf28d5b974e47eed715">FT_OPEN_PARAMS</a> )
<a name="l02041"></a>02041           {
<a name="l02042"></a>02042             num_params = args-&gt;num_params;
<a name="l02043"></a>02043             params     = args-&gt;params;
<a name="l02044"></a>02044           }
<a name="l02045"></a>02045 
<a name="l02046"></a>02046           error = open_face( driver, stream, face_index,
<a name="l02047"></a>02047                              num_params, params, &amp;face );
<a name="l02048"></a>02048           <span class="keywordflow">if</span> ( !error )
<a name="l02049"></a>02049             <span class="keywordflow">goto</span> Success;
<a name="l02050"></a>02050 
<a name="l02051"></a>02051 <span class="preprocessor">#ifdef FT_CONFIG_OPTION_MAC_FONTS</span>
<a name="l02052"></a>02052 <span class="preprocessor"></span>          <span class="keywordflow">if</span> ( <a class="code" href="ftstdlib_8h.html#a6b4c8a4f84eee3fe618812761ae78adb">ft_strcmp</a>( cur[0]-&gt;clazz-&gt;module_name, <span class="stringliteral">&quot;truetype&quot;</span> ) == 0 &amp;&amp;
<a name="l02053"></a>02053                <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) == FT_Err_Table_Missing           )
<a name="l02054"></a>02054           {
<a name="l02055"></a>02055             <span class="comment">/* TrueType but essential tables are missing */</span>
<a name="l02056"></a>02056             <span class="keywordflow">if</span> ( <a class="code" href="ftstream_8h.html#adaaeed4eea8beadd5ae9a5493b340890">FT_Stream_Seek</a>( stream, 0 ) )
<a name="l02057"></a>02057               <span class="keywordflow">break</span>;
<a name="l02058"></a>02058 
<a name="l02059"></a>02059             error = <a class="code" href="ftbase_8h.html#ae2e7aa383c4d947df388f6e2c9cd8be9">open_face_PS_from_sfnt_stream</a>( library,
<a name="l02060"></a>02060                                                    stream,
<a name="l02061"></a>02061                                                    face_index,
<a name="l02062"></a>02062                                                    num_params,
<a name="l02063"></a>02063                                                    params,
<a name="l02064"></a>02064                                                    aface );
<a name="l02065"></a>02065             <span class="keywordflow">if</span> ( !error )
<a name="l02066"></a>02066             {
<a name="l02067"></a>02067               <a class="code" href="ftstream_8h.html#ac2619fbc2d12358691456bf1bf312710">FT_Stream_Free</a>( stream, external_stream );
<a name="l02068"></a>02068               <span class="keywordflow">return</span> error;
<a name="l02069"></a>02069             }
<a name="l02070"></a>02070           }
<a name="l02071"></a>02071 <span class="preprocessor">#endif</span>
<a name="l02072"></a>02072 <span class="preprocessor"></span>
<a name="l02073"></a>02073           <span class="keywordflow">if</span> ( <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) != FT_Err_Unknown_File_Format )
<a name="l02074"></a>02074             <span class="keywordflow">goto</span> Fail3;
<a name="l02075"></a>02075         }
<a name="l02076"></a>02076       }
<a name="l02077"></a>02077 
<a name="l02078"></a>02078   Fail3:
<a name="l02079"></a>02079     <span class="comment">/* If we are on the mac, and we get an FT_Err_Invalid_Stream_Operation */</span>
<a name="l02080"></a>02080     <span class="comment">/* it may be because we have an empty data fork, so we need to check   */</span>
<a name="l02081"></a>02081     <span class="comment">/* the resource fork.                                                  */</span>
<a name="l02082"></a>02082     <span class="keywordflow">if</span> ( <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) != FT_Err_Cannot_Open_Stream       &amp;&amp;
<a name="l02083"></a>02083          <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) != FT_Err_Unknown_File_Format      &amp;&amp;
<a name="l02084"></a>02084          <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) != FT_Err_Invalid_Stream_Operation )
<a name="l02085"></a>02085       <span class="keywordflow">goto</span> Fail2;
<a name="l02086"></a>02086 
<a name="l02087"></a>02087 <span class="preprocessor">#if !defined( FT_MACINTOSH ) &amp;&amp; defined( FT_CONFIG_OPTION_MAC_FONTS )</span>
<a name="l02088"></a>02088 <span class="preprocessor"></span>    error = load_mac_face( library, stream, face_index, aface, args );
<a name="l02089"></a>02089     <span class="keywordflow">if</span> ( !error )
<a name="l02090"></a>02090     {
<a name="l02091"></a>02091       <span class="comment">/* We don&#39;t want to go to Success here.  We&#39;ve already done that. */</span>
<a name="l02092"></a>02092       <span class="comment">/* On the other hand, if we succeeded we still need to close this */</span>
<a name="l02093"></a>02093       <span class="comment">/* stream (we opened a different stream which extracted the       */</span>
<a name="l02094"></a>02094       <span class="comment">/* interesting information out of this stream here.  That stream  */</span>
<a name="l02095"></a>02095       <span class="comment">/* will still be open and the face will point to it).             */</span>
<a name="l02096"></a>02096       <a class="code" href="ftstream_8h.html#ac2619fbc2d12358691456bf1bf312710">FT_Stream_Free</a>( stream, external_stream );
<a name="l02097"></a>02097       <span class="keywordflow">return</span> error;
<a name="l02098"></a>02098     }
<a name="l02099"></a>02099 
<a name="l02100"></a>02100     <span class="keywordflow">if</span> ( <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) != FT_Err_Unknown_File_Format )
<a name="l02101"></a>02101       <span class="keywordflow">goto</span> Fail2;
<a name="l02102"></a>02102 <span class="preprocessor">#endif  </span><span class="comment">/* !FT_MACINTOSH &amp;&amp; FT_CONFIG_OPTION_MAC_FONTS */</span>
<a name="l02103"></a>02103 
<a name="l02104"></a>02104       <span class="comment">/* no driver is able to handle this format */</span>
<a name="l02105"></a>02105       error = FT_Err_Unknown_File_Format;
<a name="l02106"></a>02106 
<a name="l02107"></a>02107   Fail2:
<a name="l02108"></a>02108       <a class="code" href="ftstream_8h.html#ac2619fbc2d12358691456bf1bf312710">FT_Stream_Free</a>( stream, external_stream );
<a name="l02109"></a>02109       <span class="keywordflow">goto</span> Fail;
<a name="l02110"></a>02110     }
<a name="l02111"></a>02111 
<a name="l02112"></a>02112   Success:
<a name="l02113"></a>02113     <a class="code" href="ftdebug_8h.html#ad7e98818b876c5493b441d7516bf34a0">FT_TRACE4</a>(( <span class="stringliteral">&quot;FT_Open_Face: New face object, adding to list\n&quot;</span> ));
<a name="l02114"></a>02114 
<a name="l02115"></a>02115     <span class="comment">/* set the FT_FACE_FLAG_EXTERNAL_STREAM bit for FT_Done_Face */</span>
<a name="l02116"></a>02116     <span class="keywordflow">if</span> ( external_stream )
<a name="l02117"></a>02117       face-&gt;<a class="code" href="struct_f_t___face_rec__.html#af1596857ebc9f8eac4c4b51c8f3ffd31">face_flags</a> |= <a class="code" href="freetype_8h.html#a88935459cedd8fb94de90b54b61b5340">FT_FACE_FLAG_EXTERNAL_STREAM</a>;
<a name="l02118"></a>02118 
<a name="l02119"></a>02119     <span class="comment">/* add the face object to its driver&#39;s list */</span>
<a name="l02120"></a>02120     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a313d8de417ea0d1c5fcc7d348397a642">FT_NEW</a>( node ) )
<a name="l02121"></a>02121       <span class="keywordflow">goto</span> Fail;
<a name="l02122"></a>02122 
<a name="l02123"></a>02123     node-&gt;<a class="code" href="struct_f_t___list_node_rec__.html#ab0202be88f722442a4bec9aeb5f6418f">data</a> = face;
<a name="l02124"></a>02124     <span class="comment">/* don&#39;t assume driver is the same as face-&gt;driver, so use */</span>
<a name="l02125"></a>02125     <span class="comment">/* face-&gt;driver instead.                                   */</span>
<a name="l02126"></a>02126     <a class="code" href="ftlist_8h.html#afc59903c201f367a5d77dc6b7daf8f3c">FT_List_Add</a>( &amp;face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a011b62fcffdd6dc421c9ab3286d4c9fa">driver</a>-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a2602170e3ecde21a764dc32417aaa002">faces_list</a>, node );
<a name="l02127"></a>02127 
<a name="l02128"></a>02128     <span class="comment">/* now allocate a glyph slot object for the face */</span>
<a name="l02129"></a>02129     <a class="code" href="ftdebug_8h.html#ad7e98818b876c5493b441d7516bf34a0">FT_TRACE4</a>(( <span class="stringliteral">&quot;FT_Open_Face: Creating glyph slot\n&quot;</span> ));
<a name="l02130"></a>02130 
<a name="l02131"></a>02131     <span class="keywordflow">if</span> ( face_index &gt;= 0 )
<a name="l02132"></a>02132     {
<a name="l02133"></a>02133       error = <a class="code" href="ftobjs_8h.html#a6b8a7296866810c4feff8dc562e55c4c">FT_New_GlyphSlot</a>( face, <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> );
<a name="l02134"></a>02134       <span class="keywordflow">if</span> ( error )
<a name="l02135"></a>02135         <span class="keywordflow">goto</span> Fail;
<a name="l02136"></a>02136 
<a name="l02137"></a>02137       <span class="comment">/* finally, allocate a size object for the face */</span>
<a name="l02138"></a>02138       {
<a name="l02139"></a>02139         <a class="code" href="struct_f_t___size_rec__.html">FT_Size</a>  <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a>;
<a name="l02140"></a>02140 
<a name="l02141"></a>02141 
<a name="l02142"></a>02142         <a class="code" href="ftdebug_8h.html#ad7e98818b876c5493b441d7516bf34a0">FT_TRACE4</a>(( <span class="stringliteral">&quot;FT_Open_Face: Creating size object\n&quot;</span> ));
<a name="l02143"></a>02143 
<a name="l02144"></a>02144         error = <a class="code" href="ftsizes_8h.html#a8641d59dfb4521af8ff6377bb9b07291">FT_New_Size</a>( face, &amp;size );
<a name="l02145"></a>02145         <span class="keywordflow">if</span> ( error )
<a name="l02146"></a>02146           <span class="keywordflow">goto</span> Fail;
<a name="l02147"></a>02147 
<a name="l02148"></a>02148         face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a212d116864a5d81e80b176f9b846cd08">size</a> = <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a>;
<a name="l02149"></a>02149       }
<a name="l02150"></a>02150     }
<a name="l02151"></a>02151 
<a name="l02152"></a>02152     <span class="comment">/* some checks */</span>
<a name="l02153"></a>02153 
<a name="l02154"></a>02154     <span class="keywordflow">if</span> ( <a class="code" href="freetype_8h.html#a6974c80eab523906685030b0298141b1">FT_IS_SCALABLE</a>( face ) )
<a name="l02155"></a>02155     {
<a name="l02156"></a>02156       <span class="keywordflow">if</span> ( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6062881a848ab3395c6d096812065d9d">height</a> &lt; 0 )
<a name="l02157"></a>02157         face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6062881a848ab3395c6d096812065d9d">height</a> = (<a class="code" href="fttypes_8h.html#aa7279be89046a2563cd3d4d6651fbdcf">FT_Short</a>)-face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6062881a848ab3395c6d096812065d9d">height</a>;
<a name="l02158"></a>02158 
<a name="l02159"></a>02159       if ( !<a class="code" href="freetype_8h.html#a6eab7332965c190e91df1c92b70c6ec9">FT_HAS_VERTICAL</a>( face ) )
<a name="l02160"></a>02160         face-&gt;<a class="code" href="struct_f_t___face_rec__.html#abb74c1e75fb9138261c106e01bd08d69">max_advance_height</a> = (<a class="code" href="fttypes_8h.html#aa7279be89046a2563cd3d4d6651fbdcf">FT_Short</a>)face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6062881a848ab3395c6d096812065d9d">height</a>;
<a name="l02161"></a>02161     }
<a name="l02162"></a>02162 
<a name="l02163"></a>02163     <span class="keywordflow">if</span> ( <a class="code" href="freetype_8h.html#a5e7fe61c802f7cb7f8fddf929e3f50e3">FT_HAS_FIXED_SIZES</a>( face ) )
<a name="l02164"></a>02164     {
<a name="l02165"></a>02165       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  i;
<a name="l02166"></a>02166 
<a name="l02167"></a>02167 
<a name="l02168"></a>02168       <span class="keywordflow">for</span> ( i = 0; i &lt; face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aa652af958546eb8edf87ccd4b697bfdf">num_fixed_sizes</a>; i++ )
<a name="l02169"></a>02169       {
<a name="l02170"></a>02170         <a class="code" href="struct_f_t___bitmap___size__.html">FT_Bitmap_Size</a>*  bsize = face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a563ca9007f754aa0f711ba67050f3e47">available_sizes</a> + i;
<a name="l02171"></a>02171 
<a name="l02172"></a>02172 
<a name="l02173"></a>02173         <span class="keywordflow">if</span> ( bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#adf2f24039b458ff4674712886f242262">height</a> &lt; 0 )
<a name="l02174"></a>02174           bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#adf2f24039b458ff4674712886f242262">height</a> = (<a class="code" href="fttypes_8h.html#aa7279be89046a2563cd3d4d6651fbdcf">FT_Short</a>)-bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#adf2f24039b458ff4674712886f242262">height</a>;
<a name="l02175"></a>02175         if ( bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a6f877a792d2dc93328037c928979215f">x_ppem</a> &lt; 0 )
<a name="l02176"></a>02176           bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a6f877a792d2dc93328037c928979215f">x_ppem</a> = (<a class="code" href="fttypes_8h.html#aa7279be89046a2563cd3d4d6651fbdcf">FT_Short</a>)-bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a6f877a792d2dc93328037c928979215f">x_ppem</a>;
<a name="l02177"></a>02177         if ( bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a60d4d003d09fd57505f69f39e31e19c1">y_ppem</a> &lt; 0 )
<a name="l02178"></a>02178           bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a60d4d003d09fd57505f69f39e31e19c1">y_ppem</a> = -bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a60d4d003d09fd57505f69f39e31e19c1">y_ppem</a>;
<a name="l02179"></a>02179       }
<a name="l02180"></a>02180     }
<a name="l02181"></a>02181 
<a name="l02182"></a>02182     <span class="comment">/* initialize internal face data */</span>
<a name="l02183"></a>02183     {
<a name="l02184"></a>02184       <a class="code" href="struct_f_t___face___internal_rec__.html">FT_Face_Internal</a>  <span class="keyword">internal</span> = face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aed9a1267cddcbe790f0591471c886537">internal</a>;
<a name="l02185"></a>02185 
<a name="l02186"></a>02186 
<a name="l02187"></a>02187       <span class="keyword">internal</span>-&gt;<a class="code" href="struct_f_t___face___internal_rec__.html#ab4be2dcda098e6136f5701580d18032d">transform_matrix</a>.<a class="code" href="struct_f_t___matrix__.html#a27d51c2958634abe7bf377610e095f74">xx</a> = 0x10000L;
<a name="l02188"></a>02188       <span class="keyword">internal</span>-&gt;transform_matrix.xy = 0;
<a name="l02189"></a>02189       <span class="keyword">internal</span>-&gt;transform_matrix.yx = 0;
<a name="l02190"></a>02190       <span class="keyword">internal</span>-&gt;transform_matrix.yy = 0x10000L;
<a name="l02191"></a>02191 
<a name="l02192"></a>02192       <span class="keyword">internal</span>-&gt;transform_delta.x = 0;
<a name="l02193"></a>02193       <span class="keyword">internal</span>-&gt;transform_delta.y = 0;
<a name="l02194"></a>02194 
<a name="l02195"></a>02195       <span class="keyword">internal</span>-&gt;refcount = 1;
<a name="l02196"></a>02196     }
<a name="l02197"></a>02197 
<a name="l02198"></a>02198     <span class="keywordflow">if</span> ( aface )
<a name="l02199"></a>02199       *aface = face;
<a name="l02200"></a>02200     <span class="keywordflow">else</span>
<a name="l02201"></a>02201       <a class="code" href="freetype_8h.html#a2d1542be3d3af3d7699cee3425b2bc79">FT_Done_Face</a>( face );
<a name="l02202"></a>02202 
<a name="l02203"></a>02203     <span class="keywordflow">goto</span> Exit;
<a name="l02204"></a>02204 
<a name="l02205"></a>02205   Fail:
<a name="l02206"></a>02206     <a class="code" href="freetype_8h.html#a2d1542be3d3af3d7699cee3425b2bc79">FT_Done_Face</a>( face );
<a name="l02207"></a>02207 
<a name="l02208"></a>02208   Exit:
<a name="l02209"></a>02209     <a class="code" href="ftdebug_8h.html#ad7e98818b876c5493b441d7516bf34a0">FT_TRACE4</a>(( <span class="stringliteral">&quot;FT_Open_Face: Return %d\n&quot;</span>, error ));
<a name="l02210"></a>02210 
<a name="l02211"></a>02211     <span class="keywordflow">return</span> error;
<a name="l02212"></a>02212   }
<a name="l02213"></a>02213 
<a name="l02214"></a>02214 
<a name="l02215"></a>02215   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02216"></a>02216 
<a name="l02217"></a>02217   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02218"></a><a class="code" href="ftobjs_8c.html#ae97b04528da5fc081e0ce9be40c5b036">02218</a>   <a class="code" href="freetype_8h.html#ae97b04528da5fc081e0ce9be40c5b036">FT_Attach_File</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>      face,
<a name="l02219"></a>02219                   <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span>*  filepathname )
<a name="l02220"></a>02220   {
<a name="l02221"></a>02221     <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>  open;
<a name="l02222"></a>02222 
<a name="l02223"></a>02223 
<a name="l02224"></a>02224     <span class="comment">/* test for valid `face&#39; delayed to FT_Attach_Stream() */</span>
<a name="l02225"></a>02225 
<a name="l02226"></a>02226     <span class="keywordflow">if</span> ( !filepathname )
<a name="l02227"></a>02227       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l02228"></a>02228 
<a name="l02229"></a>02229     open.<a class="code" href="struct_f_t___open___args__.html#ae1e6444bf0c21b323ce6cbe8bc475b2b">stream</a>   = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02230"></a>02230     open.<a class="code" href="struct_f_t___open___args__.html#a2e3e6b9284fe8b4d9833e247a19181fa">flags</a>    = <a class="code" href="freetype_8h.html#a22ee89452169a0faf9f1ad797499e4bc">FT_OPEN_PATHNAME</a>;
<a name="l02231"></a>02231     open.<a class="code" href="struct_f_t___open___args__.html#aea3d454d9fd9bb7434aad07e651d027b">pathname</a> = (<span class="keywordtype">char</span>*)filepathname;
<a name="l02232"></a>02232 
<a name="l02233"></a>02233     <span class="keywordflow">return</span> <a class="code" href="freetype_8h.html#aced0db97521cb20e44bed22d03ea4b6b">FT_Attach_Stream</a>( face, &amp;open );
<a name="l02234"></a>02234   }
<a name="l02235"></a>02235 
<a name="l02236"></a>02236 
<a name="l02237"></a>02237   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02238"></a>02238 
<a name="l02239"></a>02239   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02240"></a><a class="code" href="ftobjs_8c.html#aced0db97521cb20e44bed22d03ea4b6b">02240</a>   <a class="code" href="freetype_8h.html#aced0db97521cb20e44bed22d03ea4b6b">FT_Attach_Stream</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>        face,
<a name="l02241"></a>02241                     <a class="code" href="struct_f_t___open___args__.html">FT_Open_Args</a>*  parameters )
<a name="l02242"></a>02242   {
<a name="l02243"></a>02243     <a class="code" href="struct_f_t___stream_rec__.html">FT_Stream</a>  stream;
<a name="l02244"></a>02244     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l02245"></a>02245     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>  driver;
<a name="l02246"></a>02246 
<a name="l02247"></a>02247     <a class="code" href="struct_f_t___driver___class_rec__.html">FT_Driver_Class</a>  clazz;
<a name="l02248"></a>02248 
<a name="l02249"></a>02249 
<a name="l02250"></a>02250     <span class="comment">/* test for valid `parameters&#39; delayed to FT_Stream_New() */</span>
<a name="l02251"></a>02251 
<a name="l02252"></a>02252     <span class="keywordflow">if</span> ( !face )
<a name="l02253"></a>02253       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l02254"></a>02254 
<a name="l02255"></a>02255     driver = face-&gt;driver;
<a name="l02256"></a>02256     <span class="keywordflow">if</span> ( !driver )
<a name="l02257"></a>02257       <span class="keywordflow">return</span> FT_Err_Invalid_Driver_Handle;
<a name="l02258"></a>02258 
<a name="l02259"></a>02259     error = <a class="code" href="ftstream_8h.html#ab33e9c576d1ce3850acacddcdfea8692">FT_Stream_New</a>( driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#ac3d04fbdc2988bf9a39f4ad6d3cb4b5f">library</a>, parameters, &amp;stream );
<a name="l02260"></a>02260     <span class="keywordflow">if</span> ( error )
<a name="l02261"></a>02261       <span class="keywordflow">goto</span> Exit;
<a name="l02262"></a>02262 
<a name="l02263"></a>02263     <span class="comment">/* we implement FT_Attach_Stream in each driver through the */</span>
<a name="l02264"></a>02264     <span class="comment">/* `attach_file&#39; interface                                  */</span>
<a name="l02265"></a>02265 
<a name="l02266"></a>02266     error = FT_Err_Unimplemented_Feature;
<a name="l02267"></a>02267     clazz = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>;
<a name="l02268"></a>02268     <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a9caec9ae56a4bab9c90cede699279f29">attach_file</a> )
<a name="l02269"></a>02269       error = clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a9caec9ae56a4bab9c90cede699279f29">attach_file</a>( face, stream );
<a name="l02270"></a>02270 
<a name="l02271"></a>02271     <span class="comment">/* close the attached stream */</span>
<a name="l02272"></a>02272     <a class="code" href="ftstream_8h.html#ac2619fbc2d12358691456bf1bf312710">FT_Stream_Free</a>( stream,
<a name="l02273"></a>02273                     (<a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>)( parameters-&gt;stream &amp;&amp;
<a name="l02274"></a>02274                                ( parameters-&gt;flags &amp; <a class="code" href="freetype_8h.html#aedfb4f733ac38dfa5859d83660f31bc2">FT_OPEN_STREAM</a> ) ) );
<a name="l02275"></a>02275 
<a name="l02276"></a>02276   Exit:
<a name="l02277"></a>02277     <span class="keywordflow">return</span> error;
<a name="l02278"></a>02278   }
<a name="l02279"></a>02279 
<a name="l02280"></a>02280 
<a name="l02281"></a>02281   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02282"></a>02282 
<a name="l02283"></a>02283   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02284"></a><a class="code" href="ftobjs_8c.html#ae8cfe1952b7babfb7273a976c6287ae9">02284</a>   <a class="code" href="freetype_8h.html#ae8cfe1952b7babfb7273a976c6287ae9">FT_Reference_Face</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>  face )
<a name="l02285"></a>02285   {
<a name="l02286"></a>02286     face-&gt;internal-&gt;refcount++;
<a name="l02287"></a>02287 
<a name="l02288"></a>02288     <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l02289"></a>02289   }
<a name="l02290"></a>02290 
<a name="l02291"></a>02291 
<a name="l02292"></a>02292   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02293"></a>02293 
<a name="l02294"></a>02294   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02295"></a><a class="code" href="ftobjs_8c.html#a2d1542be3d3af3d7699cee3425b2bc79">02295</a>   <a class="code" href="freetype_8h.html#a2d1542be3d3af3d7699cee3425b2bc79">FT_Done_Face</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>  face )
<a name="l02296"></a>02296   {
<a name="l02297"></a>02297     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>     error;
<a name="l02298"></a>02298     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>    driver;
<a name="l02299"></a>02299     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>    memory;
<a name="l02300"></a>02300     <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>  node;
<a name="l02301"></a>02301 
<a name="l02302"></a>02302 
<a name="l02303"></a>02303     error = FT_Err_Invalid_Face_Handle;
<a name="l02304"></a>02304     <span class="keywordflow">if</span> ( face &amp;&amp; face-&gt;driver )
<a name="l02305"></a>02305     {
<a name="l02306"></a>02306       face-&gt;internal-&gt;refcount--;
<a name="l02307"></a>02307       <span class="keywordflow">if</span> ( face-&gt;internal-&gt;refcount &gt; 0 )
<a name="l02308"></a>02308         error = FT_Err_Ok;
<a name="l02309"></a>02309       <span class="keywordflow">else</span>
<a name="l02310"></a>02310       {
<a name="l02311"></a>02311         driver = face-&gt;driver;
<a name="l02312"></a>02312         memory = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>;
<a name="l02313"></a>02313 
<a name="l02314"></a>02314         <span class="comment">/* find face in driver&#39;s list */</span>
<a name="l02315"></a>02315         node = <a class="code" href="ftlist_8h.html#ac89db0214e9810f0234f09510678b208">FT_List_Find</a>( &amp;driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a2602170e3ecde21a764dc32417aaa002">faces_list</a>, face );
<a name="l02316"></a>02316         <span class="keywordflow">if</span> ( node )
<a name="l02317"></a>02317         {
<a name="l02318"></a>02318           <span class="comment">/* remove face object from the driver&#39;s list */</span>
<a name="l02319"></a>02319           <a class="code" href="ftlist_8h.html#aad29d9cbe77803354f3bb5170360939a">FT_List_Remove</a>( &amp;driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a2602170e3ecde21a764dc32417aaa002">faces_list</a>, node );
<a name="l02320"></a>02320           <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( node );
<a name="l02321"></a>02321 
<a name="l02322"></a>02322           <span class="comment">/* now destroy the object proper */</span>
<a name="l02323"></a>02323           destroy_face( memory, face, driver );
<a name="l02324"></a>02324           error = FT_Err_Ok;
<a name="l02325"></a>02325         }
<a name="l02326"></a>02326       }
<a name="l02327"></a>02327     }
<a name="l02328"></a>02328 
<a name="l02329"></a>02329     <span class="keywordflow">return</span> error;
<a name="l02330"></a>02330   }
<a name="l02331"></a>02331 
<a name="l02332"></a>02332 
<a name="l02333"></a>02333   <span class="comment">/* documentation is in ftobjs.h */</span>
<a name="l02334"></a>02334 
<a name="l02335"></a>02335   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02336"></a><a class="code" href="ftobjs_8c.html#a9b4a1faa77e9bd3f24250affb24c1518">02336</a>   <a class="code" href="ftsizes_8h.html#a8641d59dfb4521af8ff6377bb9b07291">FT_New_Size</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l02337"></a>02337                <a class="code" href="struct_f_t___size_rec__.html">FT_Size</a>  *asize )
<a name="l02338"></a>02338   {
<a name="l02339"></a>02339     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>         error;
<a name="l02340"></a>02340     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>        memory;
<a name="l02341"></a>02341     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>        driver;
<a name="l02342"></a>02342     <a class="code" href="struct_f_t___driver___class_rec__.html">FT_Driver_Class</a>  clazz;
<a name="l02343"></a>02343 
<a name="l02344"></a>02344     <a class="code" href="struct_f_t___size_rec__.html">FT_Size</a>          size = 0;
<a name="l02345"></a>02345     <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>      node = 0;
<a name="l02346"></a>02346 
<a name="l02347"></a>02347 
<a name="l02348"></a>02348     <span class="keywordflow">if</span> ( !face )
<a name="l02349"></a>02349       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l02350"></a>02350 
<a name="l02351"></a>02351     <span class="keywordflow">if</span> ( !asize )
<a name="l02352"></a>02352       <span class="keywordflow">return</span> FT_Err_Invalid_Size_Handle;
<a name="l02353"></a>02353 
<a name="l02354"></a>02354     <span class="keywordflow">if</span> ( !face-&gt;driver )
<a name="l02355"></a>02355       <span class="keywordflow">return</span> FT_Err_Invalid_Driver_Handle;
<a name="l02356"></a>02356 
<a name="l02357"></a>02357     *asize = 0;
<a name="l02358"></a>02358 
<a name="l02359"></a>02359     driver = face-&gt;driver;
<a name="l02360"></a>02360     clazz  = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>;
<a name="l02361"></a>02361     memory = face-&gt;memory;
<a name="l02362"></a>02362 
<a name="l02363"></a>02363     <span class="comment">/* Allocate new size object and perform basic initialisation */</span>
<a name="l02364"></a>02364     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( size, clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a436687825ee47ed94da71fda90e2f578">size_object_size</a> ) || <a class="code" href="ftmemory_8h.html#a313d8de417ea0d1c5fcc7d348397a642">FT_NEW</a>( node ) )
<a name="l02365"></a>02365       <span class="keywordflow">goto</span> Exit;
<a name="l02366"></a>02366 
<a name="l02367"></a>02367     size-&gt;<a class="code" href="struct_f_t___size_rec__.html#a21b54fb07feaba8be23321054da98f5f">face</a> = face;
<a name="l02368"></a>02368 
<a name="l02369"></a>02369     <span class="comment">/* for now, do not use any internal fields in size objects */</span>
<a name="l02370"></a>02370     size-&gt;<a class="code" href="struct_f_t___size_rec__.html#a236c47ea3138e485c29b0d7baa5cf3b6">internal</a> = 0;
<a name="l02371"></a>02371 
<a name="l02372"></a>02372     <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a0aec58307bc166f0e74c890509638ddf">init_size</a> )
<a name="l02373"></a>02373       error = clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a0aec58307bc166f0e74c890509638ddf">init_size</a>( size );
<a name="l02374"></a>02374 
<a name="l02375"></a>02375     <span class="comment">/* in case of success, add to the face&#39;s list */</span>
<a name="l02376"></a>02376     <span class="keywordflow">if</span> ( !error )
<a name="l02377"></a>02377     {
<a name="l02378"></a>02378       *asize     = <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a>;
<a name="l02379"></a>02379       node-&gt;<a class="code" href="struct_f_t___list_node_rec__.html#ab0202be88f722442a4bec9aeb5f6418f">data</a> = <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a>;
<a name="l02380"></a>02380       <a class="code" href="ftlist_8h.html#afc59903c201f367a5d77dc6b7daf8f3c">FT_List_Add</a>( &amp;face-&gt;sizes_list, node );
<a name="l02381"></a>02381     }
<a name="l02382"></a>02382 
<a name="l02383"></a>02383   Exit:
<a name="l02384"></a>02384     <span class="keywordflow">if</span> ( error )
<a name="l02385"></a>02385     {
<a name="l02386"></a>02386       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( node );
<a name="l02387"></a>02387       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( size );
<a name="l02388"></a>02388     }
<a name="l02389"></a>02389 
<a name="l02390"></a>02390     <span class="keywordflow">return</span> error;
<a name="l02391"></a>02391   }
<a name="l02392"></a>02392 
<a name="l02393"></a>02393 
<a name="l02394"></a>02394   <span class="comment">/* documentation is in ftobjs.h */</span>
<a name="l02395"></a>02395 
<a name="l02396"></a>02396   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02397"></a><a class="code" href="ftobjs_8c.html#a3f370063d752eda02f1a9d54feb863a4">02397</a>   <a class="code" href="ftsizes_8h.html#a3f370063d752eda02f1a9d54feb863a4">FT_Done_Size</a>( <a class="code" href="struct_f_t___size_rec__.html">FT_Size</a>  size )
<a name="l02398"></a>02398   {
<a name="l02399"></a>02399     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>     error;
<a name="l02400"></a>02400     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>    driver;
<a name="l02401"></a>02401     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>    memory;
<a name="l02402"></a>02402     <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>      face;
<a name="l02403"></a>02403     <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>  node;
<a name="l02404"></a>02404 
<a name="l02405"></a>02405 
<a name="l02406"></a>02406     <span class="keywordflow">if</span> ( !size )
<a name="l02407"></a>02407       <span class="keywordflow">return</span> FT_Err_Invalid_Size_Handle;
<a name="l02408"></a>02408 
<a name="l02409"></a>02409     face = size-&gt;face;
<a name="l02410"></a>02410     <span class="keywordflow">if</span> ( !face )
<a name="l02411"></a>02411       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l02412"></a>02412 
<a name="l02413"></a>02413     driver = face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a011b62fcffdd6dc421c9ab3286d4c9fa">driver</a>;
<a name="l02414"></a>02414     <span class="keywordflow">if</span> ( !driver )
<a name="l02415"></a>02415       <span class="keywordflow">return</span> FT_Err_Invalid_Driver_Handle;
<a name="l02416"></a>02416 
<a name="l02417"></a>02417     memory = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a8451ceb25c76794fb47e81f477c8222d">root</a>.<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>;
<a name="l02418"></a>02418 
<a name="l02419"></a>02419     error = FT_Err_Ok;
<a name="l02420"></a>02420     node  = <a class="code" href="ftlist_8h.html#ac89db0214e9810f0234f09510678b208">FT_List_Find</a>( &amp;face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a47504203e02bfba59c802c35cb4009ed">sizes_list</a>, size );
<a name="l02421"></a>02421     <span class="keywordflow">if</span> ( node )
<a name="l02422"></a>02422     {
<a name="l02423"></a>02423       <a class="code" href="ftlist_8h.html#aad29d9cbe77803354f3bb5170360939a">FT_List_Remove</a>( &amp;face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a47504203e02bfba59c802c35cb4009ed">sizes_list</a>, node );
<a name="l02424"></a>02424       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( node );
<a name="l02425"></a>02425 
<a name="l02426"></a>02426       <span class="keywordflow">if</span> ( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a212d116864a5d81e80b176f9b846cd08">size</a> == size )
<a name="l02427"></a>02427       {
<a name="l02428"></a>02428         face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a212d116864a5d81e80b176f9b846cd08">size</a> = 0;
<a name="l02429"></a>02429         <span class="keywordflow">if</span> ( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a47504203e02bfba59c802c35cb4009ed">sizes_list</a>.<a class="code" href="struct_f_t___list_rec__.html#a09ed35c2bcdc1c3acd12ff4650dfdeb9">head</a> )
<a name="l02430"></a>02430           face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a212d116864a5d81e80b176f9b846cd08">size</a> = (<a class="code" href="freetype_8h.html#a791d0ff3273ca9628a523efd98d138c1">FT_Size</a>)(face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a47504203e02bfba59c802c35cb4009ed">sizes_list</a>.<a class="code" href="struct_f_t___list_rec__.html#a09ed35c2bcdc1c3acd12ff4650dfdeb9">head</a>-&gt;<a class="code" href="struct_f_t___list_node_rec__.html#ab0202be88f722442a4bec9aeb5f6418f">data</a>);
<a name="l02431"></a>02431       }
<a name="l02432"></a>02432 
<a name="l02433"></a>02433       destroy_size( memory, size, driver );
<a name="l02434"></a>02434     }
<a name="l02435"></a>02435     <span class="keywordflow">else</span>
<a name="l02436"></a>02436       error = FT_Err_Invalid_Size_Handle;
<a name="l02437"></a>02437 
<a name="l02438"></a>02438     <span class="keywordflow">return</span> error;
<a name="l02439"></a>02439   }
<a name="l02440"></a>02440 
<a name="l02441"></a>02441 
<a name="l02442"></a>02442   <span class="comment">/* documentation is in ftobjs.h */</span>
<a name="l02443"></a>02443 
<a name="l02444"></a>02444   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02445"></a><a class="code" href="ftobjs_8c.html#a1465e33907efc8bb43e298a4cb514078">02445</a>   <a class="code" href="ftobjs_8h.html#a1465e33907efc8bb43e298a4cb514078">FT_Match_Size</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>          face,
<a name="l02446"></a>02446                  <a class="code" href="struct_f_t___size___request_rec__.html">FT_Size_Request</a>  req,
<a name="l02447"></a>02447                  <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>          ignore_width,
<a name="l02448"></a>02448                  <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>*        size_index )
<a name="l02449"></a>02449   {
<a name="l02450"></a>02450     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>   i;
<a name="l02451"></a>02451     <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>  w, h;
<a name="l02452"></a>02452 
<a name="l02453"></a>02453 
<a name="l02454"></a>02454     <span class="keywordflow">if</span> ( !<a class="code" href="freetype_8h.html#a5e7fe61c802f7cb7f8fddf929e3f50e3">FT_HAS_FIXED_SIZES</a>( face ) )
<a name="l02455"></a>02455       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l02456"></a>02456 
<a name="l02457"></a>02457     <span class="comment">/* FT_Bitmap_Size doesn&#39;t provide enough info... */</span>
<a name="l02458"></a>02458     <span class="keywordflow">if</span> ( req-&gt;type != <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114faa91e57e841381c980f058fa094380d1d">FT_SIZE_REQUEST_TYPE_NOMINAL</a> )
<a name="l02459"></a>02459       <span class="keywordflow">return</span> FT_Err_Unimplemented_Feature;
<a name="l02460"></a>02460 
<a name="l02461"></a>02461     w = <a class="code" href="ftobjs_8h.html#a4566fb02f2dfd5fc9e40ad1e7896c9c4">FT_REQUEST_WIDTH</a> ( req );
<a name="l02462"></a>02462     h = <a class="code" href="ftobjs_8h.html#a8ce3b99abda18aa97061d997314af5f3">FT_REQUEST_HEIGHT</a>( req );
<a name="l02463"></a>02463 
<a name="l02464"></a>02464     <span class="keywordflow">if</span> ( req-&gt;width &amp;&amp; !req-&gt;height )
<a name="l02465"></a>02465       h = w;
<a name="l02466"></a>02466     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !req-&gt;width &amp;&amp; req-&gt;height )
<a name="l02467"></a>02467       w = h;
<a name="l02468"></a>02468 
<a name="l02469"></a>02469     w = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( w );
<a name="l02470"></a>02470     h = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( h );
<a name="l02471"></a>02471 
<a name="l02472"></a>02472     <span class="keywordflow">for</span> ( i = 0; i &lt; face-&gt;num_fixed_sizes; i++ )
<a name="l02473"></a>02473     {
<a name="l02474"></a>02474       <a class="code" href="struct_f_t___bitmap___size__.html">FT_Bitmap_Size</a>*  bsize = face-&gt;available_sizes + i;
<a name="l02475"></a>02475 
<a name="l02476"></a>02476 
<a name="l02477"></a>02477       <span class="keywordflow">if</span> ( h != <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a60d4d003d09fd57505f69f39e31e19c1">y_ppem</a> ) )
<a name="l02478"></a>02478         <span class="keywordflow">continue</span>;
<a name="l02479"></a>02479 
<a name="l02480"></a>02480       <span class="keywordflow">if</span> ( w == <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a6f877a792d2dc93328037c928979215f">x_ppem</a> ) || ignore_width )
<a name="l02481"></a>02481       {
<a name="l02482"></a>02482         <span class="keywordflow">if</span> ( size_index )
<a name="l02483"></a>02483           *size_index = (<a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>)i;
<a name="l02484"></a>02484 
<a name="l02485"></a>02485         <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l02486"></a>02486       }
<a name="l02487"></a>02487     }
<a name="l02488"></a>02488 
<a name="l02489"></a>02489     <span class="keywordflow">return</span> FT_Err_Invalid_Pixel_Size;
<a name="l02490"></a>02490   }
<a name="l02491"></a>02491 
<a name="l02492"></a>02492 
<a name="l02493"></a>02493   <span class="comment">/* documentation is in ftobjs.h */</span>
<a name="l02494"></a>02494 
<a name="l02495"></a>02495   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l02496"></a><a class="code" href="ftobjs_8c.html#a2b68ffda2b76d009e20d9bcaaff0421d">02496</a>   <a class="code" href="ftobjs_8h.html#a2b68ffda2b76d009e20d9bcaaff0421d">ft_synthesize_vertical_metrics</a>( <a class="code" href="freetype_8h.html#aba844698c24c1c12727c60a6fc0a9b3d">FT_Glyph_Metrics</a>*  metrics,
<a name="l02497"></a>02497                                   <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>             advance )
<a name="l02498"></a>02498   {
<a name="l02499"></a>02499     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  height = metrics-&gt;height;
<a name="l02500"></a>02500 
<a name="l02501"></a>02501 
<a name="l02502"></a>02502     <span class="comment">/* compensate for glyph with bbox above/below the baseline */</span>
<a name="l02503"></a>02503     <span class="keywordflow">if</span> ( metrics-&gt;horiBearingY &lt; 0 )
<a name="l02504"></a>02504     {
<a name="l02505"></a>02505       <span class="keywordflow">if</span> ( height &lt; metrics-&gt;horiBearingY )
<a name="l02506"></a>02506         height = metrics-&gt;horiBearingY;
<a name="l02507"></a>02507     }
<a name="l02508"></a>02508     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( metrics-&gt;horiBearingY &gt; 0 )
<a name="l02509"></a>02509       height -= metrics-&gt;horiBearingY;
<a name="l02510"></a>02510 
<a name="l02511"></a>02511     <span class="comment">/* the factor 1.2 is a heuristical value */</span>
<a name="l02512"></a>02512     <span class="keywordflow">if</span> ( !advance )
<a name="l02513"></a>02513       advance = height * 12 / 10;
<a name="l02514"></a>02514 
<a name="l02515"></a>02515     metrics-&gt;vertBearingX = metrics-&gt;horiBearingX - metrics-&gt;horiAdvance / 2;
<a name="l02516"></a>02516     metrics-&gt;vertBearingY = ( advance - height ) / 2;
<a name="l02517"></a>02517     metrics-&gt;vertAdvance  = advance;
<a name="l02518"></a>02518   }
<a name="l02519"></a>02519 
<a name="l02520"></a>02520 
<a name="l02521"></a>02521   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02522"></a>02522   ft_recompute_scaled_metrics( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>           face,
<a name="l02523"></a>02523                                <a class="code" href="struct_f_t___size___metrics__.html">FT_Size_Metrics</a>*  metrics )
<a name="l02524"></a>02524   {
<a name="l02525"></a>02525     <span class="comment">/* Compute root ascender, descender, test height, and max_advance */</span>
<a name="l02526"></a>02526 
<a name="l02527"></a>02527 <span class="preprocessor">#ifdef GRID_FIT_METRICS</span>
<a name="l02528"></a>02528 <span class="preprocessor"></span>    metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#ab5fde60a2661d7b774f61c264a2a6070">ascender</a>    = <a class="code" href="ftobjs_8h.html#a026611252cfb0918ade2d44996fac3e1">FT_PIX_CEIL</a>( <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#afd0fe7d9dc08a4afbdec0ea0eabb0198">ascender</a>,
<a name="l02529"></a>02529                                                    metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> ) );
<a name="l02530"></a>02530 
<a name="l02531"></a>02531     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a9b2ca3a4391803e8721ed99eb9953d52">descender</a>   = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a7524f78b4f7b4e91d8c690713f8de275">descender</a>,
<a name="l02532"></a>02532                                                     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> ) );
<a name="l02533"></a>02533 
<a name="l02534"></a>02534     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#ae3361e264fb8a9e669f118bdb244439b">height</a>      = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6062881a848ab3395c6d096812065d9d">height</a>,
<a name="l02535"></a>02535                                                     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> ) );
<a name="l02536"></a>02536 
<a name="l02537"></a>02537     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#ac315a7a834ac1a57c7169ce021718958">max_advance</a> = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ac8c9bd9f9b43ccb81326e7802c3d235d">max_advance_width</a>,
<a name="l02538"></a>02538                                                     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> ) );
<a name="l02539"></a>02539 <span class="preprocessor">#else </span><span class="comment">/* !GRID_FIT_METRICS */</span>
<a name="l02540"></a>02540     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#ab5fde60a2661d7b774f61c264a2a6070">ascender</a>    = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#afd0fe7d9dc08a4afbdec0ea0eabb0198">ascender</a>,
<a name="l02541"></a>02541                                       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> );
<a name="l02542"></a>02542 
<a name="l02543"></a>02543     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a9b2ca3a4391803e8721ed99eb9953d52">descender</a>   = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a7524f78b4f7b4e91d8c690713f8de275">descender</a>,
<a name="l02544"></a>02544                                       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> );
<a name="l02545"></a>02545 
<a name="l02546"></a>02546     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#ae3361e264fb8a9e669f118bdb244439b">height</a>      = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6062881a848ab3395c6d096812065d9d">height</a>,
<a name="l02547"></a>02547                                       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> );
<a name="l02548"></a>02548 
<a name="l02549"></a>02549     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#ac315a7a834ac1a57c7169ce021718958">max_advance</a> = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ac8c9bd9f9b43ccb81326e7802c3d235d">max_advance_width</a>,
<a name="l02550"></a>02550                                       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> );
<a name="l02551"></a>02551 <span class="preprocessor">#endif </span><span class="comment">/* !GRID_FIT_METRICS */</span>
<a name="l02552"></a>02552   }
<a name="l02553"></a>02553 
<a name="l02554"></a>02554 
<a name="l02555"></a>02555   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l02556"></a><a class="code" href="ftobjs_8c.html#a3a1096f28aaa3d9a0fe555df30796696">02556</a>   <a class="code" href="ftobjs_8h.html#a3a1096f28aaa3d9a0fe555df30796696">FT_Select_Metrics</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l02557"></a>02557                      <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  strike_index )
<a name="l02558"></a>02558   {
<a name="l02559"></a>02559     <a class="code" href="struct_f_t___size___metrics__.html">FT_Size_Metrics</a>*  <a class="code" href="fterrdef_8h.html#a5b089f80b4f1f749dfb33220373bde32">metrics</a>;
<a name="l02560"></a>02560     <a class="code" href="struct_f_t___bitmap___size__.html">FT_Bitmap_Size</a>*   bsize;
<a name="l02561"></a>02561 
<a name="l02562"></a>02562 
<a name="l02563"></a>02563     metrics = &amp;face-&gt;size-&gt;metrics;
<a name="l02564"></a>02564     bsize   = face-&gt;available_sizes + strike_index;
<a name="l02565"></a>02565 
<a name="l02566"></a>02566     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#abb42b175a3450e9d8b84483f166d6c8a">x_ppem</a> = (<a class="code" href="fttypes_8h.html#a937f6c17cf5ffd09086d8610c37b9f58">FT_UShort</a>)( ( bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a6f877a792d2dc93328037c928979215f">x_ppem</a> + 32 ) &gt;&gt; 6 );
<a name="l02567"></a>02567     metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#abcdb70cb9e39a74679bc39c07f3275f7">y_ppem</a> = (<a class="code" href="fttypes_8h.html#a937f6c17cf5ffd09086d8610c37b9f58">FT_UShort</a>)( ( bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a60d4d003d09fd57505f69f39e31e19c1">y_ppem</a> + 32 ) &gt;&gt; 6 );
<a name="l02568"></a>02568 
<a name="l02569"></a>02569     <span class="keywordflow">if</span> ( <a class="code" href="freetype_8h.html#a6974c80eab523906685030b0298141b1">FT_IS_SCALABLE</a>( face ) )
<a name="l02570"></a>02570     {
<a name="l02571"></a>02571       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> = <a class="code" href="freetype_8h.html#a5248df90a0d076e6543b09284face353">FT_DivFix</a>( bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a6f877a792d2dc93328037c928979215f">x_ppem</a>,
<a name="l02572"></a>02572                                     face-&gt;units_per_EM );
<a name="l02573"></a>02573       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> = <a class="code" href="freetype_8h.html#a5248df90a0d076e6543b09284face353">FT_DivFix</a>( bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a60d4d003d09fd57505f69f39e31e19c1">y_ppem</a>,
<a name="l02574"></a>02574                                     face-&gt;units_per_EM );
<a name="l02575"></a>02575 
<a name="l02576"></a>02576       ft_recompute_scaled_metrics( face, metrics );
<a name="l02577"></a>02577     }
<a name="l02578"></a>02578     <span class="keywordflow">else</span>
<a name="l02579"></a>02579     {
<a name="l02580"></a>02580       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a>     = 1L &lt;&lt; 16;
<a name="l02581"></a>02581       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a>     = 1L &lt;&lt; 16;
<a name="l02582"></a>02582       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#ab5fde60a2661d7b774f61c264a2a6070">ascender</a>    = bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a60d4d003d09fd57505f69f39e31e19c1">y_ppem</a>;
<a name="l02583"></a>02583       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a9b2ca3a4391803e8721ed99eb9953d52">descender</a>   = 0;
<a name="l02584"></a>02584       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#ae3361e264fb8a9e669f118bdb244439b">height</a>      = bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#adf2f24039b458ff4674712886f242262">height</a> &lt;&lt; 6;
<a name="l02585"></a>02585       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#ac315a7a834ac1a57c7169ce021718958">max_advance</a> = bsize-&gt;<a class="code" href="struct_f_t___bitmap___size__.html#a6f877a792d2dc93328037c928979215f">x_ppem</a>;
<a name="l02586"></a>02586     }
<a name="l02587"></a>02587   }
<a name="l02588"></a>02588 
<a name="l02589"></a>02589 
<a name="l02590"></a>02590   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l02591"></a><a class="code" href="ftobjs_8c.html#a777349d54fd01cb457fe4156c5594519">02591</a>   <a class="code" href="ftobjs_8h.html#a777349d54fd01cb457fe4156c5594519">FT_Request_Metrics</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>          face,
<a name="l02592"></a>02592                       <a class="code" href="struct_f_t___size___request_rec__.html">FT_Size_Request</a>  req )
<a name="l02593"></a>02593   {
<a name="l02594"></a>02594     <a class="code" href="struct_f_t___size___metrics__.html">FT_Size_Metrics</a>*  <a class="code" href="fterrdef_8h.html#a5b089f80b4f1f749dfb33220373bde32">metrics</a>;
<a name="l02595"></a>02595 
<a name="l02596"></a>02596 
<a name="l02597"></a>02597     metrics = &amp;face-&gt;size-&gt;metrics;
<a name="l02598"></a>02598 
<a name="l02599"></a>02599     <span class="keywordflow">if</span> ( <a class="code" href="freetype_8h.html#a6974c80eab523906685030b0298141b1">FT_IS_SCALABLE</a>( face ) )
<a name="l02600"></a>02600     {
<a name="l02601"></a>02601       <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>  w = 0, h = 0, scaled_w = 0, scaled_h = 0;
<a name="l02602"></a>02602 
<a name="l02603"></a>02603 
<a name="l02604"></a>02604       <span class="keywordflow">switch</span> ( req-&gt;type )
<a name="l02605"></a>02605       {
<a name="l02606"></a>02606       <span class="keywordflow">case</span> <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114faa91e57e841381c980f058fa094380d1d">FT_SIZE_REQUEST_TYPE_NOMINAL</a>:
<a name="l02607"></a>02607         w = h = face-&gt;units_per_EM;
<a name="l02608"></a>02608         <span class="keywordflow">break</span>;
<a name="l02609"></a>02609 
<a name="l02610"></a>02610       <span class="keywordflow">case</span> <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114fac4e0cec5f4cb57232338a6bdb960b8a7">FT_SIZE_REQUEST_TYPE_REAL_DIM</a>:
<a name="l02611"></a>02611         w = h = face-&gt;ascender - face-&gt;descender;
<a name="l02612"></a>02612         <span class="keywordflow">break</span>;
<a name="l02613"></a>02613 
<a name="l02614"></a>02614       <span class="keywordflow">case</span> <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114fa34ec6845625809803b4925c8adbebc31">FT_SIZE_REQUEST_TYPE_BBOX</a>:
<a name="l02615"></a>02615         w = face-&gt;bbox.xMax - face-&gt;bbox.xMin;
<a name="l02616"></a>02616         h = face-&gt;bbox.yMax - face-&gt;bbox.yMin;
<a name="l02617"></a>02617         <span class="keywordflow">break</span>;
<a name="l02618"></a>02618 
<a name="l02619"></a>02619       <span class="keywordflow">case</span> <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114fafba793a2f2216a300200a1a0813991d4">FT_SIZE_REQUEST_TYPE_CELL</a>:
<a name="l02620"></a>02620         w = face-&gt;max_advance_width;
<a name="l02621"></a>02621         h = face-&gt;ascender - face-&gt;descender;
<a name="l02622"></a>02622         <span class="keywordflow">break</span>;
<a name="l02623"></a>02623 
<a name="l02624"></a>02624       <span class="keywordflow">case</span> <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114fadb64f07387955ffe43c82b21507102d5">FT_SIZE_REQUEST_TYPE_SCALES</a>:
<a name="l02625"></a>02625         metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> = (<a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>)req-&gt;width;
<a name="l02626"></a>02626         metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> = (<a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>)req-&gt;height;
<a name="l02627"></a>02627         <span class="keywordflow">if</span> ( !metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> )
<a name="l02628"></a>02628           metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> = metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a>;
<a name="l02629"></a>02629         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> )
<a name="l02630"></a>02630           metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> = metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a>;
<a name="l02631"></a>02631         <span class="keywordflow">goto</span> Calculate_Ppem;
<a name="l02632"></a>02632 
<a name="l02633"></a>02633       <span class="keywordflow">case</span> <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114fae1cd01b1812a22ae21ebfb4baa6fd53a">FT_SIZE_REQUEST_TYPE_MAX</a>:
<a name="l02634"></a>02634         <span class="keywordflow">break</span>;
<a name="l02635"></a>02635       }
<a name="l02636"></a>02636 
<a name="l02637"></a>02637       <span class="comment">/* to be on the safe side */</span>
<a name="l02638"></a>02638       <span class="keywordflow">if</span> ( w &lt; 0 )
<a name="l02639"></a>02639         w = -w;
<a name="l02640"></a>02640 
<a name="l02641"></a>02641       <span class="keywordflow">if</span> ( h &lt; 0 )
<a name="l02642"></a>02642         h = -h;
<a name="l02643"></a>02643 
<a name="l02644"></a>02644       scaled_w = <a class="code" href="ftobjs_8h.html#a4566fb02f2dfd5fc9e40ad1e7896c9c4">FT_REQUEST_WIDTH</a> ( req );
<a name="l02645"></a>02645       scaled_h = <a class="code" href="ftobjs_8h.html#a8ce3b99abda18aa97061d997314af5f3">FT_REQUEST_HEIGHT</a>( req );
<a name="l02646"></a>02646 
<a name="l02647"></a>02647       <span class="comment">/* determine scales */</span>
<a name="l02648"></a>02648       <span class="keywordflow">if</span> ( req-&gt;width )
<a name="l02649"></a>02649       {
<a name="l02650"></a>02650         metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> = <a class="code" href="freetype_8h.html#a5248df90a0d076e6543b09284face353">FT_DivFix</a>( scaled_w, w );
<a name="l02651"></a>02651 
<a name="l02652"></a>02652         <span class="keywordflow">if</span> ( req-&gt;height )
<a name="l02653"></a>02653         {
<a name="l02654"></a>02654           metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> = <a class="code" href="freetype_8h.html#a5248df90a0d076e6543b09284face353">FT_DivFix</a>( scaled_h, h );
<a name="l02655"></a>02655 
<a name="l02656"></a>02656           <span class="keywordflow">if</span> ( req-&gt;type == <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114fafba793a2f2216a300200a1a0813991d4">FT_SIZE_REQUEST_TYPE_CELL</a> )
<a name="l02657"></a>02657           {
<a name="l02658"></a>02658             <span class="keywordflow">if</span> ( metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> &gt; metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> )
<a name="l02659"></a>02659               metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> = metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a>;
<a name="l02660"></a>02660             <span class="keywordflow">else</span>
<a name="l02661"></a>02661               metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> = metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a>;
<a name="l02662"></a>02662           }
<a name="l02663"></a>02663         }
<a name="l02664"></a>02664         <span class="keywordflow">else</span>
<a name="l02665"></a>02665         {
<a name="l02666"></a>02666           metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> = metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a>;
<a name="l02667"></a>02667           scaled_h = <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( scaled_w, h, w );
<a name="l02668"></a>02668         }
<a name="l02669"></a>02669       }
<a name="l02670"></a>02670       <span class="keywordflow">else</span>
<a name="l02671"></a>02671       {
<a name="l02672"></a>02672         metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> = metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> = <a class="code" href="freetype_8h.html#a5248df90a0d076e6543b09284face353">FT_DivFix</a>( scaled_h, h );
<a name="l02673"></a>02673         scaled_w = <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( scaled_h, w, h );
<a name="l02674"></a>02674       }
<a name="l02675"></a>02675 
<a name="l02676"></a>02676   Calculate_Ppem:
<a name="l02677"></a>02677       <span class="comment">/* calculate the ppems */</span>
<a name="l02678"></a>02678       <span class="keywordflow">if</span> ( req-&gt;type != <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114faa91e57e841381c980f058fa094380d1d">FT_SIZE_REQUEST_TYPE_NOMINAL</a> )
<a name="l02679"></a>02679       {
<a name="l02680"></a>02680         scaled_w = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;units_per_EM, metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> );
<a name="l02681"></a>02681         scaled_h = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( face-&gt;units_per_EM, metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> );
<a name="l02682"></a>02682       }
<a name="l02683"></a>02683 
<a name="l02684"></a>02684       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#abb42b175a3450e9d8b84483f166d6c8a">x_ppem</a> = (<a class="code" href="fttypes_8h.html#a937f6c17cf5ffd09086d8610c37b9f58">FT_UShort</a>)( ( scaled_w + 32 ) &gt;&gt; 6 );
<a name="l02685"></a>02685       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#abcdb70cb9e39a74679bc39c07f3275f7">y_ppem</a> = (<a class="code" href="fttypes_8h.html#a937f6c17cf5ffd09086d8610c37b9f58">FT_UShort</a>)( ( scaled_h + 32 ) &gt;&gt; 6 );
<a name="l02686"></a>02686 
<a name="l02687"></a>02687       ft_recompute_scaled_metrics( face, metrics );
<a name="l02688"></a>02688     }
<a name="l02689"></a>02689     <span class="keywordflow">else</span>
<a name="l02690"></a>02690     {
<a name="l02691"></a>02691       <a class="code" href="ftmemory_8h.html#a88db9f3d12c144b9f450c80ec62dc4fc">FT_ZERO</a>( metrics );
<a name="l02692"></a>02692       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a5e92028bb9881e107a6fb75d557eaff1">x_scale</a> = 1L &lt;&lt; 16;
<a name="l02693"></a>02693       metrics-&gt;<a class="code" href="struct_f_t___size___metrics__.html#a1f8b1cb3538b9920127f721dd061379d">y_scale</a> = 1L &lt;&lt; 16;
<a name="l02694"></a>02694     }
<a name="l02695"></a>02695   }
<a name="l02696"></a>02696 
<a name="l02697"></a>02697 
<a name="l02698"></a>02698   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02699"></a>02699 
<a name="l02700"></a>02700   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02701"></a><a class="code" href="ftobjs_8c.html#a6925921bbbf181ed073a154eddf3b2bc">02701</a>   <a class="code" href="freetype_8h.html#a6925921bbbf181ed073a154eddf3b2bc">FT_Select_Size</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>  face,
<a name="l02702"></a>02702                   <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>   strike_index )
<a name="l02703"></a>02703   {
<a name="l02704"></a>02704     <a class="code" href="struct_f_t___driver___class_rec__.html">FT_Driver_Class</a>  clazz;
<a name="l02705"></a>02705 
<a name="l02706"></a>02706 
<a name="l02707"></a>02707     <span class="keywordflow">if</span> ( !face || !<a class="code" href="freetype_8h.html#a5e7fe61c802f7cb7f8fddf929e3f50e3">FT_HAS_FIXED_SIZES</a>( face ) )
<a name="l02708"></a>02708       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l02709"></a>02709 
<a name="l02710"></a>02710     <span class="keywordflow">if</span> ( strike_index &lt; 0 || strike_index &gt;= face-&gt;num_fixed_sizes )
<a name="l02711"></a>02711       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l02712"></a>02712 
<a name="l02713"></a>02713     clazz = face-&gt;driver-&gt;clazz;
<a name="l02714"></a>02714 
<a name="l02715"></a>02715     <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a1b365eb82525dae0a816974d949fe0dd">select_size</a> )
<a name="l02716"></a>02716       <span class="keywordflow">return</span> clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a1b365eb82525dae0a816974d949fe0dd">select_size</a>( face-&gt;size, (<a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>)strike_index );
<a name="l02717"></a>02717 
<a name="l02718"></a>02718     <a class="code" href="ftobjs_8h.html#a3a1096f28aaa3d9a0fe555df30796696">FT_Select_Metrics</a>( face, (<a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>)strike_index );
<a name="l02719"></a>02719 
<a name="l02720"></a>02720     <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l02721"></a>02721   }
<a name="l02722"></a>02722 
<a name="l02723"></a>02723 
<a name="l02724"></a>02724   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02725"></a>02725 
<a name="l02726"></a>02726   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02727"></a><a class="code" href="ftobjs_8c.html#a75025f51e4cbb8a95a9b97ab35d481e0">02727</a>   <a class="code" href="freetype_8h.html#a75025f51e4cbb8a95a9b97ab35d481e0">FT_Request_Size</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>          face,
<a name="l02728"></a>02728                    <a class="code" href="struct_f_t___size___request_rec__.html">FT_Size_Request</a>  req )
<a name="l02729"></a>02729   {
<a name="l02730"></a>02730     <a class="code" href="struct_f_t___driver___class_rec__.html">FT_Driver_Class</a>  clazz;
<a name="l02731"></a>02731     <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>         strike_index;
<a name="l02732"></a>02732 
<a name="l02733"></a>02733 
<a name="l02734"></a>02734     <span class="keywordflow">if</span> ( !face )
<a name="l02735"></a>02735       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l02736"></a>02736 
<a name="l02737"></a>02737     <span class="keywordflow">if</span> ( !req || req-&gt;width &lt; 0 || req-&gt;height &lt; 0 ||
<a name="l02738"></a>02738          req-&gt;type &gt;= <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114fae1cd01b1812a22ae21ebfb4baa6fd53a">FT_SIZE_REQUEST_TYPE_MAX</a> )
<a name="l02739"></a>02739       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l02740"></a>02740 
<a name="l02741"></a>02741     clazz = face-&gt;driver-&gt;clazz;
<a name="l02742"></a>02742 
<a name="l02743"></a>02743     <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a03ff7c2e4a2fb6d08eb481b03a78e8de">request_size</a> )
<a name="l02744"></a>02744       <span class="keywordflow">return</span> clazz-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a03ff7c2e4a2fb6d08eb481b03a78e8de">request_size</a>( face-&gt;size, req );
<a name="l02745"></a>02745 
<a name="l02746"></a>02746     <span class="comment">/*</span>
<a name="l02747"></a>02747 <span class="comment">     * The reason that a driver doesn&#39;t have `request_size&#39; defined is</span>
<a name="l02748"></a>02748 <span class="comment">     * either that the scaling here suffices or that the supported formats</span>
<a name="l02749"></a>02749 <span class="comment">     * are bitmap-only and size matching is not implemented.</span>
<a name="l02750"></a>02750 <span class="comment">     *</span>
<a name="l02751"></a>02751 <span class="comment">     * In the latter case, a simple size matching is done.</span>
<a name="l02752"></a>02752 <span class="comment">     */</span>
<a name="l02753"></a>02753     <span class="keywordflow">if</span> ( !<a class="code" href="freetype_8h.html#a6974c80eab523906685030b0298141b1">FT_IS_SCALABLE</a>( face ) &amp;&amp; <a class="code" href="freetype_8h.html#a5e7fe61c802f7cb7f8fddf929e3f50e3">FT_HAS_FIXED_SIZES</a>( face ) )
<a name="l02754"></a>02754     {
<a name="l02755"></a>02755       <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>  error;
<a name="l02756"></a>02756 
<a name="l02757"></a>02757 
<a name="l02758"></a>02758       error = <a class="code" href="ftobjs_8h.html#a1465e33907efc8bb43e298a4cb514078">FT_Match_Size</a>( face, req, 0, &amp;strike_index );
<a name="l02759"></a>02759       <span class="keywordflow">if</span> ( error )
<a name="l02760"></a>02760         <span class="keywordflow">return</span> error;
<a name="l02761"></a>02761 
<a name="l02762"></a>02762       <a class="code" href="ftdebug_8h.html#a9ff2b46b2097d26afa62871cddccdaad">FT_TRACE3</a>(( <span class="stringliteral">&quot;FT_Request_Size: bitmap strike %lu matched\n&quot;</span>,
<a name="l02763"></a>02763                   strike_index ));
<a name="l02764"></a>02764 
<a name="l02765"></a>02765       <span class="keywordflow">return</span> <a class="code" href="freetype_8h.html#a6925921bbbf181ed073a154eddf3b2bc">FT_Select_Size</a>( face, (<a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>)strike_index );
<a name="l02766"></a>02766     }
<a name="l02767"></a>02767 
<a name="l02768"></a>02768     <a class="code" href="ftobjs_8h.html#a777349d54fd01cb457fe4156c5594519">FT_Request_Metrics</a>( face, req );
<a name="l02769"></a>02769 
<a name="l02770"></a>02770     <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l02771"></a>02771   }
<a name="l02772"></a>02772 
<a name="l02773"></a>02773 
<a name="l02774"></a>02774   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02775"></a>02775 
<a name="l02776"></a>02776   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02777"></a><a class="code" href="ftobjs_8c.html#ae36c65d750a39cc04b8c67448632d5fa">02777</a>   <a class="code" href="freetype_8h.html#ae36c65d750a39cc04b8c67448632d5fa">FT_Set_Char_Size</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>     face,
<a name="l02778"></a>02778                     <a class="code" href="fttypes_8h.html#a382164b17e99c3184911d941b2586853">FT_F26Dot6</a>  char_width,
<a name="l02779"></a>02779                     <a class="code" href="fttypes_8h.html#a382164b17e99c3184911d941b2586853">FT_F26Dot6</a>  char_height,
<a name="l02780"></a>02780                     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     horz_resolution,
<a name="l02781"></a>02781                     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     vert_resolution )
<a name="l02782"></a>02782   {
<a name="l02783"></a>02783     <a class="code" href="struct_f_t___size___request_rec__.html">FT_Size_RequestRec</a>  req;
<a name="l02784"></a>02784 
<a name="l02785"></a>02785 
<a name="l02786"></a>02786     <span class="keywordflow">if</span> ( !char_width )
<a name="l02787"></a>02787       char_width = char_height;
<a name="l02788"></a>02788     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !char_height )
<a name="l02789"></a>02789       char_height = char_width;
<a name="l02790"></a>02790 
<a name="l02791"></a>02791     <span class="keywordflow">if</span> ( !horz_resolution )
<a name="l02792"></a>02792       horz_resolution = vert_resolution;
<a name="l02793"></a>02793     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !vert_resolution )
<a name="l02794"></a>02794       vert_resolution = horz_resolution;
<a name="l02795"></a>02795 
<a name="l02796"></a>02796     <span class="keywordflow">if</span> ( char_width  &lt; 1 * 64 )
<a name="l02797"></a>02797       char_width  = 1 * 64;
<a name="l02798"></a>02798     <span class="keywordflow">if</span> ( char_height &lt; 1 * 64 )
<a name="l02799"></a>02799       char_height = 1 * 64;
<a name="l02800"></a>02800 
<a name="l02801"></a>02801     <span class="keywordflow">if</span> ( !horz_resolution )
<a name="l02802"></a>02802       horz_resolution = vert_resolution = 72;
<a name="l02803"></a>02803 
<a name="l02804"></a>02804     req.<a class="code" href="struct_f_t___size___request_rec__.html#a7644b04dd2b26c0698df558775320494">type</a>           = <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114faa91e57e841381c980f058fa094380d1d">FT_SIZE_REQUEST_TYPE_NOMINAL</a>;
<a name="l02805"></a>02805     req.<a class="code" href="struct_f_t___size___request_rec__.html#a7b044d36af318b053d5e3939eb0d5039">width</a>          = char_width;
<a name="l02806"></a>02806     req.<a class="code" href="struct_f_t___size___request_rec__.html#af8142450d8d032e1870d758cdcfa51a9">height</a>         = char_height;
<a name="l02807"></a>02807     req.<a class="code" href="struct_f_t___size___request_rec__.html#a3a85704d13561d9db53aa60f7805ec73">horiResolution</a> = horz_resolution;
<a name="l02808"></a>02808     req.<a class="code" href="struct_f_t___size___request_rec__.html#a86601c38d91064b6efe256a9e99c56f4">vertResolution</a> = vert_resolution;
<a name="l02809"></a>02809 
<a name="l02810"></a>02810     <span class="keywordflow">return</span> <a class="code" href="freetype_8h.html#a75025f51e4cbb8a95a9b97ab35d481e0">FT_Request_Size</a>( face, &amp;req );
<a name="l02811"></a>02811   }
<a name="l02812"></a>02812 
<a name="l02813"></a>02813 
<a name="l02814"></a>02814   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02815"></a>02815 
<a name="l02816"></a>02816   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02817"></a><a class="code" href="ftobjs_8c.html#a229ad0ad247b9952677d09378c813988">02817</a>   <a class="code" href="freetype_8h.html#a229ad0ad247b9952677d09378c813988">FT_Set_Pixel_Sizes</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>  face,
<a name="l02818"></a>02818                       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  pixel_width,
<a name="l02819"></a>02819                       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  pixel_height )
<a name="l02820"></a>02820   {
<a name="l02821"></a>02821     <a class="code" href="struct_f_t___size___request_rec__.html">FT_Size_RequestRec</a>  req;
<a name="l02822"></a>02822 
<a name="l02823"></a>02823 
<a name="l02824"></a>02824     <span class="keywordflow">if</span> ( pixel_width == 0 )
<a name="l02825"></a>02825       pixel_width = pixel_height;
<a name="l02826"></a>02826     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( pixel_height == 0 )
<a name="l02827"></a>02827       pixel_height = pixel_width;
<a name="l02828"></a>02828 
<a name="l02829"></a>02829     <span class="keywordflow">if</span> ( pixel_width  &lt; 1 )
<a name="l02830"></a>02830       pixel_width  = 1;
<a name="l02831"></a>02831     <span class="keywordflow">if</span> ( pixel_height &lt; 1 )
<a name="l02832"></a>02832       pixel_height = 1;
<a name="l02833"></a>02833 
<a name="l02834"></a>02834     <span class="comment">/* use `&gt;=&#39; to avoid potential compiler warning on 16bit platforms */</span>
<a name="l02835"></a>02835     <span class="keywordflow">if</span> ( pixel_width  &gt;= 0xFFFFU )
<a name="l02836"></a>02836       pixel_width  = 0xFFFFU;
<a name="l02837"></a>02837     <span class="keywordflow">if</span> ( pixel_height &gt;= 0xFFFFU )
<a name="l02838"></a>02838       pixel_height = 0xFFFFU;
<a name="l02839"></a>02839 
<a name="l02840"></a>02840     req.<a class="code" href="struct_f_t___size___request_rec__.html#a7644b04dd2b26c0698df558775320494">type</a>           = <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114faa91e57e841381c980f058fa094380d1d">FT_SIZE_REQUEST_TYPE_NOMINAL</a>;
<a name="l02841"></a>02841     req.<a class="code" href="struct_f_t___size___request_rec__.html#a7b044d36af318b053d5e3939eb0d5039">width</a>          = pixel_width &lt;&lt; 6;
<a name="l02842"></a>02842     req.<a class="code" href="struct_f_t___size___request_rec__.html#af8142450d8d032e1870d758cdcfa51a9">height</a>         = pixel_height &lt;&lt; 6;
<a name="l02843"></a>02843     req.<a class="code" href="struct_f_t___size___request_rec__.html#a3a85704d13561d9db53aa60f7805ec73">horiResolution</a> = 0;
<a name="l02844"></a>02844     req.<a class="code" href="struct_f_t___size___request_rec__.html#a86601c38d91064b6efe256a9e99c56f4">vertResolution</a> = 0;
<a name="l02845"></a>02845 
<a name="l02846"></a>02846     <span class="keywordflow">return</span> <a class="code" href="freetype_8h.html#a75025f51e4cbb8a95a9b97ab35d481e0">FT_Request_Size</a>( face, &amp;req );
<a name="l02847"></a>02847   }
<a name="l02848"></a>02848 
<a name="l02849"></a>02849 
<a name="l02850"></a>02850   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02851"></a>02851 
<a name="l02852"></a>02852   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02853"></a><a class="code" href="ftobjs_8c.html#ac577d98c18789a0d558d2b2f9fadbbf1">02853</a>   <a class="code" href="freetype_8h.html#ac577d98c18789a0d558d2b2f9fadbbf1">FT_Get_Kerning</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>     face,
<a name="l02854"></a>02854                   <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     left_glyph,
<a name="l02855"></a>02855                   <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     right_glyph,
<a name="l02856"></a>02856                   <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     kern_mode,
<a name="l02857"></a>02857                   <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>  *akerning )
<a name="l02858"></a>02858   {
<a name="l02859"></a>02859     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error = FT_Err_Ok;
<a name="l02860"></a>02860     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>  driver;
<a name="l02861"></a>02861 
<a name="l02862"></a>02862 
<a name="l02863"></a>02863     <span class="keywordflow">if</span> ( !face )
<a name="l02864"></a>02864       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l02865"></a>02865 
<a name="l02866"></a>02866     <span class="keywordflow">if</span> ( !akerning )
<a name="l02867"></a>02867       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l02868"></a>02868 
<a name="l02869"></a>02869     driver = face-&gt;driver;
<a name="l02870"></a>02870 
<a name="l02871"></a>02871     akerning-&gt;x = 0;
<a name="l02872"></a>02872     akerning-&gt;y = 0;
<a name="l02873"></a>02873 
<a name="l02874"></a>02874     <span class="keywordflow">if</span> ( driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a398395bfdbef65a8d531724d200ed91c">get_kerning</a> )
<a name="l02875"></a>02875     {
<a name="l02876"></a>02876       error = driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a398395bfdbef65a8d531724d200ed91c">get_kerning</a>( face,
<a name="l02877"></a>02877                                           left_glyph,
<a name="l02878"></a>02878                                           right_glyph,
<a name="l02879"></a>02879                                           akerning );
<a name="l02880"></a>02880       <span class="keywordflow">if</span> ( !error )
<a name="l02881"></a>02881       {
<a name="l02882"></a>02882         <span class="keywordflow">if</span> ( kern_mode != <a class="code" href="freetype_8h.html#acbb61a5f72b8a29ffe8cd98c715c7e4fa8fbe3d85d409a9f87c1b1f829e6105b9">FT_KERNING_UNSCALED</a> )
<a name="l02883"></a>02883         {
<a name="l02884"></a>02884           akerning-&gt;x = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( akerning-&gt;x, face-&gt;size-&gt;metrics.x_scale );
<a name="l02885"></a>02885           akerning-&gt;y = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( akerning-&gt;y, face-&gt;size-&gt;metrics.y_scale );
<a name="l02886"></a>02886 
<a name="l02887"></a>02887           <span class="keywordflow">if</span> ( kern_mode != <a class="code" href="freetype_8h.html#acbb61a5f72b8a29ffe8cd98c715c7e4fa11fe06da115eeae2d06cf219b01a46e6">FT_KERNING_UNFITTED</a> )
<a name="l02888"></a>02888           {
<a name="l02889"></a>02889             <span class="comment">/* we scale down kerning values for small ppem values */</span>
<a name="l02890"></a>02890             <span class="comment">/* to avoid that rounding makes them too big.         */</span>
<a name="l02891"></a>02891             <span class="comment">/* `25&#39; has been determined heuristically.            */</span>
<a name="l02892"></a>02892             <span class="keywordflow">if</span> ( face-&gt;size-&gt;metrics.x_ppem &lt; 25 )
<a name="l02893"></a>02893               akerning-&gt;x = <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( akerning-&gt;x,
<a name="l02894"></a>02894                                        face-&gt;size-&gt;metrics.x_ppem, 25 );
<a name="l02895"></a>02895             <span class="keywordflow">if</span> ( face-&gt;size-&gt;metrics.y_ppem &lt; 25 )
<a name="l02896"></a>02896               akerning-&gt;y = <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( akerning-&gt;y,
<a name="l02897"></a>02897                                        face-&gt;size-&gt;metrics.y_ppem, 25 );
<a name="l02898"></a>02898 
<a name="l02899"></a>02899             akerning-&gt;x = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( akerning-&gt;x );
<a name="l02900"></a>02900             akerning-&gt;y = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( akerning-&gt;y );
<a name="l02901"></a>02901           }
<a name="l02902"></a>02902         }
<a name="l02903"></a>02903       }
<a name="l02904"></a>02904     }
<a name="l02905"></a>02905 
<a name="l02906"></a>02906     <span class="keywordflow">return</span> error;
<a name="l02907"></a>02907   }
<a name="l02908"></a>02908 
<a name="l02909"></a>02909 
<a name="l02910"></a>02910   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02911"></a>02911 
<a name="l02912"></a>02912   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02913"></a><a class="code" href="ftobjs_8c.html#abeed63d063fd24dc5374039da3f745bf">02913</a>   <a class="code" href="freetype_8h.html#abeed63d063fd24dc5374039da3f745bf">FT_Get_Track_Kerning</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    face,
<a name="l02914"></a>02914                         <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>   point_size,
<a name="l02915"></a>02915                         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     degree,
<a name="l02916"></a>02916                         <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>*  akerning )
<a name="l02917"></a>02917   {
<a name="l02918"></a>02918     FT_Service_Kerning  service;
<a name="l02919"></a>02919     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>            error = FT_Err_Ok;
<a name="l02920"></a>02920 
<a name="l02921"></a>02921 
<a name="l02922"></a>02922     <span class="keywordflow">if</span> ( !face )
<a name="l02923"></a>02923       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l02924"></a>02924 
<a name="l02925"></a>02925     <span class="keywordflow">if</span> ( !akerning )
<a name="l02926"></a>02926       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l02927"></a>02927 
<a name="l02928"></a>02928     <a class="code" href="ftserv_8h.html#ad47fb84d86812f286123ea4e39c466ed">FT_FACE_FIND_SERVICE</a>( face, service, KERNING );
<a name="l02929"></a>02929     <span class="keywordflow">if</span> ( !service )
<a name="l02930"></a>02930       <span class="keywordflow">return</span> FT_Err_Unimplemented_Feature;
<a name="l02931"></a>02931 
<a name="l02932"></a>02932     error = service-&gt;get_track( face,
<a name="l02933"></a>02933                                 point_size,
<a name="l02934"></a>02934                                 degree,
<a name="l02935"></a>02935                                 akerning );
<a name="l02936"></a>02936 
<a name="l02937"></a>02937     <span class="keywordflow">return</span> error;
<a name="l02938"></a>02938   }
<a name="l02939"></a>02939 
<a name="l02940"></a>02940 
<a name="l02941"></a>02941   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02942"></a>02942 
<a name="l02943"></a>02943   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02944"></a><a class="code" href="ftobjs_8c.html#a5ccc241b34958a2b8818bb8b663b393f">02944</a>   <a class="code" href="freetype_8h.html#a5ccc241b34958a2b8818bb8b663b393f">FT_Select_Charmap</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>      face,
<a name="l02945"></a>02945                      <a class="code" href="freetype_8h.html#a2c7f8d9834bb770d792cd8e0079f6835">FT_Encoding</a>  encoding )
<a name="l02946"></a>02946   {
<a name="l02947"></a>02947     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>*  cur;
<a name="l02948"></a>02948     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>*  limit;
<a name="l02949"></a>02949 
<a name="l02950"></a>02950 
<a name="l02951"></a>02951     <span class="keywordflow">if</span> ( !face )
<a name="l02952"></a>02952       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l02953"></a>02953 
<a name="l02954"></a>02954     <span class="keywordflow">if</span> ( encoding == FT_ENCODING_NONE )
<a name="l02955"></a>02955       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l02956"></a>02956 
<a name="l02957"></a>02957     <span class="comment">/* FT_ENCODING_UNICODE is special.  We try to find the `best&#39; Unicode */</span>
<a name="l02958"></a>02958     <span class="comment">/* charmap available, i.e., one with UCS-4 characters, if possible.   */</span>
<a name="l02959"></a>02959     <span class="comment">/*                                                                    */</span>
<a name="l02960"></a>02960     <span class="comment">/* This is done by find_unicode_charmap() above, to share code.       */</span>
<a name="l02961"></a>02961     <span class="keywordflow">if</span> ( encoding == FT_ENCODING_UNICODE )
<a name="l02962"></a>02962       <span class="keywordflow">return</span> find_unicode_charmap( face );
<a name="l02963"></a>02963 
<a name="l02964"></a>02964     cur = face-&gt;charmaps;
<a name="l02965"></a>02965     <span class="keywordflow">if</span> ( !cur )
<a name="l02966"></a>02966       <span class="keywordflow">return</span> FT_Err_Invalid_CharMap_Handle;
<a name="l02967"></a>02967 
<a name="l02968"></a>02968     limit = cur + face-&gt;num_charmaps;
<a name="l02969"></a>02969 
<a name="l02970"></a>02970     <span class="keywordflow">for</span> ( ; cur &lt; limit; cur++ )
<a name="l02971"></a>02971     {
<a name="l02972"></a>02972       <span class="keywordflow">if</span> ( cur[0]-&gt;encoding == encoding )
<a name="l02973"></a>02973       {
<a name="l02974"></a>02974 <span class="preprocessor">#ifdef FT_MAX_CHARMAP_CACHEABLE</span>
<a name="l02975"></a>02975 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( cur - face-&gt;charmaps &gt; <a class="code" href="ftoption_8h.html#ad83d239e848a53ce9ff244ccfeb5e408">FT_MAX_CHARMAP_CACHEABLE</a> )
<a name="l02976"></a>02976         {
<a name="l02977"></a>02977           <a class="code" href="ftdebug_8h.html#a311092b5a8fece0a17cfb5b2d874e25d">FT_ERROR</a>(( <span class="stringliteral">&quot;FT_Select_Charmap: requested charmap is found (%d), &quot;</span>
<a name="l02978"></a>02978                      <span class="stringliteral">&quot;but in too late position to cache\n&quot;</span>,
<a name="l02979"></a>02979                      cur - face-&gt;charmaps ));
<a name="l02980"></a>02980           <span class="keywordflow">continue</span>;
<a name="l02981"></a>02981         }
<a name="l02982"></a>02982 <span class="preprocessor">#endif</span>
<a name="l02983"></a>02983 <span class="preprocessor"></span>        face-&gt;charmap = cur[0];
<a name="l02984"></a>02984         <span class="keywordflow">return</span> 0;
<a name="l02985"></a>02985       }
<a name="l02986"></a>02986     }
<a name="l02987"></a>02987 
<a name="l02988"></a>02988     <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l02989"></a>02989   }
<a name="l02990"></a>02990 
<a name="l02991"></a>02991 
<a name="l02992"></a>02992   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l02993"></a>02993 
<a name="l02994"></a>02994   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l02995"></a><a class="code" href="ftobjs_8c.html#a9208d1ccf0f8ad9a122fd6c9fe0c5b45">02995</a>   <a class="code" href="freetype_8h.html#a9208d1ccf0f8ad9a122fd6c9fe0c5b45">FT_Set_Charmap</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>     face,
<a name="l02996"></a>02996                   <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  charmap )
<a name="l02997"></a>02997   {
<a name="l02998"></a>02998     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>*  cur;
<a name="l02999"></a>02999     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>*  limit;
<a name="l03000"></a>03000 
<a name="l03001"></a>03001 
<a name="l03002"></a>03002     <span class="keywordflow">if</span> ( !face )
<a name="l03003"></a>03003       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l03004"></a>03004 
<a name="l03005"></a>03005     cur = face-&gt;charmaps;
<a name="l03006"></a>03006     <span class="keywordflow">if</span> ( !cur )
<a name="l03007"></a>03007       <span class="keywordflow">return</span> FT_Err_Invalid_CharMap_Handle;
<a name="l03008"></a>03008     <span class="keywordflow">if</span> ( <a class="code" href="tttables_8h.html#a9a4db80b4f71d00e28474cbfcf968614">FT_Get_CMap_Format</a>( charmap ) == 14 )
<a name="l03009"></a>03009       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l03010"></a>03010 
<a name="l03011"></a>03011     limit = cur + face-&gt;num_charmaps;
<a name="l03012"></a>03012 
<a name="l03013"></a>03013     <span class="keywordflow">for</span> ( ; cur &lt; limit; cur++ )
<a name="l03014"></a>03014     {
<a name="l03015"></a>03015       <span class="keywordflow">if</span> ( cur[0] == charmap )
<a name="l03016"></a>03016       {
<a name="l03017"></a>03017 <span class="preprocessor">#ifdef FT_MAX_CHARMAP_CACHEABLE</span>
<a name="l03018"></a>03018 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( cur - face-&gt;charmaps &gt; <a class="code" href="ftoption_8h.html#ad83d239e848a53ce9ff244ccfeb5e408">FT_MAX_CHARMAP_CACHEABLE</a> )
<a name="l03019"></a>03019         {
<a name="l03020"></a>03020           <a class="code" href="ftdebug_8h.html#a311092b5a8fece0a17cfb5b2d874e25d">FT_ERROR</a>(( <span class="stringliteral">&quot;FT_Set_Charmap: requested charmap is found (%d), &quot;</span>
<a name="l03021"></a>03021                      <span class="stringliteral">&quot;but in too late position to cache\n&quot;</span>,
<a name="l03022"></a>03022                      cur - face-&gt;charmaps ));
<a name="l03023"></a>03023           <span class="keywordflow">continue</span>;
<a name="l03024"></a>03024         }
<a name="l03025"></a>03025 <span class="preprocessor">#endif</span>
<a name="l03026"></a>03026 <span class="preprocessor"></span>        face-&gt;charmap = cur[0];
<a name="l03027"></a>03027         <span class="keywordflow">return</span> 0;
<a name="l03028"></a>03028       }
<a name="l03029"></a>03029     }
<a name="l03030"></a>03030     <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l03031"></a>03031   }
<a name="l03032"></a>03032 
<a name="l03033"></a>03033 
<a name="l03034"></a>03034   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03035"></a>03035 
<a name="l03036"></a>03036   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a> )
<a name="l03037"></a><a class="code" href="ftobjs_8c.html#a91dba3ac464a579dc5149c7cfc6f02e1">03037</a>   <a class="code" href="freetype_8h.html#a91dba3ac464a579dc5149c7cfc6f02e1">FT_Get_Charmap_Index</a>( <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  charmap )
<a name="l03038"></a>03038   {
<a name="l03039"></a>03039     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  i;
<a name="l03040"></a>03040 
<a name="l03041"></a>03041 
<a name="l03042"></a>03042     <span class="keywordflow">if</span> ( !charmap || !charmap-&gt;face )
<a name="l03043"></a>03043       <span class="keywordflow">return</span> -1;
<a name="l03044"></a>03044 
<a name="l03045"></a>03045     <span class="keywordflow">for</span> ( i = 0; i &lt; charmap-&gt;face-&gt;num_charmaps; i++ )
<a name="l03046"></a>03046       <span class="keywordflow">if</span> ( charmap-&gt;face-&gt;charmaps[i] == charmap )
<a name="l03047"></a>03047         <span class="keywordflow">break</span>;
<a name="l03048"></a>03048 
<a name="l03049"></a>03049     <a class="code" href="ftdebug_8h.html#a0edcd80581eabc970a562c5d284d5e7e">FT_ASSERT</a>( i &lt; charmap-&gt;face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a> );
<a name="l03050"></a>03050 
<a name="l03051"></a>03051 <span class="preprocessor">#ifdef FT_MAX_CHARMAP_CACHEABLE</span>
<a name="l03052"></a>03052 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( i &gt; <a class="code" href="ftoption_8h.html#ad83d239e848a53ce9ff244ccfeb5e408">FT_MAX_CHARMAP_CACHEABLE</a> )
<a name="l03053"></a>03053     {
<a name="l03054"></a>03054       <a class="code" href="ftdebug_8h.html#a311092b5a8fece0a17cfb5b2d874e25d">FT_ERROR</a>(( <span class="stringliteral">&quot;FT_Get_Charmap_Index: requested charmap is found (%d), &quot;</span>
<a name="l03055"></a>03055                  <span class="stringliteral">&quot;but in too late position to cache\n&quot;</span>,
<a name="l03056"></a>03056                  i ));
<a name="l03057"></a>03057       <span class="keywordflow">return</span> -i;
<a name="l03058"></a>03058     }
<a name="l03059"></a>03059 <span class="preprocessor">#endif</span>
<a name="l03060"></a>03060 <span class="preprocessor"></span>    <span class="keywordflow">return</span> i;
<a name="l03061"></a>03061   }
<a name="l03062"></a>03062 
<a name="l03063"></a>03063 
<a name="l03064"></a>03064   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03065"></a>03065   ft_cmap_done_internal( <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>  cmap )
<a name="l03066"></a>03066   {
<a name="l03067"></a>03067     <a class="code" href="struct_f_t___c_map___class_rec__.html">FT_CMap_Class</a>  clazz  = cmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#aa85db42650df0edb38f8af5887c0ac6a">clazz</a>;
<a name="l03068"></a>03068     <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>        face   = cmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#a39fa6de9995d4ae4496b93e2b874b34e">charmap</a>.<a class="code" href="struct_f_t___char_map_rec__.html#a70a4e53e3f9818209916e5745c46dc28">face</a>;
<a name="l03069"></a>03069     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>      memory = <a class="code" href="ftobjs_8h.html#a901bd8bdda45194f96f942684bc02510">FT_FACE_MEMORY</a>(face);
<a name="l03070"></a>03070 
<a name="l03071"></a>03071 
<a name="l03072"></a>03072     <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#a00d1d77a4d926340b4d97bc03cd29231">done</a> )
<a name="l03073"></a>03073       clazz-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#a00d1d77a4d926340b4d97bc03cd29231">done</a>( cmap );
<a name="l03074"></a>03074 
<a name="l03075"></a>03075     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( cmap );
<a name="l03076"></a>03076   }
<a name="l03077"></a>03077 
<a name="l03078"></a>03078 
<a name="l03079"></a>03079   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keywordtype">void</span> )
<a name="l03080"></a><a class="code" href="ftobjs_8c.html#a6b28a33ad0a6cfe26f0d33a896f10477">03080</a>   <a class="code" href="ftobjs_8h.html#a6b28a33ad0a6cfe26f0d33a896f10477">FT_CMap_Done</a>( <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>  cmap )
<a name="l03081"></a>03081   {
<a name="l03082"></a>03082     <span class="keywordflow">if</span> ( cmap )
<a name="l03083"></a>03083     {
<a name="l03084"></a>03084       <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    face   = cmap-&gt;<a class="code" href="struct_f_t___face_rec__.html#aca87d50488a5a1489741e8c13414c268">charmap</a>.<a class="code" href="struct_f_t___char_map_rec__.html#a70a4e53e3f9818209916e5745c46dc28">face</a>;
<a name="l03085"></a>03085       <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = <a class="code" href="ftobjs_8h.html#a901bd8bdda45194f96f942684bc02510">FT_FACE_MEMORY</a>( face );
<a name="l03086"></a>03086       <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l03087"></a>03087       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     i, j;
<a name="l03088"></a>03088 
<a name="l03089"></a>03089 
<a name="l03090"></a>03090       <span class="keywordflow">for</span> ( i = 0; i &lt; face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>; i++ )
<a name="l03091"></a>03091       {
<a name="l03092"></a>03092         <span class="keywordflow">if</span> ( (<a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>)face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>[i] == cmap )
<a name="l03093"></a>03093         {
<a name="l03094"></a>03094           <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  last_charmap = face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>[face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a> - 1];
<a name="l03095"></a>03095 
<a name="l03096"></a>03096 
<a name="l03097"></a>03097           <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#aab298dbcbacc1226f0e5da43ad91e834">FT_RENEW_ARRAY</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>,
<a name="l03098"></a>03098                                face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>,
<a name="l03099"></a>03099                                face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a> - 1 ) )
<a name="l03100"></a>03100             <span class="keywordflow">return</span>;
<a name="l03101"></a>03101 
<a name="l03102"></a>03102           <span class="comment">/* remove it from our list of charmaps */</span>
<a name="l03103"></a>03103           <span class="keywordflow">for</span> ( j = i + 1; j &lt; face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>; j++ )
<a name="l03104"></a>03104           {
<a name="l03105"></a>03105             <span class="keywordflow">if</span> ( j == face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a> - 1 )
<a name="l03106"></a>03106               face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>[j - 1] = last_charmap;
<a name="l03107"></a>03107             <span class="keywordflow">else</span>
<a name="l03108"></a>03108               face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>[j - 1] = face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>[j];
<a name="l03109"></a>03109           }
<a name="l03110"></a>03110 
<a name="l03111"></a>03111           face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>--;
<a name="l03112"></a>03112 
<a name="l03113"></a>03113           <span class="keywordflow">if</span> ( (<a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>)face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aca87d50488a5a1489741e8c13414c268">charmap</a> == cmap )
<a name="l03114"></a>03114             face-&gt;<a class="code" href="struct_f_t___face_rec__.html#aca87d50488a5a1489741e8c13414c268">charmap</a> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03115"></a>03115 
<a name="l03116"></a>03116           ft_cmap_done_internal( cmap );
<a name="l03117"></a>03117 
<a name="l03118"></a>03118           <span class="keywordflow">break</span>;
<a name="l03119"></a>03119         }
<a name="l03120"></a>03120       }
<a name="l03121"></a>03121     }
<a name="l03122"></a>03122   }
<a name="l03123"></a>03123 
<a name="l03124"></a>03124 
<a name="l03125"></a>03125   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l03126"></a><a class="code" href="ftobjs_8c.html#a951ef5b2f18dc022f7524a2c4d209b99">03126</a>   <a class="code" href="ftobjs_8h.html#a951ef5b2f18dc022f7524a2c4d209b99">FT_CMap_New</a>( <a class="code" href="struct_f_t___c_map___class_rec__.html">FT_CMap_Class</a>  clazz,
<a name="l03127"></a>03127                <a class="code" href="fttypes_8h.html#a00f9e6a0ddd7bc55f79b2f4b5b867266">FT_Pointer</a>     init_data,
<a name="l03128"></a>03128                <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>     charmap,
<a name="l03129"></a>03129                <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>       *acmap )
<a name="l03130"></a>03130   {
<a name="l03131"></a>03131     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error = FT_Err_Ok;
<a name="l03132"></a>03132     <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    face;
<a name="l03133"></a>03133     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory;
<a name="l03134"></a>03134     <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>    cmap;
<a name="l03135"></a>03135 
<a name="l03136"></a>03136 
<a name="l03137"></a>03137     <span class="keywordflow">if</span> ( clazz == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || charmap == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || charmap-&gt;face == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03138"></a>03138       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l03139"></a>03139 
<a name="l03140"></a>03140     face   = charmap-&gt;face;
<a name="l03141"></a>03141     memory = <a class="code" href="ftobjs_8h.html#a901bd8bdda45194f96f942684bc02510">FT_FACE_MEMORY</a>( face );
<a name="l03142"></a>03142 
<a name="l03143"></a>03143     <span class="keywordflow">if</span> ( !<a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( cmap, clazz-&gt;size ) )
<a name="l03144"></a>03144     {
<a name="l03145"></a>03145       cmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#a39fa6de9995d4ae4496b93e2b874b34e">charmap</a> = *charmap;
<a name="l03146"></a>03146       cmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#aa85db42650df0edb38f8af5887c0ac6a">clazz</a>   = clazz;
<a name="l03147"></a>03147 
<a name="l03148"></a>03148       <span class="keywordflow">if</span> ( clazz-&gt;init )
<a name="l03149"></a>03149       {
<a name="l03150"></a>03150         error = clazz-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#afe1da0877ec0686dfe7b2e020fc0d408">init</a>( cmap, init_data );
<a name="l03151"></a>03151         <span class="keywordflow">if</span> ( error )
<a name="l03152"></a>03152           <span class="keywordflow">goto</span> Fail;
<a name="l03153"></a>03153       }
<a name="l03154"></a>03154 
<a name="l03155"></a>03155       <span class="comment">/* add it to our list of charmaps */</span>
<a name="l03156"></a>03156       <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#aab298dbcbacc1226f0e5da43ad91e834">FT_RENEW_ARRAY</a>( face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>,
<a name="l03157"></a>03157                            face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>,
<a name="l03158"></a>03158                            face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a> + 1 ) )
<a name="l03159"></a>03159         <span class="keywordflow">goto</span> Fail;
<a name="l03160"></a>03160 
<a name="l03161"></a>03161       face-&gt;<a class="code" href="struct_f_t___face_rec__.html#ab629e1bee5ddf3a90997d66751e6dfe0">charmaps</a>[face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a6b953f00e56d508611bb94af85b6d84b">num_charmaps</a>++] = (<a class="code" href="freetype_8h.html#afc4717ddfd456a38ee15ec9c88fc7dac">FT_CharMap</a>)cmap;
<a name="l03162"></a>03162     }
<a name="l03163"></a>03163 
<a name="l03164"></a>03164   Exit:
<a name="l03165"></a>03165     <span class="keywordflow">if</span> ( acmap )
<a name="l03166"></a>03166       *acmap = cmap;
<a name="l03167"></a>03167 
<a name="l03168"></a>03168     <span class="keywordflow">return</span> error;
<a name="l03169"></a>03169 
<a name="l03170"></a>03170   Fail:
<a name="l03171"></a>03171     ft_cmap_done_internal( cmap );
<a name="l03172"></a>03172     cmap = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03173"></a>03173     <span class="keywordflow">goto</span> Exit;
<a name="l03174"></a>03174   }
<a name="l03175"></a>03175 
<a name="l03176"></a>03176 
<a name="l03177"></a>03177   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03178"></a>03178 
<a name="l03179"></a>03179   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a> )
<a name="l03180"></a><a class="code" href="ftobjs_8c.html#a529192ba5290936f21b63f257bf42bdd">03180</a>   <a class="code" href="freetype_8h.html#a529192ba5290936f21b63f257bf42bdd">FT_Get_Char_Index</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l03181"></a>03181                      <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  charcode )
<a name="l03182"></a>03182   {
<a name="l03183"></a>03183     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = 0;
<a name="l03184"></a>03184 
<a name="l03185"></a>03185 
<a name="l03186"></a>03186     <span class="keywordflow">if</span> ( face &amp;&amp; face-&gt;charmap )
<a name="l03187"></a>03187     {
<a name="l03188"></a>03188       <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>  cmap = <a class="code" href="ftobjs_8h.html#ab0954b1eab39629f00cf75f3e1ccc86d">FT_CMAP</a>( face-&gt;charmap );
<a name="l03189"></a>03189 
<a name="l03190"></a>03190 
<a name="l03191"></a>03191       <span class="keywordflow">if</span> ( charcode &gt; 0xFFFFFFFFUL )
<a name="l03192"></a>03192       {
<a name="l03193"></a>03193         <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot;FT_Get_Char_Index: too large charcode&quot;</span> ));
<a name="l03194"></a>03194         <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot; 0x%x is truncated\n&quot;</span>, charcode ));
<a name="l03195"></a>03195       }
<a name="l03196"></a>03196       result = cmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#aa85db42650df0edb38f8af5887c0ac6a">clazz</a>-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#ad1c0448188e8d52f6159b5521bb2dc83">char_index</a>( cmap, (FT_UInt32)charcode );
<a name="l03197"></a>03197     }
<a name="l03198"></a>03198     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03199"></a>03199   }
<a name="l03200"></a>03200 
<a name="l03201"></a>03201 
<a name="l03202"></a>03202   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03203"></a>03203 
<a name="l03204"></a>03204   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a> )
<a name="l03205"></a><a class="code" href="ftobjs_8c.html#a2e6870abd05ffbf08632dd5416d3093d">03205</a>   <a class="code" href="freetype_8h.html#a2e6870abd05ffbf08632dd5416d3093d">FT_Get_First_Char</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l03206"></a>03206                      <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  *agindex )
<a name="l03207"></a>03207   {
<a name="l03208"></a>03208     <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = 0;
<a name="l03209"></a>03209     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>   gindex = 0;
<a name="l03210"></a>03210 
<a name="l03211"></a>03211 
<a name="l03212"></a>03212     <span class="keywordflow">if</span> ( face &amp;&amp; face-&gt;charmap &amp;&amp; face-&gt;num_glyphs )
<a name="l03213"></a>03213     {
<a name="l03214"></a>03214       gindex = <a class="code" href="freetype_8h.html#a529192ba5290936f21b63f257bf42bdd">FT_Get_Char_Index</a>( face, 0 );
<a name="l03215"></a>03215       <span class="keywordflow">if</span> ( gindex == 0 || gindex &gt;= (<a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>)face-&gt;num_glyphs )
<a name="l03216"></a>03216         result = <a class="code" href="freetype_8h.html#a8c31d0c4f4497219e2de4c9946dbe791">FT_Get_Next_Char</a>( face, 0, &amp;gindex );
<a name="l03217"></a>03217     }
<a name="l03218"></a>03218 
<a name="l03219"></a>03219     <span class="keywordflow">if</span> ( agindex )
<a name="l03220"></a>03220       *agindex = gindex;
<a name="l03221"></a>03221 
<a name="l03222"></a>03222     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03223"></a>03223   }
<a name="l03224"></a>03224 
<a name="l03225"></a>03225 
<a name="l03226"></a>03226   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03227"></a>03227 
<a name="l03228"></a>03228   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a> )
<a name="l03229"></a><a class="code" href="ftobjs_8c.html#a04a3c0f5b4a05b4dffd3aa607363ef04">03229</a>   <a class="code" href="freetype_8h.html#a8c31d0c4f4497219e2de4c9946dbe791">FT_Get_Next_Char</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l03230"></a>03230                     <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  charcode,
<a name="l03231"></a>03231                     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  *agindex )
<a name="l03232"></a>03232   {
<a name="l03233"></a>03233     <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = 0;
<a name="l03234"></a>03234     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>   gindex = 0;
<a name="l03235"></a>03235 
<a name="l03236"></a>03236 
<a name="l03237"></a>03237     <span class="keywordflow">if</span> ( face &amp;&amp; face-&gt;charmap &amp;&amp; face-&gt;num_glyphs )
<a name="l03238"></a>03238     {
<a name="l03239"></a>03239       FT_UInt32  <a class="code" href="structcode.html">code</a> = (FT_UInt32)charcode;
<a name="l03240"></a>03240       <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>    cmap = <a class="code" href="ftobjs_8h.html#ab0954b1eab39629f00cf75f3e1ccc86d">FT_CMAP</a>( face-&gt;charmap );
<a name="l03241"></a>03241 
<a name="l03242"></a>03242 
<a name="l03243"></a>03243       <span class="keywordflow">do</span> {
<a name="l03244"></a>03244         gindex = cmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#aa85db42650df0edb38f8af5887c0ac6a">clazz</a>-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#a053362f31fcfbc6a284cc8d026ab57ff">char_next</a>( cmap, &amp;code );
<a name="l03245"></a>03245       } <span class="keywordflow">while</span> ( gindex &gt;= (<a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>)face-&gt;num_glyphs );
<a name="l03246"></a>03246 
<a name="l03247"></a>03247       result = ( gindex == 0 ) ? 0 : code;
<a name="l03248"></a>03248     }
<a name="l03249"></a>03249 
<a name="l03250"></a>03250     <span class="keywordflow">if</span> ( agindex )
<a name="l03251"></a>03251       *agindex = gindex;
<a name="l03252"></a>03252 
<a name="l03253"></a>03253     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03254"></a>03254   }
<a name="l03255"></a>03255 
<a name="l03256"></a>03256 
<a name="l03257"></a>03257   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03258"></a>03258 
<a name="l03259"></a>03259   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a> )
<a name="l03260"></a><a class="code" href="ftobjs_8c.html#a89c451544c779bb6cd84a7fb45a6e8a4">03260</a>   <a class="code" href="freetype_8h.html#a89c451544c779bb6cd84a7fb45a6e8a4">FT_Face_GetCharVariantIndex</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l03261"></a>03261                                <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  charcode,
<a name="l03262"></a>03262                                <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  variantSelector )
<a name="l03263"></a>03263   {
<a name="l03264"></a>03264     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = 0;
<a name="l03265"></a>03265 
<a name="l03266"></a>03266 
<a name="l03267"></a>03267     <span class="keywordflow">if</span> ( face &amp;&amp; face-&gt;charmap &amp;&amp;
<a name="l03268"></a>03268         face-&gt;charmap-&gt;encoding == FT_ENCODING_UNICODE )
<a name="l03269"></a>03269     {
<a name="l03270"></a>03270       <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  charmap = find_variant_selector_charmap( face );
<a name="l03271"></a>03271       <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>     ucmap = <a class="code" href="ftobjs_8h.html#ab0954b1eab39629f00cf75f3e1ccc86d">FT_CMAP</a>( face-&gt;charmap );
<a name="l03272"></a>03272 
<a name="l03273"></a>03273 
<a name="l03274"></a>03274       <span class="keywordflow">if</span> ( charmap != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03275"></a>03275       {
<a name="l03276"></a>03276         <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>  vcmap = <a class="code" href="ftobjs_8h.html#ab0954b1eab39629f00cf75f3e1ccc86d">FT_CMAP</a>( charmap );
<a name="l03277"></a>03277 
<a name="l03278"></a>03278 
<a name="l03279"></a>03279         <span class="keywordflow">if</span> ( charcode &gt; 0xFFFFFFFFUL )
<a name="l03280"></a>03280         {
<a name="l03281"></a>03281           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot;FT_Get_Char_Index: too large charcode&quot;</span> ));
<a name="l03282"></a>03282           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot; 0x%x is truncated\n&quot;</span>, charcode ));
<a name="l03283"></a>03283         }
<a name="l03284"></a>03284         <span class="keywordflow">if</span> ( variantSelector &gt; 0xFFFFFFFFUL )
<a name="l03285"></a>03285         {
<a name="l03286"></a>03286           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot;FT_Get_Char_Index: too large variantSelector&quot;</span> ));
<a name="l03287"></a>03287           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot; 0x%x is truncated\n&quot;</span>, variantSelector ));
<a name="l03288"></a>03288         }
<a name="l03289"></a>03289 
<a name="l03290"></a>03290         result = vcmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#aa85db42650df0edb38f8af5887c0ac6a">clazz</a>-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#a6bc46e2595aec30295e6d2bfc362afcb">char_var_index</a>( vcmap, ucmap,
<a name="l03291"></a>03291                                                (FT_UInt32)charcode,
<a name="l03292"></a>03292                                                (FT_UInt32)variantSelector );
<a name="l03293"></a>03293       }
<a name="l03294"></a>03294     }
<a name="l03295"></a>03295 
<a name="l03296"></a>03296     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03297"></a>03297   }
<a name="l03298"></a>03298 
<a name="l03299"></a>03299 
<a name="l03300"></a>03300   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03301"></a>03301 
<a name="l03302"></a>03302   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a> )
<a name="l03303"></a><a class="code" href="ftobjs_8c.html#adf8df0c68ce60f847a1e593918118f7b">03303</a>   <a class="code" href="freetype_8h.html#adf8df0c68ce60f847a1e593918118f7b">FT_Face_GetCharVariantIsDefault</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l03304"></a>03304                                    <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  charcode,
<a name="l03305"></a>03305                                    <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  variantSelector )
<a name="l03306"></a>03306   {
<a name="l03307"></a>03307     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = -1;
<a name="l03308"></a>03308 
<a name="l03309"></a>03309 
<a name="l03310"></a>03310     <span class="keywordflow">if</span> ( face )
<a name="l03311"></a>03311     {
<a name="l03312"></a>03312       <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  charmap = find_variant_selector_charmap( face );
<a name="l03313"></a>03313 
<a name="l03314"></a>03314 
<a name="l03315"></a>03315       <span class="keywordflow">if</span> ( charmap != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03316"></a>03316       {
<a name="l03317"></a>03317         <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>  vcmap = <a class="code" href="ftobjs_8h.html#ab0954b1eab39629f00cf75f3e1ccc86d">FT_CMAP</a>( charmap );
<a name="l03318"></a>03318 
<a name="l03319"></a>03319 
<a name="l03320"></a>03320         <span class="keywordflow">if</span> ( charcode &gt; 0xFFFFFFFFUL )
<a name="l03321"></a>03321         {
<a name="l03322"></a>03322           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot;FT_Get_Char_Index: too large charcode&quot;</span> ));
<a name="l03323"></a>03323           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot; 0x%x is truncated\n&quot;</span>, charcode ));
<a name="l03324"></a>03324         }
<a name="l03325"></a>03325         <span class="keywordflow">if</span> ( variantSelector &gt; 0xFFFFFFFFUL )
<a name="l03326"></a>03326         {
<a name="l03327"></a>03327           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot;FT_Get_Char_Index: too large variantSelector&quot;</span> ));
<a name="l03328"></a>03328           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot; 0x%x is truncated\n&quot;</span>, variantSelector ));
<a name="l03329"></a>03329         }
<a name="l03330"></a>03330 
<a name="l03331"></a>03331         result = vcmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#aa85db42650df0edb38f8af5887c0ac6a">clazz</a>-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#ac8305cb0aebd02b54c0046765f28ef4a">char_var_default</a>( vcmap,
<a name="l03332"></a>03332                                                  (FT_UInt32)charcode,
<a name="l03333"></a>03333                                                  (FT_UInt32)variantSelector );
<a name="l03334"></a>03334       }
<a name="l03335"></a>03335     }
<a name="l03336"></a>03336 
<a name="l03337"></a>03337     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03338"></a>03338   }
<a name="l03339"></a>03339 
<a name="l03340"></a>03340 
<a name="l03341"></a>03341   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03342"></a>03342 
<a name="l03343"></a>03343   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( FT_UInt32* )
<a name="l03344"></a><a class="code" href="ftobjs_8c.html#a156a71f0dc04b2041e73c300855d9158">03344</a>   <a class="code" href="freetype_8h.html#a156a71f0dc04b2041e73c300855d9158">FT_Face_GetVariantSelectors</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>  face )
<a name="l03345"></a>03345   {
<a name="l03346"></a>03346     FT_UInt32  *<a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03347"></a>03347 
<a name="l03348"></a>03348 
<a name="l03349"></a>03349     <span class="keywordflow">if</span> ( face )
<a name="l03350"></a>03350     {
<a name="l03351"></a>03351       <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  charmap = find_variant_selector_charmap( face );
<a name="l03352"></a>03352 
<a name="l03353"></a>03353 
<a name="l03354"></a>03354       <span class="keywordflow">if</span> ( charmap != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03355"></a>03355       {
<a name="l03356"></a>03356         <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>    vcmap  = <a class="code" href="ftobjs_8h.html#ab0954b1eab39629f00cf75f3e1ccc86d">FT_CMAP</a>( charmap );
<a name="l03357"></a>03357         <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = <a class="code" href="ftobjs_8h.html#a901bd8bdda45194f96f942684bc02510">FT_FACE_MEMORY</a>( face );
<a name="l03358"></a>03358 
<a name="l03359"></a>03359 
<a name="l03360"></a>03360         result = vcmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#aa85db42650df0edb38f8af5887c0ac6a">clazz</a>-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#ad61635444cbfc71c4259e74cb892c172">variant_list</a>( vcmap, memory );
<a name="l03361"></a>03361       }
<a name="l03362"></a>03362     }
<a name="l03363"></a>03363 
<a name="l03364"></a>03364     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03365"></a>03365   }
<a name="l03366"></a>03366 
<a name="l03367"></a>03367 
<a name="l03368"></a>03368   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03369"></a>03369 
<a name="l03370"></a>03370   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( FT_UInt32* )
<a name="l03371"></a><a class="code" href="ftobjs_8c.html#a334bc4b060ee2ced5caf00cd31df1902">03371</a>   <a class="code" href="freetype_8h.html#a334bc4b060ee2ced5caf00cd31df1902">FT_Face_GetVariantsOfChar</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l03372"></a>03372                              <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  charcode )
<a name="l03373"></a>03373   {
<a name="l03374"></a>03374     FT_UInt32  *<a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03375"></a>03375 
<a name="l03376"></a>03376 
<a name="l03377"></a>03377     <span class="keywordflow">if</span> ( face )
<a name="l03378"></a>03378     {
<a name="l03379"></a>03379       <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  charmap = find_variant_selector_charmap( face );
<a name="l03380"></a>03380 
<a name="l03381"></a>03381 
<a name="l03382"></a>03382       <span class="keywordflow">if</span> ( charmap != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03383"></a>03383       {
<a name="l03384"></a>03384         <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>    vcmap  = <a class="code" href="ftobjs_8h.html#ab0954b1eab39629f00cf75f3e1ccc86d">FT_CMAP</a>( charmap );
<a name="l03385"></a>03385         <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = <a class="code" href="ftobjs_8h.html#a901bd8bdda45194f96f942684bc02510">FT_FACE_MEMORY</a>( face );
<a name="l03386"></a>03386 
<a name="l03387"></a>03387 
<a name="l03388"></a>03388         <span class="keywordflow">if</span> ( charcode &gt; 0xFFFFFFFFUL )
<a name="l03389"></a>03389         {
<a name="l03390"></a>03390           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot;FT_Get_Char_Index: too large charcode&quot;</span> ));
<a name="l03391"></a>03391           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot; 0x%x is truncated\n&quot;</span>, charcode ));
<a name="l03392"></a>03392         }
<a name="l03393"></a>03393 
<a name="l03394"></a>03394         result = vcmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#aa85db42650df0edb38f8af5887c0ac6a">clazz</a>-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#a65db9dfa0e29b7de257dc8870532ab19">charvariant_list</a>( vcmap, memory,
<a name="l03395"></a>03395                                                  (FT_UInt32)charcode );
<a name="l03396"></a>03396       }
<a name="l03397"></a>03397     }
<a name="l03398"></a>03398     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03399"></a>03399   }
<a name="l03400"></a>03400 
<a name="l03401"></a>03401 
<a name="l03402"></a>03402   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03403"></a>03403 
<a name="l03404"></a>03404   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( FT_UInt32* )
<a name="l03405"></a><a class="code" href="ftobjs_8c.html#ae21fa4a376b1eb2d56c8a244d90dca11">03405</a>   <a class="code" href="freetype_8h.html#ae21fa4a376b1eb2d56c8a244d90dca11">FT_Face_GetCharsOfVariant</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>   face,
<a name="l03406"></a>03406                              <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  variantSelector )
<a name="l03407"></a>03407   {
<a name="l03408"></a>03408     FT_UInt32  *<a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03409"></a>03409 
<a name="l03410"></a>03410 
<a name="l03411"></a>03411     <span class="keywordflow">if</span> ( face )
<a name="l03412"></a>03412     {
<a name="l03413"></a>03413       <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  charmap = find_variant_selector_charmap( face );
<a name="l03414"></a>03414 
<a name="l03415"></a>03415 
<a name="l03416"></a>03416       <span class="keywordflow">if</span> ( charmap != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03417"></a>03417       {
<a name="l03418"></a>03418         <a class="code" href="struct_f_t___c_map_rec__.html">FT_CMap</a>    vcmap  = <a class="code" href="ftobjs_8h.html#ab0954b1eab39629f00cf75f3e1ccc86d">FT_CMAP</a>( charmap );
<a name="l03419"></a>03419         <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = <a class="code" href="ftobjs_8h.html#a901bd8bdda45194f96f942684bc02510">FT_FACE_MEMORY</a>( face );
<a name="l03420"></a>03420 
<a name="l03421"></a>03421 
<a name="l03422"></a>03422         <span class="keywordflow">if</span> ( variantSelector &gt; 0xFFFFFFFFUL )
<a name="l03423"></a>03423         {
<a name="l03424"></a>03424           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot;FT_Get_Char_Index: too large variantSelector&quot;</span> ));
<a name="l03425"></a>03425           <a class="code" href="ftdebug_8h.html#ac7adbe2d7e87419e83933da5f9a943e8">FT_TRACE1</a>(( <span class="stringliteral">&quot; 0x%x is truncated\n&quot;</span>, variantSelector ));
<a name="l03426"></a>03426         }
<a name="l03427"></a>03427 
<a name="l03428"></a>03428         result = vcmap-&gt;<a class="code" href="struct_f_t___c_map_rec__.html#aa85db42650df0edb38f8af5887c0ac6a">clazz</a>-&gt;<a class="code" href="struct_f_t___c_map___class_rec__.html#ac1563590a0bac99082aa0996b94aad57">variantchar_list</a>( vcmap, memory,
<a name="l03429"></a>03429                                                  (FT_UInt32)variantSelector );
<a name="l03430"></a>03430       }
<a name="l03431"></a>03431     }
<a name="l03432"></a>03432 
<a name="l03433"></a>03433     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03434"></a>03434   }
<a name="l03435"></a>03435 
<a name="l03436"></a>03436 
<a name="l03437"></a>03437   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03438"></a>03438 
<a name="l03439"></a>03439   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a> )
<a name="l03440"></a><a class="code" href="ftobjs_8c.html#abfb440cce732f3c3b03ef784601dd67a">03440</a>   <a class="code" href="freetype_8h.html#abfb440cce732f3c3b03ef784601dd67a">FT_Get_Name_Index</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>     face,
<a name="l03441"></a>03441                      <a class="code" href="fttypes_8h.html#a9846214585359eb2ba6bbb0e6de30639">FT_String</a>*  glyph_name )
<a name="l03442"></a>03442   {
<a name="l03443"></a>03443     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = 0;
<a name="l03444"></a>03444 
<a name="l03445"></a>03445 
<a name="l03446"></a>03446     <span class="keywordflow">if</span> ( face &amp;&amp; <a class="code" href="freetype_8h.html#aa98cf7f7755a226cd39aeda9eb6da44b">FT_HAS_GLYPH_NAMES</a>( face ) )
<a name="l03447"></a>03447     {
<a name="l03448"></a>03448       FT_Service_GlyphDict  service;
<a name="l03449"></a>03449 
<a name="l03450"></a>03450 
<a name="l03451"></a>03451       <a class="code" href="ftserv_8h.html#a39b85562363751f35afcc821fcb320fc">FT_FACE_LOOKUP_SERVICE</a>( face,
<a name="l03452"></a>03452                               service,
<a name="l03453"></a>03453                               GLYPH_DICT );
<a name="l03454"></a>03454 
<a name="l03455"></a>03455       <span class="keywordflow">if</span> ( service &amp;&amp; service-&gt;name_index )
<a name="l03456"></a>03456         result = service-&gt;name_index( face, glyph_name );
<a name="l03457"></a>03457     }
<a name="l03458"></a>03458 
<a name="l03459"></a>03459     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03460"></a>03460   }
<a name="l03461"></a>03461 
<a name="l03462"></a>03462 
<a name="l03463"></a>03463   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03464"></a>03464 
<a name="l03465"></a>03465   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l03466"></a><a class="code" href="ftobjs_8c.html#aa2d5108cf55705b1e1faf4fbe9873edc">03466</a>   <a class="code" href="freetype_8h.html#aa2d5108cf55705b1e1faf4fbe9873edc">FT_Get_Glyph_Name</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>     face,
<a name="l03467"></a>03467                      <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     glyph_index,
<a name="l03468"></a>03468                      <a class="code" href="fttypes_8h.html#a00f9e6a0ddd7bc55f79b2f4b5b867266">FT_Pointer</a>  buffer,
<a name="l03469"></a>03469                      <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     buffer_max )
<a name="l03470"></a>03470   {
<a name="l03471"></a>03471     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>  error = FT_Err_Invalid_Argument;
<a name="l03472"></a>03472 
<a name="l03473"></a>03473 
<a name="l03474"></a>03474     <span class="comment">/* clean up buffer */</span>
<a name="l03475"></a>03475     <span class="keywordflow">if</span> ( buffer &amp;&amp; buffer_max &gt; 0 )
<a name="l03476"></a>03476       ((<a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*)buffer)[0] = 0;
<a name="l03477"></a>03477 
<a name="l03478"></a>03478     <span class="keywordflow">if</span> ( face                                     &amp;&amp;
<a name="l03479"></a>03479          (<a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>)glyph_index &lt;= face-&gt;num_glyphs &amp;&amp;
<a name="l03480"></a>03480          <a class="code" href="freetype_8h.html#aa98cf7f7755a226cd39aeda9eb6da44b">FT_HAS_GLYPH_NAMES</a>( face )               )
<a name="l03481"></a>03481     {
<a name="l03482"></a>03482       FT_Service_GlyphDict  service;
<a name="l03483"></a>03483 
<a name="l03484"></a>03484 
<a name="l03485"></a>03485       <a class="code" href="ftserv_8h.html#a39b85562363751f35afcc821fcb320fc">FT_FACE_LOOKUP_SERVICE</a>( face,
<a name="l03486"></a>03486                               service,
<a name="l03487"></a>03487                               GLYPH_DICT );
<a name="l03488"></a>03488 
<a name="l03489"></a>03489       <span class="keywordflow">if</span> ( service &amp;&amp; service-&gt;get_name )
<a name="l03490"></a>03490         error = service-&gt;get_name( face, glyph_index, buffer, buffer_max );
<a name="l03491"></a>03491     }
<a name="l03492"></a>03492 
<a name="l03493"></a>03493     <span class="keywordflow">return</span> error;
<a name="l03494"></a>03494   }
<a name="l03495"></a>03495 
<a name="l03496"></a>03496 
<a name="l03497"></a>03497   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03498"></a>03498 
<a name="l03499"></a>03499   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* )
<a name="l03500"></a><a class="code" href="ftobjs_8c.html#a7ba3fd81be23a7e0ca0a1c435bdaa84a">03500</a>   <a class="code" href="freetype_8h.html#a7ba3fd81be23a7e0ca0a1c435bdaa84a">FT_Get_Postscript_Name</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>  face )
<a name="l03501"></a>03501   {
<a name="l03502"></a>03502     <span class="keyword">const</span> <span class="keywordtype">char</span>*  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03503"></a>03503 
<a name="l03504"></a>03504 
<a name="l03505"></a>03505     <span class="keywordflow">if</span> ( !face )
<a name="l03506"></a>03506       <span class="keywordflow">goto</span> Exit;
<a name="l03507"></a>03507 
<a name="l03508"></a>03508     <span class="keywordflow">if</span> ( !result )
<a name="l03509"></a>03509     {
<a name="l03510"></a>03510       FT_Service_PsFontName  service;
<a name="l03511"></a>03511 
<a name="l03512"></a>03512 
<a name="l03513"></a>03513       <a class="code" href="ftserv_8h.html#a39b85562363751f35afcc821fcb320fc">FT_FACE_LOOKUP_SERVICE</a>( face,
<a name="l03514"></a>03514                               service,
<a name="l03515"></a>03515                               POSTSCRIPT_FONT_NAME );
<a name="l03516"></a>03516 
<a name="l03517"></a>03517       <span class="keywordflow">if</span> ( service &amp;&amp; service-&gt;get_ps_font_name )
<a name="l03518"></a>03518         result = service-&gt;get_ps_font_name( face );
<a name="l03519"></a>03519     }
<a name="l03520"></a>03520 
<a name="l03521"></a>03521   Exit:
<a name="l03522"></a>03522     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03523"></a>03523   }
<a name="l03524"></a>03524 
<a name="l03525"></a>03525 
<a name="l03526"></a>03526   <span class="comment">/* documentation is in tttables.h */</span>
<a name="l03527"></a>03527 
<a name="l03528"></a>03528   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <span class="keywordtype">void</span>* )
<a name="l03529"></a><a class="code" href="ftobjs_8c.html#a05db257798829b76cf62cf22239e7058">03529</a>   <a class="code" href="tttables_8h.html#a05db257798829b76cf62cf22239e7058">FT_Get_Sfnt_Table</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>      face,
<a name="l03530"></a>03530                      <a class="code" href="tttables_8h.html#aa47825a845cef1422b1715723c11d6b5">FT_Sfnt_Tag</a>  tag )
<a name="l03531"></a>03531   {
<a name="l03532"></a>03532     <span class="keywordtype">void</span>*                  table = 0;
<a name="l03533"></a>03533     FT_Service_SFNT_Table  service;
<a name="l03534"></a>03534 
<a name="l03535"></a>03535 
<a name="l03536"></a>03536     <span class="keywordflow">if</span> ( face &amp;&amp; <a class="code" href="freetype_8h.html#a164adcb70a55ae22b5a795a6cd851be5">FT_IS_SFNT</a>( face ) )
<a name="l03537"></a>03537     {
<a name="l03538"></a>03538       <a class="code" href="ftserv_8h.html#ad47fb84d86812f286123ea4e39c466ed">FT_FACE_FIND_SERVICE</a>( face, service, SFNT_TABLE );
<a name="l03539"></a>03539       <span class="keywordflow">if</span> ( service != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03540"></a>03540         table = service-&gt;get_table( face, tag );
<a name="l03541"></a>03541     }
<a name="l03542"></a>03542 
<a name="l03543"></a>03543     <span class="keywordflow">return</span> table;
<a name="l03544"></a>03544   }
<a name="l03545"></a>03545 
<a name="l03546"></a>03546 
<a name="l03547"></a>03547   <span class="comment">/* documentation is in tttables.h */</span>
<a name="l03548"></a>03548 
<a name="l03549"></a>03549   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l03550"></a><a class="code" href="ftobjs_8c.html#a515e9f17645055a3aaf9a603b073d404">03550</a>   <a class="code" href="tttables_8h.html#a515e9f17645055a3aaf9a603b073d404">FT_Load_Sfnt_Table</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    face,
<a name="l03551"></a>03551                       <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>   tag,
<a name="l03552"></a>03552                       <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a>    offset,
<a name="l03553"></a>03553                       <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*   buffer,
<a name="l03554"></a>03554                       <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>*  length )
<a name="l03555"></a>03555   {
<a name="l03556"></a>03556     FT_Service_SFNT_Table  service;
<a name="l03557"></a>03557 
<a name="l03558"></a>03558 
<a name="l03559"></a>03559     <span class="keywordflow">if</span> ( !face || !<a class="code" href="freetype_8h.html#a164adcb70a55ae22b5a795a6cd851be5">FT_IS_SFNT</a>( face ) )
<a name="l03560"></a>03560       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l03561"></a>03561 
<a name="l03562"></a>03562     <a class="code" href="ftserv_8h.html#ad47fb84d86812f286123ea4e39c466ed">FT_FACE_FIND_SERVICE</a>( face, service, SFNT_TABLE );
<a name="l03563"></a>03563     <span class="keywordflow">if</span> ( service == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03564"></a>03564       <span class="keywordflow">return</span> FT_Err_Unimplemented_Feature;
<a name="l03565"></a>03565 
<a name="l03566"></a>03566     <span class="keywordflow">return</span> service-&gt;load_table( face, tag, offset, buffer, length );
<a name="l03567"></a>03567   }
<a name="l03568"></a>03568 
<a name="l03569"></a>03569 
<a name="l03570"></a>03570   <span class="comment">/* documentation is in tttables.h */</span>
<a name="l03571"></a>03571 
<a name="l03572"></a>03572   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l03573"></a><a class="code" href="ftobjs_8c.html#ae40ea2033079514f0198444910ad1e46">03573</a>   <a class="code" href="tttables_8h.html#ae40ea2033079514f0198444910ad1e46">FT_Sfnt_Table_Info</a>( <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>    face,
<a name="l03574"></a>03574                       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>    table_index,
<a name="l03575"></a>03575                       <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  *tag,
<a name="l03576"></a>03576                       <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>  *length )
<a name="l03577"></a>03577   {
<a name="l03578"></a>03578     FT_Service_SFNT_Table  service;
<a name="l03579"></a>03579     <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a>               offset;
<a name="l03580"></a>03580 
<a name="l03581"></a>03581 
<a name="l03582"></a>03582     <span class="keywordflow">if</span> ( !face || !<a class="code" href="freetype_8h.html#a164adcb70a55ae22b5a795a6cd851be5">FT_IS_SFNT</a>( face ) )
<a name="l03583"></a>03583       <span class="keywordflow">return</span> FT_Err_Invalid_Face_Handle;
<a name="l03584"></a>03584 
<a name="l03585"></a>03585     <a class="code" href="ftserv_8h.html#ad47fb84d86812f286123ea4e39c466ed">FT_FACE_FIND_SERVICE</a>( face, service, SFNT_TABLE );
<a name="l03586"></a>03586     <span class="keywordflow">if</span> ( service == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03587"></a>03587       <span class="keywordflow">return</span> FT_Err_Unimplemented_Feature;
<a name="l03588"></a>03588 
<a name="l03589"></a>03589     <span class="keywordflow">return</span> service-&gt;table_info( face, table_index, tag, &amp;offset, length );
<a name="l03590"></a>03590   }
<a name="l03591"></a>03591 
<a name="l03592"></a>03592 
<a name="l03593"></a>03593   <span class="comment">/* documentation is in tttables.h */</span>
<a name="l03594"></a>03594 
<a name="l03595"></a>03595   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a4fac88bdba78eb76b505efa6e4fbf3f5">FT_ULong</a> )
<a name="l03596"></a><a class="code" href="ftobjs_8c.html#a2ed9235237891d15d80de38e0f249717">03596</a>   <a class="code" href="tttables_8h.html#a2ed9235237891d15d80de38e0f249717">FT_Get_CMap_Language_ID</a>( <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  charmap )
<a name="l03597"></a>03597   {
<a name="l03598"></a>03598     FT_Service_TTCMaps  service;
<a name="l03599"></a>03599     <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>             face;
<a name="l03600"></a>03600     <a class="code" href="struct_t_t___c_map_info__.html">TT_CMapInfo</a>         cmap_info;
<a name="l03601"></a>03601 
<a name="l03602"></a>03602 
<a name="l03603"></a>03603     <span class="keywordflow">if</span> ( !charmap || !charmap-&gt;face )
<a name="l03604"></a>03604       <span class="keywordflow">return</span> 0;
<a name="l03605"></a>03605 
<a name="l03606"></a>03606     face = charmap-&gt;face;
<a name="l03607"></a>03607     <a class="code" href="ftserv_8h.html#ad47fb84d86812f286123ea4e39c466ed">FT_FACE_FIND_SERVICE</a>( face, service, TT_CMAP );
<a name="l03608"></a>03608     <span class="keywordflow">if</span> ( service == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03609"></a>03609       <span class="keywordflow">return</span> 0;
<a name="l03610"></a>03610     <span class="keywordflow">if</span> ( service-&gt;get_cmap_info( charmap, &amp;cmap_info ))
<a name="l03611"></a>03611       <span class="keywordflow">return</span> 0;
<a name="l03612"></a>03612 
<a name="l03613"></a>03613     <span class="keywordflow">return</span> cmap_info.<a class="code" href="struct_t_t___c_map_info__.html#a4096f460af57f87cb9434a411c502d86">language</a>;
<a name="l03614"></a>03614   }
<a name="l03615"></a>03615 
<a name="l03616"></a>03616 
<a name="l03617"></a>03617   <span class="comment">/* documentation is in tttables.h */</span>
<a name="l03618"></a>03618 
<a name="l03619"></a>03619   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a7fa72a1f0e79fb1860c5965789024d6f">FT_Long</a> )
<a name="l03620"></a><a class="code" href="ftobjs_8c.html#a9a4db80b4f71d00e28474cbfcf968614">03620</a>   <a class="code" href="tttables_8h.html#a9a4db80b4f71d00e28474cbfcf968614">FT_Get_CMap_Format</a>( <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  charmap )
<a name="l03621"></a>03621   {
<a name="l03622"></a>03622     FT_Service_TTCMaps  service;
<a name="l03623"></a>03623     <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>             face;
<a name="l03624"></a>03624     <a class="code" href="struct_t_t___c_map_info__.html">TT_CMapInfo</a>         cmap_info;
<a name="l03625"></a>03625 
<a name="l03626"></a>03626 
<a name="l03627"></a>03627     <span class="keywordflow">if</span> ( !charmap || !charmap-&gt;face )
<a name="l03628"></a>03628       <span class="keywordflow">return</span> -1;
<a name="l03629"></a>03629 
<a name="l03630"></a>03630     face = charmap-&gt;face;
<a name="l03631"></a>03631     <a class="code" href="ftserv_8h.html#ad47fb84d86812f286123ea4e39c466ed">FT_FACE_FIND_SERVICE</a>( face, service, TT_CMAP );
<a name="l03632"></a>03632     <span class="keywordflow">if</span> ( service == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03633"></a>03633       <span class="keywordflow">return</span> -1;
<a name="l03634"></a>03634     <span class="keywordflow">if</span> ( service-&gt;get_cmap_info( charmap, &amp;cmap_info ))
<a name="l03635"></a>03635       <span class="keywordflow">return</span> -1;
<a name="l03636"></a>03636 
<a name="l03637"></a>03637     <span class="keywordflow">return</span> cmap_info.<a class="code" href="struct_t_t___c_map_info__.html#a122d56b4755597f134fcf4865cb0a4fc">format</a>;
<a name="l03638"></a>03638   }
<a name="l03639"></a>03639 
<a name="l03640"></a>03640 
<a name="l03641"></a>03641   <span class="comment">/* documentation is in ftsizes.h */</span>
<a name="l03642"></a>03642 
<a name="l03643"></a>03643   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l03644"></a><a class="code" href="ftobjs_8c.html#a64b78b9733d559cd38d3db1ad91ae14d">03644</a>   <a class="code" href="ftsizes_8h.html#a64b78b9733d559cd38d3db1ad91ae14d">FT_Activate_Size</a>( <a class="code" href="struct_f_t___size_rec__.html">FT_Size</a>  size )
<a name="l03645"></a>03645   {
<a name="l03646"></a>03646     <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>  face;
<a name="l03647"></a>03647 
<a name="l03648"></a>03648 
<a name="l03649"></a>03649     <span class="keywordflow">if</span> ( size == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03650"></a>03650       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l03651"></a>03651 
<a name="l03652"></a>03652     face = size-&gt;face;
<a name="l03653"></a>03653     <span class="keywordflow">if</span> ( face == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a011b62fcffdd6dc421c9ab3286d4c9fa">driver</a> == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l03654"></a>03654       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l03655"></a>03655 
<a name="l03656"></a>03656     <span class="comment">/* we don&#39;t need anything more complex than that; all size objects */</span>
<a name="l03657"></a>03657     <span class="comment">/* are already listed by the face                                  */</span>
<a name="l03658"></a>03658     face-&gt;<a class="code" href="struct_f_t___face_rec__.html#a212d116864a5d81e80b176f9b846cd08">size</a> = <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a>;
<a name="l03659"></a>03659 
<a name="l03660"></a>03660     <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l03661"></a>03661   }
<a name="l03662"></a>03662 
<a name="l03663"></a>03663 
<a name="l03664"></a>03664   <span class="comment">/*************************************************************************/</span>
<a name="l03665"></a>03665   <span class="comment">/*************************************************************************/</span>
<a name="l03666"></a>03666   <span class="comment">/*************************************************************************/</span>
<a name="l03667"></a>03667   <span class="comment">/****                                                                 ****/</span>
<a name="l03668"></a>03668   <span class="comment">/****                                                                 ****/</span>
<a name="l03669"></a>03669   <span class="comment">/****                        R E N D E R E R S                        ****/</span>
<a name="l03670"></a>03670   <span class="comment">/****                                                                 ****/</span>
<a name="l03671"></a>03671   <span class="comment">/****                                                                 ****/</span>
<a name="l03672"></a>03672   <span class="comment">/*************************************************************************/</span>
<a name="l03673"></a>03673   <span class="comment">/*************************************************************************/</span>
<a name="l03674"></a>03674   <span class="comment">/*************************************************************************/</span>
<a name="l03675"></a>03675 
<a name="l03676"></a>03676   <span class="comment">/* lookup a renderer by glyph format in the library&#39;s list */</span>
<a name="l03677"></a>03677   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a> )
<a name="l03678"></a><a class="code" href="ftobjs_8c.html#ae4b2a9b835cfaf9e509dcc8fb1be773c">03678</a>   <a class="code" href="ftobjs_8h.html#ae4b2a9b835cfaf9e509dcc8fb1be773c">FT_Lookup_Renderer</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>       library,
<a name="l03679"></a>03679                       <a class="code" href="ftimage_8h.html#aeca0d10a27aedecbf96515e0628aff1f">FT_Glyph_Format</a>  format,
<a name="l03680"></a>03680                       <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>*     node )
<a name="l03681"></a>03681   {
<a name="l03682"></a>03682     <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>  cur;
<a name="l03683"></a>03683     <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a> = 0;
<a name="l03684"></a>03684 
<a name="l03685"></a>03685 
<a name="l03686"></a>03686     <span class="keywordflow">if</span> ( !library )
<a name="l03687"></a>03687       <span class="keywordflow">goto</span> Exit;
<a name="l03688"></a>03688 
<a name="l03689"></a>03689     cur = library-&gt;renderers.head;
<a name="l03690"></a>03690 
<a name="l03691"></a>03691     <span class="keywordflow">if</span> ( node )
<a name="l03692"></a>03692     {
<a name="l03693"></a>03693       <span class="keywordflow">if</span> ( *node )
<a name="l03694"></a>03694         cur = (*node)-&gt;<a class="code" href="struct_f_t___list_node_rec__.html#a8275962fa8c92b77435cb4fa76251f39">next</a>;
<a name="l03695"></a>03695       *node = 0;
<a name="l03696"></a>03696     }
<a name="l03697"></a>03697 
<a name="l03698"></a>03698     <span class="keywordflow">while</span> ( cur )
<a name="l03699"></a>03699     {
<a name="l03700"></a>03700       <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>  renderer = <a class="code" href="ftobjs_8h.html#ae8ed2e128837320a7f3c0a18d8e24008">FT_RENDERER</a>( cur-&gt;<a class="code" href="struct_f_t___list_node_rec__.html#ab0202be88f722442a4bec9aeb5f6418f">data</a> );
<a name="l03701"></a>03701 
<a name="l03702"></a>03702 
<a name="l03703"></a>03703       <span class="keywordflow">if</span> ( renderer-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a478b14f577b633cea7043fb17d404721">glyph_format</a> == format )
<a name="l03704"></a>03704       {
<a name="l03705"></a>03705         <span class="keywordflow">if</span> ( node )
<a name="l03706"></a>03706           *node = cur;
<a name="l03707"></a>03707 
<a name="l03708"></a>03708         result = renderer;
<a name="l03709"></a>03709         <span class="keywordflow">break</span>;
<a name="l03710"></a>03710       }
<a name="l03711"></a>03711       cur = cur-&gt;<a class="code" href="struct_f_t___list_node_rec__.html#a8275962fa8c92b77435cb4fa76251f39">next</a>;
<a name="l03712"></a>03712     }
<a name="l03713"></a>03713 
<a name="l03714"></a>03714   Exit:
<a name="l03715"></a>03715     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03716"></a>03716   }
<a name="l03717"></a>03717 
<a name="l03718"></a>03718 
<a name="l03719"></a>03719   <span class="keyword">static</span> <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>
<a name="l03720"></a>03720   ft_lookup_glyph_renderer( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  slot )
<a name="l03721"></a>03721   {
<a name="l03722"></a>03722     <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>      face    = slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#a0f5dbaf7d539bf2d92ecdff740342b04">face</a>;
<a name="l03723"></a>03723     <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>   library = <a class="code" href="ftobjs_8h.html#a067920e6bac483a3bf0da74b392413cf">FT_FACE_LIBRARY</a>( face );
<a name="l03724"></a>03724     <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>  = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#a528dd3298756070ecad7d0f82f009294">cur_renderer</a>;
<a name="l03725"></a>03725 
<a name="l03726"></a>03726 
<a name="l03727"></a>03727     <span class="keywordflow">if</span> ( !result || result-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a478b14f577b633cea7043fb17d404721">glyph_format</a> != slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#afcd35188ff4c3d5cbb518602d05b2807">format</a> )
<a name="l03728"></a>03728       result = <a class="code" href="ftobjs_8h.html#ae4b2a9b835cfaf9e509dcc8fb1be773c">FT_Lookup_Renderer</a>( library, slot-&gt;<a class="code" href="struct_f_t___glyph_slot_rec__.html#afcd35188ff4c3d5cbb518602d05b2807">format</a>, 0 );
<a name="l03729"></a>03729 
<a name="l03730"></a>03730     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l03731"></a>03731   }
<a name="l03732"></a>03732 
<a name="l03733"></a>03733 
<a name="l03734"></a>03734   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03735"></a>03735   ft_set_current_renderer( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library )
<a name="l03736"></a>03736   {
<a name="l03737"></a>03737     <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>  renderer;
<a name="l03738"></a>03738 
<a name="l03739"></a>03739 
<a name="l03740"></a>03740     renderer = <a class="code" href="ftobjs_8h.html#ae4b2a9b835cfaf9e509dcc8fb1be773c">FT_Lookup_Renderer</a>( library, <a class="code" href="ftrend1_8c.html#acd452025c8ee5551f3623ffb06c208e7">FT_GLYPH_FORMAT_OUTLINE</a>, 0 );
<a name="l03741"></a>03741     library-&gt;<a class="code" href="struct_f_t___library_rec__.html#a528dd3298756070ecad7d0f82f009294">cur_renderer</a> = renderer;
<a name="l03742"></a>03742   }
<a name="l03743"></a>03743 
<a name="l03744"></a>03744 
<a name="l03745"></a>03745   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l03746"></a>03746   ft_add_renderer( <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>  module )
<a name="l03747"></a>03747   {
<a name="l03748"></a>03748     <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>   library = module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac3d04fbdc2988bf9a39f4ad6d3cb4b5f">library</a>;
<a name="l03749"></a>03749     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>    memory  = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#afe392b83bc018b1b1fb25459f68a5861">memory</a>;
<a name="l03750"></a>03750     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>     error;
<a name="l03751"></a>03751     <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>  node    = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03752"></a>03752 
<a name="l03753"></a>03753 
<a name="l03754"></a>03754     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a313d8de417ea0d1c5fcc7d348397a642">FT_NEW</a>( node ) )
<a name="l03755"></a>03755       <span class="keywordflow">goto</span> Exit;
<a name="l03756"></a>03756 
<a name="l03757"></a>03757     {
<a name="l03758"></a>03758       <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>         render = <a class="code" href="ftobjs_8h.html#ae8ed2e128837320a7f3c0a18d8e24008">FT_RENDERER</a>( module );
<a name="l03759"></a>03759       <a class="code" href="struct_f_t___renderer___class__.html">FT_Renderer_Class</a>*  clazz  = (<a class="code" href="struct_f_t___renderer___class__.html">FT_Renderer_Class</a>*)module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>;
<a name="l03760"></a>03760 
<a name="l03761"></a>03761 
<a name="l03762"></a>03762       render-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a2b13c0a776ea7f589f41f576f9c4e8ad">clazz</a>        = clazz;
<a name="l03763"></a>03763       render-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a478b14f577b633cea7043fb17d404721">glyph_format</a> = clazz-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a2c8602452fae27379a6f85bbcb4b525c">glyph_format</a>;
<a name="l03764"></a>03764 
<a name="l03765"></a>03765       <span class="comment">/* allocate raster object if needed */</span>
<a name="l03766"></a>03766       if ( clazz-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a2c8602452fae27379a6f85bbcb4b525c">glyph_format</a> == <a class="code" href="ftrend1_8c.html#acd452025c8ee5551f3623ffb06c208e7">FT_GLYPH_FORMAT_OUTLINE</a> &amp;&amp;
<a name="l03767"></a>03767            clazz-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a5af75b9f582f98f9f74dbcbc530c7e88">raster_class</a>-&gt;<a class="code" href="struct_f_t___raster___funcs__.html#a31c9df9af6636df8a17a11bcd921b6a4">raster_new</a>                )
<a name="l03768"></a>03768       {
<a name="l03769"></a>03769         error = clazz-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a5af75b9f582f98f9f74dbcbc530c7e88">raster_class</a>-&gt;<a class="code" href="struct_f_t___raster___funcs__.html#a31c9df9af6636df8a17a11bcd921b6a4">raster_new</a>( memory, &amp;render-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a9c54a2da84f5892e0563d032ebd1ee09">raster</a> );
<a name="l03770"></a>03770         <span class="keywordflow">if</span> ( error )
<a name="l03771"></a>03771           <span class="keywordflow">goto</span> Fail;
<a name="l03772"></a>03772 
<a name="l03773"></a>03773         render-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a6dc07268fc39d9dde130a5708607d19d">raster_render</a> = clazz-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a5af75b9f582f98f9f74dbcbc530c7e88">raster_class</a>-&gt;<a class="code" href="struct_f_t___raster___funcs__.html#a7479a3def4522ce2667d6772e7bb96a5">raster_render</a>;
<a name="l03774"></a>03774         render-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a197bfeb9dde4aef8eee87bc3ea95312e">render</a>        = clazz-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a7a022b8358ce3a06620c62f3542d0d2b">render_glyph</a>;
<a name="l03775"></a>03775       }
<a name="l03776"></a>03776 
<a name="l03777"></a>03777       <span class="comment">/* add to list */</span>
<a name="l03778"></a>03778       node-&gt;<a class="code" href="struct_f_t___list_node_rec__.html#ab0202be88f722442a4bec9aeb5f6418f">data</a> = module;
<a name="l03779"></a>03779       <a class="code" href="ftlist_8h.html#afc59903c201f367a5d77dc6b7daf8f3c">FT_List_Add</a>( &amp;library-&gt;<a class="code" href="struct_f_t___library_rec__.html#ad9503f71cf4e4d88edfbdda59eb5e43d">renderers</a>, node );
<a name="l03780"></a>03780 
<a name="l03781"></a>03781       ft_set_current_renderer( library );
<a name="l03782"></a>03782     }
<a name="l03783"></a>03783 
<a name="l03784"></a>03784   Fail:
<a name="l03785"></a>03785     <span class="keywordflow">if</span> ( error )
<a name="l03786"></a>03786       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( node );
<a name="l03787"></a>03787 
<a name="l03788"></a>03788   Exit:
<a name="l03789"></a>03789     <span class="keywordflow">return</span> error;
<a name="l03790"></a>03790   }
<a name="l03791"></a>03791 
<a name="l03792"></a>03792 
<a name="l03793"></a>03793   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03794"></a>03794   ft_remove_renderer( <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>  module )
<a name="l03795"></a>03795   {
<a name="l03796"></a>03796     <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>   library = module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac3d04fbdc2988bf9a39f4ad6d3cb4b5f">library</a>;
<a name="l03797"></a>03797     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>    memory  = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#afe392b83bc018b1b1fb25459f68a5861">memory</a>;
<a name="l03798"></a>03798     <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>  node;
<a name="l03799"></a>03799 
<a name="l03800"></a>03800 
<a name="l03801"></a>03801     node = <a class="code" href="ftlist_8h.html#ac89db0214e9810f0234f09510678b208">FT_List_Find</a>( &amp;library-&gt;<a class="code" href="struct_f_t___library_rec__.html#ad9503f71cf4e4d88edfbdda59eb5e43d">renderers</a>, module );
<a name="l03802"></a>03802     <span class="keywordflow">if</span> ( node )
<a name="l03803"></a>03803     {
<a name="l03804"></a>03804       <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>  render = <a class="code" href="ftobjs_8h.html#ae8ed2e128837320a7f3c0a18d8e24008">FT_RENDERER</a>( module );
<a name="l03805"></a>03805 
<a name="l03806"></a>03806 
<a name="l03807"></a>03807       <span class="comment">/* release raster object, if any */</span>
<a name="l03808"></a>03808       <span class="keywordflow">if</span> ( render-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a2b13c0a776ea7f589f41f576f9c4e8ad">clazz</a>-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a2c8602452fae27379a6f85bbcb4b525c">glyph_format</a> == <a class="code" href="ftrend1_8c.html#acd452025c8ee5551f3623ffb06c208e7">FT_GLYPH_FORMAT_OUTLINE</a> &amp;&amp;
<a name="l03809"></a>03809            render-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a9c54a2da84f5892e0563d032ebd1ee09">raster</a>                                         )
<a name="l03810"></a>03810         render-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a2b13c0a776ea7f589f41f576f9c4e8ad">clazz</a>-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a5af75b9f582f98f9f74dbcbc530c7e88">raster_class</a>-&gt;<a class="code" href="struct_f_t___raster___funcs__.html#aecfd50bb6567d4442c997467cd68c857">raster_done</a>( render-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a9c54a2da84f5892e0563d032ebd1ee09">raster</a> );
<a name="l03811"></a>03811 
<a name="l03812"></a>03812       <span class="comment">/* remove from list */</span>
<a name="l03813"></a>03813       <a class="code" href="ftlist_8h.html#aad29d9cbe77803354f3bb5170360939a">FT_List_Remove</a>( &amp;library-&gt;<a class="code" href="struct_f_t___library_rec__.html#ad9503f71cf4e4d88edfbdda59eb5e43d">renderers</a>, node );
<a name="l03814"></a>03814       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( node );
<a name="l03815"></a>03815 
<a name="l03816"></a>03816       ft_set_current_renderer( library );
<a name="l03817"></a>03817     }
<a name="l03818"></a>03818   }
<a name="l03819"></a>03819 
<a name="l03820"></a>03820 
<a name="l03821"></a>03821   <span class="comment">/* documentation is in ftrender.h */</span>
<a name="l03822"></a>03822 
<a name="l03823"></a>03823   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a> )
<a name="l03824"></a><a class="code" href="ftobjs_8c.html#a8b85f16751ce80fd73908fff04276d15">03824</a>   <a class="code" href="ftrender_8h.html#a8b85f16751ce80fd73908fff04276d15">FT_Get_Renderer</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>       library,
<a name="l03825"></a>03825                    <a class="code" href="ftimage_8h.html#aeca0d10a27aedecbf96515e0628aff1f">FT_Glyph_Format</a>  format )
<a name="l03826"></a>03826   {
<a name="l03827"></a>03827     <span class="comment">/* test for valid `library&#39; delayed to FT_Lookup_Renderer() */</span>
<a name="l03828"></a>03828 
<a name="l03829"></a>03829     <span class="keywordflow">return</span> <a class="code" href="ftobjs_8h.html#ae4b2a9b835cfaf9e509dcc8fb1be773c">FT_Lookup_Renderer</a>( library, format, 0 );
<a name="l03830"></a>03830   }
<a name="l03831"></a>03831 
<a name="l03832"></a>03832 
<a name="l03833"></a>03833   <span class="comment">/* documentation is in ftrender.h */</span>
<a name="l03834"></a>03834 
<a name="l03835"></a>03835   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l03836"></a><a class="code" href="ftobjs_8c.html#a2a6d8dbbb7e55d023c9dacfee1dbdb0d">03836</a>   <a class="code" href="ftrender_8h.html#a2a6d8dbbb7e55d023c9dacfee1dbdb0d">FT_Set_Renderer</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>     library,
<a name="l03837"></a>03837                    <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>    renderer,
<a name="l03838"></a>03838                    <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>        num_params,
<a name="l03839"></a>03839                    <a class="code" href="struct_f_t___parameter__.html">FT_Parameter</a>*  parameters )
<a name="l03840"></a>03840   {
<a name="l03841"></a>03841     <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>  node;
<a name="l03842"></a>03842     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>     error = FT_Err_Ok;
<a name="l03843"></a>03843 
<a name="l03844"></a>03844 
<a name="l03845"></a>03845     <span class="keywordflow">if</span> ( !library )
<a name="l03846"></a>03846       <span class="keywordflow">return</span> FT_Err_Invalid_Library_Handle;
<a name="l03847"></a>03847 
<a name="l03848"></a>03848     <span class="keywordflow">if</span> ( !renderer )
<a name="l03849"></a>03849       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l03850"></a>03850 
<a name="l03851"></a>03851     node = <a class="code" href="ftlist_8h.html#ac89db0214e9810f0234f09510678b208">FT_List_Find</a>( &amp;library-&gt;renderers, renderer );
<a name="l03852"></a>03852     <span class="keywordflow">if</span> ( !node )
<a name="l03853"></a>03853     {
<a name="l03854"></a>03854       error = FT_Err_Invalid_Argument;
<a name="l03855"></a>03855       <span class="keywordflow">goto</span> Exit;
<a name="l03856"></a>03856     }
<a name="l03857"></a>03857 
<a name="l03858"></a>03858     <a class="code" href="ftlist_8h.html#a36c859fdabc29bd8e0e4fe8dba54bb70">FT_List_Up</a>( &amp;library-&gt;renderers, node );
<a name="l03859"></a>03859 
<a name="l03860"></a>03860     <span class="keywordflow">if</span> ( renderer-&gt;glyph_format == <a class="code" href="ftrend1_8c.html#acd452025c8ee5551f3623ffb06c208e7">FT_GLYPH_FORMAT_OUTLINE</a> )
<a name="l03861"></a>03861       library-&gt;cur_renderer = renderer;
<a name="l03862"></a>03862 
<a name="l03863"></a>03863     <span class="keywordflow">if</span> ( num_params &gt; 0 )
<a name="l03864"></a>03864     {
<a name="l03865"></a>03865       <a class="code" href="ftrender_8h.html#a2ba073fe01c937ca487c5dc03f0c63bb">FT_Renderer_SetModeFunc</a>  set_mode = renderer-&gt;clazz-&gt;set_mode;
<a name="l03866"></a>03866 
<a name="l03867"></a>03867 
<a name="l03868"></a>03868       <span class="keywordflow">for</span> ( ; num_params &gt; 0; num_params-- )
<a name="l03869"></a>03869       {
<a name="l03870"></a>03870         error = set_mode( renderer, parameters-&gt;tag, parameters-&gt;data );
<a name="l03871"></a>03871         <span class="keywordflow">if</span> ( error )
<a name="l03872"></a>03872           <span class="keywordflow">break</span>;
<a name="l03873"></a>03873       }
<a name="l03874"></a>03874     }
<a name="l03875"></a>03875 
<a name="l03876"></a>03876   Exit:
<a name="l03877"></a>03877     <span class="keywordflow">return</span> error;
<a name="l03878"></a>03878   }
<a name="l03879"></a>03879 
<a name="l03880"></a>03880 
<a name="l03881"></a>03881   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l03882"></a><a class="code" href="ftobjs_8c.html#a98909bc41306311d5c4cc62d6735b374">03882</a>   <a class="code" href="ftobjs_8h.html#a98909bc41306311d5c4cc62d6735b374">FT_Render_Glyph_Internal</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>      library,
<a name="l03883"></a>03883                             <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>    slot,
<a name="l03884"></a>03884                             <a class="code" href="freetype_8h.html#aaa0488bc4d2c5f0a6f4311ddee8edfb7">FT_Render_Mode</a>  render_mode )
<a name="l03885"></a>03885   {
<a name="l03886"></a>03886     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>     error = FT_Err_Ok;
<a name="l03887"></a>03887     <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>  renderer;
<a name="l03888"></a>03888 
<a name="l03889"></a>03889 
<a name="l03890"></a>03890     <span class="comment">/* if it is already a bitmap, no need to do anything */</span>
<a name="l03891"></a>03891     <span class="keywordflow">switch</span> ( slot-&gt;format )
<a name="l03892"></a>03892     {
<a name="l03893"></a>03893     <span class="keywordflow">case</span> FT_GLYPH_FORMAT_BITMAP:   <span class="comment">/* already a bitmap, don&#39;t do anything */</span>
<a name="l03894"></a>03894       <span class="keywordflow">break</span>;
<a name="l03895"></a>03895 
<a name="l03896"></a>03896     <span class="keywordflow">default</span>:
<a name="l03897"></a>03897       {
<a name="l03898"></a>03898         <a class="code" href="struct_f_t___list_node_rec__.html">FT_ListNode</a>  node   = 0;
<a name="l03899"></a>03899         <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>      update = 0;
<a name="l03900"></a>03900 
<a name="l03901"></a>03901 
<a name="l03902"></a>03902         <span class="comment">/* small shortcut for the very common case */</span>
<a name="l03903"></a>03903         <span class="keywordflow">if</span> ( slot-&gt;format == <a class="code" href="ftrend1_8c.html#acd452025c8ee5551f3623ffb06c208e7">FT_GLYPH_FORMAT_OUTLINE</a> )
<a name="l03904"></a>03904         {
<a name="l03905"></a>03905           renderer = library-&gt;cur_renderer;
<a name="l03906"></a>03906           node     = library-&gt;renderers.head;
<a name="l03907"></a>03907         }
<a name="l03908"></a>03908         <span class="keywordflow">else</span>
<a name="l03909"></a>03909           renderer = <a class="code" href="ftobjs_8h.html#ae4b2a9b835cfaf9e509dcc8fb1be773c">FT_Lookup_Renderer</a>( library, slot-&gt;format, &amp;node );
<a name="l03910"></a>03910 
<a name="l03911"></a>03911         error = FT_Err_Unimplemented_Feature;
<a name="l03912"></a>03912         <span class="keywordflow">while</span> ( renderer )
<a name="l03913"></a>03913         {
<a name="l03914"></a>03914           error = renderer-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a197bfeb9dde4aef8eee87bc3ea95312e">render</a>( renderer, slot, render_mode, <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> );
<a name="l03915"></a>03915           <span class="keywordflow">if</span> ( !error                                               ||
<a name="l03916"></a>03916                <a class="code" href="fttypes_8h.html#afff9449b4bfddb61e84999323e0a63cb">FT_ERROR_BASE</a>( error ) != FT_Err_Cannot_Render_Glyph )
<a name="l03917"></a>03917             <span class="keywordflow">break</span>;
<a name="l03918"></a>03918 
<a name="l03919"></a>03919           <span class="comment">/* FT_Err_Cannot_Render_Glyph is returned if the render mode   */</span>
<a name="l03920"></a>03920           <span class="comment">/* is unsupported by the current renderer for this glyph image */</span>
<a name="l03921"></a>03921           <span class="comment">/* format.                                                     */</span>
<a name="l03922"></a>03922 
<a name="l03923"></a>03923           <span class="comment">/* now, look for another renderer that supports the same */</span>
<a name="l03924"></a>03924           <span class="comment">/* format.                                               */</span>
<a name="l03925"></a>03925           renderer = <a class="code" href="ftobjs_8h.html#ae4b2a9b835cfaf9e509dcc8fb1be773c">FT_Lookup_Renderer</a>( library, slot-&gt;format, &amp;node );
<a name="l03926"></a>03926           update   = 1;
<a name="l03927"></a>03927         }
<a name="l03928"></a>03928 
<a name="l03929"></a>03929         <span class="comment">/* if we changed the current renderer for the glyph image format */</span>
<a name="l03930"></a>03930         <span class="comment">/* we need to select it as the next current one                  */</span>
<a name="l03931"></a>03931         <span class="keywordflow">if</span> ( !error &amp;&amp; update &amp;&amp; renderer )
<a name="l03932"></a>03932           <a class="code" href="ftrender_8h.html#a2a6d8dbbb7e55d023c9dacfee1dbdb0d">FT_Set_Renderer</a>( library, renderer, 0, 0 );
<a name="l03933"></a>03933       }
<a name="l03934"></a>03934     }
<a name="l03935"></a>03935 
<a name="l03936"></a>03936     <span class="keywordflow">return</span> error;
<a name="l03937"></a>03937   }
<a name="l03938"></a>03938 
<a name="l03939"></a>03939 
<a name="l03940"></a>03940   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l03941"></a>03941 
<a name="l03942"></a>03942   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l03943"></a><a class="code" href="ftobjs_8c.html#ab463acb65581abb6dd4a70a33b5f435f">03943</a>   <a class="code" href="freetype_8h.html#ab463acb65581abb6dd4a70a33b5f435f">FT_Render_Glyph</a>( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>    slot,
<a name="l03944"></a>03944                    <a class="code" href="freetype_8h.html#aaa0488bc4d2c5f0a6f4311ddee8edfb7">FT_Render_Mode</a>  render_mode )
<a name="l03945"></a>03945   {
<a name="l03946"></a>03946     <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library;
<a name="l03947"></a>03947 
<a name="l03948"></a>03948 
<a name="l03949"></a>03949     <span class="keywordflow">if</span> ( !slot || !slot-&gt;face )
<a name="l03950"></a>03950       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l03951"></a>03951 
<a name="l03952"></a>03952     library = <a class="code" href="ftobjs_8h.html#a067920e6bac483a3bf0da74b392413cf">FT_FACE_LIBRARY</a>( slot-&gt;face );
<a name="l03953"></a>03953 
<a name="l03954"></a>03954     <span class="keywordflow">return</span> <a class="code" href="ftobjs_8h.html#a98909bc41306311d5c4cc62d6735b374">FT_Render_Glyph_Internal</a>( library, slot, render_mode );
<a name="l03955"></a>03955   }
<a name="l03956"></a>03956 
<a name="l03957"></a>03957 
<a name="l03958"></a>03958   <span class="comment">/*************************************************************************/</span>
<a name="l03959"></a>03959   <span class="comment">/*************************************************************************/</span>
<a name="l03960"></a>03960   <span class="comment">/*************************************************************************/</span>
<a name="l03961"></a>03961   <span class="comment">/****                                                                 ****/</span>
<a name="l03962"></a>03962   <span class="comment">/****                                                                 ****/</span>
<a name="l03963"></a>03963   <span class="comment">/****                         M O D U L E S                           ****/</span>
<a name="l03964"></a>03964   <span class="comment">/****                                                                 ****/</span>
<a name="l03965"></a>03965   <span class="comment">/****                                                                 ****/</span>
<a name="l03966"></a>03966   <span class="comment">/*************************************************************************/</span>
<a name="l03967"></a>03967   <span class="comment">/*************************************************************************/</span>
<a name="l03968"></a>03968   <span class="comment">/*************************************************************************/</span>
<a name="l03969"></a>03969 
<a name="l03970"></a>03970 
<a name="l03971"></a>03971   <span class="comment">/*************************************************************************/</span>
<a name="l03972"></a>03972   <span class="comment">/*                                                                       */</span>
<a name="l03973"></a>03973   <span class="comment">/* &lt;Function&gt;                                                            */</span>
<a name="l03974"></a>03974   <span class="comment">/*    Destroy_Module                                                     */</span>
<a name="l03975"></a>03975   <span class="comment">/*                                                                       */</span>
<a name="l03976"></a>03976   <span class="comment">/* &lt;Description&gt;                                                         */</span>
<a name="l03977"></a>03977   <span class="comment">/*    Destroys a given module object.  For drivers, this also destroys   */</span>
<a name="l03978"></a>03978   <span class="comment">/*    all child faces.                                                   */</span>
<a name="l03979"></a>03979   <span class="comment">/*                                                                       */</span>
<a name="l03980"></a>03980   <span class="comment">/* &lt;InOut&gt;                                                               */</span>
<a name="l03981"></a>03981   <span class="comment">/*     module :: A handle to the target driver object.                   */</span>
<a name="l03982"></a>03982   <span class="comment">/*                                                                       */</span>
<a name="l03983"></a>03983   <span class="comment">/* &lt;Note&gt;                                                                */</span>
<a name="l03984"></a>03984   <span class="comment">/*     The driver _must_ be LOCKED!                                      */</span>
<a name="l03985"></a>03985   <span class="comment">/*                                                                       */</span>
<a name="l03986"></a>03986   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03987"></a>03987   Destroy_Module( <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>  module )
<a name="l03988"></a>03988   {
<a name="l03989"></a>03989     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>         memory  = module-&gt;<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>;
<a name="l03990"></a>03990     <a class="code" href="struct_f_t___module___class__.html">FT_Module_Class</a>*  clazz   = module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>;
<a name="l03991"></a>03991     <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>        library = module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac3d04fbdc2988bf9a39f4ad6d3cb4b5f">library</a>;
<a name="l03992"></a>03992 
<a name="l03993"></a>03993 
<a name="l03994"></a>03994     <span class="comment">/* finalize client-data - before anything else */</span>
<a name="l03995"></a>03995     <span class="keywordflow">if</span> ( module-&gt;<a class="code" href="struct_f_t___module_rec__.html#a860be13b9f239c42cacdbc5d6f81d44a">generic</a>.<a class="code" href="struct_f_t___generic__.html#a20fce8de90cc9e3876935817247b9ccc">finalizer</a> )
<a name="l03996"></a>03996       module-&gt;<a class="code" href="struct_f_t___module_rec__.html#a860be13b9f239c42cacdbc5d6f81d44a">generic</a>.<a class="code" href="struct_f_t___generic__.html#a20fce8de90cc9e3876935817247b9ccc">finalizer</a>( module );
<a name="l03997"></a>03997 
<a name="l03998"></a>03998     <span class="keywordflow">if</span> ( library &amp;&amp; library-&gt;<a class="code" href="struct_f_t___library_rec__.html#ae608b33b223905d4d70b782ed7ec8c78">auto_hinter</a> == module )
<a name="l03999"></a>03999       library-&gt;<a class="code" href="struct_f_t___library_rec__.html#ae608b33b223905d4d70b782ed7ec8c78">auto_hinter</a> = 0;
<a name="l04000"></a>04000 
<a name="l04001"></a>04001     <span class="comment">/* if the module is a renderer */</span>
<a name="l04002"></a>04002     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a147489ee1e22a7202e03be0859cd9f29">FT_MODULE_IS_RENDERER</a>( module ) )
<a name="l04003"></a>04003       ft_remove_renderer( module );
<a name="l04004"></a>04004 
<a name="l04005"></a>04005     <span class="comment">/* if the module is a font driver, add some steps */</span>
<a name="l04006"></a>04006     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#ac2d44d2f213d2a8cde5eccbb2f413e17">FT_MODULE_IS_DRIVER</a>( module ) )
<a name="l04007"></a>04007       Destroy_Driver( <a class="code" href="ftobjs_8h.html#aab06464ead266dda6098288ce9e1d8f2">FT_DRIVER</a>( module ) );
<a name="l04008"></a>04008 
<a name="l04009"></a>04009     <span class="comment">/* finalize the module object */</span>
<a name="l04010"></a>04010     <span class="keywordflow">if</span> ( clazz-&gt;<a class="code" href="struct_f_t___module___class__.html#ab6e9c780519e24a51144df79692cf339">module_done</a> )
<a name="l04011"></a>04011       clazz-&gt;<a class="code" href="struct_f_t___module___class__.html#ab6e9c780519e24a51144df79692cf339">module_done</a>( module );
<a name="l04012"></a>04012 
<a name="l04013"></a>04013     <span class="comment">/* discard it */</span>
<a name="l04014"></a>04014     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( module );
<a name="l04015"></a>04015   }
<a name="l04016"></a>04016 
<a name="l04017"></a>04017 
<a name="l04018"></a>04018   <span class="comment">/* documentation is in ftmodapi.h */</span>
<a name="l04019"></a>04019 
<a name="l04020"></a>04020   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l04021"></a><a class="code" href="ftobjs_8c.html#a537c6119249420ea935f0e61cbee5079">04021</a>   <a class="code" href="ftmodapi_8h.html#a537c6119249420ea935f0e61cbee5079">FT_Add_Module</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>              library,
<a name="l04022"></a>04022                  <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="struct_f_t___module___class__.html">FT_Module_Class</a>*  clazz )
<a name="l04023"></a>04023   {
<a name="l04024"></a>04024     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l04025"></a>04025     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory;
<a name="l04026"></a>04026     <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>  module;
<a name="l04027"></a>04027     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>    nn;
<a name="l04028"></a>04028 
<a name="l04029"></a>04029 
<a name="l04030"></a>04030 <span class="preprocessor">#define FREETYPE_VER_FIXED  ( ( (FT_Long)FREETYPE_MAJOR &lt;&lt; 16 ) | \</span>
<a name="l04031"></a>04031 <span class="preprocessor">                                FREETYPE_MINOR                  )</span>
<a name="l04032"></a>04032 <span class="preprocessor"></span>
<a name="l04033"></a>04033     <span class="keywordflow">if</span> ( !library )
<a name="l04034"></a>04034       <span class="keywordflow">return</span> FT_Err_Invalid_Library_Handle;
<a name="l04035"></a>04035 
<a name="l04036"></a>04036     <span class="keywordflow">if</span> ( !clazz )
<a name="l04037"></a>04037       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l04038"></a>04038 
<a name="l04039"></a>04039     <span class="comment">/* check freetype version */</span>
<a name="l04040"></a>04040     <span class="keywordflow">if</span> ( clazz-&gt;module_requires &gt; <a class="code" href="ftobjs_8c.html#a7c487785feb0c2301960280bb4820c69">FREETYPE_VER_FIXED</a> )
<a name="l04041"></a>04041       <span class="keywordflow">return</span> FT_Err_Invalid_Version;
<a name="l04042"></a>04042 
<a name="l04043"></a>04043     <span class="comment">/* look for a module with the same name in the library&#39;s table */</span>
<a name="l04044"></a>04044     <span class="keywordflow">for</span> ( nn = 0; nn &lt; library-&gt;num_modules; nn++ )
<a name="l04045"></a>04045     {
<a name="l04046"></a>04046       module = library-&gt;modules[nn];
<a name="l04047"></a>04047       <span class="keywordflow">if</span> ( <a class="code" href="ftstdlib_8h.html#a6b4c8a4f84eee3fe618812761ae78adb">ft_strcmp</a>( module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>-&gt;<a class="code" href="struct_f_t___module___class__.html#af25b9e32b6c91e0c31560efb62886ed7">module_name</a>, clazz-&gt;module_name ) == 0 )
<a name="l04048"></a>04048       {
<a name="l04049"></a>04049         <span class="comment">/* this installed module has the same name, compare their versions */</span>
<a name="l04050"></a>04050         <span class="keywordflow">if</span> ( clazz-&gt;module_version &lt;= module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>-&gt;<a class="code" href="struct_f_t___module___class__.html#a5b649f1965c42fd8c54bbc370fbf60b4">module_version</a> )
<a name="l04051"></a>04051           <span class="keywordflow">return</span> FT_Err_Lower_Module_Version;
<a name="l04052"></a>04052 
<a name="l04053"></a>04053         <span class="comment">/* remove the module from our list, then exit the loop to replace */</span>
<a name="l04054"></a>04054         <span class="comment">/* it by our new version..                                        */</span>
<a name="l04055"></a>04055         <a class="code" href="ftmodapi_8h.html#a036e2fa194e8a02f2626cee7aea1ac53">FT_Remove_Module</a>( library, module );
<a name="l04056"></a>04056         <span class="keywordflow">break</span>;
<a name="l04057"></a>04057       }
<a name="l04058"></a>04058     }
<a name="l04059"></a>04059 
<a name="l04060"></a>04060     memory = library-&gt;memory;
<a name="l04061"></a>04061     error  = FT_Err_Ok;
<a name="l04062"></a>04062 
<a name="l04063"></a>04063     <span class="keywordflow">if</span> ( library-&gt;num_modules &gt;= <a class="code" href="ftoption_8h.html#a2fa51a675b9b4bf8117b76f57f415592">FT_MAX_MODULES</a> )
<a name="l04064"></a>04064     {
<a name="l04065"></a>04065       error = FT_Err_Too_Many_Drivers;
<a name="l04066"></a>04066       <span class="keywordflow">goto</span> Exit;
<a name="l04067"></a>04067     }
<a name="l04068"></a>04068 
<a name="l04069"></a>04069     <span class="comment">/* allocate module object */</span>
<a name="l04070"></a>04070     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( module, clazz-&gt;module_size ) )
<a name="l04071"></a>04071       <span class="keywordflow">goto</span> Exit;
<a name="l04072"></a>04072 
<a name="l04073"></a>04073     <span class="comment">/* base initialization */</span>
<a name="l04074"></a>04074     module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac3d04fbdc2988bf9a39f4ad6d3cb4b5f">library</a> = library;
<a name="l04075"></a>04075     module-&gt;<a class="code" href="struct_f_t___module_rec__.html#a33113e9eb2d6cd8ee6666da75ff8e108">memory</a>  = memory;
<a name="l04076"></a>04076     module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>   = (<a class="code" href="struct_f_t___module___class__.html">FT_Module_Class</a>*)clazz;
<a name="l04077"></a>04077 
<a name="l04078"></a>04078     <span class="comment">/* check whether the module is a renderer - this must be performed */</span>
<a name="l04079"></a>04079     <span class="comment">/* before the normal module initialization                         */</span>
<a name="l04080"></a>04080     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a147489ee1e22a7202e03be0859cd9f29">FT_MODULE_IS_RENDERER</a>( module ) )
<a name="l04081"></a>04081     {
<a name="l04082"></a>04082       <span class="comment">/* add to the renderers list */</span>
<a name="l04083"></a>04083       error = ft_add_renderer( module );
<a name="l04084"></a>04084       <span class="keywordflow">if</span> ( error )
<a name="l04085"></a>04085         <span class="keywordflow">goto</span> Fail;
<a name="l04086"></a>04086     }
<a name="l04087"></a>04087 
<a name="l04088"></a>04088     <span class="comment">/* is the module a auto-hinter? */</span>
<a name="l04089"></a>04089     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#ad21b197a15ed6b1327e4284b42133897">FT_MODULE_IS_HINTER</a>( module ) )
<a name="l04090"></a>04090       library-&gt;auto_hinter = module;
<a name="l04091"></a>04091 
<a name="l04092"></a>04092     <span class="comment">/* if the module is a font driver */</span>
<a name="l04093"></a>04093     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#ac2d44d2f213d2a8cde5eccbb2f413e17">FT_MODULE_IS_DRIVER</a>( module ) )
<a name="l04094"></a>04094     {
<a name="l04095"></a>04095       <span class="comment">/* allocate glyph loader if needed */</span>
<a name="l04096"></a>04096       <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>  driver = <a class="code" href="ftobjs_8h.html#aab06464ead266dda6098288ce9e1d8f2">FT_DRIVER</a>( module );
<a name="l04097"></a>04097 
<a name="l04098"></a>04098 
<a name="l04099"></a>04099       driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a> = (<a class="code" href="ftdriver_8h.html#abb8124be69e585349506b14fa2dba4de">FT_Driver_Class</a>)module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>;
<a name="l04100"></a>04100       if ( <a class="code" href="ftobjs_8h.html#a2f1d4f391a7a5ef53ee949ea82939685">FT_DRIVER_USES_OUTLINES</a>( driver ) )
<a name="l04101"></a>04101       {
<a name="l04102"></a>04102         error = <a class="code" href="ftgloadr_8h.html#ad9956ad2ed4b3dfc8da30f4e3e274a49">FT_GlyphLoader_New</a>( memory, &amp;driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#ac28e7adbc14ee82c2b7710d0ee5541e2">glyph_loader</a> );
<a name="l04103"></a>04103         <span class="keywordflow">if</span> ( error )
<a name="l04104"></a>04104           <span class="keywordflow">goto</span> Fail;
<a name="l04105"></a>04105       }
<a name="l04106"></a>04106     }
<a name="l04107"></a>04107 
<a name="l04108"></a>04108     <span class="keywordflow">if</span> ( clazz-&gt;module_init )
<a name="l04109"></a>04109     {
<a name="l04110"></a>04110       error = clazz-&gt;module_init( module );
<a name="l04111"></a>04111       <span class="keywordflow">if</span> ( error )
<a name="l04112"></a>04112         <span class="keywordflow">goto</span> Fail;
<a name="l04113"></a>04113     }
<a name="l04114"></a>04114 
<a name="l04115"></a>04115     <span class="comment">/* add module to the library&#39;s table */</span>
<a name="l04116"></a>04116     library-&gt;modules[library-&gt;num_modules++] = module;
<a name="l04117"></a>04117 
<a name="l04118"></a>04118   Exit:
<a name="l04119"></a>04119     <span class="keywordflow">return</span> error;
<a name="l04120"></a>04120 
<a name="l04121"></a>04121   Fail:
<a name="l04122"></a>04122     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#ac2d44d2f213d2a8cde5eccbb2f413e17">FT_MODULE_IS_DRIVER</a>( module ) )
<a name="l04123"></a>04123     {
<a name="l04124"></a>04124       <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>  driver = <a class="code" href="ftobjs_8h.html#aab06464ead266dda6098288ce9e1d8f2">FT_DRIVER</a>( module );
<a name="l04125"></a>04125 
<a name="l04126"></a>04126 
<a name="l04127"></a>04127       <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a2f1d4f391a7a5ef53ee949ea82939685">FT_DRIVER_USES_OUTLINES</a>( driver ) )
<a name="l04128"></a>04128         <a class="code" href="ftgloadr_8h.html#a920c9ede2b8f63e3dd25f51daee360ab">FT_GlyphLoader_Done</a>( driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#ac28e7adbc14ee82c2b7710d0ee5541e2">glyph_loader</a> );
<a name="l04129"></a>04129     }
<a name="l04130"></a>04130 
<a name="l04131"></a>04131     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a147489ee1e22a7202e03be0859cd9f29">FT_MODULE_IS_RENDERER</a>( module ) )
<a name="l04132"></a>04132     {
<a name="l04133"></a>04133       <a class="code" href="struct_f_t___renderer_rec__.html">FT_Renderer</a>  renderer = <a class="code" href="ftobjs_8h.html#ae8ed2e128837320a7f3c0a18d8e24008">FT_RENDERER</a>( module );
<a name="l04134"></a>04134 
<a name="l04135"></a>04135 
<a name="l04136"></a>04136       <span class="keywordflow">if</span> ( renderer-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a2b13c0a776ea7f589f41f576f9c4e8ad">clazz</a>-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a2c8602452fae27379a6f85bbcb4b525c">glyph_format</a> == <a class="code" href="ftrend1_8c.html#acd452025c8ee5551f3623ffb06c208e7">FT_GLYPH_FORMAT_OUTLINE</a> &amp;&amp; 
<a name="l04137"></a>04137            renderer-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a9c54a2da84f5892e0563d032ebd1ee09">raster</a>                                         )
<a name="l04138"></a>04138         renderer-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a2b13c0a776ea7f589f41f576f9c4e8ad">clazz</a>-&gt;<a class="code" href="struct_f_t___renderer___class__.html#a5af75b9f582f98f9f74dbcbc530c7e88">raster_class</a>-&gt;<a class="code" href="struct_f_t___raster___funcs__.html#aecfd50bb6567d4442c997467cd68c857">raster_done</a>( renderer-&gt;<a class="code" href="struct_f_t___renderer_rec__.html#a9c54a2da84f5892e0563d032ebd1ee09">raster</a> );
<a name="l04139"></a>04139     }
<a name="l04140"></a>04140 
<a name="l04141"></a>04141     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( module );
<a name="l04142"></a>04142     <span class="keywordflow">goto</span> Exit;
<a name="l04143"></a>04143   }
<a name="l04144"></a>04144 
<a name="l04145"></a>04145 
<a name="l04146"></a>04146   <span class="comment">/* documentation is in ftmodapi.h */</span>
<a name="l04147"></a>04147 
<a name="l04148"></a>04148   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a> )
<a name="l04149"></a><a class="code" href="ftobjs_8c.html#a9aae78d37c4eadf2cd3c702ab138d3d1">04149</a>   <a class="code" href="ftmodapi_8h.html#a9aae78d37c4eadf2cd3c702ab138d3d1">FT_Get_Module</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>   library,
<a name="l04150"></a>04150                  <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span>*  module_name )
<a name="l04151"></a>04151   {
<a name="l04152"></a>04152     <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>   result = 0;
<a name="l04153"></a>04153     <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>*  cur;
<a name="l04154"></a>04154     <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>*  limit;
<a name="l04155"></a>04155 
<a name="l04156"></a>04156 
<a name="l04157"></a>04157     <span class="keywordflow">if</span> ( !library || !module_name )
<a name="l04158"></a>04158       <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l04159"></a>04159 
<a name="l04160"></a>04160     cur   = library-&gt;modules;
<a name="l04161"></a>04161     limit = cur + library-&gt;num_modules;
<a name="l04162"></a>04162 
<a name="l04163"></a>04163     <span class="keywordflow">for</span> ( ; cur &lt; limit; cur++ )
<a name="l04164"></a>04164       <span class="keywordflow">if</span> ( <a class="code" href="ftstdlib_8h.html#a6b4c8a4f84eee3fe618812761ae78adb">ft_strcmp</a>( cur[0]-&gt;clazz-&gt;<a class="code" href="struct_f_t___module___class__.html#af25b9e32b6c91e0c31560efb62886ed7">module_name</a>, module_name ) == 0 )
<a name="l04165"></a>04165       {
<a name="l04166"></a>04166         result = cur[0];
<a name="l04167"></a>04167         <span class="keywordflow">break</span>;
<a name="l04168"></a>04168       }
<a name="l04169"></a>04169 
<a name="l04170"></a>04170     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l04171"></a>04171   }
<a name="l04172"></a>04172 
<a name="l04173"></a>04173 
<a name="l04174"></a>04174   <span class="comment">/* documentation is in ftobjs.h */</span>
<a name="l04175"></a>04175 
<a name="l04176"></a>04176   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <span class="keyword">const</span> <span class="keywordtype">void</span>* )
<a name="l04177"></a><a class="code" href="ftobjs_8c.html#abc8a3cf6f444f32a6f9b18352b9f5216">04177</a>   <a class="code" href="ftobjs_8h.html#abc8a3cf6f444f32a6f9b18352b9f5216">FT_Get_Module_Interface</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>   library,
<a name="l04178"></a>04178                            <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span>*  mod_name )
<a name="l04179"></a>04179   {
<a name="l04180"></a>04180     <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>  module;
<a name="l04181"></a>04181 
<a name="l04182"></a>04182 
<a name="l04183"></a>04183     <span class="comment">/* test for valid `library&#39; delayed to FT_Get_Module() */</span>
<a name="l04184"></a>04184 
<a name="l04185"></a>04185     module = <a class="code" href="ftmodapi_8h.html#a9aae78d37c4eadf2cd3c702ab138d3d1">FT_Get_Module</a>( library, mod_name );
<a name="l04186"></a>04186 
<a name="l04187"></a>04187     <span class="keywordflow">return</span> module ? module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>-&gt;<a class="code" href="struct_f_t___module___class__.html#a320168f227e2d268691429ac0c6b2900">module_interface</a> : 0;
<a name="l04188"></a>04188   }
<a name="l04189"></a>04189 
<a name="l04190"></a>04190 
<a name="l04191"></a>04191   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a00f9e6a0ddd7bc55f79b2f4b5b867266">FT_Pointer</a> )
<a name="l04192"></a><a class="code" href="ftobjs_8c.html#ad9bcbadc579ddd55dbb1b290af1bb45a">04192</a>   <a class="code" href="ftobjs_8h.html#ad9bcbadc579ddd55dbb1b290af1bb45a">ft_module_get_service</a>( <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>    module,
<a name="l04193"></a>04193                          <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span>*  service_id )
<a name="l04194"></a>04194   {
<a name="l04195"></a>04195     <a class="code" href="fttypes_8h.html#a00f9e6a0ddd7bc55f79b2f4b5b867266">FT_Pointer</a>  result = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04196"></a>04196 
<a name="l04197"></a>04197     <span class="keywordflow">if</span> ( module )
<a name="l04198"></a>04198     {
<a name="l04199"></a>04199       <a class="code" href="ftdebug_8h.html#a0edcd80581eabc970a562c5d284d5e7e">FT_ASSERT</a>( module-&gt;clazz &amp;&amp; module-&gt;clazz-&gt;get_interface );
<a name="l04200"></a>04200 
<a name="l04201"></a>04201      <span class="comment">/* first, look for the service in the module</span>
<a name="l04202"></a>04202 <span class="comment">      */</span>
<a name="l04203"></a>04203       <span class="keywordflow">if</span> ( module-&gt;clazz-&gt;get_interface )
<a name="l04204"></a>04204         result = module-&gt;clazz-&gt;get_interface( module, service_id );
<a name="l04205"></a>04205 
<a name="l04206"></a>04206       <span class="keywordflow">if</span> ( result == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l04207"></a>04207       {
<a name="l04208"></a>04208        <span class="comment">/* we didn&#39;t find it, look in all other modules then</span>
<a name="l04209"></a>04209 <span class="comment">        */</span>
<a name="l04210"></a>04210         <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library = module-&gt;library;
<a name="l04211"></a>04211         <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>*  cur     = library-&gt;<a class="code" href="struct_f_t___library_rec__.html#af66a4d9e9fbcaa2ff0e18a9cc8d3d89d">modules</a>;
<a name="l04212"></a>04212         <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>*  limit   = cur + library-&gt;<a class="code" href="struct_f_t___library_rec__.html#af75d01983c4d91bb3373583424750afa">num_modules</a>;
<a name="l04213"></a>04213 
<a name="l04214"></a>04214         <span class="keywordflow">for</span> ( ; cur &lt; limit; cur++ )
<a name="l04215"></a>04215         {
<a name="l04216"></a>04216           <span class="keywordflow">if</span> ( cur[0] != module )
<a name="l04217"></a>04217           {
<a name="l04218"></a>04218             <a class="code" href="ftdebug_8h.html#a0edcd80581eabc970a562c5d284d5e7e">FT_ASSERT</a>( cur[0]-&gt;clazz );
<a name="l04219"></a>04219 
<a name="l04220"></a>04220             <span class="keywordflow">if</span> ( cur[0]-&gt;clazz-&gt;<a class="code" href="struct_f_t___module___class__.html#aa72d79fcd0991231e24e88f359244e8e">get_interface</a> )
<a name="l04221"></a>04221             {
<a name="l04222"></a>04222               result = cur[0]-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>-&gt;<a class="code" href="struct_f_t___module___class__.html#aa72d79fcd0991231e24e88f359244e8e">get_interface</a>( cur[0], service_id );
<a name="l04223"></a>04223               <span class="keywordflow">if</span> ( result != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l04224"></a>04224                 <span class="keywordflow">break</span>;
<a name="l04225"></a>04225             }
<a name="l04226"></a>04226           }
<a name="l04227"></a>04227         }
<a name="l04228"></a>04228       }
<a name="l04229"></a>04229     }
<a name="l04230"></a>04230 
<a name="l04231"></a>04231     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l04232"></a>04232   }
<a name="l04233"></a>04233 
<a name="l04234"></a>04234 
<a name="l04235"></a>04235   <span class="comment">/* documentation is in ftmodapi.h */</span>
<a name="l04236"></a>04236 
<a name="l04237"></a>04237   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l04238"></a><a class="code" href="ftobjs_8c.html#a036e2fa194e8a02f2626cee7aea1ac53">04238</a>   <a class="code" href="ftmodapi_8h.html#a036e2fa194e8a02f2626cee7aea1ac53">FT_Remove_Module</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library,
<a name="l04239"></a>04239                     <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>   module )
<a name="l04240"></a>04240   {
<a name="l04241"></a>04241     <span class="comment">/* try to find the module from the table, then remove it from there */</span>
<a name="l04242"></a>04242 
<a name="l04243"></a>04243     <span class="keywordflow">if</span> ( !library )
<a name="l04244"></a>04244       <span class="keywordflow">return</span> FT_Err_Invalid_Library_Handle;
<a name="l04245"></a>04245 
<a name="l04246"></a>04246     <span class="keywordflow">if</span> ( module )
<a name="l04247"></a>04247     {
<a name="l04248"></a>04248       <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>*  cur   = library-&gt;modules;
<a name="l04249"></a>04249       <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>*  limit = cur + library-&gt;num_modules;
<a name="l04250"></a>04250 
<a name="l04251"></a>04251 
<a name="l04252"></a>04252       <span class="keywordflow">for</span> ( ; cur &lt; limit; cur++ )
<a name="l04253"></a>04253       {
<a name="l04254"></a>04254         <span class="keywordflow">if</span> ( cur[0] == module )
<a name="l04255"></a>04255         {
<a name="l04256"></a>04256           <span class="comment">/* remove it from the table */</span>
<a name="l04257"></a>04257           library-&gt;num_modules--;
<a name="l04258"></a>04258           limit--;
<a name="l04259"></a>04259           <span class="keywordflow">while</span> ( cur &lt; limit )
<a name="l04260"></a>04260           {
<a name="l04261"></a>04261             cur[0] = cur[1];
<a name="l04262"></a>04262             cur++;
<a name="l04263"></a>04263           }
<a name="l04264"></a>04264           limit[0] = 0;
<a name="l04265"></a>04265 
<a name="l04266"></a>04266           <span class="comment">/* destroy the module */</span>
<a name="l04267"></a>04267           Destroy_Module( module );
<a name="l04268"></a>04268 
<a name="l04269"></a>04269           <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l04270"></a>04270         }
<a name="l04271"></a>04271       }
<a name="l04272"></a>04272     }
<a name="l04273"></a>04273     <span class="keywordflow">return</span> FT_Err_Invalid_Driver_Handle;
<a name="l04274"></a>04274   }
<a name="l04275"></a>04275 
<a name="l04276"></a>04276 
<a name="l04277"></a>04277   <span class="comment">/*************************************************************************/</span>
<a name="l04278"></a>04278   <span class="comment">/*************************************************************************/</span>
<a name="l04279"></a>04279   <span class="comment">/*************************************************************************/</span>
<a name="l04280"></a>04280   <span class="comment">/****                                                                 ****/</span>
<a name="l04281"></a>04281   <span class="comment">/****                                                                 ****/</span>
<a name="l04282"></a>04282   <span class="comment">/****                         L I B R A R Y                           ****/</span>
<a name="l04283"></a>04283   <span class="comment">/****                                                                 ****/</span>
<a name="l04284"></a>04284   <span class="comment">/****                                                                 ****/</span>
<a name="l04285"></a>04285   <span class="comment">/*************************************************************************/</span>
<a name="l04286"></a>04286   <span class="comment">/*************************************************************************/</span>
<a name="l04287"></a>04287   <span class="comment">/*************************************************************************/</span>
<a name="l04288"></a>04288 
<a name="l04289"></a>04289 
<a name="l04290"></a>04290   <span class="comment">/* documentation is in ftmodapi.h */</span>
<a name="l04291"></a>04291 
<a name="l04292"></a>04292   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l04293"></a><a class="code" href="ftobjs_8c.html#aa8353d304afe1e334e512088d056cee5">04293</a>   <a class="code" href="ftmodapi_8h.html#aa8353d304afe1e334e512088d056cee5">FT_Reference_Library</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library )
<a name="l04294"></a>04294   {
<a name="l04295"></a>04295     library-&gt;refcount++;
<a name="l04296"></a>04296 
<a name="l04297"></a>04297     <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l04298"></a>04298   }
<a name="l04299"></a>04299 
<a name="l04300"></a>04300 
<a name="l04301"></a>04301   <span class="comment">/* documentation is in ftmodapi.h */</span>
<a name="l04302"></a>04302 
<a name="l04303"></a>04303   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l04304"></a><a class="code" href="ftobjs_8c.html#a7bee32bd20d4e35dd5a87a169f76fc82">04304</a>   <a class="code" href="ftmodapi_8h.html#a7bee32bd20d4e35dd5a87a169f76fc82">FT_New_Library</a>( <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>    memory,
<a name="l04305"></a>04305                   <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  *alibrary )
<a name="l04306"></a>04306   {
<a name="l04307"></a>04307     <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04308"></a>04308     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>    error;
<a name="l04309"></a>04309 
<a name="l04310"></a>04310 
<a name="l04311"></a>04311     <span class="keywordflow">if</span> ( !memory )
<a name="l04312"></a>04312       <span class="keywordflow">return</span> FT_Err_Invalid_Argument;
<a name="l04313"></a>04313 
<a name="l04314"></a>04314 <span class="preprocessor">#ifdef FT_DEBUG_LEVEL_ERROR</span>
<a name="l04315"></a>04315 <span class="preprocessor"></span>    <span class="comment">/* init debugging support */</span>
<a name="l04316"></a>04316     <a class="code" href="ftdebug_8h.html#ac3debabea06dc9fd9c6997342d234eee">ft_debug_init</a>();
<a name="l04317"></a>04317 <span class="preprocessor">#endif</span>
<a name="l04318"></a>04318 <span class="preprocessor"></span>
<a name="l04319"></a>04319     <span class="comment">/* first of all, allocate the library object */</span>
<a name="l04320"></a>04320     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a313d8de417ea0d1c5fcc7d348397a642">FT_NEW</a>( library ) )
<a name="l04321"></a>04321       <span class="keywordflow">return</span> error;
<a name="l04322"></a>04322 
<a name="l04323"></a>04323     library-&gt;<a class="code" href="struct_f_t___library_rec__.html#afe392b83bc018b1b1fb25459f68a5861">memory</a> = memory;
<a name="l04324"></a>04324 
<a name="l04325"></a>04325 <span class="preprocessor">#ifdef FT_CONFIG_OPTION_PIC</span>
<a name="l04326"></a>04326 <span class="preprocessor"></span>    <span class="comment">/* initialize position independent code containers */</span>
<a name="l04327"></a>04327     error = ft_pic_container_init( library );
<a name="l04328"></a>04328     <span class="keywordflow">if</span> ( error )
<a name="l04329"></a>04329       <span class="keywordflow">goto</span> Fail;
<a name="l04330"></a>04330 <span class="preprocessor">#endif</span>
<a name="l04331"></a>04331 <span class="preprocessor"></span>
<a name="l04332"></a>04332     <span class="comment">/* allocate the render pool */</span>
<a name="l04333"></a>04333     library-&gt;<a class="code" href="struct_f_t___library_rec__.html#a798afdcaf0cda349eb454b769abfa251">raster_pool_size</a> = <a class="code" href="ftoption_8h.html#ae650eaa4c6ef079781b08c66d3634a98">FT_RENDER_POOL_SIZE</a>;
<a name="l04334"></a>04334 <span class="preprocessor">#if FT_RENDER_POOL_SIZE &gt; 0</span>
<a name="l04335"></a>04335 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a598206bb592354337d2bd33bcbac2681">FT_ALLOC</a>( library-&gt;<a class="code" href="struct_f_t___library_rec__.html#aa8dd799d2efb7817b05c4a02a6828275">raster_pool</a>, <a class="code" href="ftoption_8h.html#ae650eaa4c6ef079781b08c66d3634a98">FT_RENDER_POOL_SIZE</a> ) )
<a name="l04336"></a>04336       <span class="keywordflow">goto</span> Fail;
<a name="l04337"></a>04337 <span class="preprocessor">#endif</span>
<a name="l04338"></a>04338 <span class="preprocessor"></span>
<a name="l04339"></a>04339     library-&gt;<a class="code" href="struct_f_t___library_rec__.html#a218c30755bac8b58592d70148c938e38">version_major</a> = <a class="code" href="freetype_8h.html#a8c43b050c90b7a146a32297f88e85a4b">FREETYPE_MAJOR</a>;
<a name="l04340"></a>04340     library-&gt;<a class="code" href="struct_f_t___library_rec__.html#a211d591fbc89d9471715638809865290">version_minor</a> = <a class="code" href="freetype_8h.html#a90734b9c06a745153f6dbad8f9165814">FREETYPE_MINOR</a>;
<a name="l04341"></a>04341     library-&gt;<a class="code" href="struct_f_t___library_rec__.html#a51ab560542e78c5e65e248b5a94f66a1">version_patch</a> = <a class="code" href="freetype_8h.html#a2940bdb2102c2821f46e4fd1ba674e6e">FREETYPE_PATCH</a>;
<a name="l04342"></a>04342 
<a name="l04343"></a>04343     library-&gt;<a class="code" href="struct_f_t___library_rec__.html#aad71b1ecfaea56594fbd21c18e72f15c">refcount</a> = 1;
<a name="l04344"></a>04344 
<a name="l04345"></a>04345     <span class="comment">/* That&#39;s ok now */</span>
<a name="l04346"></a>04346     *alibrary = library;
<a name="l04347"></a>04347 
<a name="l04348"></a>04348     <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l04349"></a>04349 
<a name="l04350"></a>04350   Fail:
<a name="l04351"></a>04351 <span class="preprocessor">#ifdef FT_CONFIG_OPTION_PIC</span>
<a name="l04352"></a>04352 <span class="preprocessor"></span>    ft_pic_container_destroy( library );
<a name="l04353"></a>04353 <span class="preprocessor">#endif</span>
<a name="l04354"></a>04354 <span class="preprocessor"></span>    <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( library );
<a name="l04355"></a>04355     <span class="keywordflow">return</span> error;
<a name="l04356"></a>04356   }
<a name="l04357"></a>04357 
<a name="l04358"></a>04358 
<a name="l04359"></a>04359   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l04360"></a>04360 
<a name="l04361"></a>04361   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <span class="keywordtype">void</span> )
<a name="l04362"></a><a class="code" href="ftobjs_8c.html#a1f08c1971529d442c6e90ca07f79bd94">04362</a>   <a class="code" href="freetype_8h.html#a1f08c1971529d442c6e90ca07f79bd94">FT_Library_Version</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>   library,
<a name="l04363"></a>04363                       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>      *amajor,
<a name="l04364"></a>04364                       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>      *aminor,
<a name="l04365"></a>04365                       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>      *apatch )
<a name="l04366"></a>04366   {
<a name="l04367"></a>04367     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  major = 0;
<a name="l04368"></a>04368     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  minor = 0;
<a name="l04369"></a>04369     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  patch = 0;
<a name="l04370"></a>04370 
<a name="l04371"></a>04371 
<a name="l04372"></a>04372     <span class="keywordflow">if</span> ( library )
<a name="l04373"></a>04373     {
<a name="l04374"></a>04374       major = library-&gt;version_major;
<a name="l04375"></a>04375       minor = library-&gt;version_minor;
<a name="l04376"></a>04376       patch = library-&gt;version_patch;
<a name="l04377"></a>04377     }
<a name="l04378"></a>04378 
<a name="l04379"></a>04379     <span class="keywordflow">if</span> ( amajor )
<a name="l04380"></a>04380       *amajor = major;
<a name="l04381"></a>04381 
<a name="l04382"></a>04382     <span class="keywordflow">if</span> ( aminor )
<a name="l04383"></a>04383       *aminor = minor;
<a name="l04384"></a>04384 
<a name="l04385"></a>04385     <span class="keywordflow">if</span> ( apatch )
<a name="l04386"></a>04386       *apatch = patch;
<a name="l04387"></a>04387   }
<a name="l04388"></a>04388 
<a name="l04389"></a>04389 
<a name="l04390"></a>04390   <span class="comment">/* documentation is in ftmodapi.h */</span>
<a name="l04391"></a>04391 
<a name="l04392"></a>04392   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l04393"></a><a class="code" href="ftobjs_8c.html#a682ac750d151780f186333dbd85cc2fb">04393</a>   <a class="code" href="ftmodapi_8h.html#a682ac750d151780f186333dbd85cc2fb">FT_Done_Library</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library )
<a name="l04394"></a>04394   {
<a name="l04395"></a>04395     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory;
<a name="l04396"></a>04396 
<a name="l04397"></a>04397 
<a name="l04398"></a>04398     <span class="keywordflow">if</span> ( !library )
<a name="l04399"></a>04399       <span class="keywordflow">return</span> FT_Err_Invalid_Library_Handle;
<a name="l04400"></a>04400 
<a name="l04401"></a>04401     library-&gt;refcount--;
<a name="l04402"></a>04402     <span class="keywordflow">if</span> ( library-&gt;refcount &gt; 0 )
<a name="l04403"></a>04403       <span class="keywordflow">goto</span> Exit;
<a name="l04404"></a>04404 
<a name="l04405"></a>04405     memory = library-&gt;memory;
<a name="l04406"></a>04406 
<a name="l04407"></a>04407     <span class="comment">/* Discard client-data */</span>
<a name="l04408"></a>04408     <span class="keywordflow">if</span> ( library-&gt;generic.finalizer )
<a name="l04409"></a>04409       library-&gt;generic.finalizer( library );
<a name="l04410"></a>04410 
<a name="l04411"></a>04411     <span class="comment">/*</span>
<a name="l04412"></a>04412 <span class="comment">     * Close all faces in the library.  If we don&#39;t do this, we can have</span>
<a name="l04413"></a>04413 <span class="comment">     * some subtle memory leaks.</span>
<a name="l04414"></a>04414 <span class="comment">     *</span>
<a name="l04415"></a>04415 <span class="comment">     * Example:</span>
<a name="l04416"></a>04416 <span class="comment">     *</span>
<a name="l04417"></a>04417 <span class="comment">     *  - the cff font driver uses the pshinter module in cff_size_done</span>
<a name="l04418"></a>04418 <span class="comment">     *  - if the pshinter module is destroyed before the cff font driver,</span>
<a name="l04419"></a>04419 <span class="comment">     *    opened FT_Face objects managed by the driver are not properly</span>
<a name="l04420"></a>04420 <span class="comment">     *    destroyed, resulting in a memory leak</span>
<a name="l04421"></a>04421 <span class="comment">     *</span>
<a name="l04422"></a>04422 <span class="comment">     * Some faces are dependent on other faces, like Type42 faces that</span>
<a name="l04423"></a>04423 <span class="comment">     * depend on TrueType faces synthesized internally.</span>
<a name="l04424"></a>04424 <span class="comment">     *</span>
<a name="l04425"></a>04425 <span class="comment">     * The order of drivers should be specified in driver_name[].</span>
<a name="l04426"></a>04426 <span class="comment">     */</span>
<a name="l04427"></a>04427     {
<a name="l04428"></a>04428       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>      m, <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l04429"></a>04429       <span class="keyword">const</span> <span class="keywordtype">char</span>*  driver_name[] = { <span class="stringliteral">&quot;type42&quot;</span>, <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> };
<a name="l04430"></a>04430 
<a name="l04431"></a>04431 
<a name="l04432"></a>04432       <span class="keywordflow">for</span> ( m = 0;
<a name="l04433"></a>04433             m &lt; <span class="keyword">sizeof</span> ( driver_name ) / <span class="keyword">sizeof</span> ( driver_name[0] );
<a name="l04434"></a>04434             m++ )
<a name="l04435"></a>04435       {
<a name="l04436"></a>04436         <span class="keywordflow">for</span> ( n = 0; n &lt; library-&gt;num_modules; n++ )
<a name="l04437"></a>04437         {
<a name="l04438"></a>04438           <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>    module      = library-&gt;modules[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>];
<a name="l04439"></a>04439           <span class="keyword">const</span> <span class="keywordtype">char</span>*  module_name = module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>-&gt;<a class="code" href="struct_f_t___module___class__.html#af25b9e32b6c91e0c31560efb62886ed7">module_name</a>;
<a name="l04440"></a>04440           <a class="code" href="struct_f_t___list_rec__.html">FT_List</a>      faces;
<a name="l04441"></a>04441 
<a name="l04442"></a>04442 
<a name="l04443"></a>04443           <span class="keywordflow">if</span> ( driver_name[m]                                &amp;&amp;
<a name="l04444"></a>04444                <a class="code" href="ftstdlib_8h.html#a6b4c8a4f84eee3fe618812761ae78adb">ft_strcmp</a>( module_name, driver_name[m] ) != 0 )
<a name="l04445"></a>04445             <span class="keywordflow">continue</span>;
<a name="l04446"></a>04446 
<a name="l04447"></a>04447           <span class="keywordflow">if</span> ( ( module-&gt;<a class="code" href="struct_f_t___module_rec__.html#ac762573dc13af2d2af190a9e855742f5">clazz</a>-&gt;<a class="code" href="struct_f_t___module___class__.html#a54a02a3767955cd8fa0cd786bd1f9515">module_flags</a> &amp; <a class="code" href="ftmodapi_8h.html#a2f72fdfc44c042a5f6bd73a83603ef95">FT_MODULE_FONT_DRIVER</a> ) == 0 )
<a name="l04448"></a>04448             <span class="keywordflow">continue</span>;
<a name="l04449"></a>04449 
<a name="l04450"></a>04450           <a class="code" href="ftdebug_8h.html#a949e7d3b1c748d889a33dd99ec21c535">FT_TRACE7</a>(( <span class="stringliteral">&quot;FT_Done_Library: close faces for %s\n&quot;</span>, module_name ));
<a name="l04451"></a>04451 
<a name="l04452"></a>04452           faces = &amp;<a class="code" href="ftobjs_8h.html#aab06464ead266dda6098288ce9e1d8f2">FT_DRIVER</a>( module )-&gt;faces_list;
<a name="l04453"></a>04453           <span class="keywordflow">while</span> ( faces-&gt;<a class="code" href="struct_f_t___list_rec__.html#a09ed35c2bcdc1c3acd12ff4650dfdeb9">head</a> )
<a name="l04454"></a>04454           {
<a name="l04455"></a>04455             <a class="code" href="freetype_8h.html#a2d1542be3d3af3d7699cee3425b2bc79">FT_Done_Face</a>( <a class="code" href="ftobjs_8h.html#a21690c7a26f879786d49726d558d29ab">FT_FACE</a>( faces-&gt;<a class="code" href="struct_f_t___list_rec__.html#a09ed35c2bcdc1c3acd12ff4650dfdeb9">head</a>-&gt;<a class="code" href="struct_f_t___list_node_rec__.html#ab0202be88f722442a4bec9aeb5f6418f">data</a> ) );
<a name="l04456"></a>04456             <span class="keywordflow">if</span> ( faces-&gt;<a class="code" href="struct_f_t___list_rec__.html#a09ed35c2bcdc1c3acd12ff4650dfdeb9">head</a> )
<a name="l04457"></a>04457               <a class="code" href="ftdebug_8h.html#a2626b122437b69ef36f9723712feb19f">FT_TRACE0</a>(( <span class="stringliteral">&quot;FT_Done_Library: failed to free some faces\n&quot;</span> ));
<a name="l04458"></a>04458           }
<a name="l04459"></a>04459         }
<a name="l04460"></a>04460       }
<a name="l04461"></a>04461     }
<a name="l04462"></a>04462 
<a name="l04463"></a>04463     <span class="comment">/* Close all other modules in the library */</span>
<a name="l04464"></a>04464 <span class="preprocessor">#if 1</span>
<a name="l04465"></a>04465 <span class="preprocessor"></span>    <span class="comment">/* XXX Modules are removed in the reversed order so that  */</span>
<a name="l04466"></a>04466     <span class="comment">/* type42 module is removed before truetype module.  This */</span>
<a name="l04467"></a>04467     <span class="comment">/* avoids double free in some occasions.  It is a hack.   */</span>
<a name="l04468"></a>04468     <span class="keywordflow">while</span> ( library-&gt;num_modules &gt; 0 )
<a name="l04469"></a>04469       <a class="code" href="ftmodapi_8h.html#a036e2fa194e8a02f2626cee7aea1ac53">FT_Remove_Module</a>( library,
<a name="l04470"></a>04470                         library-&gt;modules[library-&gt;num_modules - 1] );
<a name="l04471"></a>04471 <span class="preprocessor">#else</span>
<a name="l04472"></a>04472 <span class="preprocessor"></span>    {
<a name="l04473"></a>04473       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l04474"></a>04474 
<a name="l04475"></a>04475 
<a name="l04476"></a>04476       <span class="keywordflow">for</span> ( n = 0; n &lt; library-&gt;num_modules; n++ )
<a name="l04477"></a>04477       {
<a name="l04478"></a>04478         <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>  module = library-&gt;modules[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>];
<a name="l04479"></a>04479 
<a name="l04480"></a>04480 
<a name="l04481"></a>04481         <span class="keywordflow">if</span> ( module )
<a name="l04482"></a>04482         {
<a name="l04483"></a>04483           Destroy_Module( module );
<a name="l04484"></a>04484           library-&gt;modules[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>] = 0;
<a name="l04485"></a>04485         }
<a name="l04486"></a>04486       }
<a name="l04487"></a>04487     }
<a name="l04488"></a>04488 <span class="preprocessor">#endif</span>
<a name="l04489"></a>04489 <span class="preprocessor"></span>
<a name="l04490"></a>04490     <span class="comment">/* Destroy raster objects */</span>
<a name="l04491"></a>04491     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( library-&gt;raster_pool );
<a name="l04492"></a>04492     library-&gt;raster_pool_size = 0;
<a name="l04493"></a>04493 
<a name="l04494"></a>04494 <span class="preprocessor">#ifdef FT_CONFIG_OPTION_PIC</span>
<a name="l04495"></a>04495 <span class="preprocessor"></span>    <span class="comment">/* Destroy pic container contents */</span>
<a name="l04496"></a>04496     ft_pic_container_destroy( library );
<a name="l04497"></a>04497 <span class="preprocessor">#endif</span>
<a name="l04498"></a>04498 <span class="preprocessor"></span>
<a name="l04499"></a>04499     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( library );
<a name="l04500"></a>04500 
<a name="l04501"></a>04501   Exit:
<a name="l04502"></a>04502     <span class="keywordflow">return</span> FT_Err_Ok;
<a name="l04503"></a>04503   }
<a name="l04504"></a>04504 
<a name="l04505"></a>04505 
<a name="l04506"></a>04506   <span class="comment">/* documentation is in ftmodapi.h */</span>
<a name="l04507"></a>04507 
<a name="l04508"></a>04508   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <span class="keywordtype">void</span> )
<a name="l04509"></a><a class="code" href="ftobjs_8c.html#a6d63da0d3f569b3e49a2f63bb47da858">04509</a>   <a class="code" href="ftmodapi_8h.html#a6d63da0d3f569b3e49a2f63bb47da858">FT_Set_Debug_Hook</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>         library,
<a name="l04510"></a>04510                      <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>            hook_index,
<a name="l04511"></a>04511                      <a class="code" href="ftmodapi_8h.html#a86349fa5682450e64690c7097cfad53a">FT_DebugHook_Func</a>  debug_hook )
<a name="l04512"></a>04512   {
<a name="l04513"></a>04513     <span class="keywordflow">if</span> ( library &amp;&amp; debug_hook &amp;&amp;
<a name="l04514"></a>04514          hook_index &lt;
<a name="l04515"></a>04515            ( <span class="keyword">sizeof</span> ( library-&gt;debug_hooks ) / <a class="code" href="afmodule_8c.html#a3491b7a4c35805e0432b6b382117c13b">sizeof</a> ( <span class="keywordtype">void</span>* ) ) )
<a name="l04516"></a>04516       library-&gt;debug_hooks[hook_index] = debug_hook;
<a name="l04517"></a>04517   }
<a name="l04518"></a>04518 
<a name="l04519"></a>04519 
<a name="l04520"></a>04520   <span class="comment">/* documentation is in ftmodapi.h */</span>
<a name="l04521"></a>04521 
<a name="l04522"></a>04522   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="ftmodapi_8h.html#adf3d040d86c86c990ae0d14b28aa96cb">FT_TrueTypeEngineType</a> )
<a name="l04523"></a><a class="code" href="ftobjs_8c.html#aa25914e847cb08519aa827a119bc2297">04523</a>   <a class="code" href="ftmodapi_8h.html#aa25914e847cb08519aa827a119bc2297">FT_Get_TrueType_Engine_Type</a>( <a class="code" href="struct_f_t___library_rec__.html">FT_Library</a>  library )
<a name="l04524"></a>04524   {
<a name="l04525"></a>04525     <a class="code" href="ftmodapi_8h.html#adf3d040d86c86c990ae0d14b28aa96cb">FT_TrueTypeEngineType</a>  result = <a class="code" href="ftmodapi_8h.html#a3f082b7c96ec929b8b1fb3cd1e25babfa3474d985d315fdbc7c3f5af9ea64ece6">FT_TRUETYPE_ENGINE_TYPE_NONE</a>;
<a name="l04526"></a>04526 
<a name="l04527"></a>04527 
<a name="l04528"></a>04528     <span class="keywordflow">if</span> ( library )
<a name="l04529"></a>04529     {
<a name="l04530"></a>04530       <a class="code" href="struct_f_t___module_rec__.html">FT_Module</a>  module = <a class="code" href="ftmodapi_8h.html#a9aae78d37c4eadf2cd3c702ab138d3d1">FT_Get_Module</a>( library, <span class="stringliteral">&quot;truetype&quot;</span> );
<a name="l04531"></a>04531 
<a name="l04532"></a>04532 
<a name="l04533"></a>04533       <span class="keywordflow">if</span> ( module )
<a name="l04534"></a>04534       {
<a name="l04535"></a>04535         FT_Service_TrueTypeEngine  service;
<a name="l04536"></a>04536 
<a name="l04537"></a>04537 
<a name="l04538"></a>04538         service = (FT_Service_TrueTypeEngine)
<a name="l04539"></a>04539                     <a class="code" href="ftobjs_8h.html#ad9bcbadc579ddd55dbb1b290af1bb45a">ft_module_get_service</a>( module,
<a name="l04540"></a>04540                                            <a class="code" href="ttdriver_8c.html#a2ddffc0d14584f5954950ad204de58dc">FT_SERVICE_ID_TRUETYPE_ENGINE</a> );
<a name="l04541"></a>04541         <span class="keywordflow">if</span> ( service )
<a name="l04542"></a>04542           result = service-&gt;engine_type;
<a name="l04543"></a>04543       }
<a name="l04544"></a>04544     }
<a name="l04545"></a>04545 
<a name="l04546"></a>04546     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l04547"></a>04547   }
<a name="l04548"></a>04548 
<a name="l04549"></a>04549 
<a name="l04550"></a>04550 <span class="preprocessor">#ifdef FT_CONFIG_OPTION_OLD_INTERNALS</span>
<a name="l04551"></a>04551 <span class="preprocessor"></span>
<a name="l04552"></a>04552   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l04553"></a>04553   ft_stub_set_char_sizes( <a class="code" href="struct_f_t___size_rec__.html">FT_Size</a>     size,
<a name="l04554"></a>04554                           <a class="code" href="fttypes_8h.html#a382164b17e99c3184911d941b2586853">FT_F26Dot6</a>  width,
<a name="l04555"></a>04555                           <a class="code" href="fttypes_8h.html#a382164b17e99c3184911d941b2586853">FT_F26Dot6</a>  height,
<a name="l04556"></a>04556                           <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     horz_res,
<a name="l04557"></a>04557                           <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     vert_res )
<a name="l04558"></a>04558   {
<a name="l04559"></a>04559     <a class="code" href="struct_f_t___size___request_rec__.html">FT_Size_RequestRec</a>  req;
<a name="l04560"></a>04560     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>           driver = size-&gt;face-&gt;driver;
<a name="l04561"></a>04561 
<a name="l04562"></a>04562 
<a name="l04563"></a>04563     <span class="keywordflow">if</span> ( driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a03ff7c2e4a2fb6d08eb481b03a78e8de">request_size</a> )
<a name="l04564"></a>04564     {
<a name="l04565"></a>04565       req.<a class="code" href="struct_f_t___size___request_rec__.html#a7644b04dd2b26c0698df558775320494">type</a>   = <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114faa91e57e841381c980f058fa094380d1d">FT_SIZE_REQUEST_TYPE_NOMINAL</a>;
<a name="l04566"></a>04566       req.<a class="code" href="struct_f_t___size___request_rec__.html#a7b044d36af318b053d5e3939eb0d5039">width</a>  = width;
<a name="l04567"></a>04567       req.<a class="code" href="struct_f_t___size___request_rec__.html#af8142450d8d032e1870d758cdcfa51a9">height</a> = height;
<a name="l04568"></a>04568 
<a name="l04569"></a>04569       <span class="keywordflow">if</span> ( horz_res == 0 )
<a name="l04570"></a>04570         horz_res = vert_res;
<a name="l04571"></a>04571 
<a name="l04572"></a>04572       <span class="keywordflow">if</span> ( vert_res == 0 )
<a name="l04573"></a>04573         vert_res = horz_res;
<a name="l04574"></a>04574 
<a name="l04575"></a>04575       <span class="keywordflow">if</span> ( horz_res == 0 )
<a name="l04576"></a>04576         horz_res = vert_res = 72;
<a name="l04577"></a>04577 
<a name="l04578"></a>04578       req.<a class="code" href="struct_f_t___size___request_rec__.html#a3a85704d13561d9db53aa60f7805ec73">horiResolution</a> = horz_res;
<a name="l04579"></a>04579       req.<a class="code" href="struct_f_t___size___request_rec__.html#a86601c38d91064b6efe256a9e99c56f4">vertResolution</a> = vert_res;
<a name="l04580"></a>04580 
<a name="l04581"></a>04581       <span class="keywordflow">return</span> driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a03ff7c2e4a2fb6d08eb481b03a78e8de">request_size</a>( size, &amp;req );
<a name="l04582"></a>04582     }
<a name="l04583"></a>04583 
<a name="l04584"></a>04584     <span class="keywordflow">return</span> 0;
<a name="l04585"></a>04585   }
<a name="l04586"></a>04586 
<a name="l04587"></a>04587 
<a name="l04588"></a>04588   <a class="code" href="ftconfig_8h.html#ad69754ed04101caf947cd79168f16aff">FT_BASE_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l04589"></a>04589   ft_stub_set_pixel_sizes( <a class="code" href="struct_f_t___size_rec__.html">FT_Size</a>  size,
<a name="l04590"></a>04590                            <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  width,
<a name="l04591"></a>04591                            <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  height )
<a name="l04592"></a>04592   {
<a name="l04593"></a>04593     <a class="code" href="struct_f_t___size___request_rec__.html">FT_Size_RequestRec</a>  req;
<a name="l04594"></a>04594     <a class="code" href="struct_f_t___driver_rec__.html">FT_Driver</a>           driver = size-&gt;face-&gt;driver;
<a name="l04595"></a>04595 
<a name="l04596"></a>04596 
<a name="l04597"></a>04597     <span class="keywordflow">if</span> ( driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a03ff7c2e4a2fb6d08eb481b03a78e8de">request_size</a> )
<a name="l04598"></a>04598     {
<a name="l04599"></a>04599       req.<a class="code" href="struct_f_t___size___request_rec__.html#a7644b04dd2b26c0698df558775320494">type</a>           = <a class="code" href="freetype_8h.html#a19bac204cb49d1340913384d1363114faa91e57e841381c980f058fa094380d1d">FT_SIZE_REQUEST_TYPE_NOMINAL</a>;
<a name="l04600"></a>04600       req.<a class="code" href="struct_f_t___size___request_rec__.html#a7b044d36af318b053d5e3939eb0d5039">width</a>          = width  &lt;&lt; 6;
<a name="l04601"></a>04601       req.<a class="code" href="struct_f_t___size___request_rec__.html#af8142450d8d032e1870d758cdcfa51a9">height</a>         = height &lt;&lt; 6;
<a name="l04602"></a>04602       req.<a class="code" href="struct_f_t___size___request_rec__.html#a3a85704d13561d9db53aa60f7805ec73">horiResolution</a> = 0;
<a name="l04603"></a>04603       req.<a class="code" href="struct_f_t___size___request_rec__.html#a86601c38d91064b6efe256a9e99c56f4">vertResolution</a> = 0;
<a name="l04604"></a>04604 
<a name="l04605"></a>04605       <span class="keywordflow">return</span> driver-&gt;<a class="code" href="struct_f_t___driver_rec__.html#a3111153608e5abeb093ed5eb7fef5aec">clazz</a>-&gt;<a class="code" href="struct_f_t___driver___class_rec__.html#a03ff7c2e4a2fb6d08eb481b03a78e8de">request_size</a>( size, &amp;req );
<a name="l04606"></a>04606     }
<a name="l04607"></a>04607 
<a name="l04608"></a>04608     <span class="keywordflow">return</span> 0;
<a name="l04609"></a>04609   }
<a name="l04610"></a>04610 
<a name="l04611"></a>04611 <span class="preprocessor">#endif </span><span class="comment">/* FT_CONFIG_OPTION_OLD_INTERNALS */</span>
<a name="l04612"></a>04612 
<a name="l04613"></a>04613 
<a name="l04614"></a>04614   <span class="comment">/* documentation is in freetype.h */</span>
<a name="l04615"></a>04615 
<a name="l04616"></a>04616   <a class="code" href="ftconfig_8h.html#ad012d49d959527854f814cfd38299aab">FT_EXPORT_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l04617"></a><a class="code" href="ftobjs_8c.html#ad9d2dcdefc29c57a6fa3efe7061bb523">04617</a>   <a class="code" href="freetype_8h.html#ad9d2dcdefc29c57a6fa3efe7061bb523">FT_Get_SubGlyph_Info</a>( <a class="code" href="struct_f_t___glyph_slot_rec__.html">FT_GlyphSlot</a>  glyph,
<a name="l04618"></a>04618                         <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>       sub_index,
<a name="l04619"></a>04619                         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>       *p_index,
<a name="l04620"></a>04620                         <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>      *p_flags,
<a name="l04621"></a>04621                         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>       *p_arg1,
<a name="l04622"></a>04622                         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>       *p_arg2,
<a name="l04623"></a>04623                         <a class="code" href="struct_f_t___matrix__.html">FT_Matrix</a>    *p_transform )
<a name="l04624"></a>04624   {
<a name="l04625"></a>04625     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>  error = FT_Err_Invalid_Argument;
<a name="l04626"></a>04626 
<a name="l04627"></a>04627 
<a name="l04628"></a>04628     <span class="keywordflow">if</span> ( glyph                                      &amp;&amp;
<a name="l04629"></a>04629          glyph-&gt;subglyphs                           &amp;&amp;
<a name="l04630"></a>04630          glyph-&gt;format == FT_GLYPH_FORMAT_COMPOSITE &amp;&amp;
<a name="l04631"></a>04631          sub_index &lt; glyph-&gt;num_subglyphs           )
<a name="l04632"></a>04632     {
<a name="l04633"></a>04633       <a class="code" href="struct_f_t___sub_glyph_rec__.html">FT_SubGlyph</a>  subg = glyph-&gt;subglyphs + sub_index;
<a name="l04634"></a>04634 
<a name="l04635"></a>04635 
<a name="l04636"></a>04636       *p_index     = subg-&gt;<a class="code" href="struct_f_t___sub_glyph_rec__.html#aa4febc2d867ff074ac116b068f372d3a">index</a>;
<a name="l04637"></a>04637       *p_flags     = subg-&gt;<a class="code" href="struct_f_t___sub_glyph_rec__.html#a2d02aefc16061f7e039f76074518f6e5">flags</a>;
<a name="l04638"></a>04638       *p_arg1      = subg-&gt;<a class="code" href="struct_f_t___sub_glyph_rec__.html#ad9f6b04ef50e1b39db90331e76f38206">arg1</a>;
<a name="l04639"></a>04639       *p_arg2      = subg-&gt;<a class="code" href="struct_f_t___sub_glyph_rec__.html#a0d27a8b473379cedeb061f9ecd7e97da">arg2</a>;
<a name="l04640"></a>04640       *p_transform = subg-&gt;<a class="code" href="struct_f_t___sub_glyph_rec__.html#a3c5fc1959a357c6c2b970ec2118d2683">transform</a>;
<a name="l04641"></a>04641     }
<a name="l04642"></a>04642 
<a name="l04643"></a>04643     <span class="keywordflow">return</span> error;
<a name="l04644"></a>04644   }
<a name="l04645"></a>04645 
<a name="l04646"></a>04646 
<a name="l04647"></a>04647 <span class="comment">/* END */</span>
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ftobjs_8c.html">ftobjs.c</a>      </li>

    <li class="footer">Generated on Tue Mar 13 2012 11:44:03 for ARK2D by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
