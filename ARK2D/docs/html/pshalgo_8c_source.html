<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ARK2D: src/ARK2D/vendor/android/freetype/jni/src/pshinter/pshalgo.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ARK2D
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('pshalgo_8c.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">src/ARK2D/vendor/android/freetype/jni/src/pshinter/pshalgo.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="pshalgo_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************/</span>
<a name="l00002"></a>00002 <span class="comment">/*                                                                         */</span>
<a name="l00003"></a>00003 <span class="comment">/*  pshalgo.c                                                              */</span>
<a name="l00004"></a>00004 <span class="comment">/*                                                                         */</span>
<a name="l00005"></a>00005 <span class="comment">/*    PostScript hinting algorithm (body).                                 */</span>
<a name="l00006"></a>00006 <span class="comment">/*                                                                         */</span>
<a name="l00007"></a>00007 <span class="comment">/*  Copyright 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010   */</span>
<a name="l00008"></a>00008 <span class="comment">/*            by                                                           */</span>
<a name="l00009"></a>00009 <span class="comment">/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<a name="l00010"></a>00010 <span class="comment">/*                                                                         */</span>
<a name="l00011"></a>00011 <span class="comment">/*  This file is part of the FreeType project, and may only be used        */</span>
<a name="l00012"></a>00012 <span class="comment">/*  modified and distributed under the terms of the FreeType project       */</span>
<a name="l00013"></a>00013 <span class="comment">/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<a name="l00014"></a>00014 <span class="comment">/*  this file you indicate that you have read the license and              */</span>
<a name="l00015"></a>00015 <span class="comment">/*  understand and accept it fully.                                        */</span>
<a name="l00016"></a>00016 <span class="comment">/*                                                                         */</span>
<a name="l00017"></a>00017 <span class="comment">/***************************************************************************/</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;<a class="code" href="ft2build_8h.html">ft2build.h</a>&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include FT_INTERNAL_OBJECTS_H</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#include FT_INTERNAL_DEBUG_H</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#include FT_INTERNAL_CALC_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="pshalgo_8h.html">pshalgo.h</a>&quot;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="pshnterr_8h.html">pshnterr.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#undef  FT_COMPONENT</span>
<a name="l00030"></a><a class="code" href="pshalgo_8c.html#a9c208ea57bc9a5fcbfc81a6106d28f3a">00030</a> <span class="preprocessor"></span><span class="preprocessor">#define FT_COMPONENT  trace_pshalgo2</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#ifdef DEBUG_HINTER</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>  <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  ps_debug_hint_table = 0;
<a name="l00035"></a>00035   PSH_HintFunc    ps_debug_hint_func  = 0;
<a name="l00036"></a>00036   <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>       ps_debug_glyph      = 0;
<a name="l00037"></a>00037 <span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="pshalgo_8c.html#a138b8f90db477181975efea4b0163c7a">00040</a> <span class="preprocessor">#define  COMPUTE_INFLEXS  </span><span class="comment">/* compute inflection points to optimize `S&#39; */</span>
<a name="l00041"></a>00041                           <span class="comment">/* and similar glyphs                        */</span>
<a name="l00042"></a><a class="code" href="pshalgo_8c.html#ad18264a730263e6d1ac5932a748c3bff">00042</a> <span class="preprocessor">#define  STRONGER         </span><span class="comment">/* slightly increase the contrast of smooth  */</span>
<a name="l00043"></a>00043                           <span class="comment">/* hinting                                   */</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <span class="comment">/*************************************************************************/</span>
<a name="l00047"></a>00047   <span class="comment">/*************************************************************************/</span>
<a name="l00048"></a>00048   <span class="comment">/*****                                                               *****/</span>
<a name="l00049"></a>00049   <span class="comment">/*****                  BASIC HINTS RECORDINGS                       *****/</span>
<a name="l00050"></a>00050   <span class="comment">/*****                                                               *****/</span>
<a name="l00051"></a>00051   <span class="comment">/*************************************************************************/</span>
<a name="l00052"></a>00052   <span class="comment">/*************************************************************************/</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <span class="comment">/* return true if two stem hints overlap */</span>
<a name="l00055"></a>00055   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>
<a name="l00056"></a>00056   psh_hint_overlap( <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint1,
<a name="l00057"></a>00057                     <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint2 )
<a name="l00058"></a>00058   {
<a name="l00059"></a>00059     <span class="keywordflow">return</span> hint1-&gt;org_pos + hint1-&gt;org_len &gt;= hint2-&gt;org_pos &amp;&amp;
<a name="l00060"></a>00060            hint2-&gt;org_pos + hint2-&gt;org_len &gt;= hint1-&gt;org_pos;
<a name="l00061"></a>00061   }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   <span class="comment">/* destroy hints table */</span>
<a name="l00065"></a>00065   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00066"></a>00066   psh_hint_table_done( <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table,
<a name="l00067"></a>00067                        <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>       memory )
<a name="l00068"></a>00068   {
<a name="l00069"></a>00069     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a4afc59850494c41579c3251ba215e0f2">zones</a> );
<a name="l00070"></a>00070     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#ae37a665a5533bc85e59d38ad1686039c">num_zones</a> = 0;
<a name="l00071"></a>00071     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#afed30407dd9e8da52d1c111987b342a9">zone</a>      = 0;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#aa05b021add8a56a12647d117eedce984">sort</a> );
<a name="l00074"></a>00074     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a845075fb5ed4acc6f024892aa00267e0">hints</a> );
<a name="l00075"></a>00075     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a31b4cf8054a137eca471b78b3c743ba4">num_hints</a>   = 0;
<a name="l00076"></a>00076     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a09397cc20944d33d6da97560b619c5ba">max_hints</a>   = 0;
<a name="l00077"></a>00077     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a2420ec7ac759f5463693c3022307ec36">sort_global</a> = 0;
<a name="l00078"></a>00078   }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   <span class="comment">/* deactivate all hints in a table */</span>
<a name="l00082"></a>00082   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00083"></a>00083   psh_hint_table_deactivate( <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table )
<a name="l00084"></a>00084   {
<a name="l00085"></a>00085     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>   count = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a09397cc20944d33d6da97560b619c5ba">max_hints</a>;
<a name="l00086"></a>00086     <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint  = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a845075fb5ed4acc6f024892aa00267e0">hints</a>;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="keywordflow">for</span> ( ; count &gt; 0; count--, hint++ )
<a name="l00090"></a>00090     {
<a name="l00091"></a>00091       <a class="code" href="pshalgo_8h.html#a1644873ed57b696df3a02d8c87207061">psh_hint_deactivate</a>( hint );
<a name="l00092"></a>00092       hint-&gt;order = -1;
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094   }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   <span class="comment">/* internal function to record a new hint */</span>
<a name="l00098"></a>00098   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00099"></a>00099   psh_hint_table_record( <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table,
<a name="l00100"></a>00100                          <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>         idx )
<a name="l00101"></a>00101   {
<a name="l00102"></a>00102     <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a845075fb5ed4acc6f024892aa00267e0">hints</a> + idx;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="keywordflow">if</span> ( idx &gt;= table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a09397cc20944d33d6da97560b619c5ba">max_hints</a> )
<a name="l00106"></a>00106     {
<a name="l00107"></a>00107       <a class="code" href="ftdebug_8h.html#a2626b122437b69ef36f9723712feb19f">FT_TRACE0</a>(( <span class="stringliteral">&quot;psh_hint_table_record: invalid hint index %d\n&quot;</span>, idx ));
<a name="l00108"></a>00108       <span class="keywordflow">return</span>;
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="comment">/* ignore active hints */</span>
<a name="l00112"></a>00112     <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a4019f2c8993405632751cb21ea2cf6a4">psh_hint_is_active</a>( hint ) )
<a name="l00113"></a>00113       <span class="keywordflow">return</span>;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <a class="code" href="pshalgo_8h.html#a53baa27d6346a3b908add84e275d4dd2">psh_hint_activate</a>( hint );
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="comment">/* now scan the current active hint set to check */</span>
<a name="l00118"></a>00118     <span class="comment">/* whether `hint&#39; overlaps with another hint     */</span>
<a name="l00119"></a>00119     {
<a name="l00120"></a>00120       <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>*  sorted = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a2420ec7ac759f5463693c3022307ec36">sort_global</a>;
<a name="l00121"></a>00121       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>    count  = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a31b4cf8054a137eca471b78b3c743ba4">num_hints</a>;
<a name="l00122"></a>00122       <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>   hint2;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a>00125       hint-&gt;parent = 0;
<a name="l00126"></a>00126       <span class="keywordflow">for</span> ( ; count &gt; 0; count--, sorted++ )
<a name="l00127"></a>00127       {
<a name="l00128"></a>00128         hint2 = sorted[0];
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keywordflow">if</span> ( psh_hint_overlap( hint, hint2 ) )
<a name="l00131"></a>00131         {
<a name="l00132"></a>00132           hint-&gt;parent = hint2;
<a name="l00133"></a>00133           <span class="keywordflow">break</span>;
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135       }
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <span class="keywordflow">if</span> ( table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a31b4cf8054a137eca471b78b3c743ba4">num_hints</a> &lt; table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a09397cc20944d33d6da97560b619c5ba">max_hints</a> )
<a name="l00139"></a>00139       table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a2420ec7ac759f5463693c3022307ec36">sort_global</a>[table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a31b4cf8054a137eca471b78b3c743ba4">num_hints</a>++] = hint;
<a name="l00140"></a>00140     <span class="keywordflow">else</span>
<a name="l00141"></a>00141       <a class="code" href="ftdebug_8h.html#a2626b122437b69ef36f9723712feb19f">FT_TRACE0</a>(( <span class="stringliteral">&quot;psh_hint_table_record: too many sorted hints!  BUG!\n&quot;</span> ));
<a name="l00142"></a>00142   }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00146"></a>00146   psh_hint_table_record_mask( <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table,
<a name="l00147"></a>00147                               <a class="code" href="struct_p_s___mask_rec__.html">PS_Mask</a>         hint_mask )
<a name="l00148"></a>00148   {
<a name="l00149"></a>00149     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>    mask = 0, val = 0;
<a name="l00150"></a>00150     <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*  cursor = hint_mask-&gt;<a class="code" href="struct_p_s___mask_rec__.html#af9cf1260cc7fa966da92a7837a09e75f">bytes</a>;
<a name="l00151"></a>00151     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>   idx, limit;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 
<a name="l00154"></a>00154     limit = hint_mask-&gt;<a class="code" href="struct_p_s___mask_rec__.html#aaa6067e8b00aab3959c00ed4822b78df">num_bits</a>;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="keywordflow">for</span> ( idx = 0; idx &lt; limit; idx++ )
<a name="l00157"></a>00157     {
<a name="l00158"></a>00158       <span class="keywordflow">if</span> ( mask == 0 )
<a name="l00159"></a>00159       {
<a name="l00160"></a>00160         val  = *cursor++;
<a name="l00161"></a>00161         mask = 0x80;
<a name="l00162"></a>00162       }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164       <span class="keywordflow">if</span> ( val &amp; mask )
<a name="l00165"></a>00165         psh_hint_table_record( table, idx );
<a name="l00166"></a>00166 
<a name="l00167"></a>00167       mask &gt;&gt;= 1;
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169   }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="comment">/* create hints table */</span>
<a name="l00173"></a>00173   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l00174"></a>00174   psh_hint_table_init( <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table,
<a name="l00175"></a>00175                        <a class="code" href="struct_p_s___hint___table_rec__.html">PS_Hint_Table</a>   hints,
<a name="l00176"></a>00176                        <a class="code" href="struct_p_s___mask___table_rec__.html">PS_Mask_Table</a>   hint_masks,
<a name="l00177"></a>00177                        <a class="code" href="struct_p_s___mask___table_rec__.html">PS_Mask_Table</a>   counter_masks,
<a name="l00178"></a>00178                        <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>       memory )
<a name="l00179"></a>00179   {
<a name="l00180"></a>00180     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>   count;
<a name="l00181"></a>00181     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>  error;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( counter_masks );
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     count = hints-&gt;<a class="code" href="struct_p_s___hint___table_rec__.html#a5734ff9130879de1e917e86950016ca9">num_hints</a>;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="comment">/* allocate our tables */</span>
<a name="l00189"></a>00189     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a231caa1da52440d78812f037f2a35a30">FT_NEW_ARRAY</a>( table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#aa05b021add8a56a12647d117eedce984">sort</a>,  2 * count     ) ||
<a name="l00190"></a>00190          <a class="code" href="ftmemory_8h.html#a231caa1da52440d78812f037f2a35a30">FT_NEW_ARRAY</a>( table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a845075fb5ed4acc6f024892aa00267e0">hints</a>,     count     ) ||
<a name="l00191"></a>00191          <a class="code" href="ftmemory_8h.html#a231caa1da52440d78812f037f2a35a30">FT_NEW_ARRAY</a>( table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a4afc59850494c41579c3251ba215e0f2">zones</a>, 2 * count + 1 ) )
<a name="l00192"></a>00192       <span class="keywordflow">goto</span> Exit;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a09397cc20944d33d6da97560b619c5ba">max_hints</a>   = count;
<a name="l00195"></a>00195     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a2420ec7ac759f5463693c3022307ec36">sort_global</a> = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#aa05b021add8a56a12647d117eedce984">sort</a> + count;
<a name="l00196"></a>00196     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a31b4cf8054a137eca471b78b3c743ba4">num_hints</a>   = 0;
<a name="l00197"></a>00197     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#ae37a665a5533bc85e59d38ad1686039c">num_zones</a>   = 0;
<a name="l00198"></a>00198     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#afed30407dd9e8da52d1c111987b342a9">zone</a>        = 0;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="comment">/* initialize the `table-&gt;hints&#39; array */</span>
<a name="l00201"></a>00201     {
<a name="l00202"></a>00202       <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  write = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a845075fb5ed4acc6f024892aa00267e0">hints</a>;
<a name="l00203"></a>00203       <a class="code" href="pshrec_8h.html#ae63007cb0e08e6bb2de22a8fab8d39c1">PS_Hint</a>   read  = hints-&gt;<a class="code" href="struct_p_s___hint___table_rec__.html#a131099e446ede3db7dd2756e24ad06bb">hints</a>;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a>00206       <span class="keywordflow">for</span> ( ; count &gt; 0; count--, write++, read++ )
<a name="l00207"></a>00207       {
<a name="l00208"></a>00208         write-&gt;org_pos = read-&gt;pos;
<a name="l00209"></a>00209         write-&gt;org_len = read-&gt;len;
<a name="l00210"></a>00210         write-&gt;flags   = read-&gt;flags;
<a name="l00211"></a>00211       }
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="comment">/* we now need to determine the initial `parent&#39; stems; first  */</span>
<a name="l00215"></a>00215     <span class="comment">/* activate the hints that are given by the initial hint masks */</span>
<a name="l00216"></a>00216     <span class="keywordflow">if</span> ( hint_masks )
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218       <a class="code" href="struct_p_s___mask_rec__.html">PS_Mask</a>  mask = hint_masks-&gt;<a class="code" href="struct_p_s___mask___table_rec__.html#a20d596cfc59134e06fca6c1b0a030fb8">masks</a>;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 
<a name="l00221"></a>00221       count             = hint_masks-&gt;<a class="code" href="struct_p_s___mask___table_rec__.html#a361f81947db638b79253b98f6ceb63b6">num_masks</a>;
<a name="l00222"></a>00222       table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a4131293707d0986ab63bc96ca580356c">hint_masks</a> = hint_masks;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224       <span class="keywordflow">for</span> ( ; count &gt; 0; count--, mask++ )
<a name="l00225"></a>00225         psh_hint_table_record_mask( table, mask );
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="comment">/* finally, do a linear parse in case some hints were left alone */</span>
<a name="l00229"></a>00229     <span class="keywordflow">if</span> ( table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a31b4cf8054a137eca471b78b3c743ba4">num_hints</a> != table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a09397cc20944d33d6da97560b619c5ba">max_hints</a> )
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  idx;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 
<a name="l00234"></a>00234       <a class="code" href="ftdebug_8h.html#a2626b122437b69ef36f9723712feb19f">FT_TRACE0</a>(( <span class="stringliteral">&quot;psh_hint_table_init: missing/incorrect hint masks\n&quot;</span> ));
<a name="l00235"></a>00235 
<a name="l00236"></a>00236       count = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a09397cc20944d33d6da97560b619c5ba">max_hints</a>;
<a name="l00237"></a>00237       <span class="keywordflow">for</span> ( idx = 0; idx &lt; count; idx++ )
<a name="l00238"></a>00238         psh_hint_table_record( table, idx );
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   Exit:
<a name="l00242"></a>00242     <span class="keywordflow">return</span> error;
<a name="l00243"></a>00243   }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00247"></a>00247   psh_hint_table_activate_mask( <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table,
<a name="l00248"></a>00248                                 <a class="code" href="struct_p_s___mask_rec__.html">PS_Mask</a>         hint_mask )
<a name="l00249"></a>00249   {
<a name="l00250"></a>00250     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>    mask = 0, val = 0;
<a name="l00251"></a>00251     <a class="code" href="fttypes_8h.html#a51f26183ca0c9f4af958939648caeccd">FT_Byte</a>*  cursor = hint_mask-&gt;<a class="code" href="struct_p_s___mask_rec__.html#af9cf1260cc7fa966da92a7837a09e75f">bytes</a>;
<a name="l00252"></a>00252     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>   idx, limit, count;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     limit = hint_mask-&gt;<a class="code" href="struct_p_s___mask_rec__.html#aaa6067e8b00aab3959c00ed4822b78df">num_bits</a>;
<a name="l00256"></a>00256     count = 0;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     psh_hint_table_deactivate( table );
<a name="l00259"></a>00259 
<a name="l00260"></a>00260     <span class="keywordflow">for</span> ( idx = 0; idx &lt; limit; idx++ )
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262       <span class="keywordflow">if</span> ( mask == 0 )
<a name="l00263"></a>00263       {
<a name="l00264"></a>00264         val  = *cursor++;
<a name="l00265"></a>00265         mask = 0x80;
<a name="l00266"></a>00266       }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268       <span class="keywordflow">if</span> ( val &amp; mask )
<a name="l00269"></a>00269       {
<a name="l00270"></a>00270         <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint = &amp;table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a845075fb5ed4acc6f024892aa00267e0">hints</a>[idx];
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         <span class="keywordflow">if</span> ( !<a class="code" href="pshalgo_8h.html#a4019f2c8993405632751cb21ea2cf6a4">psh_hint_is_active</a>( hint ) )
<a name="l00274"></a>00274         {
<a name="l00275"></a>00275           <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     count2;
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 <span class="preprocessor">#if 0</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span>          <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>*  sort = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#aa05b021add8a56a12647d117eedce984">sort</a>;
<a name="l00279"></a>00279           <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>   hint2;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a>00282           <span class="keywordflow">for</span> ( count2 = count; count2 &gt; 0; count2--, sort++ )
<a name="l00283"></a>00283           {
<a name="l00284"></a>00284             hint2 = sort[0];
<a name="l00285"></a>00285             <span class="keywordflow">if</span> ( psh_hint_overlap( hint, hint2 ) )
<a name="l00286"></a>00286               <a class="code" href="ftdebug_8h.html#a2626b122437b69ef36f9723712feb19f">FT_TRACE0</a>(( <span class="stringliteral">&quot;psh_hint_table_activate_mask:&quot;</span>
<a name="l00287"></a>00287                           <span class="stringliteral">&quot; found overlapping hints\n&quot;</span> ))
<a name="l00288"></a>00288           }
<a name="l00289"></a>00289 <span class="preprocessor">#else</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>          count2 = 0;
<a name="l00291"></a>00291 <span class="preprocessor">#endif</span>
<a name="l00292"></a>00292 <span class="preprocessor"></span>
<a name="l00293"></a>00293           <span class="keywordflow">if</span> ( count2 == 0 )
<a name="l00294"></a>00294           {
<a name="l00295"></a>00295             <a class="code" href="pshalgo_8h.html#a53baa27d6346a3b908add84e275d4dd2">psh_hint_activate</a>( hint );
<a name="l00296"></a>00296             <span class="keywordflow">if</span> ( count &lt; table-&gt;max_hints )
<a name="l00297"></a>00297               table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#aa05b021add8a56a12647d117eedce984">sort</a>[count++] = hint;
<a name="l00298"></a>00298             <span class="keywordflow">else</span>
<a name="l00299"></a>00299               <a class="code" href="ftdebug_8h.html#a2626b122437b69ef36f9723712feb19f">FT_TRACE0</a>(( <span class="stringliteral">&quot;psh_hint_tableactivate_mask:&quot;</span>
<a name="l00300"></a>00300                           <span class="stringliteral">&quot; too many active hints\n&quot;</span> ));
<a name="l00301"></a>00301           }
<a name="l00302"></a>00302         }
<a name="l00303"></a>00303       }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305       mask &gt;&gt;= 1;
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307     table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a31b4cf8054a137eca471b78b3c743ba4">num_hints</a> = count;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="comment">/* now, sort the hints; they are guaranteed to not overlap */</span>
<a name="l00310"></a>00310     <span class="comment">/* so we can compare their &quot;org_pos&quot; field directly        */</span>
<a name="l00311"></a>00311     {
<a name="l00312"></a>00312       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     i1, i2;
<a name="l00313"></a>00313       <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>   hint1, hint2;
<a name="l00314"></a>00314       <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>*  sort = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#aa05b021add8a56a12647d117eedce984">sort</a>;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00317"></a>00317       <span class="comment">/* a simple bubble sort will do, since in 99% of cases, the hints */</span>
<a name="l00318"></a>00318       <span class="comment">/* will be already sorted -- and the sort will be linear          */</span>
<a name="l00319"></a>00319       <span class="keywordflow">for</span> ( i1 = 1; i1 &lt; (<a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>)count; i1++ )
<a name="l00320"></a>00320       {
<a name="l00321"></a>00321         hint1 = sort[i1];
<a name="l00322"></a>00322         <span class="keywordflow">for</span> ( i2 = i1 - 1; i2 &gt;= 0; i2-- )
<a name="l00323"></a>00323         {
<a name="l00324"></a>00324           hint2 = sort[i2];
<a name="l00325"></a>00325 
<a name="l00326"></a>00326           <span class="keywordflow">if</span> ( hint2-&gt;org_pos &lt; hint1-&gt;org_pos )
<a name="l00327"></a>00327             <span class="keywordflow">break</span>;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329           sort[i2 + 1] = hint2;
<a name="l00330"></a>00330           sort[i2]     = hint1;
<a name="l00331"></a>00331         }
<a name="l00332"></a>00332       }
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334   }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <span class="comment">/*************************************************************************/</span>
<a name="l00338"></a>00338   <span class="comment">/*************************************************************************/</span>
<a name="l00339"></a>00339   <span class="comment">/*****                                                               *****/</span>
<a name="l00340"></a>00340   <span class="comment">/*****               HINTS GRID-FITTING AND OPTIMIZATION             *****/</span>
<a name="l00341"></a>00341   <span class="comment">/*****                                                               *****/</span>
<a name="l00342"></a>00342   <span class="comment">/*************************************************************************/</span>
<a name="l00343"></a>00343   <span class="comment">/*************************************************************************/</span>
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="preprocessor">#if 1</span>
<a name="l00346"></a>00346 <span class="preprocessor"></span>  <span class="keyword">static</span> <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>
<a name="l00347"></a>00347   psh_dimension_quantize_len( <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>  dim,
<a name="l00348"></a>00348                               <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>         len,
<a name="l00349"></a>00349                               <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>        do_snapping )
<a name="l00350"></a>00350   {
<a name="l00351"></a>00351     <span class="keywordflow">if</span> ( len &lt;= 64 )
<a name="l00352"></a>00352       len = 64;
<a name="l00353"></a>00353     <span class="keywordflow">else</span>
<a name="l00354"></a>00354     {
<a name="l00355"></a>00355       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  delta = len - dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#acf388dfaac8cb1c7ca9b5f6ad2b2f8a5">stdw</a>.<a class="code" href="struct_p_s_h___widths_rec__.html#a52a91ea0edf500d918703dcfaf12aac1">widths</a>[0].<a class="code" href="struct_p_s_h___width_rec__.html#a2478a2f260d16c420f2d885b0ef91cb3">cur</a>;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 
<a name="l00358"></a>00358       <span class="keywordflow">if</span> ( delta &lt; 0 )
<a name="l00359"></a>00359         delta = -delta;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361       <span class="keywordflow">if</span> ( delta &lt; 40 )
<a name="l00362"></a>00362       {
<a name="l00363"></a>00363         len = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#acf388dfaac8cb1c7ca9b5f6ad2b2f8a5">stdw</a>.<a class="code" href="struct_p_s_h___widths_rec__.html#a52a91ea0edf500d918703dcfaf12aac1">widths</a>[0].<a class="code" href="struct_p_s_h___width_rec__.html#a2478a2f260d16c420f2d885b0ef91cb3">cur</a>;
<a name="l00364"></a>00364         <span class="keywordflow">if</span> ( len &lt; 48 )
<a name="l00365"></a>00365           len = 48;
<a name="l00366"></a>00366       }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368       <span class="keywordflow">if</span> ( len &lt; 3 * 64 )
<a name="l00369"></a>00369       {
<a name="l00370"></a>00370         delta = ( len &amp; 63 );
<a name="l00371"></a>00371         len  &amp;= -64;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373         <span class="keywordflow">if</span> ( delta &lt; 10 )
<a name="l00374"></a>00374           len += delta;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( delta &lt; 32 )
<a name="l00377"></a>00377           len += 10;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( delta &lt; 54 )
<a name="l00380"></a>00380           len += 54;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382         <span class="keywordflow">else</span>
<a name="l00383"></a>00383           len += delta;
<a name="l00384"></a>00384       }
<a name="l00385"></a>00385       <span class="keywordflow">else</span>
<a name="l00386"></a>00386         len = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( len );
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389     <span class="keywordflow">if</span> ( do_snapping )
<a name="l00390"></a>00390       len = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( len );
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     <span class="keywordflow">return</span>  len;
<a name="l00393"></a>00393   }
<a name="l00394"></a>00394 <span class="preprocessor">#endif </span><span class="comment">/* 0 */</span>
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="preprocessor">#ifdef DEBUG_HINTER</span>
<a name="l00398"></a>00398 <span class="preprocessor"></span>
<a name="l00399"></a>00399   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00400"></a>00400   ps_simple_scale( <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table,
<a name="l00401"></a>00401                    <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>        scale,
<a name="l00402"></a>00402                    <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>        delta,
<a name="l00403"></a>00403                    <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>          dimension )
<a name="l00404"></a>00404   {
<a name="l00405"></a>00405     <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint;
<a name="l00406"></a>00406     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>   count;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="keywordflow">for</span> ( count = 0; count &lt; table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a09397cc20944d33d6da97560b619c5ba">max_hints</a>; count++ )
<a name="l00410"></a>00410     {
<a name="l00411"></a>00411       hint = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a845075fb5ed4acc6f024892aa00267e0">hints</a> + count;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413       hint-&gt;cur_pos = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( hint-&gt;org_pos, scale ) + delta;
<a name="l00414"></a>00414       hint-&gt;cur_len = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( hint-&gt;org_len, scale );
<a name="l00415"></a>00415 
<a name="l00416"></a>00416       <span class="keywordflow">if</span> ( ps_debug_hint_func )
<a name="l00417"></a>00417         ps_debug_hint_func( hint, dimension );
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419   }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421 <span class="preprocessor">#endif </span><span class="comment">/* DEBUG_HINTER */</span>
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 
<a name="l00424"></a>00424   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>
<a name="l00425"></a>00425   psh_hint_snap_stem_side_delta( <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  pos,
<a name="l00426"></a>00426                                  <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  len )
<a name="l00427"></a>00427   {
<a name="l00428"></a>00428     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  delta1 = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( pos ) - pos;
<a name="l00429"></a>00429     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  delta2 = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( pos + len ) - pos - len;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a2e917e84ed753da51ddd54c784b5991d">FT_ABS</a>( delta1 ) &lt;= <a class="code" href="ftobjs_8h.html#a2e917e84ed753da51ddd54c784b5991d">FT_ABS</a>( delta2 ) )
<a name="l00433"></a>00433       <span class="keywordflow">return</span> delta1;
<a name="l00434"></a>00434     <span class="keywordflow">else</span>
<a name="l00435"></a>00435       <span class="keywordflow">return</span> delta2;
<a name="l00436"></a>00436   }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 
<a name="l00439"></a>00439   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00440"></a>00440   psh_hint_align( <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>     hint,
<a name="l00441"></a>00441                   <a class="code" href="pshints_8h.html#aed4220b62b12a76456f9f47bafa5fe52">PSH_Globals</a>  globals,
<a name="l00442"></a>00442                   <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>       dimension,
<a name="l00443"></a>00443                   <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>    glyph )
<a name="l00444"></a>00444   {
<a name="l00445"></a>00445     <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>  dim   = &amp;globals-&gt;dimension[dimension];
<a name="l00446"></a>00446     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       scale = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a0920c1e7f14cb5c759a41c14988bca80">scale_mult</a>;
<a name="l00447"></a>00447     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       delta = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a7fe63fc51c731760358d242dee84cd53">scale_delta</a>;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     <span class="keywordflow">if</span> ( !<a class="code" href="pshalgo_8h.html#a9728e231bb97048279dc4112332abcb0">psh_hint_is_fitted</a>( hint ) )
<a name="l00451"></a>00451     {
<a name="l00452"></a>00452       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  pos = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( hint-&gt;org_pos, scale ) + delta;
<a name="l00453"></a>00453       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  len = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( hint-&gt;org_len, scale );
<a name="l00454"></a>00454 
<a name="l00455"></a>00455       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>            do_snapping;
<a name="l00456"></a>00456       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>            fit_len;
<a name="l00457"></a>00457       <a class="code" href="struct_p_s_h___alignment_rec__.html">PSH_AlignmentRec</a>  align;
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 
<a name="l00460"></a>00460       <span class="comment">/* ignore stem alignments when requested through the hint flags */</span>
<a name="l00461"></a>00461       <span class="keywordflow">if</span> ( ( dimension == 0 &amp;&amp; !glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ab5785a8d814b94b34dc589b99aa8786f">do_horz_hints</a> ) ||
<a name="l00462"></a>00462            ( dimension == 1 &amp;&amp; !glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ad10d5dab79c9c7d5ba4ad6dcfebd355d">do_vert_hints</a> ) )
<a name="l00463"></a>00463       {
<a name="l00464"></a>00464         hint-&gt;cur_pos = pos;
<a name="l00465"></a>00465         hint-&gt;cur_len = len;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         <a class="code" href="pshalgo_8h.html#a94c15a12f2d8a3ed0356779d9d48a615">psh_hint_set_fitted</a>( hint );
<a name="l00468"></a>00468         <span class="keywordflow">return</span>;
<a name="l00469"></a>00469       }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471       <span class="comment">/* perform stem snapping when requested - this is necessary</span>
<a name="l00472"></a>00472 <span class="comment">       * for monochrome and LCD hinting modes only</span>
<a name="l00473"></a>00473 <span class="comment">       */</span>
<a name="l00474"></a>00474       do_snapping = ( dimension == 0 &amp;&amp; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#adf38cde40c655af41a1a45a5590ff45c">do_horz_snapping</a> ) ||
<a name="l00475"></a>00475                     ( dimension == 1 &amp;&amp; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#aab0c5919fb0901e0b41c7fca35084044">do_vert_snapping</a> );
<a name="l00476"></a>00476 
<a name="l00477"></a>00477       hint-&gt;cur_len = fit_len = len;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479       <span class="comment">/* check blue zones for horizontal stems */</span>
<a name="l00480"></a>00480       align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ae3e8c38c467a36922be68acdfc5e0f83">align</a>     = <a class="code" href="pshglob_8h.html#a69e1e739a9b4515f57ae23eaa839593f">PSH_BLUE_ALIGN_NONE</a>;
<a name="l00481"></a>00481       align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ab6bfd035d92fb362085832c1e4a5e2f0">align_bot</a> = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#aa1138ec07d93acff80b1edd7be62ba44">align_top</a> = 0;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483       <span class="keywordflow">if</span> ( dimension == 1 )
<a name="l00484"></a>00484         <a class="code" href="pshglob_8c.html#aa46f2d67325b6b317a82fc449e721984">psh_blues_snap_stem</a>( &amp;globals-&gt;blues,
<a name="l00485"></a>00485                              hint-&gt;org_pos + hint-&gt;org_len,
<a name="l00486"></a>00486                              hint-&gt;org_pos,
<a name="l00487"></a>00487                              &amp;align );
<a name="l00488"></a>00488 
<a name="l00489"></a>00489       <span class="keywordflow">switch</span> ( align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ae3e8c38c467a36922be68acdfc5e0f83">align</a> )
<a name="l00490"></a>00490       {
<a name="l00491"></a>00491       <span class="keywordflow">case</span> <a class="code" href="pshglob_8h.html#ad88c2735fa434d084fec9331c9f8d822">PSH_BLUE_ALIGN_TOP</a>:
<a name="l00492"></a>00492         <span class="comment">/* the top of the stem is aligned against a blue zone */</span>
<a name="l00493"></a>00493         hint-&gt;cur_pos = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#aa1138ec07d93acff80b1edd7be62ba44">align_top</a> - fit_len;
<a name="l00494"></a>00494         <span class="keywordflow">break</span>;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496       <span class="keywordflow">case</span> <a class="code" href="pshglob_8h.html#a44ea027d158949cc71eef840defab938">PSH_BLUE_ALIGN_BOT</a>:
<a name="l00497"></a>00497         <span class="comment">/* the bottom of the stem is aligned against a blue zone */</span>
<a name="l00498"></a>00498         hint-&gt;cur_pos = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ab6bfd035d92fb362085832c1e4a5e2f0">align_bot</a>;
<a name="l00499"></a>00499         <span class="keywordflow">break</span>;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501       <span class="keywordflow">case</span> <a class="code" href="pshglob_8h.html#ad88c2735fa434d084fec9331c9f8d822">PSH_BLUE_ALIGN_TOP</a> | <a class="code" href="pshglob_8h.html#a44ea027d158949cc71eef840defab938">PSH_BLUE_ALIGN_BOT</a>:
<a name="l00502"></a>00502         <span class="comment">/* both edges of the stem are aligned against blue zones */</span>
<a name="l00503"></a>00503         hint-&gt;cur_pos = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ab6bfd035d92fb362085832c1e4a5e2f0">align_bot</a>;
<a name="l00504"></a>00504         hint-&gt;cur_len = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#aa1138ec07d93acff80b1edd7be62ba44">align_top</a> - align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ab6bfd035d92fb362085832c1e4a5e2f0">align_bot</a>;
<a name="l00505"></a>00505         <span class="keywordflow">break</span>;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507       <span class="keywordflow">default</span>:
<a name="l00508"></a>00508         {
<a name="l00509"></a>00509           <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  parent = hint-&gt;parent;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512           <span class="keywordflow">if</span> ( parent )
<a name="l00513"></a>00513           {
<a name="l00514"></a>00514             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  par_org_center, par_cur_center;
<a name="l00515"></a>00515             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  cur_org_center, cur_delta;
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 
<a name="l00518"></a>00518             <span class="comment">/* ensure that parent is already fitted */</span>
<a name="l00519"></a>00519             <span class="keywordflow">if</span> ( !<a class="code" href="pshalgo_8h.html#a9728e231bb97048279dc4112332abcb0">psh_hint_is_fitted</a>( parent ) )
<a name="l00520"></a>00520               psh_hint_align( parent, globals, dimension, glyph );
<a name="l00521"></a>00521 
<a name="l00522"></a>00522             <span class="comment">/* keep original relation between hints, this is, use the */</span>
<a name="l00523"></a>00523             <span class="comment">/* scaled distance between the centers of the hints to    */</span>
<a name="l00524"></a>00524             <span class="comment">/* compute the new position                               */</span>
<a name="l00525"></a>00525             par_org_center = parent-&gt;org_pos + ( parent-&gt;org_len &gt;&gt; 1 );
<a name="l00526"></a>00526             par_cur_center = parent-&gt;cur_pos + ( parent-&gt;cur_len &gt;&gt; 1 );
<a name="l00527"></a>00527             cur_org_center = hint-&gt;org_pos   + ( hint-&gt;org_len   &gt;&gt; 1 );
<a name="l00528"></a>00528 
<a name="l00529"></a>00529             cur_delta = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( cur_org_center - par_org_center, scale );
<a name="l00530"></a>00530             pos       = par_cur_center + cur_delta - ( len &gt;&gt; 1 );
<a name="l00531"></a>00531           }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533           hint-&gt;cur_pos = pos;
<a name="l00534"></a>00534           hint-&gt;cur_len = fit_len;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536           <span class="comment">/* Stem adjustment tries to snap stem widths to standard</span>
<a name="l00537"></a>00537 <span class="comment">           * ones.  This is important to prevent unpleasant rounding</span>
<a name="l00538"></a>00538 <span class="comment">           * artefacts.</span>
<a name="l00539"></a>00539 <span class="comment">           */</span>
<a name="l00540"></a>00540           <span class="keywordflow">if</span> ( glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ac9ac7c11e8e306b9cf605ff1d7f0fc56">do_stem_adjust</a> )
<a name="l00541"></a>00541           {
<a name="l00542"></a>00542             <span class="keywordflow">if</span> ( len &lt;= 64 )
<a name="l00543"></a>00543             {
<a name="l00544"></a>00544               <span class="comment">/* the stem is less than one pixel; we will center it</span>
<a name="l00545"></a>00545 <span class="comment">               * around the nearest pixel center</span>
<a name="l00546"></a>00546 <span class="comment">               */</span>
<a name="l00547"></a>00547               <span class="keywordflow">if</span> ( len &gt;= 32 )
<a name="l00548"></a>00548               {
<a name="l00549"></a>00549                 <span class="comment">/* This is a special case where we also widen the stem</span>
<a name="l00550"></a>00550 <span class="comment">                 * and align it to the pixel grid.</span>
<a name="l00551"></a>00551 <span class="comment">                 *</span>
<a name="l00552"></a>00552 <span class="comment">                 *   stem_center          = pos + (len/2)</span>
<a name="l00553"></a>00553 <span class="comment">                 *   nearest_pixel_center = FT_ROUND(stem_center-32)+32</span>
<a name="l00554"></a>00554 <span class="comment">                 *   new_pos              = nearest_pixel_center-32</span>
<a name="l00555"></a>00555 <span class="comment">                 *                        = FT_ROUND(stem_center-32)</span>
<a name="l00556"></a>00556 <span class="comment">                 *                        = FT_FLOOR(stem_center-32+32)</span>
<a name="l00557"></a>00557 <span class="comment">                 *                        = FT_FLOOR(stem_center)</span>
<a name="l00558"></a>00558 <span class="comment">                 *   new_len              = 64</span>
<a name="l00559"></a>00559 <span class="comment">                 */</span>
<a name="l00560"></a>00560                 pos = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( pos + ( len &gt;&gt; 1 ) );
<a name="l00561"></a>00561                 len = 64;
<a name="l00562"></a>00562               }
<a name="l00563"></a>00563               <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( len &gt; 0 )
<a name="l00564"></a>00564               {
<a name="l00565"></a>00565                 <span class="comment">/* This is a very small stem; we simply align it to the</span>
<a name="l00566"></a>00566 <span class="comment">                 * pixel grid, trying to find the minimal displacement.</span>
<a name="l00567"></a>00567 <span class="comment">                 *</span>
<a name="l00568"></a>00568 <span class="comment">                 * left               = pos</span>
<a name="l00569"></a>00569 <span class="comment">                 * right              = pos + len</span>
<a name="l00570"></a>00570 <span class="comment">                 * left_nearest_edge  = ROUND(pos)</span>
<a name="l00571"></a>00571 <span class="comment">                 * right_nearest_edge = ROUND(right)</span>
<a name="l00572"></a>00572 <span class="comment">                 *</span>
<a name="l00573"></a>00573 <span class="comment">                 * if ( ABS(left_nearest_edge - left) &lt;=</span>
<a name="l00574"></a>00574 <span class="comment">                 *      ABS(right_nearest_edge - right) )</span>
<a name="l00575"></a>00575 <span class="comment">                 *    new_pos = left</span>
<a name="l00576"></a>00576 <span class="comment">                 * else</span>
<a name="l00577"></a>00577 <span class="comment">                 *    new_pos = right</span>
<a name="l00578"></a>00578 <span class="comment">                 */</span>
<a name="l00579"></a>00579                 <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  left_nearest  = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( pos );
<a name="l00580"></a>00580                 <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  right_nearest = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( pos + len );
<a name="l00581"></a>00581                 <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  left_disp     = left_nearest - pos;
<a name="l00582"></a>00582                 <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  right_disp    = right_nearest - ( pos + len );
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 
<a name="l00585"></a>00585                 <span class="keywordflow">if</span> ( left_disp &lt; 0 )
<a name="l00586"></a>00586                   left_disp = -left_disp;
<a name="l00587"></a>00587                 <span class="keywordflow">if</span> ( right_disp &lt; 0 )
<a name="l00588"></a>00588                   right_disp = -right_disp;
<a name="l00589"></a>00589                 <span class="keywordflow">if</span> ( left_disp &lt;= right_disp )
<a name="l00590"></a>00590                   pos = left_nearest;
<a name="l00591"></a>00591                 <span class="keywordflow">else</span>
<a name="l00592"></a>00592                   pos = right_nearest;
<a name="l00593"></a>00593               }
<a name="l00594"></a>00594               <span class="keywordflow">else</span>
<a name="l00595"></a>00595               {
<a name="l00596"></a>00596                 <span class="comment">/* this is a ghost stem; we simply round it */</span>
<a name="l00597"></a>00597                 pos = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( pos );
<a name="l00598"></a>00598               }
<a name="l00599"></a>00599             }
<a name="l00600"></a>00600             <span class="keywordflow">else</span>
<a name="l00601"></a>00601             {
<a name="l00602"></a>00602               len = psh_dimension_quantize_len( dim, len, 0 );
<a name="l00603"></a>00603             }
<a name="l00604"></a>00604           }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606           <span class="comment">/* now that we have a good hinted stem width, try to position */</span>
<a name="l00607"></a>00607           <span class="comment">/* the stem along a pixel grid integer coordinate             */</span>
<a name="l00608"></a>00608           hint-&gt;cur_pos = pos + psh_hint_snap_stem_side_delta( pos, len );
<a name="l00609"></a>00609           hint-&gt;cur_len = len;
<a name="l00610"></a>00610         }
<a name="l00611"></a>00611       }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613       <span class="keywordflow">if</span> ( do_snapping )
<a name="l00614"></a>00614       {
<a name="l00615"></a>00615         pos = hint-&gt;cur_pos;
<a name="l00616"></a>00616         len = hint-&gt;cur_len;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618         <span class="keywordflow">if</span> ( len &lt; 64 )
<a name="l00619"></a>00619           len = 64;
<a name="l00620"></a>00620         <span class="keywordflow">else</span>
<a name="l00621"></a>00621           len = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( len );
<a name="l00622"></a>00622 
<a name="l00623"></a>00623         <span class="keywordflow">switch</span> ( align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ae3e8c38c467a36922be68acdfc5e0f83">align</a> )
<a name="l00624"></a>00624         {
<a name="l00625"></a>00625           <span class="keywordflow">case</span> <a class="code" href="pshglob_8h.html#ad88c2735fa434d084fec9331c9f8d822">PSH_BLUE_ALIGN_TOP</a>:
<a name="l00626"></a>00626             hint-&gt;cur_pos = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#aa1138ec07d93acff80b1edd7be62ba44">align_top</a> - len;
<a name="l00627"></a>00627             hint-&gt;cur_len = len;
<a name="l00628"></a>00628             <span class="keywordflow">break</span>;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630           <span class="keywordflow">case</span> <a class="code" href="pshglob_8h.html#a44ea027d158949cc71eef840defab938">PSH_BLUE_ALIGN_BOT</a>:
<a name="l00631"></a>00631             hint-&gt;cur_len = len;
<a name="l00632"></a>00632             <span class="keywordflow">break</span>;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634           <span class="keywordflow">case</span> <a class="code" href="pshglob_8h.html#a44ea027d158949cc71eef840defab938">PSH_BLUE_ALIGN_BOT</a> | <a class="code" href="pshglob_8h.html#ad88c2735fa434d084fec9331c9f8d822">PSH_BLUE_ALIGN_TOP</a>:
<a name="l00635"></a>00635             <span class="comment">/* don&#39;t touch */</span>
<a name="l00636"></a>00636             <span class="keywordflow">break</span>;
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 
<a name="l00639"></a>00639           <span class="keywordflow">default</span>:
<a name="l00640"></a>00640             hint-&gt;cur_len = len;
<a name="l00641"></a>00641             <span class="keywordflow">if</span> ( len &amp; 64 )
<a name="l00642"></a>00642               pos = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( pos + ( len &gt;&gt; 1 ) ) + 32;
<a name="l00643"></a>00643             <span class="keywordflow">else</span>
<a name="l00644"></a>00644               pos = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( pos + ( len &gt;&gt; 1 ) );
<a name="l00645"></a>00645 
<a name="l00646"></a>00646             hint-&gt;cur_pos = pos - ( len &gt;&gt; 1 );
<a name="l00647"></a>00647             hint-&gt;cur_len = len;
<a name="l00648"></a>00648         }
<a name="l00649"></a>00649       }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651       <a class="code" href="pshalgo_8h.html#a94c15a12f2d8a3ed0356779d9d48a615">psh_hint_set_fitted</a>( hint );
<a name="l00652"></a>00652 
<a name="l00653"></a>00653 <span class="preprocessor">#ifdef DEBUG_HINTER</span>
<a name="l00654"></a>00654 <span class="preprocessor"></span>      <span class="keywordflow">if</span> ( ps_debug_hint_func )
<a name="l00655"></a>00655         ps_debug_hint_func( hint, dimension );
<a name="l00656"></a>00656 <span class="preprocessor">#endif</span>
<a name="l00657"></a>00657 <span class="preprocessor"></span>    }
<a name="l00658"></a>00658   }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 
<a name="l00661"></a>00661 <span class="preprocessor">#if 0  </span><span class="comment">/* not used for now, experimental */</span>
<a name="l00662"></a>00662 
<a name="l00663"></a>00663  <span class="comment">/*</span>
<a name="l00664"></a>00664 <span class="comment">  *  A variant to perform &quot;light&quot; hinting (i.e. FT_RENDER_MODE_LIGHT)</span>
<a name="l00665"></a>00665 <span class="comment">  *  of stems</span>
<a name="l00666"></a>00666 <span class="comment">  */</span>
<a name="l00667"></a>00667   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00668"></a>00668   psh_hint_align_light( <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>     hint,
<a name="l00669"></a>00669                         <a class="code" href="pshints_8h.html#aed4220b62b12a76456f9f47bafa5fe52">PSH_Globals</a>  globals,
<a name="l00670"></a>00670                         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>       dimension,
<a name="l00671"></a>00671                         <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>    glyph )
<a name="l00672"></a>00672   {
<a name="l00673"></a>00673     <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>  dim   = &amp;globals-&gt;dimension[dimension];
<a name="l00674"></a>00674     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       scale = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a0920c1e7f14cb5c759a41c14988bca80">scale_mult</a>;
<a name="l00675"></a>00675     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       delta = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a7fe63fc51c731760358d242dee84cd53">scale_delta</a>;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677 
<a name="l00678"></a>00678     <span class="keywordflow">if</span> ( !<a class="code" href="pshalgo_8h.html#a9728e231bb97048279dc4112332abcb0">psh_hint_is_fitted</a>( hint ) )
<a name="l00679"></a>00679     {
<a name="l00680"></a>00680       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  pos = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( hint-&gt;org_pos, scale ) + delta;
<a name="l00681"></a>00681       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  len = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( hint-&gt;org_len, scale );
<a name="l00682"></a>00682 
<a name="l00683"></a>00683       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  fit_len;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685       <a class="code" href="struct_p_s_h___alignment_rec__.html">PSH_AlignmentRec</a>  align;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 
<a name="l00688"></a>00688       <span class="comment">/* ignore stem alignments when requested through the hint flags */</span>
<a name="l00689"></a>00689       <span class="keywordflow">if</span> ( ( dimension == 0 &amp;&amp; !glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ab5785a8d814b94b34dc589b99aa8786f">do_horz_hints</a> ) ||
<a name="l00690"></a>00690            ( dimension == 1 &amp;&amp; !glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ad10d5dab79c9c7d5ba4ad6dcfebd355d">do_vert_hints</a> ) )
<a name="l00691"></a>00691       {
<a name="l00692"></a>00692         hint-&gt;cur_pos = pos;
<a name="l00693"></a>00693         hint-&gt;cur_len = len;
<a name="l00694"></a>00694 
<a name="l00695"></a>00695         <a class="code" href="pshalgo_8h.html#a94c15a12f2d8a3ed0356779d9d48a615">psh_hint_set_fitted</a>( hint );
<a name="l00696"></a>00696         <span class="keywordflow">return</span>;
<a name="l00697"></a>00697       }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699       fit_len = len;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701       hint-&gt;cur_len = fit_len;
<a name="l00702"></a>00702 
<a name="l00703"></a>00703       <span class="comment">/* check blue zones for horizontal stems */</span>
<a name="l00704"></a>00704       align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ae3e8c38c467a36922be68acdfc5e0f83">align</a> = <a class="code" href="pshglob_8h.html#a69e1e739a9b4515f57ae23eaa839593f">PSH_BLUE_ALIGN_NONE</a>;
<a name="l00705"></a>00705       align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ab6bfd035d92fb362085832c1e4a5e2f0">align_bot</a> = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#aa1138ec07d93acff80b1edd7be62ba44">align_top</a> = 0;
<a name="l00706"></a>00706 
<a name="l00707"></a>00707       <span class="keywordflow">if</span> ( dimension == 1 )
<a name="l00708"></a>00708         <a class="code" href="pshglob_8c.html#aa46f2d67325b6b317a82fc449e721984">psh_blues_snap_stem</a>( &amp;globals-&gt;blues,
<a name="l00709"></a>00709                              hint-&gt;org_pos + hint-&gt;org_len,
<a name="l00710"></a>00710                              hint-&gt;org_pos,
<a name="l00711"></a>00711                              &amp;align );
<a name="l00712"></a>00712 
<a name="l00713"></a>00713       <span class="keywordflow">switch</span> ( align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ae3e8c38c467a36922be68acdfc5e0f83">align</a> )
<a name="l00714"></a>00714       {
<a name="l00715"></a>00715       <span class="keywordflow">case</span> <a class="code" href="pshglob_8h.html#ad88c2735fa434d084fec9331c9f8d822">PSH_BLUE_ALIGN_TOP</a>:
<a name="l00716"></a>00716         <span class="comment">/* the top of the stem is aligned against a blue zone */</span>
<a name="l00717"></a>00717         hint-&gt;cur_pos = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#aa1138ec07d93acff80b1edd7be62ba44">align_top</a> - fit_len;
<a name="l00718"></a>00718         <span class="keywordflow">break</span>;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720       <span class="keywordflow">case</span> <a class="code" href="pshglob_8h.html#a44ea027d158949cc71eef840defab938">PSH_BLUE_ALIGN_BOT</a>:
<a name="l00721"></a>00721         <span class="comment">/* the bottom of the stem is aligned against a blue zone */</span>
<a name="l00722"></a>00722         hint-&gt;cur_pos = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ab6bfd035d92fb362085832c1e4a5e2f0">align_bot</a>;
<a name="l00723"></a>00723         <span class="keywordflow">break</span>;
<a name="l00724"></a>00724 
<a name="l00725"></a>00725       <span class="keywordflow">case</span> <a class="code" href="pshglob_8h.html#ad88c2735fa434d084fec9331c9f8d822">PSH_BLUE_ALIGN_TOP</a> | <a class="code" href="pshglob_8h.html#a44ea027d158949cc71eef840defab938">PSH_BLUE_ALIGN_BOT</a>:
<a name="l00726"></a>00726         <span class="comment">/* both edges of the stem are aligned against blue zones */</span>
<a name="l00727"></a>00727         hint-&gt;cur_pos = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ab6bfd035d92fb362085832c1e4a5e2f0">align_bot</a>;
<a name="l00728"></a>00728         hint-&gt;cur_len = align.<a class="code" href="struct_p_s_h___alignment_rec__.html#aa1138ec07d93acff80b1edd7be62ba44">align_top</a> - align.<a class="code" href="struct_p_s_h___alignment_rec__.html#ab6bfd035d92fb362085832c1e4a5e2f0">align_bot</a>;
<a name="l00729"></a>00729         <span class="keywordflow">break</span>;
<a name="l00730"></a>00730 
<a name="l00731"></a>00731       <span class="keywordflow">default</span>:
<a name="l00732"></a>00732         {
<a name="l00733"></a>00733           <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  parent = hint-&gt;parent;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735 
<a name="l00736"></a>00736           <span class="keywordflow">if</span> ( parent )
<a name="l00737"></a>00737           {
<a name="l00738"></a>00738             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  par_org_center, par_cur_center;
<a name="l00739"></a>00739             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  cur_org_center, cur_delta;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741 
<a name="l00742"></a>00742             <span class="comment">/* ensure that parent is already fitted */</span>
<a name="l00743"></a>00743             <span class="keywordflow">if</span> ( !<a class="code" href="pshalgo_8h.html#a9728e231bb97048279dc4112332abcb0">psh_hint_is_fitted</a>( parent ) )
<a name="l00744"></a>00744               psh_hint_align_light( parent, globals, dimension, glyph );
<a name="l00745"></a>00745 
<a name="l00746"></a>00746             par_org_center = parent-&gt;org_pos + ( parent-&gt;org_len / 2 );
<a name="l00747"></a>00747             par_cur_center = parent-&gt;cur_pos + ( parent-&gt;cur_len / 2 );
<a name="l00748"></a>00748             cur_org_center = hint-&gt;org_pos   + ( hint-&gt;org_len   / 2 );
<a name="l00749"></a>00749 
<a name="l00750"></a>00750             cur_delta = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( cur_org_center - par_org_center, scale );
<a name="l00751"></a>00751             pos       = par_cur_center + cur_delta - ( len &gt;&gt; 1 );
<a name="l00752"></a>00752           }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754           <span class="comment">/* Stems less than one pixel wide are easy -- we want to</span>
<a name="l00755"></a>00755 <span class="comment">           * make them as dark as possible, so they must fall within</span>
<a name="l00756"></a>00756 <span class="comment">           * one pixel.  If the stem is split between two pixels</span>
<a name="l00757"></a>00757 <span class="comment">           * then snap the edge that is nearer to the pixel boundary</span>
<a name="l00758"></a>00758 <span class="comment">           * to the pixel boundary.</span>
<a name="l00759"></a>00759 <span class="comment">           */</span>
<a name="l00760"></a>00760           <span class="keywordflow">if</span> ( len &lt;= 64 )
<a name="l00761"></a>00761           {
<a name="l00762"></a>00762             <span class="keywordflow">if</span> ( ( pos + len + 63 ) / 64  != pos / 64 + 1 )
<a name="l00763"></a>00763               pos += psh_hint_snap_stem_side_delta ( pos, len );
<a name="l00764"></a>00764           }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766           <span class="comment">/* Position stems other to minimize the amount of mid-grays.</span>
<a name="l00767"></a>00767 <span class="comment">           * There are, in general, two positions that do this,</span>
<a name="l00768"></a>00768 <span class="comment">           * illustrated as A) and B) below.</span>
<a name="l00769"></a>00769 <span class="comment">           *</span>
<a name="l00770"></a>00770 <span class="comment">           *   +                   +                   +                   +</span>
<a name="l00771"></a>00771 <span class="comment">           *</span>
<a name="l00772"></a>00772 <span class="comment">           * A)             |--------------------------------|</span>
<a name="l00773"></a>00773 <span class="comment">           * B)   |--------------------------------|</span>
<a name="l00774"></a>00774 <span class="comment">           * C)       |--------------------------------|</span>
<a name="l00775"></a>00775 <span class="comment">           *</span>
<a name="l00776"></a>00776 <span class="comment">           * Position A) (split the excess stem equally) should be better</span>
<a name="l00777"></a>00777 <span class="comment">           * for stems of width N + f where f &lt; 0.5.</span>
<a name="l00778"></a>00778 <span class="comment">           *</span>
<a name="l00779"></a>00779 <span class="comment">           * Position B) (split the deficiency equally) should be better</span>
<a name="l00780"></a>00780 <span class="comment">           * for stems of width N + f where f &gt; 0.5.</span>
<a name="l00781"></a>00781 <span class="comment">           *</span>
<a name="l00782"></a>00782 <span class="comment">           * It turns out though that minimizing the total number of lit</span>
<a name="l00783"></a>00783 <span class="comment">           * pixels is also important, so position C), with one edge</span>
<a name="l00784"></a>00784 <span class="comment">           * aligned with a pixel boundary is actually preferable</span>
<a name="l00785"></a>00785 <span class="comment">           * to A).  There are also more possibile positions for C) than</span>
<a name="l00786"></a>00786 <span class="comment">           * for A) or B), so it involves less distortion of the overall</span>
<a name="l00787"></a>00787 <span class="comment">           * character shape.</span>
<a name="l00788"></a>00788 <span class="comment">           */</span>
<a name="l00789"></a>00789           <span class="keywordflow">else</span> <span class="comment">/* len &gt; 64 */</span>
<a name="l00790"></a>00790           {
<a name="l00791"></a>00791             <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  frac_len = len &amp; 63;
<a name="l00792"></a>00792             <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  center = pos + ( len &gt;&gt; 1 );
<a name="l00793"></a>00793             <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  delta_a, delta_b;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 
<a name="l00796"></a>00796             <span class="keywordflow">if</span> ( ( len / 64 ) &amp; 1 )
<a name="l00797"></a>00797             {
<a name="l00798"></a>00798               delta_a = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( center ) + 32 - center;
<a name="l00799"></a>00799               delta_b = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( center ) - center;
<a name="l00800"></a>00800             }
<a name="l00801"></a>00801             <span class="keywordflow">else</span>
<a name="l00802"></a>00802             {
<a name="l00803"></a>00803               delta_a = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( center ) - center;
<a name="l00804"></a>00804               delta_b = <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( center ) + 32 - center;
<a name="l00805"></a>00805             }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807             <span class="comment">/* We choose between B) and C) above based on the amount</span>
<a name="l00808"></a>00808 <span class="comment">             * of fractinal stem width; for small amounts, choose</span>
<a name="l00809"></a>00809 <span class="comment">             * C) always, for large amounts, B) always, and inbetween,</span>
<a name="l00810"></a>00810 <span class="comment">             * pick whichever one involves less stem movement.</span>
<a name="l00811"></a>00811 <span class="comment">             */</span>
<a name="l00812"></a>00812             <span class="keywordflow">if</span> ( frac_len &lt; 32 )
<a name="l00813"></a>00813             {
<a name="l00814"></a>00814               pos += psh_hint_snap_stem_side_delta ( pos, len );
<a name="l00815"></a>00815             }
<a name="l00816"></a>00816             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( frac_len &lt; 48 )
<a name="l00817"></a>00817             {
<a name="l00818"></a>00818               <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  side_delta = psh_hint_snap_stem_side_delta ( pos,
<a name="l00819"></a>00819                                                                      len );
<a name="l00820"></a>00820 
<a name="l00821"></a>00821               <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a2e917e84ed753da51ddd54c784b5991d">FT_ABS</a>( side_delta ) &lt; <a class="code" href="ftobjs_8h.html#a2e917e84ed753da51ddd54c784b5991d">FT_ABS</a>( delta_b ) )
<a name="l00822"></a>00822                 pos += side_delta;
<a name="l00823"></a>00823               <span class="keywordflow">else</span>
<a name="l00824"></a>00824                 pos += delta_b;
<a name="l00825"></a>00825             }
<a name="l00826"></a>00826             <span class="keywordflow">else</span>
<a name="l00827"></a>00827             {
<a name="l00828"></a>00828               pos += delta_b;
<a name="l00829"></a>00829             }
<a name="l00830"></a>00830           }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832           hint-&gt;cur_pos = pos;
<a name="l00833"></a>00833         }
<a name="l00834"></a>00834       }  <span class="comment">/* switch */</span>
<a name="l00835"></a>00835 
<a name="l00836"></a>00836       <a class="code" href="pshalgo_8h.html#a94c15a12f2d8a3ed0356779d9d48a615">psh_hint_set_fitted</a>( hint );
<a name="l00837"></a>00837 
<a name="l00838"></a>00838 <span class="preprocessor">#ifdef DEBUG_HINTER</span>
<a name="l00839"></a>00839 <span class="preprocessor"></span>      <span class="keywordflow">if</span> ( ps_debug_hint_func )
<a name="l00840"></a>00840         ps_debug_hint_func( hint, dimension );
<a name="l00841"></a>00841 <span class="preprocessor">#endif</span>
<a name="l00842"></a>00842 <span class="preprocessor"></span>    }
<a name="l00843"></a>00843   }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 <span class="preprocessor">#endif </span><span class="comment">/* 0 */</span>
<a name="l00846"></a>00846 
<a name="l00847"></a>00847 
<a name="l00848"></a>00848   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00849"></a>00849   psh_hint_table_align_hints( <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table,
<a name="l00850"></a>00850                               <a class="code" href="pshints_8h.html#aed4220b62b12a76456f9f47bafa5fe52">PSH_Globals</a>     globals,
<a name="l00851"></a>00851                               <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>          dimension,
<a name="l00852"></a>00852                               <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>       glyph )
<a name="l00853"></a>00853   {
<a name="l00854"></a>00854     <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>       hint;
<a name="l00855"></a>00855     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>        count;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857 <span class="preprocessor">#ifdef DEBUG_HINTER</span>
<a name="l00858"></a>00858 <span class="preprocessor"></span>
<a name="l00859"></a>00859     <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>  dim   = &amp;globals-&gt;dimension[dimension];
<a name="l00860"></a>00860     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       scale = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a0920c1e7f14cb5c759a41c14988bca80">scale_mult</a>;
<a name="l00861"></a>00861     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       delta = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a7fe63fc51c731760358d242dee84cd53">scale_delta</a>;
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <span class="keywordflow">if</span> ( ps_debug_no_vert_hints &amp;&amp; dimension == 0 )
<a name="l00865"></a>00865     {
<a name="l00866"></a>00866       ps_simple_scale( table, scale, delta, dimension );
<a name="l00867"></a>00867       <span class="keywordflow">return</span>;
<a name="l00868"></a>00868     }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870     <span class="keywordflow">if</span> ( ps_debug_no_horz_hints &amp;&amp; dimension == 1 )
<a name="l00871"></a>00871     {
<a name="l00872"></a>00872       ps_simple_scale( table, scale, delta, dimension );
<a name="l00873"></a>00873       <span class="keywordflow">return</span>;
<a name="l00874"></a>00874     }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 <span class="preprocessor">#endif </span><span class="comment">/* DEBUG_HINTER*/</span>
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     hint  = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a845075fb5ed4acc6f024892aa00267e0">hints</a>;
<a name="l00879"></a>00879     count = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a09397cc20944d33d6da97560b619c5ba">max_hints</a>;
<a name="l00880"></a>00880 
<a name="l00881"></a>00881     <span class="keywordflow">for</span> ( ; count &gt; 0; count--, hint++ )
<a name="l00882"></a>00882       psh_hint_align( hint, globals, dimension, glyph );
<a name="l00883"></a>00883   }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885 
<a name="l00886"></a>00886   <span class="comment">/*************************************************************************/</span>
<a name="l00887"></a>00887   <span class="comment">/*************************************************************************/</span>
<a name="l00888"></a>00888   <span class="comment">/*****                                                               *****/</span>
<a name="l00889"></a>00889   <span class="comment">/*****                POINTS INTERPOLATION ROUTINES                  *****/</span>
<a name="l00890"></a>00890   <span class="comment">/*****                                                               *****/</span>
<a name="l00891"></a>00891   <span class="comment">/*************************************************************************/</span>
<a name="l00892"></a>00892   <span class="comment">/*************************************************************************/</span>
<a name="l00893"></a>00893 
<a name="l00894"></a><a class="code" href="pshalgo_8c.html#ab6509b0ecf27e63b7ccb25691340992f">00894</a> <span class="preprocessor">#define PSH_ZONE_MIN  -3200000L</span>
<a name="l00895"></a><a class="code" href="pshalgo_8c.html#a9649d58de4fae8be130e45643e2ffaa2">00895</a> <span class="preprocessor"></span><span class="preprocessor">#define PSH_ZONE_MAX  +3200000L</span>
<a name="l00896"></a>00896 <span class="preprocessor"></span>
<a name="l00897"></a><a class="code" href="pshalgo_8c.html#acafc0ef4600c8f44877d36412a988b83">00897</a> <span class="preprocessor">#define xxDEBUG_ZONES</span>
<a name="l00898"></a>00898 <span class="preprocessor"></span>
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 <span class="preprocessor">#ifdef DEBUG_ZONES</span>
<a name="l00901"></a>00901 <span class="preprocessor"></span>
<a name="l00902"></a>00902 <span class="preprocessor">#include FT_CONFIG_STANDARD_LIBRARY_H</span>
<a name="l00903"></a>00903 <span class="preprocessor"></span>
<a name="l00904"></a>00904   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00905"></a>00905   <a class="code" href="pshalgo_8c.html#a6dcc09f1ae92a62507465f9cbe3f8841">psh_print_zone</a>( <a class="code" href="struct_p_s_h___zone_rec__.html">PSH_Zone</a>  zone )
<a name="l00906"></a>00906   {
<a name="l00907"></a>00907     printf( <span class="stringliteral">&quot;zone [scale,delta,min,max] = [%.3f,%.3f,%d,%d]\n&quot;</span>,
<a name="l00908"></a>00908              zone-&gt;<a class="code" href="struct_p_s_h___zone_rec__.html#ab93eb10ed45acf60824a40ced702a920">scale</a> / 65536.0,
<a name="l00909"></a>00909              zone-&gt;<a class="code" href="struct_p_s_h___zone_rec__.html#adc0752fc9ceceb51a59fd25b86ba6ded">delta</a> / 64.0,
<a name="l00910"></a>00910              zone-&gt;<a class="code" href="struct_p_s_h___zone_rec__.html#a59f0c416cf9cafe1649ec79d0f705ba8">min</a>,
<a name="l00911"></a>00911              zone-&gt;<a class="code" href="struct_p_s_h___zone_rec__.html#a0e7356897012e58fae815290c2363978">max</a> );
<a name="l00912"></a>00912   }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914 <span class="preprocessor">#else</span>
<a name="l00915"></a>00915 <span class="preprocessor"></span>
<a name="l00916"></a><a class="code" href="pshalgo_8c.html#a6dcc09f1ae92a62507465f9cbe3f8841">00916</a> <span class="preprocessor">#define psh_print_zone( x )  do { } while ( 0 )</span>
<a name="l00917"></a>00917 <span class="preprocessor"></span>
<a name="l00918"></a>00918 <span class="preprocessor">#endif </span><span class="comment">/* DEBUG_ZONES */</span>
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 
<a name="l00921"></a>00921   <span class="comment">/*************************************************************************/</span>
<a name="l00922"></a>00922   <span class="comment">/*************************************************************************/</span>
<a name="l00923"></a>00923   <span class="comment">/*****                                                               *****/</span>
<a name="l00924"></a>00924   <span class="comment">/*****                    HINTER GLYPH MANAGEMENT                    *****/</span>
<a name="l00925"></a>00925   <span class="comment">/*****                                                               *****/</span>
<a name="l00926"></a>00926   <span class="comment">/*************************************************************************/</span>
<a name="l00927"></a>00927   <span class="comment">/*************************************************************************/</span>
<a name="l00928"></a>00928 
<a name="l00929"></a>00929 <span class="preprocessor">#if 1</span>
<a name="l00930"></a>00930 <span class="preprocessor"></span>
<a name="l00931"></a><a class="code" href="pshalgo_8c.html#a25282eaa6f8fdd47343d7597f095ba9e">00931</a> <span class="preprocessor">#define  psh_corner_is_flat      ft_corner_is_flat</span>
<a name="l00932"></a><a class="code" href="pshalgo_8c.html#ac44a3a233f38436009288c642cf39740">00932</a> <span class="preprocessor"></span><span class="preprocessor">#define  psh_corner_orientation  ft_corner_orientation</span>
<a name="l00933"></a>00933 <span class="preprocessor"></span>
<a name="l00934"></a>00934 <span class="preprocessor">#else</span>
<a name="l00935"></a>00935 <span class="preprocessor"></span>
<a name="l00936"></a>00936   <a class="code" href="ftconfig_8h.html#a065cda933183dff5dc368794eefa7c93">FT_LOCAL_DEF</a>( <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a> )
<a name="l00937"></a>00937   <a class="code" href="pshalgo_8c.html#a25282eaa6f8fdd47343d7597f095ba9e">psh_corner_is_flat</a>( <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  x_in,
<a name="l00938"></a>00938                       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  y_in,
<a name="l00939"></a>00939                       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  x_out,
<a name="l00940"></a>00940                       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  y_out )
<a name="l00941"></a>00941   {
<a name="l00942"></a>00942     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  ax = x_in;
<a name="l00943"></a>00943     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  ay = y_in;
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  d_in, d_out, d_corner;
<a name="l00946"></a>00946 
<a name="l00947"></a>00947 
<a name="l00948"></a>00948     <span class="keywordflow">if</span> ( ax &lt; 0 )
<a name="l00949"></a>00949       ax = -ax;
<a name="l00950"></a>00950     <span class="keywordflow">if</span> ( ay &lt; 0 )
<a name="l00951"></a>00951       ay = -ay;
<a name="l00952"></a>00952     d_in = ax + ay;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     ax = x_out;
<a name="l00955"></a>00955     <span class="keywordflow">if</span> ( ax &lt; 0 )
<a name="l00956"></a>00956       ax = -ax;
<a name="l00957"></a>00957     ay = y_out;
<a name="l00958"></a>00958     <span class="keywordflow">if</span> ( ay &lt; 0 )
<a name="l00959"></a>00959       ay = -ay;
<a name="l00960"></a>00960     d_out = ax + ay;
<a name="l00961"></a>00961 
<a name="l00962"></a>00962     ax = x_out + x_in;
<a name="l00963"></a>00963     <span class="keywordflow">if</span> ( ax &lt; 0 )
<a name="l00964"></a>00964       ax = -ax;
<a name="l00965"></a>00965     ay = y_out + y_in;
<a name="l00966"></a>00966     <span class="keywordflow">if</span> ( ay &lt; 0 )
<a name="l00967"></a>00967       ay = -ay;
<a name="l00968"></a>00968     d_corner = ax + ay;
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     <span class="keywordflow">return</span> ( d_in + d_out - d_corner ) &lt; ( d_corner &gt;&gt; 4 );
<a name="l00971"></a>00971   }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>
<a name="l00974"></a>00974   <a class="code" href="pshalgo_8c.html#ac44a3a233f38436009288c642cf39740">psh_corner_orientation</a>( <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  in_x,
<a name="l00975"></a>00975                           <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  in_y,
<a name="l00976"></a>00976                           <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  out_x,
<a name="l00977"></a>00977                           <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  out_y )
<a name="l00978"></a>00978   {
<a name="l00979"></a>00979     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l00980"></a>00980 
<a name="l00981"></a>00981 
<a name="l00982"></a>00982     <span class="comment">/* deal with the trivial cases quickly */</span>
<a name="l00983"></a>00983     <span class="keywordflow">if</span> ( in_y == 0 )
<a name="l00984"></a>00984     {
<a name="l00985"></a>00985       <span class="keywordflow">if</span> ( in_x &gt;= 0 )
<a name="l00986"></a>00986         result = out_y;
<a name="l00987"></a>00987       <span class="keywordflow">else</span>
<a name="l00988"></a>00988         result = -out_y;
<a name="l00989"></a>00989     }
<a name="l00990"></a>00990     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( in_x == 0 )
<a name="l00991"></a>00991     {
<a name="l00992"></a>00992       <span class="keywordflow">if</span> ( in_y &gt;= 0 )
<a name="l00993"></a>00993         result = -out_x;
<a name="l00994"></a>00994       <span class="keywordflow">else</span>
<a name="l00995"></a>00995         result = out_x;
<a name="l00996"></a>00996     }
<a name="l00997"></a>00997     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( out_y == 0 )
<a name="l00998"></a>00998     {
<a name="l00999"></a>00999       <span class="keywordflow">if</span> ( out_x &gt;= 0 )
<a name="l01000"></a>01000         result = in_y;
<a name="l01001"></a>01001       <span class="keywordflow">else</span>
<a name="l01002"></a>01002         result = -in_y;
<a name="l01003"></a>01003     }
<a name="l01004"></a>01004     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( out_x == 0 )
<a name="l01005"></a>01005     {
<a name="l01006"></a>01006       <span class="keywordflow">if</span> ( out_y &gt;= 0 )
<a name="l01007"></a>01007         result = -in_x;
<a name="l01008"></a>01008       <span class="keywordflow">else</span>
<a name="l01009"></a>01009         result =  in_x;
<a name="l01010"></a>01010     }
<a name="l01011"></a>01011     <span class="keywordflow">else</span> <span class="comment">/* general case */</span>
<a name="l01012"></a>01012     {
<a name="l01013"></a>01013       <span class="keywordtype">long</span> <span class="keywordtype">long</span>  delta = (<span class="keywordtype">long</span> long)in_x * out_y - (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)in_y * out_x;
<a name="l01014"></a>01014 
<a name="l01015"></a>01015       <span class="keywordflow">if</span> ( delta == 0 )
<a name="l01016"></a>01016         result = 0;
<a name="l01017"></a>01017       <span class="keywordflow">else</span>
<a name="l01018"></a>01018         result = 1 - 2 * ( delta &lt; 0 );
<a name="l01019"></a>01019     }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l01022"></a>01022   }
<a name="l01023"></a>01023 
<a name="l01024"></a>01024 <span class="preprocessor">#endif </span><span class="comment">/* !1 */</span>
<a name="l01025"></a>01025 
<a name="l01026"></a>01026 
<a name="l01027"></a>01027 <span class="preprocessor">#ifdef COMPUTE_INFLEXS</span>
<a name="l01028"></a>01028 <span class="preprocessor"></span>
<a name="l01029"></a>01029   <span class="comment">/* compute all inflex points in a given glyph */</span>
<a name="l01030"></a>01030   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01031"></a>01031   psh_glyph_compute_inflections( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph )
<a name="l01032"></a>01032   {
<a name="l01033"></a>01033     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 
<a name="l01036"></a>01036     <span class="keywordflow">for</span> ( n = 0; n &lt; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a742cca21d75380d3b3c6589f2e69aec4">num_contours</a>; n++ )
<a name="l01037"></a>01037     {
<a name="l01038"></a>01038       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  first, start, end, before, after;
<a name="l01039"></a>01039       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>     in_x, in_y, out_x, out_y;
<a name="l01040"></a>01040       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     orient_prev, orient_cur;
<a name="l01041"></a>01041       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     finished = 0;
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 
<a name="l01044"></a>01044       <span class="comment">/* we need at least 4 points to create an inflection point */</span>
<a name="l01045"></a>01045       <span class="keywordflow">if</span> ( glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ade9e594cd9ede3162787b2be47e5b719">contours</a>[n].<a class="code" href="struct_p_s_h___contour_rec__.html#a5d45ebbfcc7c5cb394ddae2e1b9dacf3">count</a> &lt; 4 )
<a name="l01046"></a>01046         <span class="keywordflow">continue</span>;
<a name="l01047"></a>01047 
<a name="l01048"></a>01048       <span class="comment">/* compute first segment in contour */</span>
<a name="l01049"></a>01049       first = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ade9e594cd9ede3162787b2be47e5b719">contours</a>[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>].<a class="code" href="struct_p_s_h___contour_rec__.html#ada292eef1584e5f887bea69ba8703aa2">start</a>;
<a name="l01050"></a>01050 
<a name="l01051"></a>01051       start = end = first;
<a name="l01052"></a>01052       <span class="keywordflow">do</span>
<a name="l01053"></a>01053       {
<a name="l01054"></a>01054         end = end-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l01055"></a>01055         <span class="keywordflow">if</span> ( end == first )
<a name="l01056"></a>01056           <span class="keywordflow">goto</span> Skip;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058         in_x = end-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> - start-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>;
<a name="l01059"></a>01059         in_y = end-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> - start-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a>;
<a name="l01060"></a>01060 
<a name="l01061"></a>01061       } <span class="keywordflow">while</span> ( in_x == 0 &amp;&amp; in_y == 0 );
<a name="l01062"></a>01062 
<a name="l01063"></a>01063       <span class="comment">/* extend the segment start whenever possible */</span>
<a name="l01064"></a>01064       before = start;
<a name="l01065"></a>01065       <span class="keywordflow">do</span>
<a name="l01066"></a>01066       {
<a name="l01067"></a>01067         <span class="keywordflow">do</span>
<a name="l01068"></a>01068         {
<a name="l01069"></a>01069           start  = before;
<a name="l01070"></a>01070           before = before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4bcea810dd0a31e9a2ecf6a9a9f1f54e">prev</a>;
<a name="l01071"></a>01071           <span class="keywordflow">if</span> ( before == first )
<a name="l01072"></a>01072             <span class="keywordflow">goto</span> Skip;
<a name="l01073"></a>01073 
<a name="l01074"></a>01074           out_x = start-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> - before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>;
<a name="l01075"></a>01075           out_y = start-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> - before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a>;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077         } <span class="keywordflow">while</span> ( out_x == 0 &amp;&amp; out_y == 0 );
<a name="l01078"></a>01078 
<a name="l01079"></a>01079         orient_prev = <a class="code" href="pshalgo_8c.html#ac44a3a233f38436009288c642cf39740">psh_corner_orientation</a>( in_x, in_y, out_x, out_y );
<a name="l01080"></a>01080 
<a name="l01081"></a>01081       } <span class="keywordflow">while</span> ( orient_prev == 0 );
<a name="l01082"></a>01082 
<a name="l01083"></a>01083       first = start;
<a name="l01084"></a>01084       in_x  = out_x;
<a name="l01085"></a>01085       in_y  = out_y;
<a name="l01086"></a>01086 
<a name="l01087"></a>01087       <span class="comment">/* now, process all segments in the contour */</span>
<a name="l01088"></a>01088       <span class="keywordflow">do</span>
<a name="l01089"></a>01089       {
<a name="l01090"></a>01090         <span class="comment">/* first, extend current segment&#39;s end whenever possible */</span>
<a name="l01091"></a>01091         after = end;
<a name="l01092"></a>01092         <span class="keywordflow">do</span>
<a name="l01093"></a>01093         {
<a name="l01094"></a>01094           <span class="keywordflow">do</span>
<a name="l01095"></a>01095           {
<a name="l01096"></a>01096             end   = after;
<a name="l01097"></a>01097             after = after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l01098"></a>01098             <span class="keywordflow">if</span> ( after == first )
<a name="l01099"></a>01099               finished = 1;
<a name="l01100"></a>01100 
<a name="l01101"></a>01101             out_x = after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> - end-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>;
<a name="l01102"></a>01102             out_y = after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> - end-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a>;
<a name="l01103"></a>01103 
<a name="l01104"></a>01104           } <span class="keywordflow">while</span> ( out_x == 0 &amp;&amp; out_y == 0 );
<a name="l01105"></a>01105 
<a name="l01106"></a>01106           orient_cur = <a class="code" href="pshalgo_8c.html#ac44a3a233f38436009288c642cf39740">psh_corner_orientation</a>( in_x, in_y, out_x, out_y );
<a name="l01107"></a>01107 
<a name="l01108"></a>01108         } <span class="keywordflow">while</span> ( orient_cur == 0 );
<a name="l01109"></a>01109 
<a name="l01110"></a>01110         <span class="keywordflow">if</span> ( ( orient_cur ^ orient_prev ) &lt; 0 )
<a name="l01111"></a>01111         {
<a name="l01112"></a>01112           <span class="keywordflow">do</span>
<a name="l01113"></a>01113           {
<a name="l01114"></a>01114             <a class="code" href="pshalgo_8h.html#a2153dbbae6aa3fc972723b3d9a595f6f">psh_point_set_inflex</a>( start );
<a name="l01115"></a>01115             start = start-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l01116"></a>01116           }
<a name="l01117"></a>01117           <span class="keywordflow">while</span> ( start != end );
<a name="l01118"></a>01118 
<a name="l01119"></a>01119           <a class="code" href="pshalgo_8h.html#a2153dbbae6aa3fc972723b3d9a595f6f">psh_point_set_inflex</a>( start );
<a name="l01120"></a>01120         }
<a name="l01121"></a>01121 
<a name="l01122"></a>01122         start       = end;
<a name="l01123"></a>01123         end         = after;
<a name="l01124"></a>01124         orient_prev = orient_cur;
<a name="l01125"></a>01125         in_x        = out_x;
<a name="l01126"></a>01126         in_y        = out_y;
<a name="l01127"></a>01127 
<a name="l01128"></a>01128       } <span class="keywordflow">while</span> ( !finished );
<a name="l01129"></a>01129 
<a name="l01130"></a>01130     Skip:
<a name="l01131"></a>01131       ;
<a name="l01132"></a>01132     }
<a name="l01133"></a>01133   }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135 <span class="preprocessor">#endif </span><span class="comment">/* COMPUTE_INFLEXS */</span>
<a name="l01136"></a>01136 
<a name="l01137"></a>01137 
<a name="l01138"></a>01138   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01139"></a>01139   psh_glyph_done( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph )
<a name="l01140"></a>01140   {
<a name="l01141"></a>01141     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a303af9b985cdd171dc2eb9121ba8f2a2">memory</a>;
<a name="l01142"></a>01142 
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     psh_hint_table_done( &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae46b190c2bdf88f967078b11b8c05153">hint_tables</a>[1], memory );
<a name="l01145"></a>01145     psh_hint_table_done( &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae46b190c2bdf88f967078b11b8c05153">hint_tables</a>[0], memory );
<a name="l01146"></a>01146 
<a name="l01147"></a>01147     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a> );
<a name="l01148"></a>01148     <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ade9e594cd9ede3162787b2be47e5b719">contours</a> );
<a name="l01149"></a>01149 
<a name="l01150"></a>01150     glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>   = 0;
<a name="l01151"></a>01151     glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a742cca21d75380d3b3c6589f2e69aec4">num_contours</a> = 0;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a303af9b985cdd171dc2eb9121ba8f2a2">memory</a> = 0;
<a name="l01154"></a>01154   }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156 
<a name="l01157"></a>01157   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01158"></a>01158   psh_compute_dir( <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  dx,
<a name="l01159"></a>01159                    <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  dy )
<a name="l01160"></a>01160   {
<a name="l01161"></a>01161     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  ax, ay;
<a name="l01162"></a>01162     <span class="keywordtype">int</span>     result = <a class="code" href="pshalgo_8h.html#abed82baf7f470b522273a3e37c24c600ab088f26343924fb63ec139c46b421512">PSH_DIR_NONE</a>;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164 
<a name="l01165"></a>01165     ax = ( dx &gt;= 0 ) ? dx : -dx;
<a name="l01166"></a>01166     ay = ( dy &gt;= 0 ) ? dy : -dy;
<a name="l01167"></a>01167 
<a name="l01168"></a>01168     <span class="keywordflow">if</span> ( ay * 12 &lt; ax )
<a name="l01169"></a>01169     {
<a name="l01170"></a>01170       <span class="comment">/* |dy| &lt;&lt;&lt; |dx|  means a near-horizontal segment */</span>
<a name="l01171"></a>01171       result = ( dx &gt;= 0 ) ? <a class="code" href="pshalgo_8h.html#abed82baf7f470b522273a3e37c24c600a6ecfc6f91fff3897181334ec5852bd99">PSH_DIR_RIGHT</a> : <a class="code" href="pshalgo_8h.html#abed82baf7f470b522273a3e37c24c600a10b972e272eeb840024ccb0d092e558a">PSH_DIR_LEFT</a>;
<a name="l01172"></a>01172     }
<a name="l01173"></a>01173     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ax * 12 &lt; ay )
<a name="l01174"></a>01174     {
<a name="l01175"></a>01175       <span class="comment">/* |dx| &lt;&lt;&lt; |dy|  means a near-vertical segment */</span>
<a name="l01176"></a>01176       result = ( dy &gt;= 0 ) ? <a class="code" href="pshalgo_8h.html#abed82baf7f470b522273a3e37c24c600a3219f3b76f9cabc386f16cb3eab95c4d">PSH_DIR_UP</a> : <a class="code" href="pshalgo_8h.html#abed82baf7f470b522273a3e37c24c600aae086fa35014b819e1915443e877921c">PSH_DIR_DOWN</a>;
<a name="l01177"></a>01177     }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179     <span class="keywordflow">return</span> <a class="code" href="jsonmain_8cpp.html#ade6d6d18a46c8aa95eed5e179d003e45">result</a>;
<a name="l01180"></a>01180   }
<a name="l01181"></a>01181 
<a name="l01182"></a>01182 
<a name="l01183"></a>01183   <span class="comment">/* load outline point coordinates into hinter glyph */</span>
<a name="l01184"></a>01184   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01185"></a>01185   psh_glyph_load_points( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph,
<a name="l01186"></a>01186                          <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     dimension )
<a name="l01187"></a>01187   {
<a name="l01188"></a>01188     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  vec   = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a8c015e611027f9066a151443f2fc3ef0">outline</a>-&gt;<a class="code" href="struct_f_t___outline__.html#a4871896a2f38bdab947e30a7cf6bca04">points</a>;
<a name="l01189"></a>01189     <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>   point = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>;
<a name="l01190"></a>01190     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     count = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>;
<a name="l01191"></a>01191 
<a name="l01192"></a>01192 
<a name="l01193"></a>01193     <span class="keywordflow">for</span> ( ; count &gt; 0; count--, point++, vec++ )
<a name="l01194"></a>01194     {
<a name="l01195"></a>01195       point-&gt;flags2 = 0;
<a name="l01196"></a>01196       point-&gt;hint   = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01197"></a>01197       <span class="keywordflow">if</span> ( dimension == 0 )
<a name="l01198"></a>01198       {
<a name="l01199"></a>01199         point-&gt;org_u = vec-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l01200"></a>01200         point-&gt;org_v = vec-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01201"></a>01201       }
<a name="l01202"></a>01202       <span class="keywordflow">else</span>
<a name="l01203"></a>01203       {
<a name="l01204"></a>01204         point-&gt;org_u = vec-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01205"></a>01205         point-&gt;org_v = vec-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l01206"></a>01206       }
<a name="l01207"></a>01207 
<a name="l01208"></a>01208 <span class="preprocessor">#ifdef DEBUG_HINTER</span>
<a name="l01209"></a>01209 <span class="preprocessor"></span>      point-&gt;org_x = vec-&gt;<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l01210"></a>01210       point-&gt;org_y = vec-&gt;<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01211"></a>01211 <span class="preprocessor">#endif</span>
<a name="l01212"></a>01212 <span class="preprocessor"></span>
<a name="l01213"></a>01213     }
<a name="l01214"></a>01214   }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216 
<a name="l01217"></a>01217   <span class="comment">/* save hinted point coordinates back to outline */</span>
<a name="l01218"></a>01218   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01219"></a>01219   psh_glyph_save_points( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph,
<a name="l01220"></a>01220                          <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     dimension )
<a name="l01221"></a>01221   {
<a name="l01222"></a>01222     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l01223"></a>01223     <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>   point = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>;
<a name="l01224"></a>01224     <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  vec   = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a8c015e611027f9066a151443f2fc3ef0">outline</a>-&gt;<a class="code" href="struct_f_t___outline__.html#a4871896a2f38bdab947e30a7cf6bca04">points</a>;
<a name="l01225"></a>01225     <span class="keywordtype">char</span>*       tags  = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a8c015e611027f9066a151443f2fc3ef0">outline</a>-&gt;<a class="code" href="struct_f_t___outline__.html#ac84ca66907361e1f49ec11c14720087a">tags</a>;
<a name="l01226"></a>01226 
<a name="l01227"></a>01227 
<a name="l01228"></a>01228     <span class="keywordflow">for</span> ( n = 0; n &lt; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>; n++ )
<a name="l01229"></a>01229     {
<a name="l01230"></a>01230       <span class="keywordflow">if</span> ( dimension == 0 )
<a name="l01231"></a>01231         vec[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a>;
<a name="l01232"></a>01232       <span class="keywordflow">else</span>
<a name="l01233"></a>01233         vec[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a>;
<a name="l01234"></a>01234 
<a name="l01235"></a>01235       <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a0b02d3a613fb16b6bb68da871814dd89">psh_point_is_strong</a>( point ) )
<a name="l01236"></a>01236         tags[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>] |= (char)( ( dimension == 0 ) ? 32 : 64 );
<a name="l01237"></a>01237 
<a name="l01238"></a>01238 <span class="preprocessor">#ifdef DEBUG_HINTER</span>
<a name="l01239"></a>01239 <span class="preprocessor"></span>
<a name="l01240"></a>01240       <span class="keywordflow">if</span> ( dimension == 0 )
<a name="l01241"></a>01241       {
<a name="l01242"></a>01242         point-&gt;cur_x   = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a>;
<a name="l01243"></a>01243         point-&gt;flags_x = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#ab71eb24a6073342c50e6dd891e4f8af4">flags2</a> | point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4e8ff007cec28131544b2ab18d31dece">flags</a>;
<a name="l01244"></a>01244       }
<a name="l01245"></a>01245       <span class="keywordflow">else</span>
<a name="l01246"></a>01246       {
<a name="l01247"></a>01247         point-&gt;cur_y   = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a>;
<a name="l01248"></a>01248         point-&gt;flags_y = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#ab71eb24a6073342c50e6dd891e4f8af4">flags2</a> | point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4e8ff007cec28131544b2ab18d31dece">flags</a>;
<a name="l01249"></a>01249       }
<a name="l01250"></a>01250 
<a name="l01251"></a>01251 <span class="preprocessor">#endif</span>
<a name="l01252"></a>01252 <span class="preprocessor"></span>
<a name="l01253"></a>01253       point++;
<a name="l01254"></a>01254     }
<a name="l01255"></a>01255   }
<a name="l01256"></a>01256 
<a name="l01257"></a>01257 
<a name="l01258"></a>01258   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l01259"></a>01259   psh_glyph_init( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>    glyph,
<a name="l01260"></a>01260                   <a class="code" href="struct_f_t___outline__.html">FT_Outline</a>*  outline,
<a name="l01261"></a>01261                   <a class="code" href="struct_p_s___hints_rec__.html">PS_Hints</a>     ps_hints,
<a name="l01262"></a>01262                   <a class="code" href="pshints_8h.html#aed4220b62b12a76456f9f47bafa5fe52">PSH_Globals</a>  globals )
<a name="l01263"></a>01263   {
<a name="l01264"></a>01264     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>   error;
<a name="l01265"></a>01265     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>  memory;
<a name="l01266"></a>01266 
<a name="l01267"></a>01267 
<a name="l01268"></a>01268     <span class="comment">/* clear all fields */</span>
<a name="l01269"></a>01269     <a class="code" href="ftmemory_8h.html#ad04dbb2871d7219281966386fffaf909">FT_MEM_ZERO</a>( glyph, <span class="keyword">sizeof</span> ( *glyph ) );
<a name="l01270"></a>01270 
<a name="l01271"></a>01271     memory = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a303af9b985cdd171dc2eb9121ba8f2a2">memory</a> = globals-&gt;memory;
<a name="l01272"></a>01272 
<a name="l01273"></a>01273     <span class="comment">/* allocate and setup points + contours arrays */</span>
<a name="l01274"></a>01274     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a231caa1da52440d78812f037f2a35a30">FT_NEW_ARRAY</a>( glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>,   outline-&gt;<a class="code" href="struct_f_t___outline__.html#a7ebcf3c33231af88655534d1ac02b66e">n_points</a>   ) ||
<a name="l01275"></a>01275          <a class="code" href="ftmemory_8h.html#a231caa1da52440d78812f037f2a35a30">FT_NEW_ARRAY</a>( glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ade9e594cd9ede3162787b2be47e5b719">contours</a>, outline-&gt;<a class="code" href="struct_f_t___outline__.html#a0313ba9c2c51f10e6b7d7ef97bd946e2">n_contours</a> ) )
<a name="l01276"></a>01276       <span class="keywordflow">goto</span> Exit;
<a name="l01277"></a>01277 
<a name="l01278"></a>01278     glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>   = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a7ebcf3c33231af88655534d1ac02b66e">n_points</a>;
<a name="l01279"></a>01279     glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a742cca21d75380d3b3c6589f2e69aec4">num_contours</a> = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a0313ba9c2c51f10e6b7d7ef97bd946e2">n_contours</a>;
<a name="l01280"></a>01280 
<a name="l01281"></a>01281     {
<a name="l01282"></a>01282       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>      first = 0, next, <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l01283"></a>01283       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>    points  = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>;
<a name="l01284"></a>01284       <a class="code" href="struct_p_s_h___contour_rec__.html">PSH_Contour</a>  contour = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ade9e594cd9ede3162787b2be47e5b719">contours</a>;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286 
<a name="l01287"></a>01287       <span class="keywordflow">for</span> ( n = 0; n &lt; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a742cca21d75380d3b3c6589f2e69aec4">num_contours</a>; n++ )
<a name="l01288"></a>01288       {
<a name="l01289"></a>01289         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     count;
<a name="l01290"></a>01290         <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  point;
<a name="l01291"></a>01291 
<a name="l01292"></a>01292 
<a name="l01293"></a>01293         next  = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a218fdea14003061142ac1045ac50affa">contours</a>[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>] + 1;
<a name="l01294"></a>01294         count = next - first;
<a name="l01295"></a>01295 
<a name="l01296"></a>01296         contour-&gt;<a class="code" href="struct_p_s_h___contour_rec__.html#ada292eef1584e5f887bea69ba8703aa2">start</a> = points + first;
<a name="l01297"></a>01297         contour-&gt;<a class="code" href="struct_p_s_h___contour_rec__.html#a5d45ebbfcc7c5cb394ddae2e1b9dacf3">count</a> = (<a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>)count;
<a name="l01298"></a>01298 
<a name="l01299"></a>01299         <span class="keywordflow">if</span> ( count &gt; 0 )
<a name="l01300"></a>01300         {
<a name="l01301"></a>01301           point = points + first;
<a name="l01302"></a>01302 
<a name="l01303"></a>01303           point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4bcea810dd0a31e9a2ecf6a9a9f1f54e">prev</a>    = points + next - 1;
<a name="l01304"></a>01304           point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#aabab25d215eb72dfbf660a1dc34638da">contour</a> = contour;
<a name="l01305"></a>01305 
<a name="l01306"></a>01306           <span class="keywordflow">for</span> ( ; count &gt; 1; count-- )
<a name="l01307"></a>01307           {
<a name="l01308"></a>01308             point[0].<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a> = point + 1;
<a name="l01309"></a>01309             point[1].<a class="code" href="struct_p_s_h___point_rec__.html#a4bcea810dd0a31e9a2ecf6a9a9f1f54e">prev</a> = point;
<a name="l01310"></a>01310             point++;
<a name="l01311"></a>01311             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#aabab25d215eb72dfbf660a1dc34638da">contour</a> = contour;
<a name="l01312"></a>01312           }
<a name="l01313"></a>01313           point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a> = points + first;
<a name="l01314"></a>01314         }
<a name="l01315"></a>01315 
<a name="l01316"></a>01316         contour++;
<a name="l01317"></a>01317         first = next;
<a name="l01318"></a>01318       }
<a name="l01319"></a>01319     }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321     {
<a name="l01322"></a>01322       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>   points = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>;
<a name="l01323"></a>01323       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>   point  = points;
<a name="l01324"></a>01324       <a class="code" href="struct_f_t___vector__.html">FT_Vector</a>*  vec    = outline-&gt;<a class="code" href="struct_f_t___outline__.html#a4871896a2f38bdab947e30a7cf6bca04">points</a>;
<a name="l01325"></a>01325       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l01326"></a>01326 
<a name="l01327"></a>01327 
<a name="l01328"></a>01328       <span class="keywordflow">for</span> ( n = 0; n &lt; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>; n++, point++ )
<a name="l01329"></a>01329       {
<a name="l01330"></a>01330         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  n_prev = (<a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>)( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4bcea810dd0a31e9a2ecf6a9a9f1f54e">prev</a> - points );
<a name="l01331"></a>01331         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  n_next = (<a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>)( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a> - points );
<a name="l01332"></a>01332         <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  dxi, dyi, dxo, dyo;
<a name="l01333"></a>01333 
<a name="l01334"></a>01334 
<a name="l01335"></a>01335         <span class="keywordflow">if</span> ( !( outline-&gt;<a class="code" href="struct_f_t___outline__.html#ac84ca66907361e1f49ec11c14720087a">tags</a>[n] &amp; <a class="code" href="ftimage_8h.html#a967f934e5e5e1ee1fe4291d23959aa9c">FT_CURVE_TAG_ON</a> ) )
<a name="l01336"></a>01336           point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4e8ff007cec28131544b2ab18d31dece">flags</a> = <a class="code" href="pshalgo_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7b069e58d432d013a8d0a70cf659384d">PSH_POINT_OFF</a>;
<a name="l01337"></a>01337 
<a name="l01338"></a>01338         dxi = vec[n].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> - vec[n_prev].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l01339"></a>01339         dyi = vec[n].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> - vec[n_prev].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01340"></a>01340 
<a name="l01341"></a>01341         point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9ec38c3873255a735244ca2c1d1312a5">dir_in</a> = (<a class="code" href="fttypes_8h.html#a0f851552b050883885f0a0855771f39d">FT_Char</a>)psh_compute_dir( dxi, dyi );
<a name="l01342"></a>01342 
<a name="l01343"></a>01343         dxo = vec[n_next].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a> - vec[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>].<a class="code" href="struct_f_t___vector__.html#a941e818e6dfca06409cddff4f325f74c">x</a>;
<a name="l01344"></a>01344         dyo = vec[n_next].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a> - vec[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>].<a class="code" href="struct_f_t___vector__.html#ac3246ed214e880047ec74eeb15f8b973">y</a>;
<a name="l01345"></a>01345 
<a name="l01346"></a>01346         point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a52bd7db9cde5975efb5ddca68fd4329d">dir_out</a> = (<a class="code" href="fttypes_8h.html#a0f851552b050883885f0a0855771f39d">FT_Char</a>)psh_compute_dir( dxo, dyo );
<a name="l01347"></a>01347 
<a name="l01348"></a>01348         <span class="comment">/* detect smooth points */</span>
<a name="l01349"></a>01349         <span class="keywordflow">if</span> ( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4e8ff007cec28131544b2ab18d31dece">flags</a> &amp; <a class="code" href="pshalgo_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7b069e58d432d013a8d0a70cf659384d">PSH_POINT_OFF</a> )
<a name="l01350"></a>01350           point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4e8ff007cec28131544b2ab18d31dece">flags</a> |= <a class="code" href="pshalgo_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a78f2ee7865f200aa121f2c0c8d570b35">PSH_POINT_SMOOTH</a>;
<a name="l01351"></a>01351 
<a name="l01352"></a>01352         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9ec38c3873255a735244ca2c1d1312a5">dir_in</a> == point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a52bd7db9cde5975efb5ddca68fd4329d">dir_out</a> )
<a name="l01353"></a>01353         {
<a name="l01354"></a>01354           <span class="keywordflow">if</span> ( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a52bd7db9cde5975efb5ddca68fd4329d">dir_out</a> != <a class="code" href="pshalgo_8h.html#abed82baf7f470b522273a3e37c24c600ab088f26343924fb63ec139c46b421512">PSH_DIR_NONE</a>           ||
<a name="l01355"></a>01355                <a class="code" href="pshalgo_8c.html#a25282eaa6f8fdd47343d7597f095ba9e">psh_corner_is_flat</a>( dxi, dyi, dxo, dyo ) )
<a name="l01356"></a>01356             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4e8ff007cec28131544b2ab18d31dece">flags</a> |= <a class="code" href="pshalgo_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a78f2ee7865f200aa121f2c0c8d570b35">PSH_POINT_SMOOTH</a>;
<a name="l01357"></a>01357         }
<a name="l01358"></a>01358       }
<a name="l01359"></a>01359     }
<a name="l01360"></a>01360 
<a name="l01361"></a>01361     glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a8c015e611027f9066a151443f2fc3ef0">outline</a> = outline;
<a name="l01362"></a>01362     glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a> = globals;
<a name="l01363"></a>01363 
<a name="l01364"></a>01364 <span class="preprocessor">#ifdef COMPUTE_INFLEXS</span>
<a name="l01365"></a>01365 <span class="preprocessor"></span>    psh_glyph_load_points( glyph, 0 );
<a name="l01366"></a>01366     psh_glyph_compute_inflections( glyph );
<a name="l01367"></a>01367 <span class="preprocessor">#endif </span><span class="comment">/* COMPUTE_INFLEXS */</span>
<a name="l01368"></a>01368 
<a name="l01369"></a>01369     <span class="comment">/* now deal with hints tables */</span>
<a name="l01370"></a>01370     error = psh_hint_table_init( &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae46b190c2bdf88f967078b11b8c05153">hint_tables</a> [0],
<a name="l01371"></a>01371                                  &amp;ps_hints-&gt;<a class="code" href="struct_p_s___hints_rec__.html#aee12973ffdaed3ae12c1438084e776ee">dimension</a>[0].<a class="code" href="struct_p_s___dimension_rec__.html#ab17240e2369b8bfb3571dde1835b2957">hints</a>,
<a name="l01372"></a>01372                                  &amp;ps_hints-&gt;<a class="code" href="struct_p_s___hints_rec__.html#aee12973ffdaed3ae12c1438084e776ee">dimension</a>[0].<a class="code" href="struct_p_s___dimension_rec__.html#a20947113c40dde015cff4e71b7dec4e7">masks</a>,
<a name="l01373"></a>01373                                  &amp;ps_hints-&gt;<a class="code" href="struct_p_s___hints_rec__.html#aee12973ffdaed3ae12c1438084e776ee">dimension</a>[0].<a class="code" href="struct_p_s___dimension_rec__.html#a8d1dcd6a6eea15fe82f50f97ec0afe6c">counters</a>,
<a name="l01374"></a>01374                                  memory );
<a name="l01375"></a>01375     <span class="keywordflow">if</span> ( error )
<a name="l01376"></a>01376       <span class="keywordflow">goto</span> Exit;
<a name="l01377"></a>01377 
<a name="l01378"></a>01378     error = psh_hint_table_init( &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae46b190c2bdf88f967078b11b8c05153">hint_tables</a> [1],
<a name="l01379"></a>01379                                  &amp;ps_hints-&gt;<a class="code" href="struct_p_s___hints_rec__.html#aee12973ffdaed3ae12c1438084e776ee">dimension</a>[1].<a class="code" href="struct_p_s___dimension_rec__.html#ab17240e2369b8bfb3571dde1835b2957">hints</a>,
<a name="l01380"></a>01380                                  &amp;ps_hints-&gt;<a class="code" href="struct_p_s___hints_rec__.html#aee12973ffdaed3ae12c1438084e776ee">dimension</a>[1].<a class="code" href="struct_p_s___dimension_rec__.html#a20947113c40dde015cff4e71b7dec4e7">masks</a>,
<a name="l01381"></a>01381                                  &amp;ps_hints-&gt;<a class="code" href="struct_p_s___hints_rec__.html#aee12973ffdaed3ae12c1438084e776ee">dimension</a>[1].<a class="code" href="struct_p_s___dimension_rec__.html#a8d1dcd6a6eea15fe82f50f97ec0afe6c">counters</a>,
<a name="l01382"></a>01382                                  memory );
<a name="l01383"></a>01383     <span class="keywordflow">if</span> ( error )
<a name="l01384"></a>01384       <span class="keywordflow">goto</span> Exit;
<a name="l01385"></a>01385 
<a name="l01386"></a>01386   Exit:
<a name="l01387"></a>01387     <span class="keywordflow">return</span> error;
<a name="l01388"></a>01388   }
<a name="l01389"></a>01389 
<a name="l01390"></a>01390 
<a name="l01391"></a>01391   <span class="comment">/* compute all extrema in a glyph for a given dimension */</span>
<a name="l01392"></a>01392   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01393"></a>01393   psh_glyph_compute_extrema( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph )
<a name="l01394"></a>01394   {
<a name="l01395"></a>01395     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l01396"></a>01396 
<a name="l01397"></a>01397 
<a name="l01398"></a>01398     <span class="comment">/* first of all, compute all local extrema */</span>
<a name="l01399"></a>01399     <span class="keywordflow">for</span> ( n = 0; n &lt; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a742cca21d75380d3b3c6589f2e69aec4">num_contours</a>; n++ )
<a name="l01400"></a>01400     {
<a name="l01401"></a>01401       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  first = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ade9e594cd9ede3162787b2be47e5b719">contours</a>[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>].<a class="code" href="struct_p_s_h___contour_rec__.html#ada292eef1584e5f887bea69ba8703aa2">start</a>;
<a name="l01402"></a>01402       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  point, before, after;
<a name="l01403"></a>01403 
<a name="l01404"></a>01404 
<a name="l01405"></a>01405       <span class="keywordflow">if</span> ( glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ade9e594cd9ede3162787b2be47e5b719">contours</a>[n].<a class="code" href="struct_p_s_h___contour_rec__.html#a5d45ebbfcc7c5cb394ddae2e1b9dacf3">count</a> == 0 )
<a name="l01406"></a>01406         <span class="keywordflow">continue</span>;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408       point  = first;
<a name="l01409"></a>01409       before = point;
<a name="l01410"></a>01410       after  = point;
<a name="l01411"></a>01411 
<a name="l01412"></a>01412       <span class="keywordflow">do</span>
<a name="l01413"></a>01413       {
<a name="l01414"></a>01414         before = before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4bcea810dd0a31e9a2ecf6a9a9f1f54e">prev</a>;
<a name="l01415"></a>01415         <span class="keywordflow">if</span> ( before == first )
<a name="l01416"></a>01416           <span class="keywordflow">goto</span> Skip;
<a name="l01417"></a>01417 
<a name="l01418"></a>01418       } <span class="keywordflow">while</span> ( before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> == point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> );
<a name="l01419"></a>01419 
<a name="l01420"></a>01420       first = point = before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l01421"></a>01421 
<a name="l01422"></a>01422       <span class="keywordflow">for</span> (;;)
<a name="l01423"></a>01423       {
<a name="l01424"></a>01424         after = point;
<a name="l01425"></a>01425         <span class="keywordflow">do</span>
<a name="l01426"></a>01426         {
<a name="l01427"></a>01427           after = after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l01428"></a>01428           <span class="keywordflow">if</span> ( after == first )
<a name="l01429"></a>01429             <span class="keywordflow">goto</span> Next;
<a name="l01430"></a>01430 
<a name="l01431"></a>01431         } <span class="keywordflow">while</span> ( after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> == point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> );
<a name="l01432"></a>01432 
<a name="l01433"></a>01433         <span class="keywordflow">if</span> ( before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> &lt; point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> )
<a name="l01434"></a>01434         {
<a name="l01435"></a>01435           <span class="keywordflow">if</span> ( after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> &lt; point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> )
<a name="l01436"></a>01436           {
<a name="l01437"></a>01437             <span class="comment">/* local maximum */</span>
<a name="l01438"></a>01438             <span class="keywordflow">goto</span> Extremum;
<a name="l01439"></a>01439           }
<a name="l01440"></a>01440         }
<a name="l01441"></a>01441         <span class="keywordflow">else</span> <span class="comment">/* before-&gt;org_u &gt; point-&gt;org_u */</span>
<a name="l01442"></a>01442         {
<a name="l01443"></a>01443           <span class="keywordflow">if</span> ( after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> &gt; point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> )
<a name="l01444"></a>01444           {
<a name="l01445"></a>01445             <span class="comment">/* local minimum */</span>
<a name="l01446"></a>01446           Extremum:
<a name="l01447"></a>01447             <span class="keywordflow">do</span>
<a name="l01448"></a>01448             {
<a name="l01449"></a>01449               <a class="code" href="pshalgo_8h.html#a89e0e5bcd791416c406deffb2a72379a">psh_point_set_extremum</a>( point );
<a name="l01450"></a>01450               point = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l01451"></a>01451 
<a name="l01452"></a>01452             } <span class="keywordflow">while</span> ( point != after );
<a name="l01453"></a>01453           }
<a name="l01454"></a>01454         }
<a name="l01455"></a>01455 
<a name="l01456"></a>01456         before = after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4bcea810dd0a31e9a2ecf6a9a9f1f54e">prev</a>;
<a name="l01457"></a>01457         point  = after;
<a name="l01458"></a>01458 
<a name="l01459"></a>01459       } <span class="comment">/* for  */</span>
<a name="l01460"></a>01460 
<a name="l01461"></a>01461     Next:
<a name="l01462"></a>01462       ;
<a name="l01463"></a>01463     }
<a name="l01464"></a>01464 
<a name="l01465"></a>01465     <span class="comment">/* for each extremum, determine its direction along the */</span>
<a name="l01466"></a>01466     <span class="comment">/* orthogonal axis                                      */</span>
<a name="l01467"></a>01467     <span class="keywordflow">for</span> ( n = 0; n &lt; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>; n++ )
<a name="l01468"></a>01468     {
<a name="l01469"></a>01469       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  point, before, after;
<a name="l01470"></a>01470 
<a name="l01471"></a>01471 
<a name="l01472"></a>01472       point  = &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>];
<a name="l01473"></a>01473       before = point;
<a name="l01474"></a>01474       after  = point;
<a name="l01475"></a>01475 
<a name="l01476"></a>01476       <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a71799815223bfc8cacd7ecefe7e19eab">psh_point_is_extremum</a>( point ) )
<a name="l01477"></a>01477       {
<a name="l01478"></a>01478         <span class="keywordflow">do</span>
<a name="l01479"></a>01479         {
<a name="l01480"></a>01480           before = before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4bcea810dd0a31e9a2ecf6a9a9f1f54e">prev</a>;
<a name="l01481"></a>01481           <span class="keywordflow">if</span> ( before == point )
<a name="l01482"></a>01482             <span class="keywordflow">goto</span> Skip;
<a name="l01483"></a>01483 
<a name="l01484"></a>01484         } <span class="keywordflow">while</span> ( before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> == point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> );
<a name="l01485"></a>01485 
<a name="l01486"></a>01486         <span class="keywordflow">do</span>
<a name="l01487"></a>01487         {
<a name="l01488"></a>01488           after = after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l01489"></a>01489           <span class="keywordflow">if</span> ( after == point )
<a name="l01490"></a>01490             <span class="keywordflow">goto</span> Skip;
<a name="l01491"></a>01491 
<a name="l01492"></a>01492         } <span class="keywordflow">while</span> ( after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> == point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> );
<a name="l01493"></a>01493       }
<a name="l01494"></a>01494 
<a name="l01495"></a>01495       <span class="keywordflow">if</span> ( before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> &lt; point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> &amp;&amp;
<a name="l01496"></a>01496            after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a>  &gt; point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> )
<a name="l01497"></a>01497       {
<a name="l01498"></a>01498         <a class="code" href="pshalgo_8h.html#a95e8a79bd1fcde4f1df7115b5c6f5c29">psh_point_set_positive</a>( point );
<a name="l01499"></a>01499       }
<a name="l01500"></a>01500       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> &gt; point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> &amp;&amp;
<a name="l01501"></a>01501                 after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a>  &lt; point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a94acbecbc9fa199392195078878e59d1">org_v</a> )
<a name="l01502"></a>01502       {
<a name="l01503"></a>01503         <a class="code" href="pshalgo_8h.html#a7536ec7740828d22e88a55c1c513aab2">psh_point_set_negative</a>( point );
<a name="l01504"></a>01504       }
<a name="l01505"></a>01505 
<a name="l01506"></a>01506     Skip:
<a name="l01507"></a>01507       ;
<a name="l01508"></a>01508     }
<a name="l01509"></a>01509   }
<a name="l01510"></a>01510 
<a name="l01511"></a>01511 
<a name="l01512"></a>01512   <span class="comment">/* major_dir is the direction for points on the bottom/left of the stem; */</span>
<a name="l01513"></a>01513   <span class="comment">/* Points on the top/right of the stem will have a direction of          */</span>
<a name="l01514"></a>01514   <span class="comment">/* -major_dir.                                                           */</span>
<a name="l01515"></a>01515 
<a name="l01516"></a>01516   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01517"></a>01517   psh_hint_table_find_strong_points( <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table,
<a name="l01518"></a>01518                                      <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>       point,
<a name="l01519"></a>01519                                      <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>         count,
<a name="l01520"></a>01520                                      <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>          threshold,
<a name="l01521"></a>01521                                      <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>          major_dir )
<a name="l01522"></a>01522   {
<a name="l01523"></a>01523     <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>*  sort      = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#aa05b021add8a56a12647d117eedce984">sort</a>;
<a name="l01524"></a>01524     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>    num_hints = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a31b4cf8054a137eca471b78b3c743ba4">num_hints</a>;
<a name="l01525"></a>01525 
<a name="l01526"></a>01526 
<a name="l01527"></a>01527     <span class="keywordflow">for</span> ( ; count &gt; 0; count--, point++ )
<a name="l01528"></a>01528     {
<a name="l01529"></a>01529       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  point_dir = 0;
<a name="l01530"></a>01530       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  org_u     = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>;
<a name="l01531"></a>01531 
<a name="l01532"></a>01532 
<a name="l01533"></a>01533       <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a0b02d3a613fb16b6bb68da871814dd89">psh_point_is_strong</a>( point ) )
<a name="l01534"></a>01534         <span class="keywordflow">continue</span>;
<a name="l01535"></a>01535 
<a name="l01536"></a>01536       <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a86580bb4cdcb4b5788cfdbc8693d0964">PSH_DIR_COMPARE</a>( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9ec38c3873255a735244ca2c1d1312a5">dir_in</a>, major_dir ) )
<a name="l01537"></a>01537         point_dir = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9ec38c3873255a735244ca2c1d1312a5">dir_in</a>;
<a name="l01538"></a>01538 
<a name="l01539"></a>01539       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a86580bb4cdcb4b5788cfdbc8693d0964">PSH_DIR_COMPARE</a>( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a52bd7db9cde5975efb5ddca68fd4329d">dir_out</a>, major_dir ) )
<a name="l01540"></a>01540         point_dir = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a52bd7db9cde5975efb5ddca68fd4329d">dir_out</a>;
<a name="l01541"></a>01541 
<a name="l01542"></a>01542       <span class="keywordflow">if</span> ( point_dir )
<a name="l01543"></a>01543       {
<a name="l01544"></a>01544         <span class="keywordflow">if</span> ( point_dir == major_dir )
<a name="l01545"></a>01545         {
<a name="l01546"></a>01546           <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  nn;
<a name="l01547"></a>01547 
<a name="l01548"></a>01548 
<a name="l01549"></a>01549           <span class="keywordflow">for</span> ( nn = 0; nn &lt; num_hints; nn++ )
<a name="l01550"></a>01550           {
<a name="l01551"></a>01551             <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint = sort[nn];
<a name="l01552"></a>01552             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>    d    = org_u - hint-&gt;org_pos;
<a name="l01553"></a>01553 
<a name="l01554"></a>01554 
<a name="l01555"></a>01555             <span class="keywordflow">if</span> ( d &lt; threshold &amp;&amp; -d &lt; threshold )
<a name="l01556"></a>01556             {
<a name="l01557"></a>01557               <a class="code" href="pshalgo_8h.html#a7bac07cb1fa5fd1115b1b7cd2fa7df3a">psh_point_set_strong</a>( point );
<a name="l01558"></a>01558               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#ab71eb24a6073342c50e6dd891e4f8af4">flags2</a> |= <a class="code" href="pshalgo_8h.html#a385c44f6fb256e5716a2302a5b940388adad9db46f0945adc9fc406f357b8aa1b">PSH_POINT_EDGE_MIN</a>;
<a name="l01559"></a>01559               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a1dc99602e87f3fa14ac6af2d2ba040f4">hint</a>    = hint;
<a name="l01560"></a>01560               <span class="keywordflow">break</span>;
<a name="l01561"></a>01561             }
<a name="l01562"></a>01562           }
<a name="l01563"></a>01563         }
<a name="l01564"></a>01564         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( point_dir == -major_dir )
<a name="l01565"></a>01565         {
<a name="l01566"></a>01566           <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  nn;
<a name="l01567"></a>01567 
<a name="l01568"></a>01568 
<a name="l01569"></a>01569           <span class="keywordflow">for</span> ( nn = 0; nn &lt; num_hints; nn++ )
<a name="l01570"></a>01570           {
<a name="l01571"></a>01571             <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint = sort[nn];
<a name="l01572"></a>01572             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>    d    = org_u - hint-&gt;org_pos - hint-&gt;org_len;
<a name="l01573"></a>01573 
<a name="l01574"></a>01574 
<a name="l01575"></a>01575             <span class="keywordflow">if</span> ( d &lt; threshold &amp;&amp; -d &lt; threshold )
<a name="l01576"></a>01576             {
<a name="l01577"></a>01577               <a class="code" href="pshalgo_8h.html#a7bac07cb1fa5fd1115b1b7cd2fa7df3a">psh_point_set_strong</a>( point );
<a name="l01578"></a>01578               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#ab71eb24a6073342c50e6dd891e4f8af4">flags2</a> |= <a class="code" href="pshalgo_8h.html#a385c44f6fb256e5716a2302a5b940388ac25a46a71864f4366e1dde133f16a625">PSH_POINT_EDGE_MAX</a>;
<a name="l01579"></a>01579               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a1dc99602e87f3fa14ac6af2d2ba040f4">hint</a>    = hint;
<a name="l01580"></a>01580               <span class="keywordflow">break</span>;
<a name="l01581"></a>01581             }
<a name="l01582"></a>01582           }
<a name="l01583"></a>01583         }
<a name="l01584"></a>01584       }
<a name="l01585"></a>01585 
<a name="l01586"></a>01586 <span class="preprocessor">#if 1</span>
<a name="l01587"></a>01587 <span class="preprocessor"></span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a71799815223bfc8cacd7ecefe7e19eab">psh_point_is_extremum</a>( point ) )
<a name="l01588"></a>01588       {
<a name="l01589"></a>01589         <span class="comment">/* treat extrema as special cases for stem edge alignment */</span>
<a name="l01590"></a>01590         <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  nn, min_flag, max_flag;
<a name="l01591"></a>01591 
<a name="l01592"></a>01592 
<a name="l01593"></a>01593         <span class="keywordflow">if</span> ( major_dir == <a class="code" href="pshalgo_8h.html#ae25f60eb7d20d7b79e9e341a2afcbda2">PSH_DIR_HORIZONTAL</a> )
<a name="l01594"></a>01594         {
<a name="l01595"></a>01595           min_flag = <a class="code" href="pshalgo_8h.html#a385c44f6fb256e5716a2302a5b940388aba451b5bbfc8e04755199d61909f1099">PSH_POINT_POSITIVE</a>;
<a name="l01596"></a>01596           max_flag = <a class="code" href="pshalgo_8h.html#a385c44f6fb256e5716a2302a5b940388a0ed0a9de5b8e9dd949091ca468ee8063">PSH_POINT_NEGATIVE</a>;
<a name="l01597"></a>01597         }
<a name="l01598"></a>01598         <span class="keywordflow">else</span>
<a name="l01599"></a>01599         {
<a name="l01600"></a>01600           min_flag = <a class="code" href="pshalgo_8h.html#a385c44f6fb256e5716a2302a5b940388a0ed0a9de5b8e9dd949091ca468ee8063">PSH_POINT_NEGATIVE</a>;
<a name="l01601"></a>01601           max_flag = <a class="code" href="pshalgo_8h.html#a385c44f6fb256e5716a2302a5b940388aba451b5bbfc8e04755199d61909f1099">PSH_POINT_POSITIVE</a>;
<a name="l01602"></a>01602         }
<a name="l01603"></a>01603 
<a name="l01604"></a>01604         <span class="keywordflow">if</span> ( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#ab71eb24a6073342c50e6dd891e4f8af4">flags2</a> &amp; min_flag )
<a name="l01605"></a>01605         {
<a name="l01606"></a>01606           <span class="keywordflow">for</span> ( nn = 0; nn &lt; num_hints; nn++ )
<a name="l01607"></a>01607           {
<a name="l01608"></a>01608             <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint = sort[nn];
<a name="l01609"></a>01609             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>    d    = org_u - hint-&gt;org_pos;
<a name="l01610"></a>01610 
<a name="l01611"></a>01611 
<a name="l01612"></a>01612             <span class="keywordflow">if</span> ( d &lt; threshold &amp;&amp; -d &lt; threshold )
<a name="l01613"></a>01613             {
<a name="l01614"></a>01614               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#ab71eb24a6073342c50e6dd891e4f8af4">flags2</a> |= <a class="code" href="pshalgo_8h.html#a385c44f6fb256e5716a2302a5b940388adad9db46f0945adc9fc406f357b8aa1b">PSH_POINT_EDGE_MIN</a>;
<a name="l01615"></a>01615               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a1dc99602e87f3fa14ac6af2d2ba040f4">hint</a>    = hint;
<a name="l01616"></a>01616               <a class="code" href="pshalgo_8h.html#a7bac07cb1fa5fd1115b1b7cd2fa7df3a">psh_point_set_strong</a>( point );
<a name="l01617"></a>01617               <span class="keywordflow">break</span>;
<a name="l01618"></a>01618             }
<a name="l01619"></a>01619           }
<a name="l01620"></a>01620         }
<a name="l01621"></a>01621         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#ab71eb24a6073342c50e6dd891e4f8af4">flags2</a> &amp; max_flag )
<a name="l01622"></a>01622         {
<a name="l01623"></a>01623           <span class="keywordflow">for</span> ( nn = 0; nn &lt; num_hints; nn++ )
<a name="l01624"></a>01624           {
<a name="l01625"></a>01625             <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint = sort[nn];
<a name="l01626"></a>01626             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>    d    = org_u - hint-&gt;org_pos - hint-&gt;org_len;
<a name="l01627"></a>01627 
<a name="l01628"></a>01628 
<a name="l01629"></a>01629             <span class="keywordflow">if</span> ( d &lt; threshold &amp;&amp; -d &lt; threshold )
<a name="l01630"></a>01630             {
<a name="l01631"></a>01631               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#ab71eb24a6073342c50e6dd891e4f8af4">flags2</a> |= <a class="code" href="pshalgo_8h.html#a385c44f6fb256e5716a2302a5b940388ac25a46a71864f4366e1dde133f16a625">PSH_POINT_EDGE_MAX</a>;
<a name="l01632"></a>01632               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a1dc99602e87f3fa14ac6af2d2ba040f4">hint</a>    = hint;
<a name="l01633"></a>01633               <a class="code" href="pshalgo_8h.html#a7bac07cb1fa5fd1115b1b7cd2fa7df3a">psh_point_set_strong</a>( point );
<a name="l01634"></a>01634               <span class="keywordflow">break</span>;
<a name="l01635"></a>01635             }
<a name="l01636"></a>01636           }
<a name="l01637"></a>01637         }
<a name="l01638"></a>01638 
<a name="l01639"></a>01639         <span class="keywordflow">if</span> ( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a1dc99602e87f3fa14ac6af2d2ba040f4">hint</a> == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l01640"></a>01640         {
<a name="l01641"></a>01641           <span class="keywordflow">for</span> ( nn = 0; nn &lt; num_hints; nn++ )
<a name="l01642"></a>01642           {
<a name="l01643"></a>01643             <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint = sort[nn];
<a name="l01644"></a>01644 
<a name="l01645"></a>01645 
<a name="l01646"></a>01646             <span class="keywordflow">if</span> ( org_u &gt;= hint-&gt;org_pos                 &amp;&amp;
<a name="l01647"></a>01647                 org_u &lt;= hint-&gt;org_pos + hint-&gt;org_len )
<a name="l01648"></a>01648             {
<a name="l01649"></a>01649               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a1dc99602e87f3fa14ac6af2d2ba040f4">hint</a> = hint;
<a name="l01650"></a>01650               <span class="keywordflow">break</span>;
<a name="l01651"></a>01651             }
<a name="l01652"></a>01652           }
<a name="l01653"></a>01653         }
<a name="l01654"></a>01654       }
<a name="l01655"></a>01655 
<a name="l01656"></a>01656 <span class="preprocessor">#endif </span><span class="comment">/* 1 */</span>
<a name="l01657"></a>01657     }
<a name="l01658"></a>01658   }
<a name="l01659"></a>01659 
<a name="l01660"></a>01660 
<a name="l01661"></a>01661   <span class="comment">/* the accepted shift for strong points in fractional pixels */</span>
<a name="l01662"></a><a class="code" href="pshalgo_8c.html#a33f610a982f921dffe160fd10402c95a">01662</a> <span class="preprocessor">#define PSH_STRONG_THRESHOLD  32</span>
<a name="l01663"></a>01663 <span class="preprocessor"></span>
<a name="l01664"></a>01664   <span class="comment">/* the maximum shift value in font units */</span>
<a name="l01665"></a><a class="code" href="pshalgo_8c.html#a78f2ee551e7bb9f0fe4c33bda7f301ac">01665</a> <span class="preprocessor">#define PSH_STRONG_THRESHOLD_MAXIMUM  30</span>
<a name="l01666"></a>01666 <span class="preprocessor"></span>
<a name="l01667"></a>01667 
<a name="l01668"></a>01668   <span class="comment">/* find strong points in a glyph */</span>
<a name="l01669"></a>01669   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01670"></a>01670   psh_glyph_find_strong_points( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph,
<a name="l01671"></a>01671                                 <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     dimension )
<a name="l01672"></a>01672   {
<a name="l01673"></a>01673     <span class="comment">/* a point is `strong&#39; if it is located on a stem edge and       */</span>
<a name="l01674"></a>01674     <span class="comment">/* has an `in&#39; or `out&#39; tangent parallel to the hint&#39;s direction */</span>
<a name="l01675"></a>01675 
<a name="l01676"></a>01676     <a class="code" href="struct_p_s_h___hint___table_rec__.html">PSH_Hint_Table</a>  table     = &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae46b190c2bdf88f967078b11b8c05153">hint_tables</a>[dimension];
<a name="l01677"></a>01677     <a class="code" href="struct_p_s___mask_rec__.html">PS_Mask</a>         mask      = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a4131293707d0986ab63bc96ca580356c">hint_masks</a>-&gt;<a class="code" href="struct_p_s___mask___table_rec__.html#a20d596cfc59134e06fca6c1b0a030fb8">masks</a>;
<a name="l01678"></a>01678     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>         num_masks = table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a4131293707d0986ab63bc96ca580356c">hint_masks</a>-&gt;<a class="code" href="struct_p_s___mask___table_rec__.html#a361f81947db638b79253b98f6ceb63b6">num_masks</a>;
<a name="l01679"></a>01679     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>         first     = 0;
<a name="l01680"></a>01680     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>          major_dir = dimension == 0 ? <a class="code" href="pshalgo_8h.html#a45a705e63180828cfd6766b54338298c">PSH_DIR_VERTICAL</a>
<a name="l01681"></a>01681                                                : <a class="code" href="pshalgo_8h.html#ae25f60eb7d20d7b79e9e341a2afcbda2">PSH_DIR_HORIZONTAL</a>;
<a name="l01682"></a>01682     <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>   dim       = &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a>-&gt;dimension[dimension];
<a name="l01683"></a>01683     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>        scale     = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a0920c1e7f14cb5c759a41c14988bca80">scale_mult</a>;
<a name="l01684"></a>01684     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>          threshold;
<a name="l01685"></a>01685 
<a name="l01686"></a>01686 
<a name="l01687"></a>01687     threshold = (<a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>)<a class="code" href="freetype_8h.html#a5248df90a0d076e6543b09284face353">FT_DivFix</a>( <a class="code" href="pshalgo_8c.html#a33f610a982f921dffe160fd10402c95a">PSH_STRONG_THRESHOLD</a>, scale );
<a name="l01688"></a>01688     <span class="keywordflow">if</span> ( threshold &gt; <a class="code" href="pshalgo_8c.html#a78f2ee551e7bb9f0fe4c33bda7f301ac">PSH_STRONG_THRESHOLD_MAXIMUM</a> )
<a name="l01689"></a>01689       threshold = <a class="code" href="pshalgo_8c.html#a78f2ee551e7bb9f0fe4c33bda7f301ac">PSH_STRONG_THRESHOLD_MAXIMUM</a>;
<a name="l01690"></a>01690 
<a name="l01691"></a>01691     <span class="comment">/* process secondary hints to `selected&#39; points */</span>
<a name="l01692"></a>01692     <span class="keywordflow">if</span> ( num_masks &gt; 1 &amp;&amp; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a> &gt; 0 )
<a name="l01693"></a>01693     {
<a name="l01694"></a>01694       <span class="comment">/* the `endchar&#39; op can reduce the number of points */</span>
<a name="l01695"></a>01695       first = mask-&gt;<a class="code" href="struct_p_s___mask_rec__.html#a521beb50ceb5c7125ecd3ecccad918b0">end_point</a> &gt; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>
<a name="l01696"></a>01696                 ? glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>
<a name="l01697"></a>01697                 : mask-&gt;<a class="code" href="struct_p_s___mask_rec__.html#a521beb50ceb5c7125ecd3ecccad918b0">end_point</a>;
<a name="l01698"></a>01698       mask++;
<a name="l01699"></a>01699       <span class="keywordflow">for</span> ( ; num_masks &gt; 1; num_masks--, mask++ )
<a name="l01700"></a>01700       {
<a name="l01701"></a>01701         <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>  next;
<a name="l01702"></a>01702         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>   count;
<a name="l01703"></a>01703 
<a name="l01704"></a>01704 
<a name="l01705"></a>01705         next  = mask-&gt;<a class="code" href="struct_p_s___mask_rec__.html#a521beb50ceb5c7125ecd3ecccad918b0">end_point</a> &gt; glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>
<a name="l01706"></a>01706                   ? glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>
<a name="l01707"></a>01707                   : mask-&gt;<a class="code" href="struct_p_s___mask_rec__.html#a521beb50ceb5c7125ecd3ecccad918b0">end_point</a>;
<a name="l01708"></a>01708         count = next - first;
<a name="l01709"></a>01709         <span class="keywordflow">if</span> ( count &gt; 0 )
<a name="l01710"></a>01710         {
<a name="l01711"></a>01711           <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  point = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a> + first;
<a name="l01712"></a>01712 
<a name="l01713"></a>01713 
<a name="l01714"></a>01714           psh_hint_table_activate_mask( table, mask );
<a name="l01715"></a>01715 
<a name="l01716"></a>01716           psh_hint_table_find_strong_points( table, point, count,
<a name="l01717"></a>01717                                              threshold, major_dir );
<a name="l01718"></a>01718         }
<a name="l01719"></a>01719         first = next;
<a name="l01720"></a>01720       }
<a name="l01721"></a>01721     }
<a name="l01722"></a>01722 
<a name="l01723"></a>01723     <span class="comment">/* process primary hints for all points */</span>
<a name="l01724"></a>01724     <span class="keywordflow">if</span> ( num_masks == 1 )
<a name="l01725"></a>01725     {
<a name="l01726"></a>01726       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>    count = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>;
<a name="l01727"></a>01727       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  point = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>;
<a name="l01728"></a>01728 
<a name="l01729"></a>01729 
<a name="l01730"></a>01730       psh_hint_table_activate_mask( table, table-&gt;<a class="code" href="struct_p_s_h___hint___table_rec__.html#a4131293707d0986ab63bc96ca580356c">hint_masks</a>-&gt;<a class="code" href="struct_p_s___mask___table_rec__.html#a20d596cfc59134e06fca6c1b0a030fb8">masks</a> );
<a name="l01731"></a>01731 
<a name="l01732"></a>01732       psh_hint_table_find_strong_points( table, point, count,
<a name="l01733"></a>01733                                          threshold, major_dir );
<a name="l01734"></a>01734     }
<a name="l01735"></a>01735 
<a name="l01736"></a>01736     <span class="comment">/* now, certain points may have been attached to a hint and */</span>
<a name="l01737"></a>01737     <span class="comment">/* not marked as strong; update their flags then            */</span>
<a name="l01738"></a>01738     {
<a name="l01739"></a>01739       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>    count = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>;
<a name="l01740"></a>01740       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  point = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>;
<a name="l01741"></a>01741 
<a name="l01742"></a>01742 
<a name="l01743"></a>01743       <span class="keywordflow">for</span> ( ; count &gt; 0; count--, point++ )
<a name="l01744"></a>01744         <span class="keywordflow">if</span> ( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a1dc99602e87f3fa14ac6af2d2ba040f4">hint</a> &amp;&amp; !<a class="code" href="pshalgo_8h.html#a0b02d3a613fb16b6bb68da871814dd89">psh_point_is_strong</a>( point ) )
<a name="l01745"></a>01745           <a class="code" href="pshalgo_8h.html#a7bac07cb1fa5fd1115b1b7cd2fa7df3a">psh_point_set_strong</a>( point );
<a name="l01746"></a>01746     }
<a name="l01747"></a>01747   }
<a name="l01748"></a>01748 
<a name="l01749"></a>01749 
<a name="l01750"></a>01750   <span class="comment">/* find points in a glyph which are in a blue zone and have `in&#39; or */</span>
<a name="l01751"></a>01751   <span class="comment">/* `out&#39; tangents parallel to the horizontal axis                   */</span>
<a name="l01752"></a>01752   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01753"></a>01753   psh_glyph_find_blue_points( <a class="code" href="struct_p_s_h___blues_rec__.html">PSH_Blues</a>  blues,
<a name="l01754"></a>01754                               <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph )
<a name="l01755"></a>01755   {
<a name="l01756"></a>01756     <a class="code" href="struct_p_s_h___blue___table_rec__.html">PSH_Blue_Table</a>  table;
<a name="l01757"></a>01757     <a class="code" href="struct_p_s_h___blue___zone_rec__.html">PSH_Blue_Zone</a>   zone;
<a name="l01758"></a>01758     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>         glyph_count = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>;
<a name="l01759"></a>01759     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>         blue_count;
<a name="l01760"></a>01760     <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>       point = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>;
<a name="l01761"></a>01761 
<a name="l01762"></a>01762 
<a name="l01763"></a>01763     <span class="keywordflow">for</span> ( ; glyph_count &gt; 0; glyph_count--, point++ )
<a name="l01764"></a>01764     {
<a name="l01765"></a>01765       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  y;
<a name="l01766"></a>01766 
<a name="l01767"></a>01767 
<a name="l01768"></a>01768       <span class="comment">/* check tangents */</span>
<a name="l01769"></a>01769       <span class="keywordflow">if</span> ( !<a class="code" href="pshalgo_8h.html#a86580bb4cdcb4b5788cfdbc8693d0964">PSH_DIR_COMPARE</a>( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9ec38c3873255a735244ca2c1d1312a5">dir_in</a>,  <a class="code" href="pshalgo_8h.html#ae25f60eb7d20d7b79e9e341a2afcbda2">PSH_DIR_HORIZONTAL</a> ) &amp;&amp;
<a name="l01770"></a>01770            !<a class="code" href="pshalgo_8h.html#a86580bb4cdcb4b5788cfdbc8693d0964">PSH_DIR_COMPARE</a>( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a52bd7db9cde5975efb5ddca68fd4329d">dir_out</a>, <a class="code" href="pshalgo_8h.html#ae25f60eb7d20d7b79e9e341a2afcbda2">PSH_DIR_HORIZONTAL</a> ) )
<a name="l01771"></a>01771         <span class="keywordflow">continue</span>;
<a name="l01772"></a>01772 
<a name="l01773"></a>01773       <span class="comment">/* skip strong points */</span>
<a name="l01774"></a>01774       <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a0b02d3a613fb16b6bb68da871814dd89">psh_point_is_strong</a>( point ) )
<a name="l01775"></a>01775         <span class="keywordflow">continue</span>;
<a name="l01776"></a>01776 
<a name="l01777"></a>01777       y = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>;
<a name="l01778"></a>01778 
<a name="l01779"></a>01779       <span class="comment">/* look up top zones */</span>
<a name="l01780"></a>01780       table      = &amp;blues-&gt;<a class="code" href="struct_p_s_h___blues_rec__.html#abd1fdcbf0cea8fc142cafb19c1ebfdc5">normal_top</a>;
<a name="l01781"></a>01781       blue_count = table-&gt;<a class="code" href="struct_p_s_h___blue___table_rec__.html#a20c47e75c99471378ee6cd7bba745e29">count</a>;
<a name="l01782"></a>01782       zone       = table-&gt;<a class="code" href="struct_p_s_h___blue___table_rec__.html#a81f477ba33c7de685c36ac8afa32efa2">zones</a>;
<a name="l01783"></a>01783 
<a name="l01784"></a>01784       <span class="keywordflow">for</span> ( ; blue_count &gt; 0; blue_count--, zone++ )
<a name="l01785"></a>01785       {
<a name="l01786"></a>01786         <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  delta = y - zone-&gt;<a class="code" href="struct_p_s_h___blue___zone_rec__.html#af09f51397360e614f909802e5fa29575">org_bottom</a>;
<a name="l01787"></a>01787 
<a name="l01788"></a>01788 
<a name="l01789"></a>01789         <span class="keywordflow">if</span> ( delta &lt; -blues-&gt;blue_fuzz )
<a name="l01790"></a>01790           <span class="keywordflow">break</span>;
<a name="l01791"></a>01791 
<a name="l01792"></a>01792         <span class="keywordflow">if</span> ( y &lt;= zone-&gt;org_top + blues-&gt;<a class="code" href="struct_p_s_h___blues_rec__.html#a3f1bbc8e8dc8c3ddec79c4adc5a55e54">blue_fuzz</a> )
<a name="l01793"></a>01793           <span class="keywordflow">if</span> ( blues-&gt;<a class="code" href="struct_p_s_h___blues_rec__.html#a63d0b7f44d1188f908c2dc0e43a81d95">no_overshoots</a> || delta &lt;= blues-&gt;blue_threshold )
<a name="l01794"></a>01794           {
<a name="l01795"></a>01795             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = zone-&gt;<a class="code" href="struct_p_s_h___blue___zone_rec__.html#a0aefe85c9fe5aed2ff60b5e7f204ca9b">cur_bottom</a>;
<a name="l01796"></a>01796             <a class="code" href="pshalgo_8h.html#a7bac07cb1fa5fd1115b1b7cd2fa7df3a">psh_point_set_strong</a>( point );
<a name="l01797"></a>01797             <a class="code" href="pshalgo_8h.html#ac1b671f89205d251fb5f64858e1bbe92">psh_point_set_fitted</a>( point );
<a name="l01798"></a>01798           }
<a name="l01799"></a>01799       }
<a name="l01800"></a>01800 
<a name="l01801"></a>01801       <span class="comment">/* look up bottom zones */</span>
<a name="l01802"></a>01802       table      = &amp;blues-&gt;<a class="code" href="struct_p_s_h___blues_rec__.html#aed54cd3e8fac122be75c69629cbf2165">normal_bottom</a>;
<a name="l01803"></a>01803       blue_count = table-&gt;<a class="code" href="struct_p_s_h___blue___table_rec__.html#a20c47e75c99471378ee6cd7bba745e29">count</a>;
<a name="l01804"></a>01804       zone       = table-&gt;<a class="code" href="struct_p_s_h___blue___table_rec__.html#a81f477ba33c7de685c36ac8afa32efa2">zones</a> + blue_count - 1;
<a name="l01805"></a>01805 
<a name="l01806"></a>01806       <span class="keywordflow">for</span> ( ; blue_count &gt; 0; blue_count--, zone-- )
<a name="l01807"></a>01807       {
<a name="l01808"></a>01808         <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  delta = zone-&gt;<a class="code" href="struct_p_s_h___blue___zone_rec__.html#a62dac7f5e8d472ea47a1a9ec962f4b01">org_top</a> - y;
<a name="l01809"></a>01809 
<a name="l01810"></a>01810 
<a name="l01811"></a>01811         <span class="keywordflow">if</span> ( delta &lt; -blues-&gt;blue_fuzz )
<a name="l01812"></a>01812           <span class="keywordflow">break</span>;
<a name="l01813"></a>01813 
<a name="l01814"></a>01814         <span class="keywordflow">if</span> ( y &gt;= zone-&gt;<a class="code" href="struct_p_s_h___blue___zone_rec__.html#af09f51397360e614f909802e5fa29575">org_bottom</a> - blues-&gt;<a class="code" href="struct_p_s_h___blues_rec__.html#a3f1bbc8e8dc8c3ddec79c4adc5a55e54">blue_fuzz</a> )
<a name="l01815"></a>01815           <span class="keywordflow">if</span> ( blues-&gt;<a class="code" href="struct_p_s_h___blues_rec__.html#a63d0b7f44d1188f908c2dc0e43a81d95">no_overshoots</a> || delta &lt; blues-&gt;blue_threshold )
<a name="l01816"></a>01816           {
<a name="l01817"></a>01817             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = zone-&gt;<a class="code" href="struct_p_s_h___blue___zone_rec__.html#a24412f1d3e29e588387b65912a4f948c">cur_top</a>;
<a name="l01818"></a>01818             <a class="code" href="pshalgo_8h.html#a7bac07cb1fa5fd1115b1b7cd2fa7df3a">psh_point_set_strong</a>( point );
<a name="l01819"></a>01819             <a class="code" href="pshalgo_8h.html#ac1b671f89205d251fb5f64858e1bbe92">psh_point_set_fitted</a>( point );
<a name="l01820"></a>01820           }
<a name="l01821"></a>01821       }
<a name="l01822"></a>01822     }
<a name="l01823"></a>01823   }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825 
<a name="l01826"></a>01826   <span class="comment">/* interpolate strong points with the help of hinted coordinates */</span>
<a name="l01827"></a>01827   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01828"></a>01828   psh_glyph_interpolate_strong_points( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph,
<a name="l01829"></a>01829                                        <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     dimension )
<a name="l01830"></a>01830   {
<a name="l01831"></a>01831     <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>  dim   = &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a>-&gt;dimension[dimension];
<a name="l01832"></a>01832     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       scale = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a0920c1e7f14cb5c759a41c14988bca80">scale_mult</a>;
<a name="l01833"></a>01833 
<a name="l01834"></a>01834     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>        count = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>;
<a name="l01835"></a>01835     <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>      point = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>;
<a name="l01836"></a>01836 
<a name="l01837"></a>01837 
<a name="l01838"></a>01838     <span class="keywordflow">for</span> ( ; count &gt; 0; count--, point++ )
<a name="l01839"></a>01839     {
<a name="l01840"></a>01840       <a class="code" href="pshalgo_8h.html#a2e8064fa55617617c9519266a5f9f36d">PSH_Hint</a>  hint = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a1dc99602e87f3fa14ac6af2d2ba040f4">hint</a>;
<a name="l01841"></a>01841 
<a name="l01842"></a>01842 
<a name="l01843"></a>01843       <span class="keywordflow">if</span> ( hint )
<a name="l01844"></a>01844       {
<a name="l01845"></a>01845         <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  delta;
<a name="l01846"></a>01846 
<a name="l01847"></a>01847 
<a name="l01848"></a>01848         <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a80691c5d3573d8e7fef86393a107a6e9">psh_point_is_edge_min</a>( point ) )
<a name="l01849"></a>01849           point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = hint-&gt;cur_pos;
<a name="l01850"></a>01850 
<a name="l01851"></a>01851         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a47c08d480f9aa8064721c63cbf85f254">psh_point_is_edge_max</a>( point ) )
<a name="l01852"></a>01852           point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = hint-&gt;cur_pos + hint-&gt;cur_len;
<a name="l01853"></a>01853 
<a name="l01854"></a>01854         <span class="keywordflow">else</span>
<a name="l01855"></a>01855         {
<a name="l01856"></a>01856           delta = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> - hint-&gt;org_pos;
<a name="l01857"></a>01857 
<a name="l01858"></a>01858           <span class="keywordflow">if</span> ( delta &lt;= 0 )
<a name="l01859"></a>01859             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = hint-&gt;cur_pos + <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( delta, scale );
<a name="l01860"></a>01860 
<a name="l01861"></a>01861           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( delta &gt;= hint-&gt;org_len )
<a name="l01862"></a>01862             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = hint-&gt;cur_pos + hint-&gt;cur_len +
<a name="l01863"></a>01863                              <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( delta - hint-&gt;org_len, scale );
<a name="l01864"></a>01864 
<a name="l01865"></a>01865           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( hint-&gt;org_len &gt; 0 )
<a name="l01866"></a>01866             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = hint-&gt;cur_pos +
<a name="l01867"></a>01867                              <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( delta, hint-&gt;cur_len,
<a name="l01868"></a>01868                                         hint-&gt;org_len );
<a name="l01869"></a>01869           <span class="keywordflow">else</span>
<a name="l01870"></a>01870             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = hint-&gt;cur_pos;
<a name="l01871"></a>01871         }
<a name="l01872"></a>01872         <a class="code" href="pshalgo_8h.html#ac1b671f89205d251fb5f64858e1bbe92">psh_point_set_fitted</a>( point );
<a name="l01873"></a>01873       }
<a name="l01874"></a>01874     }
<a name="l01875"></a>01875   }
<a name="l01876"></a>01876 
<a name="l01877"></a>01877 
<a name="l01878"></a><a class="code" href="pshalgo_8c.html#ab575a49609192b12fef95f1610739107">01878</a> <span class="preprocessor">#define  PSH_MAX_STRONG_INTERNAL  16</span>
<a name="l01879"></a>01879 <span class="preprocessor"></span>
<a name="l01880"></a>01880   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01881"></a>01881   psh_glyph_interpolate_normal_points( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph,
<a name="l01882"></a>01882                                        <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     dimension )
<a name="l01883"></a>01883   {
<a name="l01884"></a>01884 
<a name="l01885"></a>01885 <span class="preprocessor">#if 1</span>
<a name="l01886"></a>01886 <span class="preprocessor"></span>    <span class="comment">/* first technique: a point is strong if it is a local extremum */</span>
<a name="l01887"></a>01887 
<a name="l01888"></a>01888     <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>  dim    = &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a>-&gt;dimension[dimension];
<a name="l01889"></a>01889     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       scale  = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a0920c1e7f14cb5c759a41c14988bca80">scale_mult</a>;
<a name="l01890"></a>01890     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>      memory = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a303af9b985cdd171dc2eb9121ba8f2a2">memory</a>;
<a name="l01891"></a>01891 
<a name="l01892"></a>01892     <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>*     strongs     = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01893"></a>01893     <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>      strongs_0[<a class="code" href="pshalgo_8c.html#ab575a49609192b12fef95f1610739107">PSH_MAX_STRONG_INTERNAL</a>];
<a name="l01894"></a>01894     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>        num_strongs = 0;
<a name="l01895"></a>01895 
<a name="l01896"></a>01896     <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>      points = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a1e4872d9c2286dafb261a1398152674a">points</a>;
<a name="l01897"></a>01897     <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>      points_end = points + glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a696eb2226c5aa1c55ab162f725a7c9b7">num_points</a>;
<a name="l01898"></a>01898     <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>      point;
<a name="l01899"></a>01899 
<a name="l01900"></a>01900 
<a name="l01901"></a>01901     <span class="comment">/* first count the number of strong points */</span>
<a name="l01902"></a>01902     <span class="keywordflow">for</span> ( point = points; point &lt; points_end; point++ )
<a name="l01903"></a>01903     {
<a name="l01904"></a>01904       <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a0b02d3a613fb16b6bb68da871814dd89">psh_point_is_strong</a>( point ) )
<a name="l01905"></a>01905         num_strongs++;
<a name="l01906"></a>01906     }
<a name="l01907"></a>01907 
<a name="l01908"></a>01908     <span class="keywordflow">if</span> ( num_strongs == 0 )  <span class="comment">/* nothing to do here */</span>
<a name="l01909"></a>01909       <span class="keywordflow">return</span>;
<a name="l01910"></a>01910 
<a name="l01911"></a>01911     <span class="comment">/* allocate an array to store a list of points, */</span>
<a name="l01912"></a>01912     <span class="comment">/* stored in increasing org_u order             */</span>
<a name="l01913"></a>01913     <span class="keywordflow">if</span> ( num_strongs &lt;= <a class="code" href="pshalgo_8c.html#ab575a49609192b12fef95f1610739107">PSH_MAX_STRONG_INTERNAL</a> )
<a name="l01914"></a>01914       strongs = strongs_0;
<a name="l01915"></a>01915     <span class="keywordflow">else</span>
<a name="l01916"></a>01916     {
<a name="l01917"></a>01917       <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>  error;
<a name="l01918"></a>01918 
<a name="l01919"></a>01919 
<a name="l01920"></a>01920       <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a231caa1da52440d78812f037f2a35a30">FT_NEW_ARRAY</a>( strongs, num_strongs ) )
<a name="l01921"></a>01921         <span class="keywordflow">return</span>;
<a name="l01922"></a>01922     }
<a name="l01923"></a>01923 
<a name="l01924"></a>01924     num_strongs = 0;
<a name="l01925"></a>01925     <span class="keywordflow">for</span> ( point = points; point &lt; points_end; point++ )
<a name="l01926"></a>01926     {
<a name="l01927"></a>01927       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>*  insert;
<a name="l01928"></a>01928 
<a name="l01929"></a>01929 
<a name="l01930"></a>01930       <span class="keywordflow">if</span> ( !<a class="code" href="pshalgo_8h.html#a0b02d3a613fb16b6bb68da871814dd89">psh_point_is_strong</a>( point ) )
<a name="l01931"></a>01931         <span class="keywordflow">continue</span>;
<a name="l01932"></a>01932 
<a name="l01933"></a>01933       <span class="keywordflow">for</span> ( insert = strongs + num_strongs; insert &gt; strongs; insert-- )
<a name="l01934"></a>01934       {
<a name="l01935"></a>01935         <span class="keywordflow">if</span> ( insert[-1]-&gt;org_u &lt;= point-&gt;org_u )
<a name="l01936"></a>01936           <span class="keywordflow">break</span>;
<a name="l01937"></a>01937 
<a name="l01938"></a>01938         insert[0] = insert[-1];
<a name="l01939"></a>01939       }
<a name="l01940"></a>01940       insert[0] = point;
<a name="l01941"></a>01941       num_strongs++;
<a name="l01942"></a>01942     }
<a name="l01943"></a>01943 
<a name="l01944"></a>01944     <span class="comment">/* now try to interpolate all normal points */</span>
<a name="l01945"></a>01945     <span class="keywordflow">for</span> ( point = points; point &lt; points_end; point++ )
<a name="l01946"></a>01946     {
<a name="l01947"></a>01947       <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a0b02d3a613fb16b6bb68da871814dd89">psh_point_is_strong</a>( point ) )
<a name="l01948"></a>01948         <span class="keywordflow">continue</span>;
<a name="l01949"></a>01949 
<a name="l01950"></a>01950       <span class="comment">/* sometimes, some local extrema are smooth points */</span>
<a name="l01951"></a>01951       <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#a630000442c85da689f7bfab3e3fd4cb5">psh_point_is_smooth</a>( point ) )
<a name="l01952"></a>01952       {
<a name="l01953"></a>01953         <span class="keywordflow">if</span> ( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9ec38c3873255a735244ca2c1d1312a5">dir_in</a> == <a class="code" href="pshalgo_8h.html#abed82baf7f470b522273a3e37c24c600ab088f26343924fb63ec139c46b421512">PSH_DIR_NONE</a>   ||
<a name="l01954"></a>01954              point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9ec38c3873255a735244ca2c1d1312a5">dir_in</a> != point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a52bd7db9cde5975efb5ddca68fd4329d">dir_out</a> )
<a name="l01955"></a>01955           <span class="keywordflow">continue</span>;
<a name="l01956"></a>01956 
<a name="l01957"></a>01957         <span class="keywordflow">if</span> ( !<a class="code" href="pshalgo_8h.html#a71799815223bfc8cacd7ecefe7e19eab">psh_point_is_extremum</a>( point ) &amp;&amp;
<a name="l01958"></a>01958              !<a class="code" href="pshalgo_8h.html#a28fbb8f16977632bce4c8b90972a1b03">psh_point_is_inflex</a>( point )   )
<a name="l01959"></a>01959           <span class="keywordflow">continue</span>;
<a name="l01960"></a>01960 
<a name="l01961"></a>01961         point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a4e8ff007cec28131544b2ab18d31dece">flags</a> &amp;= ~<a class="code" href="pshalgo_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a78f2ee7865f200aa121f2c0c8d570b35">PSH_POINT_SMOOTH</a>;
<a name="l01962"></a>01962       }
<a name="l01963"></a>01963 
<a name="l01964"></a>01964       <span class="comment">/* find best enclosing point coordinates then interpolate */</span>
<a name="l01965"></a>01965       {
<a name="l01966"></a>01966         <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>   before, after;
<a name="l01967"></a>01967         <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>     nn;
<a name="l01968"></a>01968 
<a name="l01969"></a>01969 
<a name="l01970"></a>01970         <span class="keywordflow">for</span> ( nn = 0; nn &lt; num_strongs; nn++ )
<a name="l01971"></a>01971           <span class="keywordflow">if</span> ( strongs[nn]-&gt;org_u &gt; point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> )
<a name="l01972"></a>01972             <span class="keywordflow">break</span>;
<a name="l01973"></a>01973 
<a name="l01974"></a>01974         <span class="keywordflow">if</span> ( nn == 0 )  <span class="comment">/* point before the first strong point */</span>
<a name="l01975"></a>01975         {
<a name="l01976"></a>01976           after = strongs[0];
<a name="l01977"></a>01977 
<a name="l01978"></a>01978           point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> +
<a name="l01979"></a>01979                            <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> - after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>,
<a name="l01980"></a>01980                                       scale );
<a name="l01981"></a>01981         }
<a name="l01982"></a>01982         <span class="keywordflow">else</span>
<a name="l01983"></a>01983         {
<a name="l01984"></a>01984           before = strongs[nn - 1];
<a name="l01985"></a>01985 
<a name="l01986"></a>01986           <span class="keywordflow">for</span> ( nn = num_strongs; nn &gt; 0; nn-- )
<a name="l01987"></a>01987             <span class="keywordflow">if</span> ( strongs[nn - 1]-&gt;org_u &lt; point-&gt;org_u )
<a name="l01988"></a>01988               <span class="keywordflow">break</span>;
<a name="l01989"></a>01989 
<a name="l01990"></a>01990           <span class="keywordflow">if</span> ( nn == num_strongs )  <span class="comment">/* point is after last strong point */</span>
<a name="l01991"></a>01991           {
<a name="l01992"></a>01992             before = strongs[nn - 1];
<a name="l01993"></a>01993 
<a name="l01994"></a>01994             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> +
<a name="l01995"></a>01995                              <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> - before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>,
<a name="l01996"></a>01996                                         scale );
<a name="l01997"></a>01997           }
<a name="l01998"></a>01998           <span class="keywordflow">else</span>
<a name="l01999"></a>01999           {
<a name="l02000"></a>02000             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  u;
<a name="l02001"></a>02001 
<a name="l02002"></a>02002 
<a name="l02003"></a>02003             after = strongs[nn];
<a name="l02004"></a>02004 
<a name="l02005"></a>02005             <span class="comment">/* now interpolate point between before and after */</span>
<a name="l02006"></a>02006             u = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>;
<a name="l02007"></a>02007 
<a name="l02008"></a>02008             <span class="keywordflow">if</span> ( u == before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> )
<a name="l02009"></a>02009               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a>;
<a name="l02010"></a>02010 
<a name="l02011"></a>02011             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( u == after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> )
<a name="l02012"></a>02012               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a>;
<a name="l02013"></a>02013 
<a name="l02014"></a>02014             <span class="keywordflow">else</span>
<a name="l02015"></a>02015               point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> +
<a name="l02016"></a>02016                                <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( u - before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>,
<a name="l02017"></a>02017                                           after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> - before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a>,
<a name="l02018"></a>02018                                           after-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> - before-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> );
<a name="l02019"></a>02019           }
<a name="l02020"></a>02020         }
<a name="l02021"></a>02021         <a class="code" href="pshalgo_8h.html#ac1b671f89205d251fb5f64858e1bbe92">psh_point_set_fitted</a>( point );
<a name="l02022"></a>02022       }
<a name="l02023"></a>02023     }
<a name="l02024"></a>02024 
<a name="l02025"></a>02025     <span class="keywordflow">if</span> ( strongs != strongs_0 )
<a name="l02026"></a>02026       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( strongs );
<a name="l02027"></a>02027 
<a name="l02028"></a>02028 <span class="preprocessor">#endif </span><span class="comment">/* 1 */</span>
<a name="l02029"></a>02029 
<a name="l02030"></a>02030   }
<a name="l02031"></a>02031 
<a name="l02032"></a>02032 
<a name="l02033"></a>02033   <span class="comment">/* interpolate other points */</span>
<a name="l02034"></a>02034   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02035"></a>02035   psh_glyph_interpolate_other_points( <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>  glyph,
<a name="l02036"></a>02036                                       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>     dimension )
<a name="l02037"></a>02037   {
<a name="l02038"></a>02038     <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>  dim          = &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a>-&gt;dimension[dimension];
<a name="l02039"></a>02039     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       scale        = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a0920c1e7f14cb5c759a41c14988bca80">scale_mult</a>;
<a name="l02040"></a>02040     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>       delta        = dim-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a7fe63fc51c731760358d242dee84cd53">scale_delta</a>;
<a name="l02041"></a>02041     <a class="code" href="struct_p_s_h___contour_rec__.html">PSH_Contour</a>    contour      = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ade9e594cd9ede3162787b2be47e5b719">contours</a>;
<a name="l02042"></a>02042     <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>        num_contours = glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a742cca21d75380d3b3c6589f2e69aec4">num_contours</a>;
<a name="l02043"></a>02043 
<a name="l02044"></a>02044 
<a name="l02045"></a>02045     <span class="keywordflow">for</span> ( ; num_contours &gt; 0; num_contours--, contour++ )
<a name="l02046"></a>02046     {
<a name="l02047"></a>02047       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  start = contour-&gt;<a class="code" href="struct_p_s_h___contour_rec__.html#ada292eef1584e5f887bea69ba8703aa2">start</a>;
<a name="l02048"></a>02048       <a class="code" href="struct_p_s_h___point_rec__.html">PSH_Point</a>  first, next, point;
<a name="l02049"></a>02049       <a class="code" href="fttypes_8h.html#abcb8db4dbf35d2b55a9e8c7b0926dc52">FT_UInt</a>    fit_count;
<a name="l02050"></a>02050 
<a name="l02051"></a>02051 
<a name="l02052"></a>02052       <span class="comment">/* count the number of strong points in this contour */</span>
<a name="l02053"></a>02053       next      = start + contour-&gt;<a class="code" href="struct_p_s_h___contour_rec__.html#a5d45ebbfcc7c5cb394ddae2e1b9dacf3">count</a>;
<a name="l02054"></a>02054       fit_count = 0;
<a name="l02055"></a>02055       first     = 0;
<a name="l02056"></a>02056 
<a name="l02057"></a>02057       <span class="keywordflow">for</span> ( point = start; point &lt; next; point++ )
<a name="l02058"></a>02058         <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#ac5359f6b47a6d1daa80ddf9d88547761">psh_point_is_fitted</a>( point ) )
<a name="l02059"></a>02059         {
<a name="l02060"></a>02060           <span class="keywordflow">if</span> ( !first )
<a name="l02061"></a>02061             first = point;
<a name="l02062"></a>02062 
<a name="l02063"></a>02063           fit_count++;
<a name="l02064"></a>02064         }
<a name="l02065"></a>02065 
<a name="l02066"></a>02066       <span class="comment">/* if there are less than 2 fitted points in the contour, we */</span>
<a name="l02067"></a>02067       <span class="comment">/* simply scale and eventually translate the contour points  */</span>
<a name="l02068"></a>02068       <span class="keywordflow">if</span> ( fit_count &lt; 2 )
<a name="l02069"></a>02069       {
<a name="l02070"></a>02070         <span class="keywordflow">if</span> ( fit_count == 1 )
<a name="l02071"></a>02071           delta = first-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> - <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( first-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>, scale );
<a name="l02072"></a>02072 
<a name="l02073"></a>02073         <span class="keywordflow">for</span> ( point = start; point &lt; next; point++ )
<a name="l02074"></a>02074           <span class="keywordflow">if</span> ( point != first )
<a name="l02075"></a>02075             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>, scale ) + delta;
<a name="l02076"></a>02076 
<a name="l02077"></a>02077         <span class="keywordflow">goto</span> Next_Contour;
<a name="l02078"></a>02078       }
<a name="l02079"></a>02079 
<a name="l02080"></a>02080       <span class="comment">/* there are more than 2 strong points in this contour; we */</span>
<a name="l02081"></a>02081       <span class="comment">/* need to interpolate weak points between them            */</span>
<a name="l02082"></a>02082       start = first;
<a name="l02083"></a>02083       <span class="keywordflow">do</span>
<a name="l02084"></a>02084       {
<a name="l02085"></a>02085         point = first;
<a name="l02086"></a>02086 
<a name="l02087"></a>02087         <span class="comment">/* skip consecutive fitted points */</span>
<a name="l02088"></a>02088         <span class="keywordflow">for</span> (;;)
<a name="l02089"></a>02089         {
<a name="l02090"></a>02090           next = first-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l02091"></a>02091           <span class="keywordflow">if</span> ( next == start )
<a name="l02092"></a>02092             <span class="keywordflow">goto</span> Next_Contour;
<a name="l02093"></a>02093 
<a name="l02094"></a>02094           <span class="keywordflow">if</span> ( !<a class="code" href="pshalgo_8h.html#ac5359f6b47a6d1daa80ddf9d88547761">psh_point_is_fitted</a>( next ) )
<a name="l02095"></a>02095             <span class="keywordflow">break</span>;
<a name="l02096"></a>02096 
<a name="l02097"></a>02097           first = next;
<a name="l02098"></a>02098         }
<a name="l02099"></a>02099 
<a name="l02100"></a>02100         <span class="comment">/* find next fitted point after unfitted one */</span>
<a name="l02101"></a>02101         <span class="keywordflow">for</span> (;;)
<a name="l02102"></a>02102         {
<a name="l02103"></a>02103           next = next-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l02104"></a>02104           <span class="keywordflow">if</span> ( <a class="code" href="pshalgo_8h.html#ac5359f6b47a6d1daa80ddf9d88547761">psh_point_is_fitted</a>( next ) )
<a name="l02105"></a>02105             <span class="keywordflow">break</span>;
<a name="l02106"></a>02106         }
<a name="l02107"></a>02107 
<a name="l02108"></a>02108         <span class="comment">/* now interpolate between them */</span>
<a name="l02109"></a>02109         {
<a name="l02110"></a>02110           <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>    org_a, org_ab, cur_a, cur_ab;
<a name="l02111"></a>02111           <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>    org_c, org_ac, cur_c;
<a name="l02112"></a>02112           <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  scale_ab;
<a name="l02113"></a>02113 
<a name="l02114"></a>02114 
<a name="l02115"></a>02115           <span class="keywordflow">if</span> ( first-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> &lt;= next-&gt;org_u )
<a name="l02116"></a>02116           {
<a name="l02117"></a>02117             org_a  = first-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>;
<a name="l02118"></a>02118             cur_a  = first-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a>;
<a name="l02119"></a>02119             org_ab = next-&gt;org_u - org_a;
<a name="l02120"></a>02120             cur_ab = next-&gt;cur_u - cur_a;
<a name="l02121"></a>02121           }
<a name="l02122"></a>02122           <span class="keywordflow">else</span>
<a name="l02123"></a>02123           {
<a name="l02124"></a>02124             org_a  = next-&gt;org_u;
<a name="l02125"></a>02125             cur_a  = next-&gt;cur_u;
<a name="l02126"></a>02126             org_ab = first-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a> - org_a;
<a name="l02127"></a>02127             cur_ab = first-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> - cur_a;
<a name="l02128"></a>02128           }
<a name="l02129"></a>02129 
<a name="l02130"></a>02130           scale_ab = 0x10000L;
<a name="l02131"></a>02131           <span class="keywordflow">if</span> ( org_ab &gt; 0 )
<a name="l02132"></a>02132             scale_ab = <a class="code" href="freetype_8h.html#a5248df90a0d076e6543b09284face353">FT_DivFix</a>( cur_ab, org_ab );
<a name="l02133"></a>02133 
<a name="l02134"></a>02134           point = first-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l02135"></a>02135           <span class="keywordflow">do</span>
<a name="l02136"></a>02136           {
<a name="l02137"></a>02137             org_c  = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a360fd71c553c9868575458592ef8cb40">org_u</a>;
<a name="l02138"></a>02138             org_ac = org_c - org_a;
<a name="l02139"></a>02139 
<a name="l02140"></a>02140             <span class="keywordflow">if</span> ( org_ac &lt;= 0 )
<a name="l02141"></a>02141             {
<a name="l02142"></a>02142               <span class="comment">/* on the left of the interpolation zone */</span>
<a name="l02143"></a>02143               cur_c = cur_a + <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( org_ac, scale );
<a name="l02144"></a>02144             }
<a name="l02145"></a>02145             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( org_ac &gt;= org_ab )
<a name="l02146"></a>02146             {
<a name="l02147"></a>02147               <span class="comment">/* on the right on the interpolation zone */</span>
<a name="l02148"></a>02148               cur_c = cur_a + cur_ab + <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( org_ac - org_ab, scale );
<a name="l02149"></a>02149             }
<a name="l02150"></a>02150             <span class="keywordflow">else</span>
<a name="l02151"></a>02151             {
<a name="l02152"></a>02152               <span class="comment">/* within the interpolation zone */</span>
<a name="l02153"></a>02153               cur_c = cur_a + <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( org_ac, scale_ab );
<a name="l02154"></a>02154             }
<a name="l02155"></a>02155 
<a name="l02156"></a>02156             point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a56b8b9f6144f07a636ad406f363abce8">cur_u</a> = cur_c;
<a name="l02157"></a>02157 
<a name="l02158"></a>02158             point = point-&gt;<a class="code" href="struct_p_s_h___point_rec__.html#a9e5fdea59770272ca2ad1d7738f151b1">next</a>;
<a name="l02159"></a>02159 
<a name="l02160"></a>02160           } <span class="keywordflow">while</span> ( point != next );
<a name="l02161"></a>02161         }
<a name="l02162"></a>02162 
<a name="l02163"></a>02163         <span class="comment">/* keep going until all points in the contours have been processed */</span>
<a name="l02164"></a>02164         first = next;
<a name="l02165"></a>02165 
<a name="l02166"></a>02166       } <span class="keywordflow">while</span> ( first != start );
<a name="l02167"></a>02167 
<a name="l02168"></a>02168     Next_Contour:
<a name="l02169"></a>02169       ;
<a name="l02170"></a>02170     }
<a name="l02171"></a>02171   }
<a name="l02172"></a>02172 
<a name="l02173"></a>02173 
<a name="l02174"></a>02174   <span class="comment">/*************************************************************************/</span>
<a name="l02175"></a>02175   <span class="comment">/*************************************************************************/</span>
<a name="l02176"></a>02176   <span class="comment">/*****                                                               *****/</span>
<a name="l02177"></a>02177   <span class="comment">/*****                     HIGH-LEVEL INTERFACE                      *****/</span>
<a name="l02178"></a>02178   <span class="comment">/*****                                                               *****/</span>
<a name="l02179"></a>02179   <span class="comment">/*************************************************************************/</span>
<a name="l02180"></a>02180   <span class="comment">/*************************************************************************/</span>
<a name="l02181"></a>02181 
<a name="l02182"></a>02182   <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l02183"></a><a class="code" href="pshalgo_8h.html#a8f53a1b18800f3735cf9ba81716ab5fa">02183</a>   <a class="code" href="pshalgo_8c.html#a8f53a1b18800f3735cf9ba81716ab5fa">ps_hints_apply</a>( <a class="code" href="struct_p_s___hints_rec__.html">PS_Hints</a>        ps_hints,
<a name="l02184"></a>02184                   <a class="code" href="struct_f_t___outline__.html">FT_Outline</a>*     outline,
<a name="l02185"></a>02185                   <a class="code" href="pshints_8h.html#aed4220b62b12a76456f9f47bafa5fe52">PSH_Globals</a>     globals,
<a name="l02186"></a>02186                   <a class="code" href="freetype_8h.html#aaa0488bc4d2c5f0a6f4311ddee8edfb7">FT_Render_Mode</a>  hint_mode )
<a name="l02187"></a>02187   {
<a name="l02188"></a>02188     <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_GlyphRec</a>  glyphrec;
<a name="l02189"></a>02189     <a class="code" href="struct_p_s_h___glyph_rec__.html">PSH_Glyph</a>     glyph = &amp;glyphrec;
<a name="l02190"></a>02190     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>      error;
<a name="l02191"></a>02191 <span class="preprocessor">#ifdef DEBUG_HINTER</span>
<a name="l02192"></a>02192 <span class="preprocessor"></span>    <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>     memory;
<a name="l02193"></a>02193 <span class="preprocessor">#endif</span>
<a name="l02194"></a>02194 <span class="preprocessor"></span>    <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>        dimension;
<a name="l02195"></a>02195 
<a name="l02196"></a>02196 
<a name="l02197"></a>02197     <span class="comment">/* something to do? */</span>
<a name="l02198"></a>02198     <span class="keywordflow">if</span> ( outline-&gt;<a class="code" href="struct_f_t___outline__.html#a7ebcf3c33231af88655534d1ac02b66e">n_points</a> == 0 || outline-&gt;<a class="code" href="struct_f_t___outline__.html#a0313ba9c2c51f10e6b7d7ef97bd946e2">n_contours</a> == 0 )
<a name="l02199"></a>02199       <span class="keywordflow">return</span> PSH_Err_Ok;
<a name="l02200"></a>02200 
<a name="l02201"></a>02201 <span class="preprocessor">#ifdef DEBUG_HINTER</span>
<a name="l02202"></a>02202 <span class="preprocessor"></span>
<a name="l02203"></a>02203     memory = globals-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#a303af9b985cdd171dc2eb9121ba8f2a2">memory</a>;
<a name="l02204"></a>02204 
<a name="l02205"></a>02205     <span class="keywordflow">if</span> ( ps_debug_glyph )
<a name="l02206"></a>02206     {
<a name="l02207"></a>02207       psh_glyph_done( ps_debug_glyph );
<a name="l02208"></a>02208       <a class="code" href="ftmemory_8h.html#a65757b0bcd1194545354e86e7c687300">FT_FREE</a>( ps_debug_glyph );
<a name="l02209"></a>02209     }
<a name="l02210"></a>02210 
<a name="l02211"></a>02211     <span class="keywordflow">if</span> ( <a class="code" href="ftmemory_8h.html#a313d8de417ea0d1c5fcc7d348397a642">FT_NEW</a>( glyph ) )
<a name="l02212"></a>02212       <span class="keywordflow">return</span> error;
<a name="l02213"></a>02213 
<a name="l02214"></a>02214     ps_debug_glyph = glyph;
<a name="l02215"></a>02215 
<a name="l02216"></a>02216 <span class="preprocessor">#endif </span><span class="comment">/* DEBUG_HINTER */</span>
<a name="l02217"></a>02217 
<a name="l02218"></a>02218     error = psh_glyph_init( glyph, outline, ps_hints, globals );
<a name="l02219"></a>02219     <span class="keywordflow">if</span> ( error )
<a name="l02220"></a>02220       <span class="keywordflow">goto</span> Exit;
<a name="l02221"></a>02221 
<a name="l02222"></a>02222     <span class="comment">/* try to optimize the y_scale so that the top of non-capital letters</span>
<a name="l02223"></a>02223 <span class="comment">     * is aligned on a pixel boundary whenever possible</span>
<a name="l02224"></a>02224 <span class="comment">     */</span>
<a name="l02225"></a>02225     {
<a name="l02226"></a>02226       <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>  dim_x = &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a>-&gt;dimension[0];
<a name="l02227"></a>02227       <a class="code" href="struct_p_s_h___dimension_rec__.html">PSH_Dimension</a>  dim_y = &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a>-&gt;dimension[1];
<a name="l02228"></a>02228 
<a name="l02229"></a>02229       <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  x_scale = dim_x-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a0920c1e7f14cb5c759a41c14988bca80">scale_mult</a>;
<a name="l02230"></a>02230       <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  y_scale = dim_y-&gt;<a class="code" href="struct_p_s_h___dimension_rec__.html#a0920c1e7f14cb5c759a41c14988bca80">scale_mult</a>;
<a name="l02231"></a>02231 
<a name="l02232"></a>02232       <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  old_x_scale = x_scale;
<a name="l02233"></a>02233       <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  old_y_scale = y_scale;
<a name="l02234"></a>02234 
<a name="l02235"></a>02235       <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  scaled;
<a name="l02236"></a>02236       <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>  fitted;
<a name="l02237"></a>02237 
<a name="l02238"></a>02238       <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>  rescale = <a class="code" href="ftobjs_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02239"></a>02239 
<a name="l02240"></a>02240 
<a name="l02241"></a>02241       scaled = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( globals-&gt;blues.normal_top.zones-&gt;org_ref, y_scale );
<a name="l02242"></a>02242       fitted = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( scaled );
<a name="l02243"></a>02243 
<a name="l02244"></a>02244       <span class="keywordflow">if</span> ( fitted != 0 &amp;&amp; scaled != fitted )
<a name="l02245"></a>02245       {
<a name="l02246"></a>02246         rescale = <a class="code" href="ftobjs_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02247"></a>02247 
<a name="l02248"></a>02248         y_scale = <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( y_scale, fitted, scaled );
<a name="l02249"></a>02249 
<a name="l02250"></a>02250         <span class="keywordflow">if</span> ( fitted &lt; scaled )
<a name="l02251"></a>02251           x_scale -= x_scale / 50;
<a name="l02252"></a>02252 
<a name="l02253"></a>02253         <a class="code" href="pshglob_8c.html#ae85354258f535f13e282488704207d7b">psh_globals_set_scale</a>( glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a>, x_scale, y_scale, 0, 0 );
<a name="l02254"></a>02254       }
<a name="l02255"></a>02255 
<a name="l02256"></a>02256       glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ab5785a8d814b94b34dc589b99aa8786f">do_horz_hints</a> = 1;
<a name="l02257"></a>02257       glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ad10d5dab79c9c7d5ba4ad6dcfebd355d">do_vert_hints</a> = 1;
<a name="l02258"></a>02258 
<a name="l02259"></a>02259       glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#adf38cde40c655af41a1a45a5590ff45c">do_horz_snapping</a> = <a class="code" href="fttypes_8h.html#adf712510036d534403cbddf4f18c2083">FT_BOOL</a>( hint_mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba2fad77b660130c90b38b873901f55b08">FT_RENDER_MODE_MONO</a> ||
<a name="l02260"></a>02260                                          hint_mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebbaecd5542530a6ea50bb5aad5294936b61">FT_RENDER_MODE_LCD</a>  );
<a name="l02261"></a>02261 
<a name="l02262"></a>02262       glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#aab0c5919fb0901e0b41c7fca35084044">do_vert_snapping</a> = <a class="code" href="fttypes_8h.html#adf712510036d534403cbddf4f18c2083">FT_BOOL</a>( hint_mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba2fad77b660130c90b38b873901f55b08">FT_RENDER_MODE_MONO</a>  ||
<a name="l02263"></a>02263                                          hint_mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebbadd611405f6c2933e848d299100101ade">FT_RENDER_MODE_LCD_V</a> );
<a name="l02264"></a>02264 
<a name="l02265"></a>02265       glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ac9ac7c11e8e306b9cf605ff1d7f0fc56">do_stem_adjust</a>   = <a class="code" href="fttypes_8h.html#adf712510036d534403cbddf4f18c2083">FT_BOOL</a>( hint_mode != <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba5b3b4a74eb40bff744348e7d6c69170f">FT_RENDER_MODE_LIGHT</a> );
<a name="l02266"></a>02266 
<a name="l02267"></a>02267       <span class="keywordflow">for</span> ( dimension = 0; dimension &lt; 2; dimension++ )
<a name="l02268"></a>02268       {
<a name="l02269"></a>02269         <span class="comment">/* load outline coordinates into glyph */</span>
<a name="l02270"></a>02270         psh_glyph_load_points( glyph, dimension );
<a name="l02271"></a>02271 
<a name="l02272"></a>02272         <span class="comment">/* compute local extrema */</span>
<a name="l02273"></a>02273         psh_glyph_compute_extrema( glyph );
<a name="l02274"></a>02274 
<a name="l02275"></a>02275         <span class="comment">/* compute aligned stem/hints positions */</span>
<a name="l02276"></a>02276         psh_hint_table_align_hints( &amp;glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae46b190c2bdf88f967078b11b8c05153">hint_tables</a>[dimension],
<a name="l02277"></a>02277                                     glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a>,
<a name="l02278"></a>02278                                     dimension,
<a name="l02279"></a>02279                                     glyph );
<a name="l02280"></a>02280 
<a name="l02281"></a>02281         <span class="comment">/* find strong points, align them, then interpolate others */</span>
<a name="l02282"></a>02282         psh_glyph_find_strong_points( glyph, dimension );
<a name="l02283"></a>02283         <span class="keywordflow">if</span> ( dimension == 1 )
<a name="l02284"></a>02284           psh_glyph_find_blue_points( &amp;globals-&gt;blues, glyph );
<a name="l02285"></a>02285         psh_glyph_interpolate_strong_points( glyph, dimension );
<a name="l02286"></a>02286         psh_glyph_interpolate_normal_points( glyph, dimension );
<a name="l02287"></a>02287         psh_glyph_interpolate_other_points( glyph, dimension );
<a name="l02288"></a>02288 
<a name="l02289"></a>02289         <span class="comment">/* save hinted coordinates back to outline */</span>
<a name="l02290"></a>02290         psh_glyph_save_points( glyph, dimension );
<a name="l02291"></a>02291 
<a name="l02292"></a>02292         <span class="keywordflow">if</span> ( rescale )
<a name="l02293"></a>02293           <a class="code" href="pshglob_8c.html#ae85354258f535f13e282488704207d7b">psh_globals_set_scale</a>( glyph-&gt;<a class="code" href="struct_p_s_h___glyph_rec__.html#ae0ee8eeafcdf9c301b1b2d38b50a04e1">globals</a>,
<a name="l02294"></a>02294                                  old_x_scale, old_y_scale, 0, 0 );
<a name="l02295"></a>02295       }
<a name="l02296"></a>02296     }
<a name="l02297"></a>02297 
<a name="l02298"></a>02298   Exit:
<a name="l02299"></a>02299 
<a name="l02300"></a>02300 <span class="preprocessor">#ifndef DEBUG_HINTER</span>
<a name="l02301"></a>02301 <span class="preprocessor"></span>    psh_glyph_done( glyph );
<a name="l02302"></a>02302 <span class="preprocessor">#endif</span>
<a name="l02303"></a>02303 <span class="preprocessor"></span>
<a name="l02304"></a>02304     <span class="keywordflow">return</span> error;
<a name="l02305"></a>02305   }
<a name="l02306"></a>02306 
<a name="l02307"></a>02307 
<a name="l02308"></a>02308 <span class="comment">/* END */</span>
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="pshalgo_8c.html">pshalgo.c</a>      </li>

    <li class="footer">Generated on Tue Mar 13 2012 11:44:03 for ARK2D by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
