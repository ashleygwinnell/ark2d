<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ARK2D: src/ARK2D/vendor/zlib123/gzio.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ARK2D
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('gzio_8c.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">src/ARK2D/vendor/zlib123/gzio.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="gzio_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* gzio.c -- IO on .gz files</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 1995-2005 Jean-loup Gailly.</span>
<a name="l00003"></a>00003 <span class="comment"> * For conditions of distribution and use, see copyright notice in zlib.h</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * Compile this file with -DNO_GZCOMPRESS to avoid the compression code.</span>
<a name="l00006"></a>00006 <span class="comment"> */</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment">/* @(#) $Id$ */</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="zutil_8h.html">zutil.h</a>&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#ifdef NO_DEFLATE       </span><span class="comment">/* for compatibility with old definition */</span>
<a name="l00015"></a>00015 <span class="preprocessor">#  define NO_GZCOMPRESS</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span>
<a name="l00018"></a>00018 <span class="preprocessor">#ifndef NO_DUMMY_DECL</span>
<a name="l00019"></a><a class="code" href="structinternal__state.html#ab000a3e3c901dd063859521988ad7e52">00019</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structinternal__state.html">internal_state</a> {<span class="keywordtype">int</span> <a class="code" href="structinternal__state.html#ab000a3e3c901dd063859521988ad7e52">dummy</a>;}; <span class="comment">/* for buggy compilers */</span>
<a name="l00020"></a>00020 <span class="preprocessor">#endif</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef Z_BUFSIZE</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#  ifdef MAXSEG_64K</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#    define Z_BUFSIZE 4096 </span><span class="comment">/* minimize memory usage for 16-bit DOS */</span>
<a name="l00025"></a>00025 <span class="preprocessor">#  else</span>
<a name="l00026"></a><a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">00026</a> <span class="preprocessor"></span><span class="preprocessor">#    define Z_BUFSIZE 16384</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#  endif</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#ifndef Z_PRINTF_BUFSIZE</span>
<a name="l00030"></a><a class="code" href="gzio_8c.html#adb69caa8684234b7c63f24d64b7659db">00030</a> <span class="preprocessor"></span><span class="preprocessor">#  define Z_PRINTF_BUFSIZE 4096</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="preprocessor">#ifdef __MVS__</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#  pragma map (fdopen , &quot;\174\174FDOPEN&quot;)</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>   FILE *fdopen(<span class="keywordtype">int</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00036"></a>00036 <span class="preprocessor">#endif</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 <span class="preprocessor">#ifndef STDC</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="keyword">extern</span> <a class="code" href="zconf_8h.html#aa3397ff439b5e076528b04bc9b8b086a">voidp</a>  malloc <a class="code" href="zconf_8h.html#aa6c3c093d0900e1d96d07c91b53c1b5d">OF</a>((<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a> <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a>));
<a name="l00040"></a>00040 <span class="keyword">extern</span> <span class="keywordtype">void</span>   free   <a class="code" href="zconf_8h.html#aa6c3c093d0900e1d96d07c91b53c1b5d">OF</a>((<a class="code" href="zconf_8h.html#a04c731495379021454c8e61439dc88ec">voidpf</a> ptr));
<a name="l00041"></a>00041 <span class="preprocessor">#endif</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a><a class="code" href="gzio_8c.html#ac5c822e3692a95451e8f70a5916f05a3">00043</a> <span class="preprocessor">#define ALLOC(size) malloc(size)</span>
<a name="l00044"></a><a class="code" href="gzio_8c.html#a5fb23c00a00f3856832e660edc2ab03d">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define TRYFREE(p) {if (p) free(p);}</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="keyword">static</span> <span class="keywordtype">int</span> <span class="keyword">const</span> gz_magic[2] = {0x1f, 0x8b}; <span class="comment">/* gzip magic header */</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="comment">/* gzip flag byte */</span>
<a name="l00049"></a><a class="code" href="gzio_8c.html#aa3c005b88b9e5ba0660df7eba43832cb">00049</a> <span class="preprocessor">#define ASCII_FLAG   0x01 </span><span class="comment">/* bit 0 set: file probably ascii text */</span>
<a name="l00050"></a><a class="code" href="gzio_8c.html#a552e6306aac9df122ffc3ca089b4663b">00050</a> <span class="preprocessor">#define HEAD_CRC     0x02 </span><span class="comment">/* bit 1 set: header CRC present */</span>
<a name="l00051"></a><a class="code" href="gzio_8c.html#a50beca0e4608c1ee356a8ced2497db75">00051</a> <span class="preprocessor">#define EXTRA_FIELD  0x04 </span><span class="comment">/* bit 2 set: extra field present */</span>
<a name="l00052"></a><a class="code" href="gzio_8c.html#ab16f7d2a15f2ef64ffa109a7cda5e65b">00052</a> <span class="preprocessor">#define ORIG_NAME    0x08 </span><span class="comment">/* bit 3 set: original file name present */</span>
<a name="l00053"></a><a class="code" href="gzio_8c.html#a180f5b3835bdbfc11b353fd2af5c8659">00053</a> <span class="preprocessor">#define COMMENT      0x10 </span><span class="comment">/* bit 4 set: file comment present */</span>
<a name="l00054"></a><a class="code" href="gzio_8c.html#a56701f18aaad537f7fc0e9be309503c3">00054</a> <span class="preprocessor">#define RESERVED     0xE0 </span><span class="comment">/* bits 5..7: reserved */</span>
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="structgz__stream.html">00056</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structgz__stream.html">gz_stream</a> {
<a name="l00057"></a><a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">00057</a>     <a class="code" href="structz__stream__s.html">z_stream</a> <a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>;
<a name="l00058"></a><a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">00058</a>     <span class="keywordtype">int</span>      <a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a>;   <span class="comment">/* error code for last stream operation */</span>
<a name="l00059"></a><a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">00059</a>     <span class="keywordtype">int</span>      <a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a>;   <span class="comment">/* set if end of input file */</span>
<a name="l00060"></a><a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">00060</a>     FILE     *<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>;   <span class="comment">/* .gz file */</span>
<a name="l00061"></a><a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">00061</a>     <a class="code" href="ftraster_8c.html#ae3a497195d617519e5353ea7b417940f">Byte</a>     *<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a>;  <span class="comment">/* input buffer */</span>
<a name="l00062"></a><a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">00062</a>     <a class="code" href="ftraster_8c.html#ae3a497195d617519e5353ea7b417940f">Byte</a>     *<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a>; <span class="comment">/* output buffer */</span>
<a name="l00063"></a><a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">00063</a>     <a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a>    <a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a>;     <span class="comment">/* crc32 of uncompressed data */</span>
<a name="l00064"></a><a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">00064</a>     <span class="keywordtype">char</span>     *<a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">msg</a>;    <span class="comment">/* error message */</span>
<a name="l00065"></a><a class="code" href="structgz__stream.html#a75008e50b323bcb85198023003cdc2c6">00065</a>     <span class="keywordtype">char</span>     *<a class="code" href="structgz__stream.html#a75008e50b323bcb85198023003cdc2c6">path</a>;   <span class="comment">/* path name for debugging only */</span>
<a name="l00066"></a><a class="code" href="structgz__stream.html#a5bbfa8460d94ffea4ac6d78aedfc70d1">00066</a>     <span class="keywordtype">int</span>      <a class="code" href="structgz__stream.html#a5bbfa8460d94ffea4ac6d78aedfc70d1">transparent</a>; <span class="comment">/* 1 if input file is not a .gz file */</span>
<a name="l00067"></a><a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">00067</a>     <span class="keywordtype">char</span>     <a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a>;    <span class="comment">/* &#39;w&#39; or &#39;r&#39; */</span>
<a name="l00068"></a><a class="code" href="structgz__stream.html#ae136c7871c6a87f0190c8245921e8145">00068</a>     <a class="code" href="zconf_8h.html#a8cf4661a88ec12823d7cbdd3fa629eb0">z_off_t</a>  <a class="code" href="structgz__stream.html#ae136c7871c6a87f0190c8245921e8145">start</a>;   <span class="comment">/* start of compressed data in file (header skipped) */</span>
<a name="l00069"></a><a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">00069</a>     <a class="code" href="zconf_8h.html#a8cf4661a88ec12823d7cbdd3fa629eb0">z_off_t</a>  <a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a>;      <span class="comment">/* bytes into deflate or inflate */</span>
<a name="l00070"></a><a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">00070</a>     <a class="code" href="zconf_8h.html#a8cf4661a88ec12823d7cbdd3fa629eb0">z_off_t</a>  <a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a>;     <span class="comment">/* bytes out of deflate or inflate */</span>
<a name="l00071"></a><a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">00071</a>     <span class="keywordtype">int</span>      <a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a>;    <span class="comment">/* one character push-back */</span>
<a name="l00072"></a><a class="code" href="structgz__stream.html#a7c5213935b324dfb9a4101a73dd24a37">00072</a>     <span class="keywordtype">int</span>      <a class="code" href="structgz__stream.html#a7c5213935b324dfb9a4101a73dd24a37">last</a>;    <span class="comment">/* true if push-back is last character */</span>
<a name="l00073"></a>00073 } <a class="code" href="gzio_8c.html#a29207c3607ca0ccbc285bcd1b1c727f8">gz_stream</a>;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> <a class="code" href="gzio_8c.html#af96a4a255ee43ecf8a0c77d949114a8f">gz_open</a>      <a class="code" href="zconf_8h.html#aa6c3c093d0900e1d96d07c91b53c1b5d">OF</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *mode, <span class="keywordtype">int</span>  fd));
<a name="l00077"></a>00077 <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">int</span> <a class="code" href="gzio_8c.html#afafc4bbc6787281ae67c082cb529787d">do_flush</a>        <a class="code" href="zconf_8h.html#aa6c3c093d0900e1d96d07c91b53c1b5d">OF</a>((<a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file, <span class="keywordtype">int</span> flush));
<a name="l00078"></a>00078 <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">int</span>    <a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>     <a class="code" href="zconf_8h.html#aa6c3c093d0900e1d96d07c91b53c1b5d">OF</a>((<a class="code" href="structgz__stream.html">gz_stream</a> *s));
<a name="l00079"></a>00079 <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">void</span>   <a class="code" href="gzio_8c.html#a11bd73d6799ab3eae0ac3e7d068ea190">check_header</a> <a class="code" href="zconf_8h.html#aa6c3c093d0900e1d96d07c91b53c1b5d">OF</a>((<a class="code" href="structgz__stream.html">gz_stream</a> *s));
<a name="l00080"></a>00080 <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">int</span>    <a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">destroy</a>      <a class="code" href="zconf_8h.html#aa6c3c093d0900e1d96d07c91b53c1b5d">OF</a>((<a class="code" href="structgz__stream.html">gz_stream</a> *s));
<a name="l00081"></a>00081 <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">void</span>   <a class="code" href="gzio_8c.html#ad1f8f0552c7a8ce50739ce3e49ca5114">putLong</a>      <a class="code" href="zconf_8h.html#aa6c3c093d0900e1d96d07c91b53c1b5d">OF</a>((FILE *file, <a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a> x));
<a name="l00082"></a>00082 <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a>  <a class="code" href="gzio_8c.html#aaa7ad90748c13a5a06768ab2599fbc69">getLong</a>      <a class="code" href="zconf_8h.html#aa6c3c093d0900e1d96d07c91b53c1b5d">OF</a>((<a class="code" href="structgz__stream.html">gz_stream</a> *s));
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="comment">/* ===========================================================================</span>
<a name="l00085"></a>00085 <span class="comment">     Opens a gzip (.gz) file for reading or writing. The mode parameter</span>
<a name="l00086"></a>00086 <span class="comment">   is as in fopen (&quot;rb&quot; or &quot;wb&quot;). The file is given either by file descriptor</span>
<a name="l00087"></a>00087 <span class="comment">   or path name (if fd == -1).</span>
<a name="l00088"></a>00088 <span class="comment">     gz_open returns NULL if the file could not be opened or if there was</span>
<a name="l00089"></a>00089 <span class="comment">   insufficient memory to allocate the (de)compression state; errno</span>
<a name="l00090"></a>00090 <span class="comment">   can be checked to distinguish the two cases (if errno is zero, the</span>
<a name="l00091"></a>00091 <span class="comment">   zlib error is Z_MEM_ERROR).</span>
<a name="l00092"></a>00092 <span class="comment">*/</span>
<a name="l00093"></a><a class="code" href="gzio_8c.html#af96a4a255ee43ecf8a0c77d949114a8f">00093</a> <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> <a class="code" href="gzio_8c.html#af96a4a255ee43ecf8a0c77d949114a8f">gz_open</a> (path, mode, fd)
<a name="l00094"></a>00094     <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span> *path;
<a name="l00095"></a>00095     <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span> *mode;
<a name="l00096"></a>00096     <span class="keywordtype">int</span>  fd;
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098     <span class="keywordtype">int</span> err;
<a name="l00099"></a>00099     <span class="keywordtype">int</span> level = <a class="code" href="zlib_8h.html#af5387baee05124298e431ebe6fe96b17">Z_DEFAULT_COMPRESSION</a>; <span class="comment">/* compression level */</span>
<a name="l00100"></a>00100     <span class="keywordtype">int</span> strategy = <a class="code" href="zlib_8h.html#a580d7c2527e653ddd783109271750849">Z_DEFAULT_STRATEGY</a>; <span class="comment">/* compression strategy */</span>
<a name="l00101"></a>00101     <span class="keywordtype">char</span> *p = (<span class="keywordtype">char</span>*)mode;
<a name="l00102"></a>00102     <a class="code" href="structgz__stream.html">gz_stream</a> *s;
<a name="l00103"></a>00103     <span class="keywordtype">char</span> fmode[80]; <span class="comment">/* copy of mode, without the compression level */</span>
<a name="l00104"></a>00104     <span class="keywordtype">char</span> *m = fmode;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <span class="keywordflow">if</span> (!path || !mode) <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     s = (<a class="code" href="structgz__stream.html">gz_stream</a> *)<a class="code" href="gzio_8c.html#ac5c822e3692a95451e8f70a5916f05a3">ALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="structgz__stream.html">gz_stream</a>));
<a name="l00109"></a>00109     <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a23a2299c384f808e76e9908f21216b0f">zalloc</a> = (alloc_func)0;
<a name="l00112"></a>00112     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a89eb750ade7f4f0b56bfdadf13344982">zfree</a> = (free_func)0;
<a name="l00113"></a>00113     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#ab72467f908d2ce65d5b42ee6556ef8bb">opaque</a> = (<a class="code" href="zconf_8h.html#a04c731495379021454c8e61439dc88ec">voidpf</a>)0;
<a name="l00114"></a>00114     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a21d2c026f0f2fcd67f33011231f8ed00">next_in</a> = s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a> = <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00115"></a>00115     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a> = s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a> = <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00116"></a>00116     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a> = s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> = 0;
<a name="l00117"></a>00117     s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00118"></a>00118     s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>;
<a name="l00119"></a>00119     s-&gt;<a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a> = 0;
<a name="l00120"></a>00120     s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a> = 0;
<a name="l00121"></a>00121     s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> = 0;
<a name="l00122"></a>00122     s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a> = <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>;
<a name="l00123"></a>00123     s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a> = <a class="code" href="crc32_8c.html#a5d6fb454f076e5762905a247702c9be3">crc32</a>(0L, <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>, 0);
<a name="l00124"></a>00124     s-&gt;<a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">msg</a> = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00125"></a>00125     s-&gt;<a class="code" href="structgz__stream.html#a5bbfa8460d94ffea4ac6d78aedfc70d1">transparent</a> = 0;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     s-&gt;<a class="code" href="structgz__stream.html#a75008e50b323bcb85198023003cdc2c6">path</a> = (<span class="keywordtype">char</span>*)<a class="code" href="gzio_8c.html#ac5c822e3692a95451e8f70a5916f05a3">ALLOC</a>(strlen(path)+1);
<a name="l00128"></a>00128     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a75008e50b323bcb85198023003cdc2c6">path</a> == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00129"></a>00129         <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">destroy</a>(s), (<a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a>)<a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     strcpy(s-&gt;<a class="code" href="structgz__stream.html#a75008e50b323bcb85198023003cdc2c6">path</a>, path); <span class="comment">/* do this early for debugging */</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00134"></a>00134     <span class="keywordflow">do</span> {
<a name="l00135"></a>00135         <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;r&#39;</span>) s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> = <span class="charliteral">&#39;r&#39;</span>;
<a name="l00136"></a>00136         <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;w&#39;</span> || *p == <span class="charliteral">&#39;a&#39;</span>) s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> = <span class="charliteral">&#39;w&#39;</span>;
<a name="l00137"></a>00137         <span class="keywordflow">if</span> (*p &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;9&#39;</span>) {
<a name="l00138"></a>00138             level = *p - <span class="charliteral">&#39;0&#39;</span>;
<a name="l00139"></a>00139         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;f&#39;</span>) {
<a name="l00140"></a>00140           strategy = <a class="code" href="zlib_8h.html#af01ccb5a9db8d415cde987d9553ad200">Z_FILTERED</a>;
<a name="l00141"></a>00141         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;h&#39;</span>) {
<a name="l00142"></a>00142           strategy = <a class="code" href="zlib_8h.html#a1eec3d3720ba91fd54fa08d2757c1785">Z_HUFFMAN_ONLY</a>;
<a name="l00143"></a>00143         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;R&#39;</span>) {
<a name="l00144"></a>00144           strategy = <a class="code" href="zlib_8h.html#af52c1220e7193d2da78332d75f9251ea">Z_RLE</a>;
<a name="l00145"></a>00145         } <span class="keywordflow">else</span> {
<a name="l00146"></a>00146             *m++ = *p; <span class="comment">/* copy the mode */</span>
<a name="l00147"></a>00147         }
<a name="l00148"></a>00148     } <span class="keywordflow">while</span> (*p++ &amp;&amp; m != fmode + <span class="keyword">sizeof</span>(fmode));
<a name="l00149"></a>00149     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> == <span class="charliteral">&#39;\0&#39;</span>) <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">destroy</a>(s), (<a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a>)<a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> == <span class="charliteral">&#39;w&#39;</span>) {
<a name="l00152"></a>00152 <span class="preprocessor">#ifdef NO_GZCOMPRESS</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span>        err = <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00154"></a>00154 <span class="preprocessor">#else</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>        err = <a class="code" href="zlib_8h.html#a59b575a521efe7ea0d3b9dd3c8d315c1">deflateInit2</a>(&amp;(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>), level,
<a name="l00156"></a>00156                            <a class="code" href="zlib_8h.html#a27a96226f3dc88e4743131c632adf32f">Z_DEFLATED</a>, -<a class="code" href="zconf_8h.html#abd2f406ac1f9c49236376115d78ccb5b">MAX_WBITS</a>, <a class="code" href="zutil_8h.html#a19c8e60fa32d4ddf303ce988ba97af61">DEF_MEM_LEVEL</a>, strategy);
<a name="l00157"></a>00157         <span class="comment">/* windowBits is passed &lt; 0 to suppress zlib header */</span>
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a> = s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a> = (<a class="code" href="ftraster_8c.html#ae3a497195d617519e5353ea7b417940f">Byte</a>*)<a class="code" href="gzio_8c.html#ac5c822e3692a95451e8f70a5916f05a3">ALLOC</a>(<a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>);
<a name="l00160"></a>00160 <span class="preprocessor">#endif</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (err != <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a> || s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a> == <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>) {
<a name="l00162"></a>00162             <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">destroy</a>(s), (<a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a>)<a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164     } <span class="keywordflow">else</span> {
<a name="l00165"></a>00165         s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a21d2c026f0f2fcd67f33011231f8ed00">next_in</a>  = s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a> = (<a class="code" href="ftraster_8c.html#ae3a497195d617519e5353ea7b417940f">Byte</a>*)<a class="code" href="gzio_8c.html#ac5c822e3692a95451e8f70a5916f05a3">ALLOC</a>(<a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         err = <a class="code" href="zlib_8h.html#a611fc206e69f34e812ca8b590982fdd5">inflateInit2</a>(&amp;(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>), -<a class="code" href="zconf_8h.html#abd2f406ac1f9c49236376115d78ccb5b">MAX_WBITS</a>);
<a name="l00168"></a>00168         <span class="comment">/* windowBits is passed &lt; 0 to tell that there is no zlib header.</span>
<a name="l00169"></a>00169 <span class="comment">         * Note that in this case inflate *requires* an extra &quot;dummy&quot; byte</span>
<a name="l00170"></a>00170 <span class="comment">         * after the compressed stream in order to complete decompression and</span>
<a name="l00171"></a>00171 <span class="comment">         * return Z_STREAM_END. Here the gzip CRC32 ensures that 4 bytes are</span>
<a name="l00172"></a>00172 <span class="comment">         * present after the compressed stream.</span>
<a name="l00173"></a>00173 <span class="comment">         */</span>
<a name="l00174"></a>00174         <span class="keywordflow">if</span> (err != <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a> || s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a> == <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>) {
<a name="l00175"></a>00175             <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">destroy</a>(s), (<a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a>)<a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> = <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     errno = 0;
<a name="l00181"></a>00181     s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a> = fd &lt; 0 ? <a class="code" href="zutil_8h.html#a7d40e22cfc0ad4087bf371d61290a0f5">F_OPEN</a>(path, fmode) : (FILE*)fdopen(fd, fmode);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a> == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00184"></a>00184         <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">destroy</a>(s), (<a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a>)<a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> == <span class="charliteral">&#39;w&#39;</span>) {
<a name="l00187"></a>00187         <span class="comment">/* Write a very simple .gz header:</span>
<a name="l00188"></a>00188 <span class="comment">         */</span>
<a name="l00189"></a>00189         fprintf(s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>, <span class="stringliteral">&quot;%c%c%c%c%c%c%c%c%c%c&quot;</span>, gz_magic[0], gz_magic[1],
<a name="l00190"></a>00190              <a class="code" href="zlib_8h.html#a27a96226f3dc88e4743131c632adf32f">Z_DEFLATED</a>, 0 <span class="comment">/*flags*/</span>, 0,0,0,0 <span class="comment">/*time*/</span>, 0 <span class="comment">/*xflags*/</span>, <a class="code" href="zutil_8h.html#a919da7d9b61966c3af796ab42e618bef">OS_CODE</a>);
<a name="l00191"></a>00191         s-&gt;<a class="code" href="structgz__stream.html#ae136c7871c6a87f0190c8245921e8145">start</a> = 10L;
<a name="l00192"></a>00192         <span class="comment">/* We use 10L instead of ftell(s-&gt;file) to because ftell causes an</span>
<a name="l00193"></a>00193 <span class="comment">         * fflush on some systems. This version of the library doesn&#39;t use</span>
<a name="l00194"></a>00194 <span class="comment">         * start anyway in write mode, so this initialization is not</span>
<a name="l00195"></a>00195 <span class="comment">         * necessary.</span>
<a name="l00196"></a>00196 <span class="comment">         */</span>
<a name="l00197"></a>00197     } <span class="keywordflow">else</span> {
<a name="l00198"></a>00198         <a class="code" href="gzio_8c.html#a11bd73d6799ab3eae0ac3e7d068ea190">check_header</a>(s); <span class="comment">/* skip the .gz header */</span>
<a name="l00199"></a>00199         s-&gt;<a class="code" href="structgz__stream.html#ae136c7871c6a87f0190c8245921e8145">start</a> = ftell(s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>) - s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a>;
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <span class="keywordflow">return</span> (<a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a>)s;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="comment">/* ===========================================================================</span>
<a name="l00206"></a>00206 <span class="comment">     Opens a gzip (.gz) file for reading or writing.</span>
<a name="l00207"></a>00207 <span class="comment">*/</span>
<a name="l00208"></a><a class="code" href="gzio_8c.html#a7f900a46dab5612a2840fdb3959f0afd">00208</a> <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a7f900a46dab5612a2840fdb3959f0afd">gzopen</a> (path, mode)
<a name="l00209"></a>00209     <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span> *path;
<a name="l00210"></a>00210     <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span> *mode;
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212     <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#af96a4a255ee43ecf8a0c77d949114a8f">gz_open</a> (path, mode, -1);
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="comment">/* ===========================================================================</span>
<a name="l00216"></a>00216 <span class="comment">     Associate a gzFile with the file descriptor fd. fd is not dup&#39;ed here</span>
<a name="l00217"></a>00217 <span class="comment">   to mimic the behavio(u)r of fdopen.</span>
<a name="l00218"></a>00218 <span class="comment">*/</span>
<a name="l00219"></a><a class="code" href="gzio_8c.html#a8f2a01545223ba6b825118addb6f1534">00219</a> <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a8f2a01545223ba6b825118addb6f1534">gzdopen</a> (fd, mode)
<a name="l00220"></a>00220     int fd;
<a name="l00221"></a>00221     <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span> *mode;
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223     <span class="keywordtype">char</span> name[46];      <span class="comment">/* allow for up to 128-bit integers */</span>
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <span class="keywordflow">if</span> (fd &lt; 0) <span class="keywordflow">return</span> (<a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a>)<a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00226"></a>00226     sprintf(name, <span class="stringliteral">&quot;&lt;fd:%d&gt;&quot;</span>, fd); <span class="comment">/* for debugging */</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#af96a4a255ee43ecf8a0c77d949114a8f">gz_open</a> (name, mode, fd);
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="comment">/* ===========================================================================</span>
<a name="l00232"></a>00232 <span class="comment"> * Update the compression level and strategy</span>
<a name="l00233"></a>00233 <span class="comment"> */</span>
<a name="l00234"></a><a class="code" href="gzio_8c.html#a20e49f282c69489d3733593736212876">00234</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a20e49f282c69489d3733593736212876">gzsetparams</a> (file, level, strategy)
<a name="l00235"></a>00235     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00236"></a>00236     <span class="keywordtype">int</span> level;
<a name="l00237"></a>00237     <span class="keywordtype">int</span> strategy;
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> != <span class="charliteral">&#39;w&#39;</span>) <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="comment">/* Make room to allow flushing */</span>
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> == 0) {
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a> = s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a>;
<a name="l00247"></a>00247         <span class="keywordflow">if</span> (fwrite(s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a>, 1, <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>, s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>) != <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>) {
<a name="l00248"></a>00248             s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>;
<a name="l00249"></a>00249         }
<a name="l00250"></a>00250         s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> = <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>;
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     <span class="keywordflow">return</span> <a class="code" href="deflate_8c.html#a6be3d26b7e317aa4db6c7870b1911d4d">deflateParams</a> (&amp;(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>), level, strategy);
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">/* ===========================================================================</span>
<a name="l00257"></a>00257 <span class="comment">     Read a byte from a gz_stream; update next_in and avail_in. Return EOF</span>
<a name="l00258"></a>00258 <span class="comment">   for end of file.</span>
<a name="l00259"></a>00259 <span class="comment">   IN assertion: the stream s has been sucessfully opened for reading.</span>
<a name="l00260"></a>00260 <span class="comment">*/</span>
<a name="l00261"></a><a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">00261</a> <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">int</span> <a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s)
<a name="l00262"></a>00262     <a class="code" href="structgz__stream.html">gz_stream</a> *s;
<a name="l00263"></a>00263 {
<a name="l00264"></a>00264     <span class="keywordflow">if</span> (s-&gt;z_eof) <span class="keywordflow">return</span> <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>;
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (s-&gt;stream.avail_in == 0) {
<a name="l00266"></a>00266         errno = 0;
<a name="l00267"></a>00267         s-&gt;stream.avail_in = (<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)fread(s-&gt;inbuf, 1, <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>, s-&gt;file);
<a name="l00268"></a>00268         <span class="keywordflow">if</span> (s-&gt;stream.avail_in == 0) {
<a name="l00269"></a>00269             s-&gt;z_eof = 1;
<a name="l00270"></a>00270             <span class="keywordflow">if</span> (ferror(s-&gt;file)) s-&gt;z_err = <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>;
<a name="l00271"></a>00271             <span class="keywordflow">return</span> <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>;
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273         s-&gt;stream.next_in = s-&gt;inbuf;
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275     s-&gt;stream.avail_in--;
<a name="l00276"></a>00276     <span class="keywordflow">return</span> *(s-&gt;stream.next_in)++;
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="comment">/* ===========================================================================</span>
<a name="l00280"></a>00280 <span class="comment">      Check the gzip header of a gz_stream opened for reading. Set the stream</span>
<a name="l00281"></a>00281 <span class="comment">    mode to transparent if the gzip magic header is not present; set s-&gt;err</span>
<a name="l00282"></a>00282 <span class="comment">    to Z_DATA_ERROR if the magic header is present but the rest of the header</span>
<a name="l00283"></a>00283 <span class="comment">    is incorrect.</span>
<a name="l00284"></a>00284 <span class="comment">    IN assertion: the stream s has already been created sucessfully;</span>
<a name="l00285"></a>00285 <span class="comment">       s-&gt;stream.avail_in is zero for the first time, but may be non-zero</span>
<a name="l00286"></a>00286 <span class="comment">       for concatenated .gz files.</span>
<a name="l00287"></a>00287 <span class="comment">*/</span>
<a name="l00288"></a><a class="code" href="gzio_8c.html#a11bd73d6799ab3eae0ac3e7d068ea190">00288</a> <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">void</span> <a class="code" href="gzio_8c.html#a11bd73d6799ab3eae0ac3e7d068ea190">check_header</a>(s)
<a name="l00289"></a>00289     <a class="code" href="structgz__stream.html">gz_stream</a> *s;
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291     <span class="keywordtype">int</span> method; <span class="comment">/* method byte */</span>
<a name="l00292"></a>00292     <span class="keywordtype">int</span> flags;  <span class="comment">/* flags byte */</span>
<a name="l00293"></a>00293     <a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a> len;
<a name="l00294"></a>00294     <span class="keywordtype">int</span> c;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <span class="comment">/* Assure two bytes in the buffer so we can peek ahead -- handle case</span>
<a name="l00297"></a>00297 <span class="comment">       where first byte of header is at the end of the buffer after the last</span>
<a name="l00298"></a>00298 <span class="comment">       gzip segment */</span>
<a name="l00299"></a>00299     len = s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a>;
<a name="l00300"></a>00300     <span class="keywordflow">if</span> (len &lt; 2) {
<a name="l00301"></a>00301         <span class="keywordflow">if</span> (len) s-&gt;inbuf[0] = s-&gt;stream.next_in[0];
<a name="l00302"></a>00302         errno = 0;
<a name="l00303"></a>00303         len = (<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)fread(s-&gt;inbuf + len, 1, <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a> &gt;&gt; len, s-&gt;file);
<a name="l00304"></a>00304         <span class="keywordflow">if</span> (len == 0 &amp;&amp; ferror(s-&gt;file)) s-&gt;z_err = <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>;
<a name="l00305"></a>00305         s-&gt;stream.avail_in += len;
<a name="l00306"></a>00306         s-&gt;stream.next_in = s-&gt;inbuf;
<a name="l00307"></a>00307         if (s-&gt;stream.avail_in &lt; 2) {
<a name="l00308"></a>00308             s-&gt;transparent = s-&gt;stream.avail_in;
<a name="l00309"></a>00309             <span class="keywordflow">return</span>;
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="comment">/* Peek ahead to check the gzip magic header */</span>
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (s-&gt;stream.next_in[0] != gz_magic[0] ||
<a name="l00315"></a>00315         s-&gt;stream.next_in[1] != gz_magic[1]) {
<a name="l00316"></a>00316         s-&gt;transparent = 1;
<a name="l00317"></a>00317         <span class="keywordflow">return</span>;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319     s-&gt;stream.avail_in -= 2;
<a name="l00320"></a>00320     s-&gt;stream.next_in += 2;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="comment">/* Check the rest of the gzip header */</span>
<a name="l00323"></a>00323     method = <a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s);
<a name="l00324"></a>00324     flags = <a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s);
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (method != <a class="code" href="zlib_8h.html#a27a96226f3dc88e4743131c632adf32f">Z_DEFLATED</a> || (flags &amp; <a class="code" href="gzio_8c.html#a56701f18aaad537f7fc0e9be309503c3">RESERVED</a>) != 0) {
<a name="l00326"></a>00326         s-&gt;z_err = <a class="code" href="zlib_8h.html#a9eda83d428a71752d148f38b5dbe04f2">Z_DATA_ERROR</a>;
<a name="l00327"></a>00327         <span class="keywordflow">return</span>;
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     <span class="comment">/* Discard time, xflags and OS code: */</span>
<a name="l00331"></a>00331     <span class="keywordflow">for</span> (len = 0; len &lt; 6; len++) (<span class="keywordtype">void</span>)<a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     <span class="keywordflow">if</span> ((flags &amp; <a class="code" href="gzio_8c.html#a50beca0e4608c1ee356a8ced2497db75">EXTRA_FIELD</a>) != 0) { <span class="comment">/* skip the extra field */</span>
<a name="l00334"></a>00334         len  =  (<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)<a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s);
<a name="l00335"></a>00335         len += ((<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)<a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s))&lt;&lt;8;
<a name="l00336"></a>00336         <span class="comment">/* len is garbage if EOF but the loop below will quit anyway */</span>
<a name="l00337"></a>00337         <span class="keywordflow">while</span> (len-- != 0 &amp;&amp; <a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s) != <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>) ;
<a name="l00338"></a>00338     }
<a name="l00339"></a>00339     <span class="keywordflow">if</span> ((flags &amp; <a class="code" href="gzio_8c.html#ab16f7d2a15f2ef64ffa109a7cda5e65b">ORIG_NAME</a>) != 0) { <span class="comment">/* skip the original file name */</span>
<a name="l00340"></a>00340         <span class="keywordflow">while</span> ((c = <a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s)) != 0 &amp;&amp; c != <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>) ;
<a name="l00341"></a>00341     }
<a name="l00342"></a>00342     <span class="keywordflow">if</span> ((flags &amp; <a class="code" href="gzio_8c.html#a180f5b3835bdbfc11b353fd2af5c8659">COMMENT</a>) != 0) {   <span class="comment">/* skip the .gz file comment */</span>
<a name="l00343"></a>00343         <span class="keywordflow">while</span> ((c = <a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s)) != 0 &amp;&amp; c != <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>) ;
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345     <span class="keywordflow">if</span> ((flags &amp; <a class="code" href="gzio_8c.html#a552e6306aac9df122ffc3ca089b4663b">HEAD_CRC</a>) != 0) {  <span class="comment">/* skip the header crc */</span>
<a name="l00346"></a>00346         <span class="keywordflow">for</span> (len = 0; len &lt; 2; len++) (<span class="keywordtype">void</span>)<a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s);
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348     s-&gt;z_err = s-&gt;z_eof ? <a class="code" href="zlib_8h.html#a9eda83d428a71752d148f38b5dbe04f2">Z_DATA_ERROR</a> : <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>;
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351  <span class="comment">/* ===========================================================================</span>
<a name="l00352"></a>00352 <span class="comment"> * Cleanup then free the given gz_stream. Return a zlib error code.</span>
<a name="l00353"></a>00353 <span class="comment">   Try freeing in the reverse order of allocations.</span>
<a name="l00354"></a>00354 <span class="comment"> */</span>
<a name="l00355"></a><a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">00355</a> <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">int</span> <a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">destroy</a> (s)
<a name="l00356"></a>00356     <a class="code" href="structgz__stream.html">gz_stream</a> *s;
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <span class="keywordtype">int</span> err = <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <a class="code" href="gzio_8c.html#a5fb23c00a00f3856832e660edc2ab03d">TRYFREE</a>(s-&gt;msg);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (s-&gt;stream.state != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00365"></a>00365         <span class="keywordflow">if</span> (s-&gt;mode == <span class="charliteral">&#39;w&#39;</span>) {
<a name="l00366"></a>00366 <span class="preprocessor">#ifdef NO_GZCOMPRESS</span>
<a name="l00367"></a>00367 <span class="preprocessor"></span>            err = <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00368"></a>00368 <span class="preprocessor">#else</span>
<a name="l00369"></a>00369 <span class="preprocessor"></span>            err = <a class="code" href="deflate_8c.html#ada68769789b1d84de7e708d6e848a075">deflateEnd</a>(&amp;(s-&gt;stream));
<a name="l00370"></a>00370 <span class="preprocessor">#endif</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;mode == <span class="charliteral">&#39;r&#39;</span>) {
<a name="l00372"></a>00372             err = <a class="code" href="inflate_8c.html#aed3136bc8afc3ef309b731b4ad724534">inflateEnd</a>(&amp;(s-&gt;stream));
<a name="l00373"></a>00373         }
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375     <span class="keywordflow">if</span> (s-&gt;file != <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; fclose(s-&gt;file)) {
<a name="l00376"></a>00376 <span class="preprocessor">#ifdef ESPIPE</span>
<a name="l00377"></a>00377 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (errno != ESPIPE) <span class="comment">/* fclose is broken for pipes in HP/UX */</span>
<a name="l00378"></a>00378 <span class="preprocessor">#endif</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span>            err = <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>;
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381     <span class="keywordflow">if</span> (s-&gt;z_err &lt; 0) err = s-&gt;z_err;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <a class="code" href="gzio_8c.html#a5fb23c00a00f3856832e660edc2ab03d">TRYFREE</a>(s-&gt;inbuf);
<a name="l00384"></a>00384     <a class="code" href="gzio_8c.html#a5fb23c00a00f3856832e660edc2ab03d">TRYFREE</a>(s-&gt;outbuf);
<a name="l00385"></a>00385     <a class="code" href="gzio_8c.html#a5fb23c00a00f3856832e660edc2ab03d">TRYFREE</a>(s-&gt;path);
<a name="l00386"></a>00386     <a class="code" href="gzio_8c.html#a5fb23c00a00f3856832e660edc2ab03d">TRYFREE</a>(s);
<a name="l00387"></a>00387     <span class="keywordflow">return</span> err;
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment">/* ===========================================================================</span>
<a name="l00391"></a>00391 <span class="comment">     Reads the given number of uncompressed bytes from the compressed file.</span>
<a name="l00392"></a>00392 <span class="comment">   gzread returns the number of bytes actually read (0 for end of file).</span>
<a name="l00393"></a>00393 <span class="comment">*/</span>
<a name="l00394"></a><a class="code" href="gzio_8c.html#a2d0d971b446b67bbc4261fa5fef622bd">00394</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a2d0d971b446b67bbc4261fa5fef622bd">gzread</a> (file, buf, len)
<a name="l00395"></a>00395     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00396"></a>00396     <a class="code" href="zconf_8h.html#aa3397ff439b5e076528b04bc9b8b086a">voidp</a> buf;
<a name="l00397"></a>00397     <span class="keywordtype">unsigned</span> len;
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00400"></a>00400     <a class="code" href="zconf_8h.html#aeb722a888064be47e12d05f692e0f407">Bytef</a> *start = (<a class="code" href="zconf_8h.html#aeb722a888064be47e12d05f692e0f407">Bytef</a>*)buf; <span class="comment">/* starting point for crc computation */</span>
<a name="l00401"></a>00401     <a class="code" href="ftraster_8c.html#ae3a497195d617519e5353ea7b417940f">Byte</a>  *next_out; <span class="comment">/* == stream.next_out but not forced far (for MSDOS) */</span>
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> != <span class="charliteral">&#39;r&#39;</span>) <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a9eda83d428a71752d148f38b5dbe04f2">Z_DATA_ERROR</a> || s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>) <span class="keywordflow">return</span> -1;
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a>) <span class="keywordflow">return</span> 0;  <span class="comment">/* EOF */</span>
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     next_out = (<a class="code" href="ftraster_8c.html#ae3a497195d617519e5353ea7b417940f">Byte</a>*)buf;
<a name="l00409"></a>00409     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a> = (<a class="code" href="zconf_8h.html#aeb722a888064be47e12d05f692e0f407">Bytef</a>*)buf;
<a name="l00410"></a>00410     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> = len;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> &amp;&amp; s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a> != <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>) {
<a name="l00413"></a>00413         *next_out++ = s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a>;
<a name="l00414"></a>00414         s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a>++;
<a name="l00415"></a>00415         s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>--;
<a name="l00416"></a>00416         s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a> = <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>;
<a name="l00417"></a>00417         s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a>++;
<a name="l00418"></a>00418         start++;
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a7c5213935b324dfb9a4101a73dd24a37">last</a>) {
<a name="l00420"></a>00420             s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a>;
<a name="l00421"></a>00421             <span class="keywordflow">return</span> 1;
<a name="l00422"></a>00422         }
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     <span class="keywordflow">while</span> (s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> != 0) {
<a name="l00426"></a>00426 
<a name="l00427"></a>00427         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a5bbfa8460d94ffea4ac6d78aedfc70d1">transparent</a>) {
<a name="l00428"></a>00428             <span class="comment">/* Copy first the lookahead bytes: */</span>
<a name="l00429"></a>00429             <a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a> <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a> = s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a>;
<a name="l00430"></a>00430             <span class="keywordflow">if</span> (n &gt; s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>) n = s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>;
<a name="l00431"></a>00431             <span class="keywordflow">if</span> (n &gt; 0) {
<a name="l00432"></a>00432                 <a class="code" href="zutil_8c.html#aaeaf4c4bfd0bbb073ce42fe420bb828a">zmemcpy</a>(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a>, s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a21d2c026f0f2fcd67f33011231f8ed00">next_in</a>, n);
<a name="l00433"></a>00433                 next_out += <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l00434"></a>00434                 s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a> = next_out;
<a name="l00435"></a>00435                 s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a21d2c026f0f2fcd67f33011231f8ed00">next_in</a>   += <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l00436"></a>00436                 s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> -= <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l00437"></a>00437                 s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a>  -= <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l00438"></a>00438             }
<a name="l00439"></a>00439             <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> &gt; 0) {
<a name="l00440"></a>00440                 s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> -=
<a name="l00441"></a>00441                     (<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)fread(next_out, 1, s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>, s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>);
<a name="l00442"></a>00442             }
<a name="l00443"></a>00443             len -= s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>;
<a name="l00444"></a>00444             s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a>  += len;
<a name="l00445"></a>00445             s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> += len;
<a name="l00446"></a>00446             <span class="keywordflow">if</span> (len == 0) s-&gt;<a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a> = 1;
<a name="l00447"></a>00447             <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)len;
<a name="l00448"></a>00448         }
<a name="l00449"></a>00449         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a> == 0 &amp;&amp; !s-&gt;<a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a>) {
<a name="l00450"></a>00450 
<a name="l00451"></a>00451             errno = 0;
<a name="l00452"></a>00452             s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a> = (<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)fread(s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a>, 1, <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>, s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>);
<a name="l00453"></a>00453             <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a> == 0) {
<a name="l00454"></a>00454                 s-&gt;<a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a> = 1;
<a name="l00455"></a>00455                 <span class="keywordflow">if</span> (ferror(s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>)) {
<a name="l00456"></a>00456                     s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>;
<a name="l00457"></a>00457                     <span class="keywordflow">break</span>;
<a name="l00458"></a>00458                 }
<a name="l00459"></a>00459             }
<a name="l00460"></a>00460             s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a21d2c026f0f2fcd67f33011231f8ed00">next_in</a> = s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a>;
<a name="l00461"></a>00461         }
<a name="l00462"></a>00462         s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a> += s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a>;
<a name="l00463"></a>00463         s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> += s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>;
<a name="l00464"></a>00464         s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="inflate_8c.html#a9a49cf8b6ce882dea33505b0ac84ecef">inflate</a>(&amp;(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>), <a class="code" href="zlib_8h.html#ac3b62e37b9922d9496014515acd6083a">Z_NO_FLUSH</a>);
<a name="l00465"></a>00465         s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a> -= s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a>;
<a name="l00466"></a>00466         s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> -= s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a>) {
<a name="l00469"></a>00469             <span class="comment">/* Check CRC and original size */</span>
<a name="l00470"></a>00470             s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a> = <a class="code" href="crc32_8c.html#a5d6fb454f076e5762905a247702c9be3">crc32</a>(s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a>, start, (<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a> - start));
<a name="l00471"></a>00471             start = s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a>;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473             <span class="keywordflow">if</span> (<a class="code" href="gzio_8c.html#aaa7ad90748c13a5a06768ab2599fbc69">getLong</a>(s) != s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a>) {
<a name="l00474"></a>00474                 s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a9eda83d428a71752d148f38b5dbe04f2">Z_DATA_ERROR</a>;
<a name="l00475"></a>00475             } <span class="keywordflow">else</span> {
<a name="l00476"></a>00476                 (void)<a class="code" href="gzio_8c.html#aaa7ad90748c13a5a06768ab2599fbc69">getLong</a>(s);
<a name="l00477"></a>00477                 <span class="comment">/* The uncompressed length returned by above getlong() may be</span>
<a name="l00478"></a>00478 <span class="comment">                 * different from s-&gt;out in case of concatenated .gz files.</span>
<a name="l00479"></a>00479 <span class="comment">                 * Check for such files:</span>
<a name="l00480"></a>00480 <span class="comment">                 */</span>
<a name="l00481"></a>00481                 <a class="code" href="gzio_8c.html#a11bd73d6799ab3eae0ac3e7d068ea190">check_header</a>(s);
<a name="l00482"></a>00482                 <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>) {
<a name="l00483"></a>00483                     <a class="code" href="inflate_8c.html#adb02c2100f9179f4075b220395b1553c">inflateReset</a>(&amp;(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>));
<a name="l00484"></a>00484                     s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a> = <a class="code" href="crc32_8c.html#a5d6fb454f076e5762905a247702c9be3">crc32</a>(0L, <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>, 0);
<a name="l00485"></a>00485                 }
<a name="l00486"></a>00486             }
<a name="l00487"></a>00487         }
<a name="l00488"></a>00488         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> != <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a> || s-&gt;<a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a>) <span class="keywordflow">break</span>;
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490     s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a> = <a class="code" href="crc32_8c.html#a5d6fb454f076e5762905a247702c9be3">crc32</a>(s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a>, start, (<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a> - start));
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <span class="keywordflow">if</span> (len == s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> &amp;&amp;
<a name="l00493"></a>00493         (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a9eda83d428a71752d148f38b5dbe04f2">Z_DATA_ERROR</a> || s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>))
<a name="l00494"></a>00494         <span class="keywordflow">return</span> -1;
<a name="l00495"></a>00495     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(len - s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>);
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 <span class="comment">/* ===========================================================================</span>
<a name="l00500"></a>00500 <span class="comment">      Reads one byte from the compressed file. gzgetc returns this byte</span>
<a name="l00501"></a>00501 <span class="comment">   or -1 in case of end of file or error.</span>
<a name="l00502"></a>00502 <span class="comment">*/</span>
<a name="l00503"></a><a class="code" href="gzio_8c.html#a1e9f6a517ed1e04c3765fe24153fb639">00503</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a1e9f6a517ed1e04c3765fe24153fb639">gzgetc</a>(file)
<a name="l00504"></a>00504     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00505"></a>00505 {
<a name="l00506"></a>00506     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a2d0d971b446b67bbc4261fa5fef622bd">gzread</a>(file, &amp;c, 1) == 1 ? c : -1;
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 <span class="comment">/* ===========================================================================</span>
<a name="l00513"></a>00513 <span class="comment">      Push one byte back onto the stream.</span>
<a name="l00514"></a>00514 <span class="comment">*/</span>
<a name="l00515"></a><a class="code" href="gzio_8c.html#a0b81c1a6e144a3cc5cd97a26688fed69">00515</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a0b81c1a6e144a3cc5cd97a26688fed69">gzungetc</a>(c, file)
<a name="l00516"></a>00516     int c;
<a name="l00517"></a>00517     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> != <span class="charliteral">&#39;r&#39;</span> || c == <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a> || s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a> != <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>) <span class="keywordflow">return</span> <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>;
<a name="l00522"></a>00522     s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a> = c;
<a name="l00523"></a>00523     s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a>--;
<a name="l00524"></a>00524     s-&gt;<a class="code" href="structgz__stream.html#a7c5213935b324dfb9a4101a73dd24a37">last</a> = (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a>);
<a name="l00525"></a>00525     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a7c5213935b324dfb9a4101a73dd24a37">last</a>) s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>;
<a name="l00526"></a>00526     s-&gt;<a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a> = 0;
<a name="l00527"></a>00527     <span class="keywordflow">return</span> c;
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 <span class="comment">/* ===========================================================================</span>
<a name="l00532"></a>00532 <span class="comment">      Reads bytes from the compressed file until len-1 characters are</span>
<a name="l00533"></a>00533 <span class="comment">   read, or a newline character is read and transferred to buf, or an</span>
<a name="l00534"></a>00534 <span class="comment">   end-of-file condition is encountered.  The string is then terminated</span>
<a name="l00535"></a>00535 <span class="comment">   with a null character.</span>
<a name="l00536"></a>00536 <span class="comment">      gzgets returns buf, or Z_NULL in case of error.</span>
<a name="l00537"></a>00537 <span class="comment"></span>
<a name="l00538"></a>00538 <span class="comment">      The current implementation is not optimized at all.</span>
<a name="l00539"></a>00539 <span class="comment">*/</span>
<a name="l00540"></a><a class="code" href="gzio_8c.html#a72d5c31ad36987a6a3252d56f1e98664">00540</a> <span class="keywordtype">char</span> * <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a72d5c31ad36987a6a3252d56f1e98664">gzgets</a>(file, buf, len)
<a name="l00541"></a>00541     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00542"></a>00542     <span class="keywordtype">char</span> *buf;
<a name="l00543"></a>00543     <span class="keywordtype">int</span> len;
<a name="l00544"></a>00544 {
<a name="l00545"></a>00545     <span class="keywordtype">char</span> *b = buf;
<a name="l00546"></a>00546     <span class="keywordflow">if</span> (buf == <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a> || len &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <span class="keywordflow">while</span> (--len &gt; 0 &amp;&amp; <a class="code" href="gzio_8c.html#a2d0d971b446b67bbc4261fa5fef622bd">gzread</a>(file, buf, 1) == 1 &amp;&amp; *buf++ != <span class="charliteral">&#39;\n&#39;</span>) ;
<a name="l00549"></a>00549     *buf = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00550"></a>00550     <span class="keywordflow">return</span> b == buf &amp;&amp; len &gt; 0 ? <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a> : b;
<a name="l00551"></a>00551 }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="preprocessor">#ifndef NO_GZCOMPRESS</span>
<a name="l00555"></a>00555 <span class="preprocessor"></span><span class="comment">/* ===========================================================================</span>
<a name="l00556"></a>00556 <span class="comment">     Writes the given number of uncompressed bytes into the compressed file.</span>
<a name="l00557"></a>00557 <span class="comment">   gzwrite returns the number of bytes actually written (0 in case of error).</span>
<a name="l00558"></a>00558 <span class="comment">*/</span>
<a name="l00559"></a><a class="code" href="gzio_8c.html#a93323ef1288f105db8a89e80f2764d3b">00559</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a93323ef1288f105db8a89e80f2764d3b">gzwrite</a> (file, buf, len)
<a name="l00560"></a>00560     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00561"></a>00561     <a class="code" href="zconf_8h.html#a7db54413d7060e4b57868c2b23c0ec1c">voidpc</a> buf;
<a name="l00562"></a>00562     <span class="keywordtype">unsigned</span> len;
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> != <span class="charliteral">&#39;w&#39;</span>) <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a21d2c026f0f2fcd67f33011231f8ed00">next_in</a> = (<a class="code" href="zconf_8h.html#aeb722a888064be47e12d05f692e0f407">Bytef</a>*)buf;
<a name="l00569"></a>00569     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a> = len;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     <span class="keywordflow">while</span> (s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a> != 0) {
<a name="l00572"></a>00572 
<a name="l00573"></a>00573         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> == 0) {
<a name="l00574"></a>00574 
<a name="l00575"></a>00575             s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a> = s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a>;
<a name="l00576"></a>00576             <span class="keywordflow">if</span> (fwrite(s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a>, 1, <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>, s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>) != <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>) {
<a name="l00577"></a>00577                 s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>;
<a name="l00578"></a>00578                 <span class="keywordflow">break</span>;
<a name="l00579"></a>00579             }
<a name="l00580"></a>00580             s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> = <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>;
<a name="l00581"></a>00581         }
<a name="l00582"></a>00582         s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a> += s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a>;
<a name="l00583"></a>00583         s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> += s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>;
<a name="l00584"></a>00584         s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="deflate_8c.html#aedba3a94d6e827d61b660443ae5b9f09">deflate</a>(&amp;(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>), <a class="code" href="zlib_8h.html#ac3b62e37b9922d9496014515acd6083a">Z_NO_FLUSH</a>);
<a name="l00585"></a>00585         s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a> -= s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a>;
<a name="l00586"></a>00586         s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> -= s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>;
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> != <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>) <span class="keywordflow">break</span>;
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589     s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a> = <a class="code" href="crc32_8c.html#a5d6fb454f076e5762905a247702c9be3">crc32</a>(s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a>, (<span class="keyword">const</span> <a class="code" href="zconf_8h.html#aeb722a888064be47e12d05f692e0f407">Bytef</a> *)buf, len);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(len - s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a>);
<a name="l00592"></a>00592 }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 <span class="comment">/* ===========================================================================</span>
<a name="l00596"></a>00596 <span class="comment">     Converts, formats, and writes the args to the compressed file under</span>
<a name="l00597"></a>00597 <span class="comment">   control of the format string, as in fprintf. gzprintf returns the number of</span>
<a name="l00598"></a>00598 <span class="comment">   uncompressed bytes actually written (0 in case of error).</span>
<a name="l00599"></a>00599 <span class="comment">*/</span>
<a name="l00600"></a>00600 <span class="preprocessor">#ifdef STDC</span>
<a name="l00601"></a>00601 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#af38d1853df635eee27f1a02f96457b22">ZEXPORTVA</a> <a class="code" href="gzio_8c.html#a23cb6f01c1de1f861e22091d0ca092ef">gzprintf</a> (<a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, <span class="comment">/* args */</span> ...)
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605     <span class="keywordtype">char</span> buf[<a class="code" href="gzio_8c.html#adb69caa8684234b7c63f24d64b7659db">Z_PRINTF_BUFSIZE</a>];
<a name="l00606"></a>00606     va_list va;
<a name="l00607"></a>00607     <span class="keywordtype">int</span> len;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     buf[<span class="keyword">sizeof</span>(buf) - 1] = 0;
<a name="l00610"></a>00610     va_start(va, format);
<a name="l00611"></a>00611 <span class="preprocessor">#ifdef NO_vsnprintf</span>
<a name="l00612"></a>00612 <span class="preprocessor"></span><span class="preprocessor">#  ifdef HAS_vsprintf_void</span>
<a name="l00613"></a>00613 <span class="preprocessor"></span>    (void)vsprintf(buf, format, va);
<a name="l00614"></a>00614     va_end(va);
<a name="l00615"></a>00615     <span class="keywordflow">for</span> (len = 0; len &lt; <span class="keyword">sizeof</span>(buf); len++)
<a name="l00616"></a>00616         <span class="keywordflow">if</span> (buf[len] == 0) <span class="keywordflow">break</span>;
<a name="l00617"></a>00617 <span class="preprocessor">#  else</span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>    len = vsprintf(buf, format, va);
<a name="l00619"></a>00619     va_end(va);
<a name="l00620"></a>00620 <span class="preprocessor">#  endif</span>
<a name="l00621"></a>00621 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00622"></a>00622 <span class="preprocessor"></span><span class="preprocessor">#  ifdef HAS_vsnprintf_void</span>
<a name="l00623"></a>00623 <span class="preprocessor"></span>    (void)vsnprintf(buf, <span class="keyword">sizeof</span>(buf), format, va);
<a name="l00624"></a>00624     va_end(va);
<a name="l00625"></a>00625     len = strlen(buf);
<a name="l00626"></a>00626 <span class="preprocessor">#  else</span>
<a name="l00627"></a>00627 <span class="preprocessor"></span>    len = vsnprintf(buf, <span class="keyword">sizeof</span>(buf), format, va);
<a name="l00628"></a>00628     va_end(va);
<a name="l00629"></a>00629 <span class="preprocessor">#  endif</span>
<a name="l00630"></a>00630 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00631"></a>00631 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (len &lt;= 0 || len &gt;= (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(buf) || buf[<span class="keyword">sizeof</span>(buf) - 1] != 0)
<a name="l00632"></a>00632         <span class="keywordflow">return</span> 0;
<a name="l00633"></a>00633     <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a93323ef1288f105db8a89e80f2764d3b">gzwrite</a>(file, buf, (<span class="keywordtype">unsigned</span>)len);
<a name="l00634"></a>00634 }
<a name="l00635"></a>00635 <span class="preprocessor">#else </span><span class="comment">/* not ANSI C */</span>
<a name="l00636"></a>00636 
<a name="l00637"></a><a class="code" href="gzio_8c.html#a23cb6f01c1de1f861e22091d0ca092ef">00637</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#af38d1853df635eee27f1a02f96457b22">ZEXPORTVA</a> <a class="code" href="gzio_8c.html#a23cb6f01c1de1f861e22091d0ca092ef">gzprintf</a> (file, format, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10,
<a name="l00638"></a>00638                        a11, a12, a13, a14, a15, a16, a17, a18, a19, a20)
<a name="l00639"></a>00639     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00640"></a>00640     <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span> *format;
<a name="l00641"></a>00641     <span class="keywordtype">int</span> a1, a2, a3, a4, a5, a6, a7, a8, a9, a10,
<a name="l00642"></a>00642         a11, a12, a13, a14, a15, a16, a17, a18, a19, a20;
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644     <span class="keywordtype">char</span> buf[<a class="code" href="gzio_8c.html#adb69caa8684234b7c63f24d64b7659db">Z_PRINTF_BUFSIZE</a>];
<a name="l00645"></a>00645     <span class="keywordtype">int</span> len;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     buf[<span class="keyword">sizeof</span>(buf) - 1] = 0;
<a name="l00648"></a>00648 <span class="preprocessor">#ifdef NO_snprintf</span>
<a name="l00649"></a>00649 <span class="preprocessor"></span><span class="preprocessor">#  ifdef HAS_sprintf_void</span>
<a name="l00650"></a>00650 <span class="preprocessor"></span>    sprintf(buf, format, a1, a2, a3, a4, a5, a6, a7, a8,
<a name="l00651"></a>00651             a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20);
<a name="l00652"></a>00652     <span class="keywordflow">for</span> (len = 0; len &lt; <span class="keyword">sizeof</span>(buf); len++)
<a name="l00653"></a>00653         <span class="keywordflow">if</span> (buf[len] == 0) <span class="keywordflow">break</span>;
<a name="l00654"></a>00654 <span class="preprocessor">#  else</span>
<a name="l00655"></a>00655 <span class="preprocessor"></span>    len = sprintf(buf, format, a1, a2, a3, a4, a5, a6, a7, a8,
<a name="l00656"></a>00656                 a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20);
<a name="l00657"></a>00657 <span class="preprocessor">#  endif</span>
<a name="l00658"></a>00658 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00659"></a>00659 <span class="preprocessor"></span><span class="preprocessor">#  ifdef HAS_snprintf_void</span>
<a name="l00660"></a>00660 <span class="preprocessor"></span>    snprintf(buf, <span class="keyword">sizeof</span>(buf), format, a1, a2, a3, a4, a5, a6, a7, a8,
<a name="l00661"></a>00661              a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20);
<a name="l00662"></a>00662     len = strlen(buf);
<a name="l00663"></a>00663 <span class="preprocessor">#  else</span>
<a name="l00664"></a>00664 <span class="preprocessor"></span>    len = snprintf(buf, <span class="keyword">sizeof</span>(buf), format, a1, a2, a3, a4, a5, a6, a7, a8,
<a name="l00665"></a>00665                  a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20);
<a name="l00666"></a>00666 <span class="preprocessor">#  endif</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00668"></a>00668 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (len &lt;= 0 || len &gt;= <span class="keyword">sizeof</span>(buf) || buf[<span class="keyword">sizeof</span>(buf) - 1] != 0)
<a name="l00669"></a>00669         <span class="keywordflow">return</span> 0;
<a name="l00670"></a>00670     <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a93323ef1288f105db8a89e80f2764d3b">gzwrite</a>(file, buf, len);
<a name="l00671"></a>00671 }
<a name="l00672"></a>00672 <span class="preprocessor">#endif</span>
<a name="l00673"></a>00673 <span class="preprocessor"></span>
<a name="l00674"></a>00674 <span class="comment">/* ===========================================================================</span>
<a name="l00675"></a>00675 <span class="comment">      Writes c, converted to an unsigned char, into the compressed file.</span>
<a name="l00676"></a>00676 <span class="comment">   gzputc returns the value that was written, or -1 in case of error.</span>
<a name="l00677"></a>00677 <span class="comment">*/</span>
<a name="l00678"></a><a class="code" href="gzio_8c.html#a37f7621e057bd71abdbe2f2480b69935">00678</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a37f7621e057bd71abdbe2f2480b69935">gzputc</a>(file, c)
<a name="l00679"></a>00679     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00680"></a>00680     <span class="keywordtype">int</span> c;
<a name="l00681"></a>00681 {
<a name="l00682"></a>00682     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cc = (<span class="keywordtype">unsigned</span> char) c; <span class="comment">/* required for big endian systems */</span>
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a93323ef1288f105db8a89e80f2764d3b">gzwrite</a>(file, &amp;cc, 1) == 1 ? (int)cc : -1;
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 
<a name="l00688"></a>00688 <span class="comment">/* ===========================================================================</span>
<a name="l00689"></a>00689 <span class="comment">      Writes the given null-terminated string to the compressed file, excluding</span>
<a name="l00690"></a>00690 <span class="comment">   the terminating null character.</span>
<a name="l00691"></a>00691 <span class="comment">      gzputs returns the number of characters written, or -1 in case of error.</span>
<a name="l00692"></a>00692 <span class="comment">*/</span>
<a name="l00693"></a><a class="code" href="gzio_8c.html#a3d37964a3a465f7eb3e14df58a68efba">00693</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a3d37964a3a465f7eb3e14df58a68efba">gzputs</a>(file, s)
<a name="l00694"></a>00694     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00695"></a>00695     <a class="code" href="zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <span class="keywordtype">char</span> *s;
<a name="l00696"></a>00696 {
<a name="l00697"></a>00697     <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a93323ef1288f105db8a89e80f2764d3b">gzwrite</a>(file, (<span class="keywordtype">char</span>*)s, (<span class="keywordtype">unsigned</span>)strlen(s));
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 <span class="comment">/* ===========================================================================</span>
<a name="l00702"></a>00702 <span class="comment">     Flushes all pending output into the compressed file. The parameter</span>
<a name="l00703"></a>00703 <span class="comment">   flush is as in the deflate() function.</span>
<a name="l00704"></a>00704 <span class="comment">*/</span>
<a name="l00705"></a><a class="code" href="gzio_8c.html#afafc4bbc6787281ae67c082cb529787d">00705</a> <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">int</span> <a class="code" href="gzio_8c.html#afafc4bbc6787281ae67c082cb529787d">do_flush</a> (file, flush)
<a name="l00706"></a>00706     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00707"></a>00707     <span class="keywordtype">int</span> flush;
<a name="l00708"></a>00708 {
<a name="l00709"></a>00709     <a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a> len;
<a name="l00710"></a>00710     <span class="keywordtype">int</span> done = 0;
<a name="l00711"></a>00711     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> != <span class="charliteral">&#39;w&#39;</span>) <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a> = 0; <span class="comment">/* should be zero already anyway */</span>
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="keywordflow">for</span> (;;) {
<a name="l00718"></a>00718         len = <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a> - s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720         <span class="keywordflow">if</span> (len != 0) {
<a name="l00721"></a>00721             <span class="keywordflow">if</span> ((<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)fwrite(s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a>, 1, len, s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>) != len) {
<a name="l00722"></a>00722                 s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>;
<a name="l00723"></a>00723                 <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a>;
<a name="l00724"></a>00724             }
<a name="l00725"></a>00725             s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#aed4a02cfe93e975314fed50b04427bf3">next_out</a> = s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a>;
<a name="l00726"></a>00726             s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> = <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>;
<a name="l00727"></a>00727         }
<a name="l00728"></a>00728         <span class="keywordflow">if</span> (done) <span class="keywordflow">break</span>;
<a name="l00729"></a>00729         s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> += s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>;
<a name="l00730"></a>00730         s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="deflate_8c.html#aedba3a94d6e827d61b660443ae5b9f09">deflate</a>(&amp;(s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>), flush);
<a name="l00731"></a>00731         s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> -= s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a>;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733         <span class="comment">/* Ignore the second of two consecutive flushes: */</span>
<a name="l00734"></a>00734         <span class="keywordflow">if</span> (len == 0 &amp;&amp; s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a425e2f0664e1b1f75bf2bffab88d353d">Z_BUF_ERROR</a>) s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         <span class="comment">/* deflate has finished flushing only when it hasn&#39;t used up</span>
<a name="l00737"></a>00737 <span class="comment">         * all the available space in the output buffer:</span>
<a name="l00738"></a>00738 <span class="comment">         */</span>
<a name="l00739"></a>00739         done = (s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a45ad2364307af9d944fd39d4eca3ca3c">avail_out</a> != 0 || s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a>);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> != <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a> &amp;&amp; s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> != <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a>) <span class="keywordflow">break</span>;
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743     <span class="keywordflow">return</span>  s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a> ? <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a> : s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a>;
<a name="l00744"></a>00744 }
<a name="l00745"></a>00745 
<a name="l00746"></a><a class="code" href="gzio_8c.html#a6b70d5783d03b12adfd369bd9b7394a2">00746</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a6b70d5783d03b12adfd369bd9b7394a2">gzflush</a> (file, flush)
<a name="l00747"></a>00747      <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00748"></a>00748      <span class="keywordtype">int</span> flush;
<a name="l00749"></a>00749 {
<a name="l00750"></a>00750     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00751"></a>00751     <span class="keywordtype">int</span> err = <a class="code" href="gzio_8c.html#afafc4bbc6787281ae67c082cb529787d">do_flush</a> (file, flush);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="keywordflow">if</span> (err) <span class="keywordflow">return</span> err;
<a name="l00754"></a>00754     fflush(s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>);
<a name="l00755"></a>00755     <span class="keywordflow">return</span>  s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a> ? <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a> : s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a>;
<a name="l00756"></a>00756 }
<a name="l00757"></a>00757 <span class="preprocessor">#endif </span><span class="comment">/* NO_GZCOMPRESS */</span>
<a name="l00758"></a>00758 
<a name="l00759"></a>00759 <span class="comment">/* ===========================================================================</span>
<a name="l00760"></a>00760 <span class="comment">      Sets the starting position for the next gzread or gzwrite on the given</span>
<a name="l00761"></a>00761 <span class="comment">   compressed file. The offset represents a number of bytes in the</span>
<a name="l00762"></a>00762 <span class="comment">      gzseek returns the resulting offset location as measured in bytes from</span>
<a name="l00763"></a>00763 <span class="comment">   the beginning of the uncompressed stream, or -1 in case of error.</span>
<a name="l00764"></a>00764 <span class="comment">      SEEK_END is not implemented, returns error.</span>
<a name="l00765"></a>00765 <span class="comment">      In this version of the library, gzseek can be extremely slow.</span>
<a name="l00766"></a>00766 <span class="comment">*/</span>
<a name="l00767"></a><a class="code" href="gzio_8c.html#a65f5382f62fce418f110877c817b27b7">00767</a> <a class="code" href="zconf_8h.html#a8cf4661a88ec12823d7cbdd3fa629eb0">z_off_t</a> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a65f5382f62fce418f110877c817b27b7">gzseek</a> (file, offset, whence)
<a name="l00768"></a>00768     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00769"></a>00769     <a class="code" href="zconf_8h.html#a8cf4661a88ec12823d7cbdd3fa629eb0">z_off_t</a> offset;
<a name="l00770"></a>00770     <span class="keywordtype">int</span> whence;
<a name="l00771"></a>00771 {
<a name="l00772"></a>00772     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00773"></a>00773 
<a name="l00774"></a>00774     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || whence == <a class="code" href="zconf_8h.html#ad2a2e6c114780c3071efd24f16c7f7d8">SEEK_END</a> ||
<a name="l00775"></a>00775         s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a> || s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a9eda83d428a71752d148f38b5dbe04f2">Z_DATA_ERROR</a>) {
<a name="l00776"></a>00776         <span class="keywordflow">return</span> -1L;
<a name="l00777"></a>00777     }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> == <span class="charliteral">&#39;w&#39;</span>) {
<a name="l00780"></a>00780 <span class="preprocessor">#ifdef NO_GZCOMPRESS</span>
<a name="l00781"></a>00781 <span class="preprocessor"></span>        <span class="keywordflow">return</span> -1L;
<a name="l00782"></a>00782 <span class="preprocessor">#else</span>
<a name="l00783"></a>00783 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (whence == <a class="code" href="zconf_8h.html#a0d112bae8fd35be772185b6ec6bcbe64">SEEK_SET</a>) {
<a name="l00784"></a>00784             offset -= s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a>;
<a name="l00785"></a>00785         }
<a name="l00786"></a>00786         <span class="keywordflow">if</span> (offset &lt; 0) <span class="keywordflow">return</span> -1L;
<a name="l00787"></a>00787 
<a name="l00788"></a>00788         <span class="comment">/* At this point, offset is the number of zero bytes to write. */</span>
<a name="l00789"></a>00789         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a> == <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>) {
<a name="l00790"></a>00790             s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a> = (<a class="code" href="ftraster_8c.html#ae3a497195d617519e5353ea7b417940f">Byte</a>*)<a class="code" href="gzio_8c.html#ac5c822e3692a95451e8f70a5916f05a3">ALLOC</a>(<a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>); <span class="comment">/* for seeking */</span>
<a name="l00791"></a>00791             <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a> == <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>) <span class="keywordflow">return</span> -1L;
<a name="l00792"></a>00792             <a class="code" href="zutil_8c.html#ae92187bde62d7c4e84b231576d291881">zmemzero</a>(s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a>, <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>);
<a name="l00793"></a>00793         }
<a name="l00794"></a>00794         <span class="keywordflow">while</span> (offset &gt; 0)  {
<a name="l00795"></a>00795             <a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a> <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a> = <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>;
<a name="l00796"></a>00796             <span class="keywordflow">if</span> (offset &lt; <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>) size = (<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)offset;
<a name="l00797"></a>00797 
<a name="l00798"></a>00798             size = <a class="code" href="gzio_8c.html#a93323ef1288f105db8a89e80f2764d3b">gzwrite</a>(file, s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a>, size);
<a name="l00799"></a>00799             <span class="keywordflow">if</span> (size == 0) <span class="keywordflow">return</span> -1L;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801             offset -= <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a>;
<a name="l00802"></a>00802         }
<a name="l00803"></a>00803         <span class="keywordflow">return</span> s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a>;
<a name="l00804"></a>00804 <span class="preprocessor">#endif</span>
<a name="l00805"></a>00805 <span class="preprocessor"></span>    }
<a name="l00806"></a>00806     <span class="comment">/* Rest of function is for reading only */</span>
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <span class="comment">/* compute absolute position */</span>
<a name="l00809"></a>00809     <span class="keywordflow">if</span> (whence == <a class="code" href="zconf_8h.html#a4c8d0b76b470ba65a43ca46a88320f39">SEEK_CUR</a>) {
<a name="l00810"></a>00810         offset += s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a>;
<a name="l00811"></a>00811     }
<a name="l00812"></a>00812     <span class="keywordflow">if</span> (offset &lt; 0) <span class="keywordflow">return</span> -1L;
<a name="l00813"></a>00813 
<a name="l00814"></a>00814     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a5bbfa8460d94ffea4ac6d78aedfc70d1">transparent</a>) {
<a name="l00815"></a>00815         <span class="comment">/* map to fseek */</span>
<a name="l00816"></a>00816         s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a> = <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>;
<a name="l00817"></a>00817         s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a> = 0;
<a name="l00818"></a>00818         s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a21d2c026f0f2fcd67f33011231f8ed00">next_in</a> = s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a>;
<a name="l00819"></a>00819         <span class="keywordflow">if</span> (fseek(s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>, offset, <a class="code" href="zconf_8h.html#a0d112bae8fd35be772185b6ec6bcbe64">SEEK_SET</a>) &lt; 0) <span class="keywordflow">return</span> -1L;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821         s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a> = s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> = offset;
<a name="l00822"></a>00822         <span class="keywordflow">return</span> offset;
<a name="l00823"></a>00823     }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825     <span class="comment">/* For a negative seek, rewind and use positive seek */</span>
<a name="l00826"></a>00826     <span class="keywordflow">if</span> (offset &gt;= s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a>) {
<a name="l00827"></a>00827         offset -= s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a>;
<a name="l00828"></a>00828     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="gzio_8c.html#a3b6bca34940a55ff52fba6f099d065c0">gzrewind</a>(file) &lt; 0) {
<a name="l00829"></a>00829         <span class="keywordflow">return</span> -1L;
<a name="l00830"></a>00830     }
<a name="l00831"></a>00831     <span class="comment">/* offset is now the number of bytes to skip. */</span>
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     <span class="keywordflow">if</span> (offset != 0 &amp;&amp; s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a> == <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>) {
<a name="l00834"></a>00834         s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a> = (<a class="code" href="ftraster_8c.html#ae3a497195d617519e5353ea7b417940f">Byte</a>*)<a class="code" href="gzio_8c.html#ac5c822e3692a95451e8f70a5916f05a3">ALLOC</a>(<a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>);
<a name="l00835"></a>00835         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a> == <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>) <span class="keywordflow">return</span> -1L;
<a name="l00836"></a>00836     }
<a name="l00837"></a>00837     <span class="keywordflow">if</span> (offset &amp;&amp; s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a> != <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>) {
<a name="l00838"></a>00838         s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a> = <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>;
<a name="l00839"></a>00839         s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a>++;
<a name="l00840"></a>00840         offset--;
<a name="l00841"></a>00841         <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a7c5213935b324dfb9a4101a73dd24a37">last</a>) s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a>;
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843     <span class="keywordflow">while</span> (offset &gt; 0)  {
<a name="l00844"></a>00844         <span class="keywordtype">int</span> <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a> = <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>;
<a name="l00845"></a>00845         <span class="keywordflow">if</span> (offset &lt; <a class="code" href="gzio_8c.html#a1491823e6cf52e751120f367bdc68a00">Z_BUFSIZE</a>) size = (int)offset;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847         size = <a class="code" href="gzio_8c.html#a2d0d971b446b67bbc4261fa5fef622bd">gzread</a>(file, s-&gt;<a class="code" href="structgz__stream.html#acef09df121278a0b4053f45356bfa823">outbuf</a>, (<a class="code" href="zconf_8h.html#a87d141052bcd5ec8a80812a565c70369">uInt</a>)size);
<a name="l00848"></a>00848         <span class="keywordflow">if</span> (size &lt;= 0) <span class="keywordflow">return</span> -1L;
<a name="l00849"></a>00849         offset -= <a class="code" href="jsonmain_8cpp.html#ae5efd41ba4949e198484a6a7f1fd543b">size</a>;
<a name="l00850"></a>00850     }
<a name="l00851"></a>00851     <span class="keywordflow">return</span> s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a>;
<a name="l00852"></a>00852 }
<a name="l00853"></a>00853 
<a name="l00854"></a>00854 <span class="comment">/* ===========================================================================</span>
<a name="l00855"></a>00855 <span class="comment">     Rewinds input file.</span>
<a name="l00856"></a>00856 <span class="comment">*/</span>
<a name="l00857"></a><a class="code" href="gzio_8c.html#a3b6bca34940a55ff52fba6f099d065c0">00857</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a3b6bca34940a55ff52fba6f099d065c0">gzrewind</a> (file)
<a name="l00858"></a>00858     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00859"></a>00859 {
<a name="l00860"></a>00860     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> != <span class="charliteral">&#39;r&#39;</span>) <span class="keywordflow">return</span> -1;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>;
<a name="l00865"></a>00865     s-&gt;<a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a> = 0;
<a name="l00866"></a>00866     s-&gt;<a class="code" href="structgz__stream.html#a3760ed2b7d4f83931000728a70846766">back</a> = <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>;
<a name="l00867"></a>00867     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a0cf177f50dbb49692f27480cbcfde794">avail_in</a> = 0;
<a name="l00868"></a>00868     s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a21d2c026f0f2fcd67f33011231f8ed00">next_in</a> = s-&gt;<a class="code" href="structgz__stream.html#a332c5ae7b5ccd1a571d89ab15940ea70">inbuf</a>;
<a name="l00869"></a>00869     s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a> = <a class="code" href="crc32_8c.html#a5d6fb454f076e5762905a247702c9be3">crc32</a>(0L, <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>, 0);
<a name="l00870"></a>00870     <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="structgz__stream.html#a5bbfa8460d94ffea4ac6d78aedfc70d1">transparent</a>) (void)<a class="code" href="inflate_8c.html#adb02c2100f9179f4075b220395b1553c">inflateReset</a>(&amp;s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>);
<a name="l00871"></a>00871     s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a> = 0;
<a name="l00872"></a>00872     s-&gt;<a class="code" href="structgz__stream.html#a2a414dd95210bef0643cfe60678f72c0">out</a> = 0;
<a name="l00873"></a>00873     <span class="keywordflow">return</span> fseek(s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>, s-&gt;<a class="code" href="structgz__stream.html#ae136c7871c6a87f0190c8245921e8145">start</a>, <a class="code" href="zconf_8h.html#a0d112bae8fd35be772185b6ec6bcbe64">SEEK_SET</a>);
<a name="l00874"></a>00874 }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 <span class="comment">/* ===========================================================================</span>
<a name="l00877"></a>00877 <span class="comment">     Returns the starting position for the next gzread or gzwrite on the</span>
<a name="l00878"></a>00878 <span class="comment">   given compressed file. This position represents a number of bytes in the</span>
<a name="l00879"></a>00879 <span class="comment">   uncompressed data stream.</span>
<a name="l00880"></a>00880 <span class="comment">*/</span>
<a name="l00881"></a><a class="code" href="gzio_8c.html#ad3f4308666663c0a2510b0c6be031ad8">00881</a> <a class="code" href="zconf_8h.html#a8cf4661a88ec12823d7cbdd3fa629eb0">z_off_t</a> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#ad3f4308666663c0a2510b0c6be031ad8">gztell</a> (file)
<a name="l00882"></a>00882     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00883"></a>00883 {
<a name="l00884"></a>00884     <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a65f5382f62fce418f110877c817b27b7">gzseek</a>(file, 0L, <a class="code" href="zconf_8h.html#a4c8d0b76b470ba65a43ca46a88320f39">SEEK_CUR</a>);
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="comment">/* ===========================================================================</span>
<a name="l00888"></a>00888 <span class="comment">     Returns 1 when EOF has previously been detected reading the given</span>
<a name="l00889"></a>00889 <span class="comment">   input stream, otherwise zero.</span>
<a name="l00890"></a>00890 <span class="comment">*/</span>
<a name="l00891"></a><a class="code" href="gzio_8c.html#a824d669e463e728eccc79c6ce57674a0">00891</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a824d669e463e728eccc79c6ce57674a0">gzeof</a> (file)
<a name="l00892"></a>00892     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00893"></a>00893 {
<a name="l00894"></a>00894     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     <span class="comment">/* With concatenated compressed files that can have embedded</span>
<a name="l00897"></a>00897 <span class="comment">     * crc trailers, z_eof is no longer the only/best indicator of EOF</span>
<a name="l00898"></a>00898 <span class="comment">     * on a gz_stream. Handle end-of-stream error explicitly here.</span>
<a name="l00899"></a>00899 <span class="comment">     */</span>
<a name="l00900"></a>00900     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> != <span class="charliteral">&#39;r&#39;</span>) <span class="keywordflow">return</span> 0;
<a name="l00901"></a>00901     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a>) <span class="keywordflow">return</span> 1;
<a name="l00902"></a>00902     <span class="keywordflow">return</span> s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> == <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a>;
<a name="l00903"></a>00903 }
<a name="l00904"></a>00904 
<a name="l00905"></a>00905 <span class="comment">/* ===========================================================================</span>
<a name="l00906"></a>00906 <span class="comment">     Returns 1 if reading and doing so transparently, otherwise zero.</span>
<a name="l00907"></a>00907 <span class="comment">*/</span>
<a name="l00908"></a><a class="code" href="gzio_8c.html#a1f049b9405deb0e7dad1fe97ed4dd8c2">00908</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a1f049b9405deb0e7dad1fe97ed4dd8c2">gzdirect</a> (file)
<a name="l00909"></a>00909     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00910"></a>00910 {
<a name="l00911"></a>00911     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00912"></a>00912 
<a name="l00913"></a>00913     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> != <span class="charliteral">&#39;r&#39;</span>) <span class="keywordflow">return</span> 0;
<a name="l00914"></a>00914     <span class="keywordflow">return</span> s-&gt;<a class="code" href="structgz__stream.html#a5bbfa8460d94ffea4ac6d78aedfc70d1">transparent</a>;
<a name="l00915"></a>00915 }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 <span class="comment">/* ===========================================================================</span>
<a name="l00918"></a>00918 <span class="comment">   Outputs a long in LSB order to the given file</span>
<a name="l00919"></a>00919 <span class="comment">*/</span>
<a name="l00920"></a><a class="code" href="gzio_8c.html#ad1f8f0552c7a8ce50739ce3e49ca5114">00920</a> <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <span class="keywordtype">void</span> <a class="code" href="gzio_8c.html#ad1f8f0552c7a8ce50739ce3e49ca5114">putLong</a> (file, x)
<a name="l00921"></a>00921     FILE *file;
<a name="l00922"></a>00922     <a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a> x;
<a name="l00923"></a>00923 {
<a name="l00924"></a>00924     <span class="keywordtype">int</span> <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l00925"></a>00925     <span class="keywordflow">for</span> (n = 0; n &lt; 4; n++) {
<a name="l00926"></a>00926         fputc((<span class="keywordtype">int</span>)(x &amp; 0xff), file);
<a name="l00927"></a>00927         x &gt;&gt;= 8;
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929 }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931 <span class="comment">/* ===========================================================================</span>
<a name="l00932"></a>00932 <span class="comment">   Reads a long in LSB order from the given gz_stream. Sets z_err in case</span>
<a name="l00933"></a>00933 <span class="comment">   of error.</span>
<a name="l00934"></a>00934 <span class="comment">*/</span>
<a name="l00935"></a><a class="code" href="gzio_8c.html#aaa7ad90748c13a5a06768ab2599fbc69">00935</a> <a class="code" href="crc32_8c.html#a08023ea6765c99d60a6a3840cd07156e">local</a> <a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a> <a class="code" href="gzio_8c.html#aaa7ad90748c13a5a06768ab2599fbc69">getLong</a> (s)
<a name="l00936"></a>00936     <a class="code" href="structgz__stream.html">gz_stream</a> *s;
<a name="l00937"></a>00937 {
<a name="l00938"></a>00938     <a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a> x = (<a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a>)<a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s);
<a name="l00939"></a>00939     <span class="keywordtype">int</span> c;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     x += ((<a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a>)<a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s))&lt;&lt;8;
<a name="l00942"></a>00942     x += ((<a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a>)<a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s))&lt;&lt;16;
<a name="l00943"></a>00943     c = <a class="code" href="gzio_8c.html#ab4601361fd7d350998aba79bd24f59f5">get_byte</a>(s);
<a name="l00944"></a>00944     <span class="keywordflow">if</span> (c == <a class="code" href="afmparse_8c.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a>) s-&gt;z_err = <a class="code" href="zlib_8h.html#a9eda83d428a71752d148f38b5dbe04f2">Z_DATA_ERROR</a>;
<a name="l00945"></a>00945     x += ((<a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a>)c)&lt;&lt;24;
<a name="l00946"></a>00946     <span class="keywordflow">return</span> x;
<a name="l00947"></a>00947 }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 <span class="comment">/* ===========================================================================</span>
<a name="l00950"></a>00950 <span class="comment">     Flushes all pending output if necessary, closes the compressed file</span>
<a name="l00951"></a>00951 <span class="comment">   and deallocates all the (de)compression state.</span>
<a name="l00952"></a>00952 <span class="comment">*/</span>
<a name="l00953"></a><a class="code" href="gzio_8c.html#aa7cbb6800b5c2e3a897b4470fbb3abcd">00953</a> <span class="keywordtype">int</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#aa7cbb6800b5c2e3a897b4470fbb3abcd">gzclose</a> (file)
<a name="l00954"></a>00954     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00955"></a>00955 {
<a name="l00956"></a>00956     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00957"></a>00957 
<a name="l00958"></a>00958     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#a1a78082ea3705a5ea837dbfb9c19268f">mode</a> == <span class="charliteral">&#39;w&#39;</span>) {
<a name="l00961"></a>00961 <span class="preprocessor">#ifdef NO_GZCOMPRESS</span>
<a name="l00962"></a>00962 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00963"></a>00963 <span class="preprocessor">#else</span>
<a name="l00964"></a>00964 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="gzio_8c.html#afafc4bbc6787281ae67c082cb529787d">do_flush</a> (file, <a class="code" href="zlib_8h.html#a876a626ba14eb12eea4bbf6823b6ca50">Z_FINISH</a>) != <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>)
<a name="l00965"></a>00965             <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">destroy</a>((<a class="code" href="structgz__stream.html">gz_stream</a>*)file);
<a name="l00966"></a>00966 
<a name="l00967"></a>00967         <a class="code" href="gzio_8c.html#ad1f8f0552c7a8ce50739ce3e49ca5114">putLong</a> (s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>, s-&gt;<a class="code" href="structgz__stream.html#a4d13a01877d20bda538cbf913029e49b">crc</a>);
<a name="l00968"></a>00968         <a class="code" href="gzio_8c.html#ad1f8f0552c7a8ce50739ce3e49ca5114">putLong</a> (s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>, (<a class="code" href="zconf_8h.html#acd2a5701a3aecf6700d2c66c606ecb40">uLong</a>)(s-&gt;<a class="code" href="structgz__stream.html#a4dd2a80eecd5d13f03bb3feddcb12dc1">in</a> &amp; 0xffffffff));
<a name="l00969"></a>00969 <span class="preprocessor">#endif</span>
<a name="l00970"></a>00970 <span class="preprocessor"></span>    }
<a name="l00971"></a>00971     <span class="keywordflow">return</span> <a class="code" href="gzio_8c.html#a47b8b068b10f0aa50eba5c2ec86cff0b">destroy</a>((<a class="code" href="structgz__stream.html">gz_stream</a>*)file);
<a name="l00972"></a>00972 }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974 <span class="preprocessor">#ifdef STDC</span>
<a name="l00975"></a>00975 <span class="preprocessor"></span><span class="preprocessor">#  define zstrerror(errnum) strerror(errnum)</span>
<a name="l00976"></a>00976 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00977"></a><a class="code" href="gzio_8c.html#a62122f710fb754b114c1ce12ff0bd191">00977</a> <span class="preprocessor"></span><span class="preprocessor">#  define zstrerror(errnum) &quot;&quot;</span>
<a name="l00978"></a>00978 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00979"></a>00979 <span class="preprocessor"></span>
<a name="l00980"></a>00980 <span class="comment">/* ===========================================================================</span>
<a name="l00981"></a>00981 <span class="comment">     Returns the error message for the last error which occurred on the</span>
<a name="l00982"></a>00982 <span class="comment">   given compressed file. errnum is set to zlib error number. If an</span>
<a name="l00983"></a>00983 <span class="comment">   error occurred in the file system and not in the compression library,</span>
<a name="l00984"></a>00984 <span class="comment">   errnum is set to Z_ERRNO and the application may consult errno</span>
<a name="l00985"></a>00985 <span class="comment">   to get the exact error code.</span>
<a name="l00986"></a>00986 <span class="comment">*/</span>
<a name="l00987"></a><a class="code" href="gzio_8c.html#aab4a0d420cf22ee2affce7562fe09b8f">00987</a> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#aab4a0d420cf22ee2affce7562fe09b8f">gzerror</a> (file, errnum)
<a name="l00988"></a>00988     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l00989"></a>00989     <span class="keywordtype">int</span> *errnum;
<a name="l00990"></a>00990 {
<a name="l00991"></a>00991     <span class="keywordtype">char</span> *m;
<a name="l00992"></a>00992     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00995"></a>00995         *errnum = <a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>;
<a name="l00996"></a>00996         <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*)<a class="code" href="zutil_8h.html#a66466516a4a71f3c78ccc40d203c92e5">ERR_MSG</a>(<a class="code" href="zlib_8h.html#aad97cde83a9a4bb77f5c3b03bb68e483">Z_STREAM_ERROR</a>);
<a name="l00997"></a>00997     }
<a name="l00998"></a>00998     *errnum = s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a>;
<a name="l00999"></a>00999     <span class="keywordflow">if</span> (*errnum == <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>) <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;&quot;</span>;
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     m = (<span class="keywordtype">char</span>*)(*errnum == <a class="code" href="zlib_8h.html#a3c66d64c427c0337c64e578537478737">Z_ERRNO</a> ? <a class="code" href="gzio_8c.html#a62122f710fb754b114c1ce12ff0bd191">zstrerror</a>(errno) : s-&gt;<a class="code" href="structgz__stream.html#a08366a18e41afcc67dd0965074286618">stream</a>.<a class="code" href="structz__stream__s.html#a9b2f745fc780e3b33e2935f8c650a326">msg</a>);
<a name="l01002"></a>01002 
<a name="l01003"></a>01003     <span class="keywordflow">if</span> (m == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || *m == <span class="charliteral">&#39;\0&#39;</span>) m = (<span class="keywordtype">char</span>*)<a class="code" href="zutil_8h.html#a66466516a4a71f3c78ccc40d203c92e5">ERR_MSG</a>(s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a>);
<a name="l01004"></a>01004 
<a name="l01005"></a>01005     <a class="code" href="gzio_8c.html#a5fb23c00a00f3856832e660edc2ab03d">TRYFREE</a>(s-&gt;<a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">msg</a>);
<a name="l01006"></a>01006     s-&gt;<a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">msg</a> = (<span class="keywordtype">char</span>*)<a class="code" href="gzio_8c.html#ac5c822e3692a95451e8f70a5916f05a3">ALLOC</a>(strlen(s-&gt;<a class="code" href="structgz__stream.html#a75008e50b323bcb85198023003cdc2c6">path</a>) + strlen(m) + 3);
<a name="l01007"></a>01007     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">msg</a> == <a class="code" href="zlib_8h.html#ad15afa2776b41b2f4d8582dd152bd736">Z_NULL</a>) <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*)<a class="code" href="zutil_8h.html#a66466516a4a71f3c78ccc40d203c92e5">ERR_MSG</a>(<a class="code" href="zlib_8h.html#ae2be6be871e377c6e2c25a7296ce320c">Z_MEM_ERROR</a>);
<a name="l01008"></a>01008     strcpy(s-&gt;<a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">msg</a>, s-&gt;<a class="code" href="structgz__stream.html#a75008e50b323bcb85198023003cdc2c6">path</a>);
<a name="l01009"></a>01009     strcat(s-&gt;<a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">msg</a>, <span class="stringliteral">&quot;: &quot;</span>);
<a name="l01010"></a>01010     strcat(s-&gt;<a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">msg</a>, m);
<a name="l01011"></a>01011     <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*)s-&gt;<a class="code" href="structgz__stream.html#afe7afcaffe9005256f416273c8049ae5">msg</a>;
<a name="l01012"></a>01012 }
<a name="l01013"></a>01013 
<a name="l01014"></a>01014 <span class="comment">/* ===========================================================================</span>
<a name="l01015"></a>01015 <span class="comment">     Clear the error and end-of-file flags, and do the same for the real file.</span>
<a name="l01016"></a>01016 <span class="comment">*/</span>
<a name="l01017"></a><a class="code" href="gzio_8c.html#a00cdd679373c2efd7d1720e3b9f7bfd0">01017</a> <span class="keywordtype">void</span> <a class="code" href="zconf_8h.html#a181415878f03b95a7094309d824a14b6">ZEXPORT</a> <a class="code" href="gzio_8c.html#a00cdd679373c2efd7d1720e3b9f7bfd0">gzclearerr</a> (file)
<a name="l01018"></a>01018     <a class="code" href="zlib_8h.html#acd0143ddd532551631ecc7093fd7adfc">gzFile</a> file;
<a name="l01019"></a>01019 {
<a name="l01020"></a>01020     <a class="code" href="structgz__stream.html">gz_stream</a> *s = (<a class="code" href="structgz__stream.html">gz_stream</a>*)file;
<a name="l01021"></a>01021 
<a name="l01022"></a>01022     <span class="keywordflow">if</span> (s == <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> != <a class="code" href="zlib_8h.html#a7d94a4a852228a899864a0053162e7a8">Z_STREAM_END</a>) s-&gt;<a class="code" href="structgz__stream.html#ace34952b7eac004c84d1d3726c5a3187">z_err</a> = <a class="code" href="zlib_8h.html#a8cb802b6a11e926478dc6547c514c65c">Z_OK</a>;
<a name="l01024"></a>01024     s-&gt;<a class="code" href="structgz__stream.html#a1d0148ec4694b3ba81889cacb85b136a">z_eof</a> = 0;
<a name="l01025"></a>01025     clearerr(s-&gt;<a class="code" href="structgz__stream.html#a1b41d5983900b66bff148aa6361721db">file</a>);
<a name="l01026"></a>01026 }
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="gzio_8c.html">gzio.c</a>      </li>

    <li class="footer">Generated on Tue Mar 13 2012 11:44:12 for ARK2D by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
