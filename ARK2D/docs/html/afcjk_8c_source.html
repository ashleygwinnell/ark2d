<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ARK2D: src/ARK2D/vendor/android/freetype/jni/src/autofit/afcjk.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ARK2D
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('afcjk_8c.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">src/ARK2D/vendor/android/freetype/jni/src/autofit/afcjk.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="afcjk_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************/</span>
<a name="l00002"></a>00002 <span class="comment">/*                                                                         */</span>
<a name="l00003"></a>00003 <span class="comment">/*  afcjk.c                                                                */</span>
<a name="l00004"></a>00004 <span class="comment">/*                                                                         */</span>
<a name="l00005"></a>00005 <span class="comment">/*    Auto-fitter hinting routines for CJK script (body).                  */</span>
<a name="l00006"></a>00006 <span class="comment">/*                                                                         */</span>
<a name="l00007"></a>00007 <span class="comment">/*  Copyright 2006, 2007, 2008, 2009, 2010 by                              */</span>
<a name="l00008"></a>00008 <span class="comment">/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<a name="l00009"></a>00009 <span class="comment">/*                                                                         */</span>
<a name="l00010"></a>00010 <span class="comment">/*  This file is part of the FreeType project, and may only be used,       */</span>
<a name="l00011"></a>00011 <span class="comment">/*  modified, and distributed under the terms of the FreeType project      */</span>
<a name="l00012"></a>00012 <span class="comment">/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<a name="l00013"></a>00013 <span class="comment">/*  this file you indicate that you have read the license and              */</span>
<a name="l00014"></a>00014 <span class="comment">/*  understand and accept it fully.                                        */</span>
<a name="l00015"></a>00015 <span class="comment">/*                                                                         */</span>
<a name="l00016"></a>00016 <span class="comment">/***************************************************************************/</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018   <span class="comment">/*</span>
<a name="l00019"></a>00019 <span class="comment">   *  The algorithm is based on akito&#39;s autohint patch, available here:</span>
<a name="l00020"></a>00020 <span class="comment">   *</span>
<a name="l00021"></a>00021 <span class="comment">   *  http://www.kde.gr.jp/~akito/patch/freetype2/</span>
<a name="l00022"></a>00022 <span class="comment">   *</span>
<a name="l00023"></a>00023 <span class="comment">   */</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="aftypes_8h.html">aftypes.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="aflatin_8h.html">aflatin.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#ifdef AF_CONFIG_OPTION_CJK</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="afcjk_8h.html">afcjk.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="aferrors_8h.html">aferrors.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#ifdef AF_USE_WARPER</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="afwarp_8h.html">afwarp.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040   <span class="comment">/*************************************************************************/</span>
<a name="l00041"></a>00041   <span class="comment">/*************************************************************************/</span>
<a name="l00042"></a>00042   <span class="comment">/*****                                                               *****/</span>
<a name="l00043"></a>00043   <span class="comment">/*****              C J K   G L O B A L   M E T R I C S              *****/</span>
<a name="l00044"></a>00044   <span class="comment">/*****                                                               *****/</span>
<a name="l00045"></a>00045   <span class="comment">/*************************************************************************/</span>
<a name="l00046"></a>00046   <span class="comment">/*************************************************************************/</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048   <a class="code" href="ftconfig_8h.html#a065cda933183dff5dc368794eefa7c93">FT_LOCAL_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l00049"></a>00049   <a class="code" href="afcjk_8h.html#afc55671a558d499d0630872ef463e925">af_cjk_metrics_init</a>( <a class="code" href="struct_a_f___latin_metrics_rec__.html">AF_LatinMetrics</a>  <a class="code" href="fterrdef_8h.html#a5b089f80b4f1f749dfb33220373bde32">metrics</a>,
<a name="l00050"></a>00050                        <a class="code" href="struct_f_t___face_rec__.html">FT_Face</a>          face )
<a name="l00051"></a>00051   {
<a name="l00052"></a>00052     <a class="code" href="struct_f_t___char_map_rec__.html">FT_CharMap</a>  oldmap = face-&gt;charmap;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055     metrics-&gt;units_per_em = face-&gt;units_per_EM;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     <span class="comment">/* TODO are there blues? */</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     <span class="keywordflow">if</span> ( <a class="code" href="freetype_8h.html#a5ccc241b34958a2b8818bb8b663b393f">FT_Select_Charmap</a>( face, FT_ENCODING_UNICODE ) )
<a name="l00060"></a>00060       face-&gt;charmap = <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00061"></a>00061     <span class="keywordflow">else</span>
<a name="l00062"></a>00062     {
<a name="l00063"></a>00063       <span class="comment">/* latin&#39;s version would suffice */</span>
<a name="l00064"></a>00064       <a class="code" href="aflatin_8c.html#a20c6e05283d6444c1e8c4083f10ecf31">af_latin_metrics_init_widths</a>( metrics, face, 0x7530 );
<a name="l00065"></a>00065       <a class="code" href="aflatin_8c.html#aaaa8d7175da627d4b2d0157a4094a56f">af_latin_metrics_check_digits</a>( metrics, face );
<a name="l00066"></a>00066     }
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     <a class="code" href="freetype_8h.html#a9208d1ccf0f8ad9a122fd6c9fe0c5b45">FT_Set_Charmap</a>( face, oldmap );
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="keywordflow">return</span> AF_Err_Ok;
<a name="l00071"></a>00071   }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 
<a name="l00074"></a>00074   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00075"></a>00075   af_cjk_metrics_scale_dim( <a class="code" href="struct_a_f___latin_metrics_rec__.html">AF_LatinMetrics</a>  metrics,
<a name="l00076"></a>00076                             <a class="code" href="struct_a_f___scaler_rec__.html">AF_Scaler</a>        scaler,
<a name="l00077"></a>00077                             <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>     dim )
<a name="l00078"></a>00078   {
<a name="l00079"></a>00079     <a class="code" href="struct_a_f___latin_axis_rec__.html">AF_LatinAxis</a>  axis;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     axis = &amp;metrics-&gt;<a class="code" href="struct_a_f___latin_metrics_rec__.html#af1bc992e9c29a875d1f3ad1fe1b48ba3">axis</a>[dim];
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="keywordflow">if</span> ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> )
<a name="l00085"></a>00085     {
<a name="l00086"></a>00086       axis-&gt;<a class="code" href="struct_a_f___latin_axis_rec__.html#ac59ded22f8b7e8990afa1b57844aa4c0">scale</a> = scaler-&gt;<a class="code" href="struct_a_f___scaler_rec__.html#acc8f40b57f6c142801cae42ab2304c6b">x_scale</a>;
<a name="l00087"></a>00087       axis-&gt;<a class="code" href="struct_a_f___latin_axis_rec__.html#a5a9438869fa1e7250a76387d1a6c8c59">delta</a> = scaler-&gt;<a class="code" href="struct_a_f___scaler_rec__.html#a806f45a9ef06653df58974f5c180b447">x_delta</a>;
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089     <span class="keywordflow">else</span>
<a name="l00090"></a>00090     {
<a name="l00091"></a>00091       axis-&gt;<a class="code" href="struct_a_f___latin_axis_rec__.html#ac59ded22f8b7e8990afa1b57844aa4c0">scale</a> = scaler-&gt;<a class="code" href="struct_a_f___scaler_rec__.html#aa5074c2d767b7b2b88cce17170804a17">y_scale</a>;
<a name="l00092"></a>00092       axis-&gt;<a class="code" href="struct_a_f___latin_axis_rec__.html#a5a9438869fa1e7250a76387d1a6c8c59">delta</a> = scaler-&gt;<a class="code" href="struct_a_f___scaler_rec__.html#a4268e4713bf34c85bbb004867f6a421d">y_delta</a>;
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094   }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   <a class="code" href="ftconfig_8h.html#a065cda933183dff5dc368794eefa7c93">FT_LOCAL_DEF</a>( <span class="keywordtype">void</span> )
<a name="l00098"></a>00098   <a class="code" href="afcjk_8h.html#abe0b153d1ec6f83c5d85bca479d12d31">af_cjk_metrics_scale</a>( <a class="code" href="struct_a_f___latin_metrics_rec__.html">AF_LatinMetrics</a>  metrics,
<a name="l00099"></a>00099                         <a class="code" href="struct_a_f___scaler_rec__.html">AF_Scaler</a>        scaler )
<a name="l00100"></a>00100   {
<a name="l00101"></a>00101     metrics-&gt;root.scaler = *scaler;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     af_cjk_metrics_scale_dim( metrics, scaler, <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> );
<a name="l00104"></a>00104     af_cjk_metrics_scale_dim( metrics, scaler, <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a> );
<a name="l00105"></a>00105   }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00108"></a>00108   <span class="comment">/*************************************************************************/</span>
<a name="l00109"></a>00109   <span class="comment">/*************************************************************************/</span>
<a name="l00110"></a>00110   <span class="comment">/*****                                                               *****/</span>
<a name="l00111"></a>00111   <span class="comment">/*****              C J K   G L Y P H   A N A L Y S I S              *****/</span>
<a name="l00112"></a>00112   <span class="comment">/*****                                                               *****/</span>
<a name="l00113"></a>00113   <span class="comment">/*************************************************************************/</span>
<a name="l00114"></a>00114   <span class="comment">/*************************************************************************/</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l00117"></a>00117   af_cjk_hints_compute_segments( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l00118"></a>00118                                  <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>   dim )
<a name="l00119"></a>00119   {
<a name="l00120"></a>00120     <a class="code" href="struct_a_f___axis_hints_rec__.html">AF_AxisHints</a>  axis          = &amp;hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a88d06a7880ba2423c73f937b7baedb46">axis</a>[dim];
<a name="l00121"></a>00121     <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>    segments      = axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a0af027de055b8d646d0c1c7468c4cb52">segments</a>;
<a name="l00122"></a>00122     <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>    segment_limit = segments + axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a59363b5d4f01b2596971cda9bcc6ba1f">num_segments</a>;
<a name="l00123"></a>00123     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>      error;
<a name="l00124"></a>00124     <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>    seg;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     error = <a class="code" href="aflatin_8c.html#a95154feb41ba613444ba22a455bcf1d4">af_latin_hints_compute_segments</a>( hints, dim );
<a name="l00128"></a>00128     <span class="keywordflow">if</span> ( error )
<a name="l00129"></a>00129       <span class="keywordflow">return</span> error;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="comment">/* a segment is round if it doesn&#39;t have successive */</span>
<a name="l00132"></a>00132     <span class="comment">/* on-curve points.                                 */</span>
<a name="l00133"></a>00133     <span class="keywordflow">for</span> ( seg = segments; seg &lt; segment_limit; seg++ )
<a name="l00134"></a>00134     {
<a name="l00135"></a>00135       <a class="code" href="struct_a_f___point_rec__.html">AF_Point</a>  pt   = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a73795f6dab95b41ea461c3ffd926f90c">first</a>;
<a name="l00136"></a>00136       <a class="code" href="struct_a_f___point_rec__.html">AF_Point</a>  last = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1e2d450a4f1684bee96c39209970f324">last</a>;
<a name="l00137"></a>00137       <a class="code" href="afhints_8h.html#a6e158e94ba5decb1bca56e2aff2b7265">AF_Flags</a>  f0   = (<a class="code" href="afhints_8h.html#a6e158e94ba5decb1bca56e2aff2b7265">AF_Flags</a>)(pt-&gt;<a class="code" href="struct_a_f___point_rec__.html#ade9c4b603d4d6a0223b7b5efec75a321">flags</a> &amp; <a class="code" href="afhints_8h.html#a7e299cfd9a20868dd4a5ec833b18b38fafc1882369d4e3bd2c49119e40da8aae3">AF_FLAG_CONTROL</a>);
<a name="l00138"></a>00138       <a class="code" href="afhints_8h.html#a6e158e94ba5decb1bca56e2aff2b7265">AF_Flags</a>  f1;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00141"></a>00141       seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a06c2fb24257b1ac68ee3e4e705838d67">flags</a> &amp;= ~<a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa8e934813176a94ea8ce1902c533e4f89">AF_EDGE_ROUND</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143       <span class="keywordflow">for</span> ( ; pt != last; f0 = f1 )
<a name="l00144"></a>00144       {
<a name="l00145"></a>00145         pt = pt-&gt;<a class="code" href="struct_a_f___point_rec__.html#a645170dd7325b98848313447aeee08fa">next</a>;
<a name="l00146"></a>00146         f1 = (<a class="code" href="afhints_8h.html#a6e158e94ba5decb1bca56e2aff2b7265">AF_Flags</a>)(pt-&gt;<a class="code" href="struct_a_f___point_rec__.html#ade9c4b603d4d6a0223b7b5efec75a321">flags</a> &amp; <a class="code" href="afhints_8h.html#a7e299cfd9a20868dd4a5ec833b18b38fafc1882369d4e3bd2c49119e40da8aae3">AF_FLAG_CONTROL</a>);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="keywordflow">if</span> ( !f0 &amp;&amp; !f1 )
<a name="l00149"></a>00149           <span class="keywordflow">break</span>;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         <span class="keywordflow">if</span> ( pt == last )
<a name="l00152"></a>00152           seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a06c2fb24257b1ac68ee3e4e705838d67">flags</a> |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa8e934813176a94ea8ce1902c533e4f89">AF_EDGE_ROUND</a>;
<a name="l00153"></a>00153       }
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="keywordflow">return</span> AF_Err_Ok;
<a name="l00157"></a>00157   }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00161"></a>00161   af_cjk_hints_link_segments( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l00162"></a>00162                               <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>   dim )
<a name="l00163"></a>00163   {
<a name="l00164"></a>00164     <a class="code" href="struct_a_f___axis_hints_rec__.html">AF_AxisHints</a>  axis          = &amp;hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a88d06a7880ba2423c73f937b7baedb46">axis</a>[dim];
<a name="l00165"></a>00165     <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>    segments      = axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a0af027de055b8d646d0c1c7468c4cb52">segments</a>;
<a name="l00166"></a>00166     <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>    segment_limit = segments + axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a59363b5d4f01b2596971cda9bcc6ba1f">num_segments</a>;
<a name="l00167"></a>00167     <a class="code" href="afhints_8h.html#a55aeea8a2bac31353c89ac3f6762a3ac">AF_Direction</a>  major_dir     = axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a57536b4d9796707b7580ec00cd34453e">major_dir</a>;
<a name="l00168"></a>00168     <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>    seg1, seg2;
<a name="l00169"></a>00169     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>        len_threshold;
<a name="l00170"></a>00170     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>        dist_threshold;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     len_threshold = <a class="code" href="aflatin_8h.html#a89db9195c927f3e92ee2e49ca5b78aab">AF_LATIN_CONSTANT</a>( hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a96b6a66abf44b73ac399e15f4ba40c13">metrics</a>, 8 );
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     dist_threshold = ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> ) ? hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#af31b148e7250e634571f9ebe5b041f48">x_scale</a>
<a name="l00176"></a>00176                                                   : hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a7cf24284c694b4fd858ab2f726adc79b">y_scale</a>;
<a name="l00177"></a>00177     dist_threshold = <a class="code" href="freetype_8h.html#a5248df90a0d076e6543b09284face353">FT_DivFix</a>( 64 * 3, dist_threshold );
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="comment">/* now compare each segment to the others */</span>
<a name="l00180"></a>00180     <span class="keywordflow">for</span> ( seg1 = segments; seg1 &lt; segment_limit; seg1++ )
<a name="l00181"></a>00181     {
<a name="l00182"></a>00182       <span class="comment">/* the fake segments are for metrics hinting only */</span>
<a name="l00183"></a>00183       <span class="keywordflow">if</span> ( seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a73795f6dab95b41ea461c3ffd926f90c">first</a> == seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1e2d450a4f1684bee96c39209970f324">last</a> )
<a name="l00184"></a>00184         <span class="keywordflow">continue</span>;
<a name="l00185"></a>00185 
<a name="l00186"></a>00186       <span class="keywordflow">if</span> ( seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1f224feb1e9cc92b368f2bdf6cf2d2fb">dir</a> != major_dir )
<a name="l00187"></a>00187         <span class="keywordflow">continue</span>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189       <span class="keywordflow">for</span> ( seg2 = segments; seg2 &lt; segment_limit; seg2++ )
<a name="l00190"></a>00190         <span class="keywordflow">if</span> ( seg2 != seg1 &amp;&amp; seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1f224feb1e9cc92b368f2bdf6cf2d2fb">dir</a> + seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1f224feb1e9cc92b368f2bdf6cf2d2fb">dir</a> == 0 )
<a name="l00191"></a>00191         {
<a name="l00192"></a>00192           <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  dist = seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> - seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a>;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 
<a name="l00195"></a>00195           <span class="keywordflow">if</span> ( dist &lt; 0 )
<a name="l00196"></a>00196             <span class="keywordflow">continue</span>;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198           {
<a name="l00199"></a>00199             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  <a class="code" href="al_main_8h.html#abb702d8b501669a23aa0ab3b281b9384">min</a> = seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a25de1ec9f40e6bae9aa268a9425db490">min_coord</a>;
<a name="l00200"></a>00200             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  <a class="code" href="al_main_8h.html#ac39d9cef6a5e030ba8d9e11121054268">max</a> = seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a2c87699e923b2e510ad6367e94f72e7a">max_coord</a>;
<a name="l00201"></a>00201             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  len;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 
<a name="l00204"></a>00204             <span class="keywordflow">if</span> ( min &lt; seg2-&gt;min_coord )
<a name="l00205"></a>00205               min = seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a25de1ec9f40e6bae9aa268a9425db490">min_coord</a>;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207             <span class="keywordflow">if</span> ( max &gt; seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a2c87699e923b2e510ad6367e94f72e7a">max_coord</a> )
<a name="l00208"></a>00208               max = seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a2c87699e923b2e510ad6367e94f72e7a">max_coord</a>;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210             len = max - <a class="code" href="al_main_8h.html#abb702d8b501669a23aa0ab3b281b9384">min</a>;
<a name="l00211"></a>00211             <span class="keywordflow">if</span> ( len &gt;= len_threshold )
<a name="l00212"></a>00212             {
<a name="l00213"></a>00213               <span class="keywordflow">if</span> ( dist * 8 &lt; seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> * 9                        &amp;&amp;
<a name="l00214"></a>00214                    ( dist * 8 &lt; seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> * 7 || seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac75cbe8b7d1f0ca6a8b177e5d09f9982">len</a> &lt; len ) )
<a name="l00215"></a>00215               {
<a name="l00216"></a>00216                 seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> = dist;
<a name="l00217"></a>00217                 seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac75cbe8b7d1f0ca6a8b177e5d09f9982">len</a>   = len;
<a name="l00218"></a>00218                 seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>  = seg2;
<a name="l00219"></a>00219               }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221               <span class="keywordflow">if</span> ( dist * 8 &lt; seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> * 9                        &amp;&amp;
<a name="l00222"></a>00222                    ( dist * 8 &lt; seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> * 7 || seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac75cbe8b7d1f0ca6a8b177e5d09f9982">len</a> &lt; len ) )
<a name="l00223"></a>00223               {
<a name="l00224"></a>00224                 seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> = dist;
<a name="l00225"></a>00225                 seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac75cbe8b7d1f0ca6a8b177e5d09f9982">len</a>   = len;
<a name="l00226"></a>00226                 seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>  = seg1;
<a name="l00227"></a>00227               }
<a name="l00228"></a>00228             }
<a name="l00229"></a>00229           }
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="comment">/*</span>
<a name="l00234"></a>00234 <span class="comment">     *  now compute the `serif&#39; segments</span>
<a name="l00235"></a>00235 <span class="comment">     *</span>
<a name="l00236"></a>00236 <span class="comment">     *  In Hanzi, some strokes are wider on one or both of the ends.</span>
<a name="l00237"></a>00237 <span class="comment">     *  We either identify the stems on the ends as serifs or remove</span>
<a name="l00238"></a>00238 <span class="comment">     *  the linkage, depending on the length of the stems.</span>
<a name="l00239"></a>00239 <span class="comment">     *</span>
<a name="l00240"></a>00240 <span class="comment">     */</span>
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243       <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>  link1, link2;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a>00246       <span class="keywordflow">for</span> ( seg1 = segments; seg1 &lt; segment_limit; seg1++ )
<a name="l00247"></a>00247       {
<a name="l00248"></a>00248         link1 = seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>;
<a name="l00249"></a>00249         <span class="keywordflow">if</span> ( !link1 || link1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a> != seg1 || link1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> &lt;= seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> )
<a name="l00250"></a>00250           <span class="keywordflow">continue</span>;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         <span class="keywordflow">if</span> ( seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> &gt;= dist_threshold )
<a name="l00253"></a>00253           <span class="keywordflow">continue</span>;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255         <span class="keywordflow">for</span> ( seg2 = segments; seg2 &lt; segment_limit; seg2++ )
<a name="l00256"></a>00256         {
<a name="l00257"></a>00257           <span class="keywordflow">if</span> ( seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> &gt; seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> || seg1 == seg2 )
<a name="l00258"></a>00258             <span class="keywordflow">continue</span>;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260           link2 = seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>;
<a name="l00261"></a>00261           <span class="keywordflow">if</span> ( !link2 || link2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a> != seg2 || link2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> &lt; link1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> )
<a name="l00262"></a>00262             <span class="keywordflow">continue</span>;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264           <span class="keywordflow">if</span> ( seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> == seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> &amp;&amp; link1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> == link2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> )
<a name="l00265"></a>00265             <span class="keywordflow">continue</span>;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267           <span class="keywordflow">if</span> ( seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> &lt;= seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> || seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> * 4 &lt;= seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> )
<a name="l00268"></a>00268             <span class="keywordflow">continue</span>;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270           <span class="comment">/* seg2 &lt; seg1 &lt; link1 &lt; link2 */</span>
<a name="l00271"></a>00271 
<a name="l00272"></a>00272           <span class="keywordflow">if</span> ( seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac75cbe8b7d1f0ca6a8b177e5d09f9982">len</a> &gt;= seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac75cbe8b7d1f0ca6a8b177e5d09f9982">len</a> * 3 )
<a name="l00273"></a>00273           {
<a name="l00274"></a>00274             <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>  seg;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 
<a name="l00277"></a>00277             <span class="keywordflow">for</span> ( seg = segments; seg &lt; segment_limit; seg++ )
<a name="l00278"></a>00278             {
<a name="l00279"></a>00279               <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>  link = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a>00282               <span class="keywordflow">if</span> ( link == seg2 )
<a name="l00283"></a>00283               {
<a name="l00284"></a>00284                 seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>  = 0;
<a name="l00285"></a>00285                 seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#af0b01b67fb7b94d387ac64ee86f21a15">serif</a> = link1;
<a name="l00286"></a>00286               }
<a name="l00287"></a>00287               <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( link == link2 )
<a name="l00288"></a>00288               {
<a name="l00289"></a>00289                 seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>  = 0;
<a name="l00290"></a>00290                 seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#af0b01b67fb7b94d387ac64ee86f21a15">serif</a> = seg1;
<a name="l00291"></a>00291               }
<a name="l00292"></a>00292             }
<a name="l00293"></a>00293           }
<a name="l00294"></a>00294           <span class="keywordflow">else</span>
<a name="l00295"></a>00295           {
<a name="l00296"></a>00296             seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a> = link1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a> = 0;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298             <span class="keywordflow">break</span>;
<a name="l00299"></a>00299           }
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301       }
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keywordflow">for</span> ( seg1 = segments; seg1 &lt; segment_limit; seg1++ )
<a name="l00305"></a>00305     {
<a name="l00306"></a>00306       seg2 = seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308       <span class="keywordflow">if</span> ( seg2 )
<a name="l00309"></a>00309       {
<a name="l00310"></a>00310         seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a96c84500df1a004ae29439030d772c7c">num_linked</a>++;
<a name="l00311"></a>00311         <span class="keywordflow">if</span> ( seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a> != seg1 )
<a name="l00312"></a>00312         {
<a name="l00313"></a>00313           seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a> = 0;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315           <span class="keywordflow">if</span> ( seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> &lt; dist_threshold || seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> &lt; seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae84e19dcd0a5ef19baa19f1b8d0258ca">score</a> * 4 )
<a name="l00316"></a>00316             seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#af0b01b67fb7b94d387ac64ee86f21a15">serif</a> = seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>;
<a name="l00317"></a>00317           <span class="keywordflow">else</span>
<a name="l00318"></a>00318             seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a96c84500df1a004ae29439030d772c7c">num_linked</a>--;
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320       }
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322   }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l00326"></a>00326   af_cjk_hints_compute_edges( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l00327"></a>00327                               <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>   dim )
<a name="l00328"></a>00328   {
<a name="l00329"></a>00329     <a class="code" href="struct_a_f___axis_hints_rec__.html">AF_AxisHints</a>  axis   = &amp;hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a88d06a7880ba2423c73f937b7baedb46">axis</a>[dim];
<a name="l00330"></a>00330     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>      error  = AF_Err_Ok;
<a name="l00331"></a>00331     <a class="code" href="ftsystem_8h.html#a67ec7ea35cde99a89a65e9f827a9ad3a">FT_Memory</a>     memory = hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a1f7353d9cd7c324d9c60a40233c5705b">memory</a>;
<a name="l00332"></a>00332     <a class="code" href="struct_a_f___latin_axis_rec__.html">AF_LatinAxis</a>  laxis  = &amp;((<a class="code" href="aflatin_8h.html#a95459a1e876a766cc558731c75debb9f">AF_LatinMetrics</a>)hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a96b6a66abf44b73ac399e15f4ba40c13">metrics</a>)-&gt;axis[dim];
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>    segments      = axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a0af027de055b8d646d0c1c7468c4cb52">segments</a>;
<a name="l00335"></a>00335     <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>    segment_limit = segments + axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a59363b5d4f01b2596971cda9bcc6ba1f">num_segments</a>;
<a name="l00336"></a>00336     <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>    seg;
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>      scale;
<a name="l00339"></a>00339     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>        edge_distance_threshold;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a3313ee61ecfaac9625f5925c79b0a9bb">num_edges</a> = 0;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     scale = ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> ) ? hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#af31b148e7250e634571f9ebe5b041f48">x_scale</a>
<a name="l00345"></a>00345                                          : hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a7cf24284c694b4fd858ab2f726adc79b">y_scale</a>;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="comment">/*********************************************************************/</span>
<a name="l00348"></a>00348     <span class="comment">/*                                                                   */</span>
<a name="l00349"></a>00349     <span class="comment">/* We begin by generating a sorted table of edges for the current    */</span>
<a name="l00350"></a>00350     <span class="comment">/* direction.  To do so, we simply scan each segment and try to find */</span>
<a name="l00351"></a>00351     <span class="comment">/* an edge in our table that corresponds to its position.            */</span>
<a name="l00352"></a>00352     <span class="comment">/*                                                                   */</span>
<a name="l00353"></a>00353     <span class="comment">/* If no edge is found, we create and insert a new edge in the       */</span>
<a name="l00354"></a>00354     <span class="comment">/* sorted table.  Otherwise, we simply add the segment to the edge&#39;s */</span>
<a name="l00355"></a>00355     <span class="comment">/* list which is then processed in the second step to compute the    */</span>
<a name="l00356"></a>00356     <span class="comment">/* edge&#39;s properties.                                                */</span>
<a name="l00357"></a>00357     <span class="comment">/*                                                                   */</span>
<a name="l00358"></a>00358     <span class="comment">/* Note that the edges table is sorted along the segment/edge        */</span>
<a name="l00359"></a>00359     <span class="comment">/* position.                                                         */</span>
<a name="l00360"></a>00360     <span class="comment">/*                                                                   */</span>
<a name="l00361"></a>00361     <span class="comment">/*********************************************************************/</span>
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     edge_distance_threshold = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( laxis-&gt;<a class="code" href="struct_a_f___latin_axis_rec__.html#a5d07185dec6434da53d28ffb5b56393c">edge_distance_threshold</a>,
<a name="l00364"></a>00364                                          scale );
<a name="l00365"></a>00365     <span class="keywordflow">if</span> ( edge_distance_threshold &gt; 64 / 4 )
<a name="l00366"></a>00366       edge_distance_threshold = <a class="code" href="freetype_8h.html#a5248df90a0d076e6543b09284face353">FT_DivFix</a>( 64 / 4, scale );
<a name="l00367"></a>00367     <span class="keywordflow">else</span>
<a name="l00368"></a>00368       edge_distance_threshold = laxis-&gt;<a class="code" href="struct_a_f___latin_axis_rec__.html#a5d07185dec6434da53d28ffb5b56393c">edge_distance_threshold</a>;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <span class="keywordflow">for</span> ( seg = segments; seg &lt; segment_limit; seg++ )
<a name="l00371"></a>00371     {
<a name="l00372"></a>00372       <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>  found = 0;
<a name="l00373"></a>00373       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>   best  = 0xFFFFU;
<a name="l00374"></a>00374       <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>   ee;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 
<a name="l00377"></a>00377       <span class="comment">/* look for an edge corresponding to the segment */</span>
<a name="l00378"></a>00378       <span class="keywordflow">for</span> ( ee = 0; ee &lt; axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a3313ee61ecfaac9625f5925c79b0a9bb">num_edges</a>; ee++ )
<a name="l00379"></a>00379       {
<a name="l00380"></a>00380         <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>  edge = axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a4c2d0f3a7406e87957d4a8cbdb9f5d44">edges</a> + ee;
<a name="l00381"></a>00381         <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>   dist;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 
<a name="l00384"></a>00384         <span class="keywordflow">if</span> ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a04e72c31f57dd4317b95445cf649c1db">dir</a> != seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1f224feb1e9cc92b368f2bdf6cf2d2fb">dir</a> )
<a name="l00385"></a>00385           <span class="keywordflow">continue</span>;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         dist = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a> - edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a>;
<a name="l00388"></a>00388         <span class="keywordflow">if</span> ( dist &lt; 0 )
<a name="l00389"></a>00389           dist = -dist;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="keywordflow">if</span> ( dist &lt; edge_distance_threshold &amp;&amp; dist &lt; best )
<a name="l00392"></a>00392         {
<a name="l00393"></a>00393           <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>  link = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 
<a name="l00396"></a>00396           <span class="comment">/* check whether all linked segments of the candidate edge */</span>
<a name="l00397"></a>00397           <span class="comment">/* can make a single edge.                                 */</span>
<a name="l00398"></a>00398           <span class="keywordflow">if</span> ( link )
<a name="l00399"></a>00399           {
<a name="l00400"></a>00400             <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>  seg1 = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a>;
<a name="l00401"></a>00401             <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>  link1;
<a name="l00402"></a>00402             <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>      dist2 = 0;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405             <span class="keywordflow">do</span>
<a name="l00406"></a>00406             {
<a name="l00407"></a>00407               link1 = seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>;
<a name="l00408"></a>00408               <span class="keywordflow">if</span> ( link1 )
<a name="l00409"></a>00409               {
<a name="l00410"></a>00410                 dist2 = <a class="code" href="afhints_8h.html#a296ba70129a40b6e919269b64c325d98">AF_SEGMENT_DIST</a>( link, link1 );
<a name="l00411"></a>00411                 <span class="keywordflow">if</span> ( dist2 &gt;= edge_distance_threshold )
<a name="l00412"></a>00412                   <span class="keywordflow">break</span>;
<a name="l00413"></a>00413               }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415             } <span class="keywordflow">while</span> ( ( seg1 = seg1-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a68786aed948ad02e736927b29413b77f">edge_next</a> ) != edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a> );
<a name="l00416"></a>00416 
<a name="l00417"></a>00417             <span class="keywordflow">if</span> ( dist2 &gt;= edge_distance_threshold )
<a name="l00418"></a>00418               <span class="keywordflow">continue</span>;
<a name="l00419"></a>00419           }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421           best  = dist;
<a name="l00422"></a>00422           found = edge;
<a name="l00423"></a>00423         }
<a name="l00424"></a>00424       }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426       <span class="keywordflow">if</span> ( !found )
<a name="l00427"></a>00427       {
<a name="l00428"></a>00428         <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>  edge;
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 
<a name="l00431"></a>00431         <span class="comment">/* insert a new edge in the list and */</span>
<a name="l00432"></a>00432         <span class="comment">/* sort according to the position    */</span>
<a name="l00433"></a>00433         error = <a class="code" href="afhints_8c.html#a72be99b84012f6e0db670ea35e300212">af_axis_hints_new_edge</a>( axis, seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a>,
<a name="l00434"></a>00434                                         (<a class="code" href="afhints_8h.html#a55aeea8a2bac31353c89ac3f6762a3ac">AF_Direction</a>)seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1f224feb1e9cc92b368f2bdf6cf2d2fb">dir</a>,
<a name="l00435"></a>00435                                         memory, &amp;edge );
<a name="l00436"></a>00436         <span class="keywordflow">if</span> ( error )
<a name="l00437"></a>00437           <span class="keywordflow">goto</span> Exit;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439         <span class="comment">/* add the segment to the new edge&#39;s list */</span>
<a name="l00440"></a>00440         <a class="code" href="ftmemory_8h.html#a88db9f3d12c144b9f450c80ec62dc4fc">FT_ZERO</a>( edge );
<a name="l00441"></a>00441 
<a name="l00442"></a>00442         edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a>    = seg;
<a name="l00443"></a>00443         edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a68730a288fd588ada62778918d563696">last</a>     = seg;
<a name="l00444"></a>00444         edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a>     = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a>;
<a name="l00445"></a>00445         edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a>     = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> = <a class="code" href="freetype_8h.html#aeb37c2858e2851e15465580de1d1d218">FT_MulFix</a>( seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ac9fc981f4e37658ec98757f45673f1f0">pos</a>, scale );
<a name="l00446"></a>00446         seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a68786aed948ad02e736927b29413b77f">edge_next</a> = seg;
<a name="l00447"></a>00447         edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a04e72c31f57dd4317b95445cf649c1db">dir</a>      = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1f224feb1e9cc92b368f2bdf6cf2d2fb">dir</a>;
<a name="l00448"></a>00448       }
<a name="l00449"></a>00449       <span class="keywordflow">else</span>
<a name="l00450"></a>00450       {
<a name="l00451"></a>00451         <span class="comment">/* if an edge was found, simply add the segment to the edge&#39;s */</span>
<a name="l00452"></a>00452         <span class="comment">/* list                                                       */</span>
<a name="l00453"></a>00453         seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a68786aed948ad02e736927b29413b77f">edge_next</a>         = found-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a>;
<a name="l00454"></a>00454         found-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a68730a288fd588ada62778918d563696">last</a>-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a68786aed948ad02e736927b29413b77f">edge_next</a> = seg;
<a name="l00455"></a>00455         found-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a68730a288fd588ada62778918d563696">last</a>            = seg;
<a name="l00456"></a>00456       }
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="comment">/*********************************************************************/</span>
<a name="l00460"></a>00460     <span class="comment">/*                                                                   */</span>
<a name="l00461"></a>00461     <span class="comment">/* Good, we now compute each edge&#39;s properties according to segments */</span>
<a name="l00462"></a>00462     <span class="comment">/* found on its position.  Basically, these are as follows.          */</span>
<a name="l00463"></a>00463     <span class="comment">/*                                                                   */</span>
<a name="l00464"></a>00464     <span class="comment">/*  - edge&#39;s main direction                                          */</span>
<a name="l00465"></a>00465     <span class="comment">/*  - stem edge, serif edge or both (which defaults to stem then)    */</span>
<a name="l00466"></a>00466     <span class="comment">/*  - rounded edge, straight or both (which defaults to straight)    */</span>
<a name="l00467"></a>00467     <span class="comment">/*  - link for edge                                                  */</span>
<a name="l00468"></a>00468     <span class="comment">/*                                                                   */</span>
<a name="l00469"></a>00469     <span class="comment">/*********************************************************************/</span>
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="comment">/* first of all, set the `edge&#39; field in each segment -- this is     */</span>
<a name="l00472"></a>00472     <span class="comment">/* required in order to compute edge links                           */</span>
<a name="l00473"></a>00473     <span class="comment">/*                                                                   */</span>
<a name="l00474"></a>00474     <span class="comment">/* Note that removing this loop and setting the `edge&#39; field of each */</span>
<a name="l00475"></a>00475     <span class="comment">/* segment directly in the code above slows down execution speed for */</span>
<a name="l00476"></a>00476     <span class="comment">/* some reasons on platforms like the Sun.                           */</span>
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     {
<a name="l00479"></a>00479       <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>  edges      = axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a4c2d0f3a7406e87957d4a8cbdb9f5d44">edges</a>;
<a name="l00480"></a>00480       <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>  edge_limit = edges + axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a3313ee61ecfaac9625f5925c79b0a9bb">num_edges</a>;
<a name="l00481"></a>00481       <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>  edge;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483 
<a name="l00484"></a>00484       <span class="keywordflow">for</span> ( edge = edges; edge &lt; edge_limit; edge++ )
<a name="l00485"></a>00485       {
<a name="l00486"></a>00486         seg = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a>;
<a name="l00487"></a>00487         <span class="keywordflow">if</span> ( seg )
<a name="l00488"></a>00488           <span class="keywordflow">do</span>
<a name="l00489"></a>00489           {
<a name="l00490"></a>00490             seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae7725abe2fb5d3da8123edc8579124bf">edge</a> = edge;
<a name="l00491"></a>00491             seg       = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a68786aed948ad02e736927b29413b77f">edge_next</a>;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493           } <span class="keywordflow">while</span> ( seg != edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a> );
<a name="l00494"></a>00494       }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496       <span class="comment">/* now compute each edge properties */</span>
<a name="l00497"></a>00497       <span class="keywordflow">for</span> ( edge = edges; edge &lt; edge_limit; edge++ )
<a name="l00498"></a>00498       {
<a name="l00499"></a>00499         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  is_round    = 0;  <span class="comment">/* does it contain round segments?    */</span>
<a name="l00500"></a>00500         <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>  is_straight = 0;  <span class="comment">/* does it contain straight segments? */</span>
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a>00503         seg = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a>;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505         <span class="keywordflow">do</span>
<a name="l00506"></a>00506         {
<a name="l00507"></a>00507           <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>  is_serif;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 
<a name="l00510"></a>00510           <span class="comment">/* check for roundness of segment */</span>
<a name="l00511"></a>00511           <span class="keywordflow">if</span> ( seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a06c2fb24257b1ac68ee3e4e705838d67">flags</a> &amp; <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa8e934813176a94ea8ce1902c533e4f89">AF_EDGE_ROUND</a> )
<a name="l00512"></a>00512             is_round++;
<a name="l00513"></a>00513           <span class="keywordflow">else</span>
<a name="l00514"></a>00514             is_straight++;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516           <span class="comment">/* check for links -- if seg-&gt;serif is set, then seg-&gt;link must */</span>
<a name="l00517"></a>00517           <span class="comment">/* be ignored                                                   */</span>
<a name="l00518"></a>00518           is_serif = (<a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>)( seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#af0b01b67fb7b94d387ac64ee86f21a15">serif</a> &amp;&amp; seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#af0b01b67fb7b94d387ac64ee86f21a15">serif</a>-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae7725abe2fb5d3da8123edc8579124bf">edge</a> != edge );
<a name="l00519"></a>00519 
<a name="l00520"></a>00520           <span class="keywordflow">if</span> ( seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a> || is_serif )
<a name="l00521"></a>00521           {
<a name="l00522"></a>00522             <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>     edge2;
<a name="l00523"></a>00523             <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>  seg2;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 
<a name="l00526"></a>00526             edge2 = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>;
<a name="l00527"></a>00527             seg2  = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a7283d71a7e761ea793b9908cf0be7bb9">link</a>;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529             <span class="keywordflow">if</span> ( is_serif )
<a name="l00530"></a>00530             {
<a name="l00531"></a>00531               seg2  = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#af0b01b67fb7b94d387ac64ee86f21a15">serif</a>;
<a name="l00532"></a>00532               edge2 = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a12d7731f9283877723fc7a2d9c40d937">serif</a>;
<a name="l00533"></a>00533             }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535             <span class="keywordflow">if</span> ( edge2 )
<a name="l00536"></a>00536             {
<a name="l00537"></a>00537               <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  edge_delta;
<a name="l00538"></a>00538               <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  seg_delta;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 
<a name="l00541"></a>00541               edge_delta = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a> - edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a>;
<a name="l00542"></a>00542               <span class="keywordflow">if</span> ( edge_delta &lt; 0 )
<a name="l00543"></a>00543                 edge_delta = -edge_delta;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545               seg_delta = <a class="code" href="afhints_8h.html#a296ba70129a40b6e919269b64c325d98">AF_SEGMENT_DIST</a>( seg, seg2 );
<a name="l00546"></a>00546 
<a name="l00547"></a>00547               <span class="keywordflow">if</span> ( seg_delta &lt; edge_delta )
<a name="l00548"></a>00548                 edge2 = seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae7725abe2fb5d3da8123edc8579124bf">edge</a>;
<a name="l00549"></a>00549             }
<a name="l00550"></a>00550             <span class="keywordflow">else</span>
<a name="l00551"></a>00551               edge2 = seg2-&gt;<a class="code" href="struct_a_f___segment_rec__.html#ae7725abe2fb5d3da8123edc8579124bf">edge</a>;
<a name="l00552"></a>00552 
<a name="l00553"></a>00553             <span class="keywordflow">if</span> ( is_serif )
<a name="l00554"></a>00554             {
<a name="l00555"></a>00555               edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a12d7731f9283877723fc7a2d9c40d937">serif</a>   = edge2;
<a name="l00556"></a>00556               edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa7d76964fd71ed767be31b4832694b77b">AF_EDGE_SERIF</a>;
<a name="l00557"></a>00557             }
<a name="l00558"></a>00558             <span class="keywordflow">else</span>
<a name="l00559"></a>00559               edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>  = edge2;
<a name="l00560"></a>00560           }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562           seg = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a68786aed948ad02e736927b29413b77f">edge_next</a>;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564         } <span class="keywordflow">while</span> ( seg != edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a> );
<a name="l00565"></a>00565 
<a name="l00566"></a>00566         <span class="comment">/* set the round/straight flags */</span>
<a name="l00567"></a>00567         edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> = <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaad8ecfbd7f6b8cfe29e36651331d01590">AF_EDGE_NORMAL</a>;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569         <span class="keywordflow">if</span> ( is_round &gt; 0 &amp;&amp; is_round &gt;= is_straight )
<a name="l00570"></a>00570           edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa8e934813176a94ea8ce1902c533e4f89">AF_EDGE_ROUND</a>;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572         <span class="comment">/* get rid of serifs if link is set                 */</span>
<a name="l00573"></a>00573         <span class="comment">/* XXX: This gets rid of many unpleasant artefacts! */</span>
<a name="l00574"></a>00574         <span class="comment">/*      Example: the `c&#39; in cour.pfa at size 13     */</span>
<a name="l00575"></a>00575 
<a name="l00576"></a>00576         <span class="keywordflow">if</span> ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a12d7731f9283877723fc7a2d9c40d937">serif</a> &amp;&amp; edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> )
<a name="l00577"></a>00577           edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a12d7731f9283877723fc7a2d9c40d937">serif</a> = 0;
<a name="l00578"></a>00578       }
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   Exit:
<a name="l00582"></a>00582     <span class="keywordflow">return</span> error;
<a name="l00583"></a>00583   }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 
<a name="l00586"></a>00586   <span class="keyword">static</span> <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>
<a name="l00587"></a>00587   af_cjk_hints_detect_features( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l00588"></a>00588                                 <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>   dim )
<a name="l00589"></a>00589   {
<a name="l00590"></a>00590     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>  error;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     error = af_cjk_hints_compute_segments( hints, dim );
<a name="l00594"></a>00594     <span class="keywordflow">if</span> ( !error )
<a name="l00595"></a>00595     {
<a name="l00596"></a>00596       af_cjk_hints_link_segments( hints, dim );
<a name="l00597"></a>00597 
<a name="l00598"></a>00598       error = af_cjk_hints_compute_edges( hints, dim );
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600     <span class="keywordflow">return</span> error;
<a name="l00601"></a>00601   }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 
<a name="l00604"></a>00604   <a class="code" href="ftconfig_8h.html#a065cda933183dff5dc368794eefa7c93">FT_LOCAL_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l00605"></a>00605   <a class="code" href="afcjk_8h.html#a648eade290f5b95e9699fb690594a94f">af_cjk_hints_init</a>( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>    hints,
<a name="l00606"></a>00606                      <a class="code" href="struct_a_f___latin_metrics_rec__.html">AF_LatinMetrics</a>  metrics )
<a name="l00607"></a>00607   {
<a name="l00608"></a>00608     <a class="code" href="freetype_8h.html#aaa0488bc4d2c5f0a6f4311ddee8edfb7">FT_Render_Mode</a>  mode;
<a name="l00609"></a>00609     FT_UInt32       scaler_flags, other_flags;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <a class="code" href="afhints_8c.html#a814db1e5ffe8784185c11c3c94fe0d4a">af_glyph_hints_rescale</a>( hints, (<a class="code" href="struct_a_f___script_metrics_rec__.html">AF_ScriptMetrics</a>)metrics );
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="comment">/*</span>
<a name="l00615"></a>00615 <span class="comment">     *  correct x_scale and y_scale when needed, since they may have</span>
<a name="l00616"></a>00616 <span class="comment">     *  been modified af_cjk_scale_dim above</span>
<a name="l00617"></a>00617 <span class="comment">     */</span>
<a name="l00618"></a>00618     hints-&gt;x_scale = metrics-&gt;axis[<a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a>].scale;
<a name="l00619"></a>00619     hints-&gt;x_delta = metrics-&gt;axis[<a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a>].delta;
<a name="l00620"></a>00620     hints-&gt;y_scale = metrics-&gt;axis[<a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a>].scale;
<a name="l00621"></a>00621     hints-&gt;y_delta = metrics-&gt;axis[<a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a>].delta;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="comment">/* compute flags depending on render mode, etc. */</span>
<a name="l00624"></a>00624     mode = metrics-&gt;root.scaler.render_mode;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 <span class="preprocessor">#ifdef AF_USE_WARPER</span>
<a name="l00627"></a>00627 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebbaecd5542530a6ea50bb5aad5294936b61">FT_RENDER_MODE_LCD</a> || mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebbadd611405f6c2933e848d299100101ade">FT_RENDER_MODE_LCD_V</a> )
<a name="l00628"></a>00628       metrics-&gt;root.scaler.render_mode = mode = <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba33d5620a2c09624a042f9f222b28e197">FT_RENDER_MODE_NORMAL</a>;
<a name="l00629"></a>00629 <span class="preprocessor">#endif</span>
<a name="l00630"></a>00630 <span class="preprocessor"></span>
<a name="l00631"></a>00631     scaler_flags = hints-&gt;scaler_flags;
<a name="l00632"></a>00632     other_flags  = 0;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     <span class="comment">/*</span>
<a name="l00635"></a>00635 <span class="comment">     *  We snap the width of vertical stems for the monochrome and</span>
<a name="l00636"></a>00636 <span class="comment">     *  horizontal LCD rendering targets only.</span>
<a name="l00637"></a>00637 <span class="comment">     */</span>
<a name="l00638"></a>00638     <span class="keywordflow">if</span> ( mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba2fad77b660130c90b38b873901f55b08">FT_RENDER_MODE_MONO</a> || mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebbaecd5542530a6ea50bb5aad5294936b61">FT_RENDER_MODE_LCD</a> )
<a name="l00639"></a>00639       other_flags |= <a class="code" href="aflatin_8h.html#adc29c2ff13d900c2f185ee95427fb06ca93157d94991eafac3ba70a2ca732b0b7">AF_LATIN_HINTS_HORZ_SNAP</a>;
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="comment">/*</span>
<a name="l00642"></a>00642 <span class="comment">     *  We snap the width of horizontal stems for the monochrome and</span>
<a name="l00643"></a>00643 <span class="comment">     *  vertical LCD rendering targets only.</span>
<a name="l00644"></a>00644 <span class="comment">     */</span>
<a name="l00645"></a>00645     <span class="keywordflow">if</span> ( mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba2fad77b660130c90b38b873901f55b08">FT_RENDER_MODE_MONO</a> || mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebbadd611405f6c2933e848d299100101ade">FT_RENDER_MODE_LCD_V</a> )
<a name="l00646"></a>00646       other_flags |= <a class="code" href="aflatin_8h.html#adc29c2ff13d900c2f185ee95427fb06caecf68937fe101a26405830e8f74e514d">AF_LATIN_HINTS_VERT_SNAP</a>;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648     <span class="comment">/*</span>
<a name="l00649"></a>00649 <span class="comment">     *  We adjust stems to full pixels only if we don&#39;t use the `light&#39; mode.</span>
<a name="l00650"></a>00650 <span class="comment">     */</span>
<a name="l00651"></a>00651     <span class="keywordflow">if</span> ( mode != <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba5b3b4a74eb40bff744348e7d6c69170f">FT_RENDER_MODE_LIGHT</a> )
<a name="l00652"></a>00652       other_flags |= <a class="code" href="aflatin_8h.html#adc29c2ff13d900c2f185ee95427fb06ca4d4135e3735695143befb7c060901a54">AF_LATIN_HINTS_STEM_ADJUST</a>;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     <span class="keywordflow">if</span> ( mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba2fad77b660130c90b38b873901f55b08">FT_RENDER_MODE_MONO</a> )
<a name="l00655"></a>00655       other_flags |= <a class="code" href="aflatin_8h.html#adc29c2ff13d900c2f185ee95427fb06cabd202a14ee632191b10ea00d6a7b4209">AF_LATIN_HINTS_MONO</a>;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     scaler_flags |= <a class="code" href="aftypes_8h.html#aa4306f445ecd56efdd11fa6ed3d7e300a623e9011938ff49cf701a244339093ae">AF_SCALER_FLAG_NO_ADVANCE</a>;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     hints-&gt;scaler_flags = scaler_flags;
<a name="l00660"></a>00660     hints-&gt;other_flags  = other_flags;
<a name="l00661"></a>00661 
<a name="l00662"></a>00662     <span class="keywordflow">return</span> 0;
<a name="l00663"></a>00663   }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 
<a name="l00666"></a>00666   <span class="comment">/*************************************************************************/</span>
<a name="l00667"></a>00667   <span class="comment">/*************************************************************************/</span>
<a name="l00668"></a>00668   <span class="comment">/*****                                                               *****/</span>
<a name="l00669"></a>00669   <span class="comment">/*****          C J K   G L Y P H   G R I D - F I T T I N G          *****/</span>
<a name="l00670"></a>00670   <span class="comment">/*****                                                               *****/</span>
<a name="l00671"></a>00671   <span class="comment">/*************************************************************************/</span>
<a name="l00672"></a>00672   <span class="comment">/*************************************************************************/</span>
<a name="l00673"></a>00673 
<a name="l00674"></a>00674   <span class="comment">/* snap a given width in scaled coordinates to one of the */</span>
<a name="l00675"></a>00675   <span class="comment">/* current standard widths                                */</span>
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <span class="keyword">static</span> <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>
<a name="l00678"></a>00678   af_cjk_snap_width( <a class="code" href="struct_a_f___width_rec__.html">AF_Width</a>  widths,
<a name="l00679"></a>00679                      <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>    count,
<a name="l00680"></a>00680                      <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>    width )
<a name="l00681"></a>00681   {
<a name="l00682"></a>00682     <span class="keywordtype">int</span>     <a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>;
<a name="l00683"></a>00683     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  best      = 64 + 32 + 2;
<a name="l00684"></a>00684     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  reference = width;
<a name="l00685"></a>00685     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  scaled;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 
<a name="l00688"></a>00688     <span class="keywordflow">for</span> ( n = 0; n &lt; count; n++ )
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  w;
<a name="l00691"></a>00691       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  dist;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 
<a name="l00694"></a>00694       w = widths[<a class="code" href="jsonmain_8cpp.html#a4eacae1d9e7c39f8236bb36d4ececa77">n</a>].<a class="code" href="struct_a_f___width_rec__.html#a07d632f5b3c38eace8193872d752e1d1">cur</a>;
<a name="l00695"></a>00695       dist = width - w;
<a name="l00696"></a>00696       <span class="keywordflow">if</span> ( dist &lt; 0 )
<a name="l00697"></a>00697         dist = -dist;
<a name="l00698"></a>00698       <span class="keywordflow">if</span> ( dist &lt; best )
<a name="l00699"></a>00699       {
<a name="l00700"></a>00700         best      = dist;
<a name="l00701"></a>00701         reference = w;
<a name="l00702"></a>00702       }
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705     scaled = <a class="code" href="ftobjs_8h.html#a9ebf47b0a94061637a0e38d243476033">FT_PIX_ROUND</a>( reference );
<a name="l00706"></a>00706 
<a name="l00707"></a>00707     <span class="keywordflow">if</span> ( width &gt;= reference )
<a name="l00708"></a>00708     {
<a name="l00709"></a>00709       <span class="keywordflow">if</span> ( width &lt; scaled + 48 )
<a name="l00710"></a>00710         width = reference;
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712     <span class="keywordflow">else</span>
<a name="l00713"></a>00713     {
<a name="l00714"></a>00714       <span class="keywordflow">if</span> ( width &gt; scaled - 48 )
<a name="l00715"></a>00715         width = reference;
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="keywordflow">return</span> width;
<a name="l00719"></a>00719   }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 
<a name="l00722"></a>00722   <span class="comment">/* compute the snapped width of a given stem */</span>
<a name="l00723"></a>00723 
<a name="l00724"></a>00724   <span class="keyword">static</span> <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>
<a name="l00725"></a>00725   af_cjk_compute_stem_width( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l00726"></a>00726                              <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>   dim,
<a name="l00727"></a>00727                              <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>         width,
<a name="l00728"></a>00728                              <a class="code" href="afhints_8h.html#a32a719d6ffa20f427eeb81da86300f60">AF_Edge_Flags</a>  base_flags,
<a name="l00729"></a>00729                              <a class="code" href="afhints_8h.html#a32a719d6ffa20f427eeb81da86300f60">AF_Edge_Flags</a>  stem_flags )
<a name="l00730"></a>00730   {
<a name="l00731"></a>00731     <a class="code" href="struct_a_f___latin_metrics_rec__.html">AF_LatinMetrics</a>  metrics  = (<a class="code" href="aflatin_8h.html#a95459a1e876a766cc558731c75debb9f">AF_LatinMetrics</a>) hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a96b6a66abf44b73ac399e15f4ba40c13">metrics</a>;
<a name="l00732"></a>00732     <a class="code" href="struct_a_f___latin_axis_rec__.html">AF_LatinAxis</a>     axis     = &amp; metrics-&gt;<a class="code" href="struct_a_f___latin_metrics_rec__.html#af1bc992e9c29a875d1f3ad1fe1b48ba3">axis</a>[dim];
<a name="l00733"></a>00733     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>           dist     = width;
<a name="l00734"></a>00734     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>           sign     = 0;
<a name="l00735"></a>00735     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>           vertical = ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a> );
<a name="l00736"></a>00736 
<a name="l00737"></a>00737     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( base_flags );
<a name="l00738"></a>00738     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( stem_flags );
<a name="l00739"></a>00739 
<a name="l00740"></a>00740 
<a name="l00741"></a>00741     <span class="keywordflow">if</span> ( !<a class="code" href="aflatin_8h.html#ab816330c2f7a043f26039b06d21b567f">AF_LATIN_HINTS_DO_STEM_ADJUST</a>( hints ) )
<a name="l00742"></a>00742       <span class="keywordflow">return</span> width;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     <span class="keywordflow">if</span> ( dist &lt; 0 )
<a name="l00745"></a>00745     {
<a name="l00746"></a>00746       dist = -width;
<a name="l00747"></a>00747       sign = 1;
<a name="l00748"></a>00748     }
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     <span class="keywordflow">if</span> ( (  vertical &amp;&amp; !<a class="code" href="aflatin_8h.html#a59bce244780a44f655898f856b9e46ec">AF_LATIN_HINTS_DO_VERT_SNAP</a>( hints ) ) ||
<a name="l00751"></a>00751          ( !vertical &amp;&amp; !<a class="code" href="aflatin_8h.html#ab27325e7809741769de2f67a2fc34751">AF_LATIN_HINTS_DO_HORZ_SNAP</a>( hints ) ) )
<a name="l00752"></a>00752     {
<a name="l00753"></a>00753       <span class="comment">/* smooth hinting process: very lightly quantize the stem width */</span>
<a name="l00754"></a>00754 
<a name="l00755"></a>00755       <span class="keywordflow">if</span> ( axis-&gt;width_count &gt; 0 )
<a name="l00756"></a>00756       {
<a name="l00757"></a>00757         <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a2e917e84ed753da51ddd54c784b5991d">FT_ABS</a>( dist - axis-&gt;widths[0].cur ) &lt; 40 )
<a name="l00758"></a>00758         {
<a name="l00759"></a>00759           dist = axis-&gt;widths[0].cur;
<a name="l00760"></a>00760           <span class="keywordflow">if</span> ( dist &lt; 48 )
<a name="l00761"></a>00761             dist = 48;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763           <span class="keywordflow">goto</span> Done_Width;
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765       }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767       <span class="keywordflow">if</span> ( dist &lt; 54 )
<a name="l00768"></a>00768         dist += ( 54 - dist ) / 2 ;
<a name="l00769"></a>00769       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( dist &lt; 3 * 64 )
<a name="l00770"></a>00770       {
<a name="l00771"></a>00771         <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  delta;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 
<a name="l00774"></a>00774         delta  = dist &amp; 63;
<a name="l00775"></a>00775         dist  &amp;= -64;
<a name="l00776"></a>00776 
<a name="l00777"></a>00777         <span class="keywordflow">if</span> ( delta &lt; 10 )
<a name="l00778"></a>00778           dist += delta;
<a name="l00779"></a>00779         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( delta &lt; 22 )
<a name="l00780"></a>00780           dist += 10;
<a name="l00781"></a>00781         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( delta &lt; 42 )
<a name="l00782"></a>00782           dist += delta;
<a name="l00783"></a>00783         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( delta &lt; 54 )
<a name="l00784"></a>00784           dist += 54;
<a name="l00785"></a>00785         <span class="keywordflow">else</span>
<a name="l00786"></a>00786           dist += delta;
<a name="l00787"></a>00787       }
<a name="l00788"></a>00788     }
<a name="l00789"></a>00789     <span class="keywordflow">else</span>
<a name="l00790"></a>00790     {
<a name="l00791"></a>00791       <span class="comment">/* strong hinting process: snap the stem width to integer pixels */</span>
<a name="l00792"></a>00792 
<a name="l00793"></a>00793       dist = af_cjk_snap_width( axis-&gt;widths, axis-&gt;width_count, dist );
<a name="l00794"></a>00794 
<a name="l00795"></a>00795       <span class="keywordflow">if</span> ( vertical )
<a name="l00796"></a>00796       {
<a name="l00797"></a>00797         <span class="comment">/* in the case of vertical hinting, always round */</span>
<a name="l00798"></a>00798         <span class="comment">/* the stem heights to integer pixels            */</span>
<a name="l00799"></a>00799 
<a name="l00800"></a>00800         <span class="keywordflow">if</span> ( dist &gt;= 64 )
<a name="l00801"></a>00801           dist = ( dist + 16 ) &amp; ~63;
<a name="l00802"></a>00802         <span class="keywordflow">else</span>
<a name="l00803"></a>00803           dist = 64;
<a name="l00804"></a>00804       }
<a name="l00805"></a>00805       <span class="keywordflow">else</span>
<a name="l00806"></a>00806       {
<a name="l00807"></a>00807         <span class="keywordflow">if</span> ( <a class="code" href="aflatin_8h.html#a373188aa2c0c38e6a53aa132d493b7e8">AF_LATIN_HINTS_DO_MONO</a>( hints ) )
<a name="l00808"></a>00808         {
<a name="l00809"></a>00809           <span class="comment">/* monochrome horizontal hinting: snap widths to integer pixels */</span>
<a name="l00810"></a>00810           <span class="comment">/* with a different threshold                                   */</span>
<a name="l00811"></a>00811 
<a name="l00812"></a>00812           <span class="keywordflow">if</span> ( dist &lt; 64 )
<a name="l00813"></a>00813             dist = 64;
<a name="l00814"></a>00814           <span class="keywordflow">else</span>
<a name="l00815"></a>00815             dist = ( dist + 32 ) &amp; ~63;
<a name="l00816"></a>00816         }
<a name="l00817"></a>00817         <span class="keywordflow">else</span>
<a name="l00818"></a>00818         {
<a name="l00819"></a>00819           <span class="comment">/* for horizontal anti-aliased hinting, we adopt a more subtle */</span>
<a name="l00820"></a>00820           <span class="comment">/* approach: we strengthen small stems, round stems whose size */</span>
<a name="l00821"></a>00821           <span class="comment">/* is between 1 and 2 pixels to an integer, otherwise nothing  */</span>
<a name="l00822"></a>00822 
<a name="l00823"></a>00823           <span class="keywordflow">if</span> ( dist &lt; 48 )
<a name="l00824"></a>00824             dist = ( dist + 64 ) &gt;&gt; 1;
<a name="l00825"></a>00825 
<a name="l00826"></a>00826           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( dist &lt; 128 )
<a name="l00827"></a>00827             dist = ( dist + 22 ) &amp; ~63;
<a name="l00828"></a>00828           <span class="keywordflow">else</span>
<a name="l00829"></a>00829             <span class="comment">/* round otherwise to prevent color fringes in LCD mode */</span>
<a name="l00830"></a>00830             dist = ( dist + 32 ) &amp; ~63;
<a name="l00831"></a>00831         }
<a name="l00832"></a>00832       }
<a name="l00833"></a>00833     }
<a name="l00834"></a>00834 
<a name="l00835"></a>00835   Done_Width:
<a name="l00836"></a>00836     <span class="keywordflow">if</span> ( sign )
<a name="l00837"></a>00837       dist = -dist;
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <span class="keywordflow">return</span> dist;
<a name="l00840"></a>00840   }
<a name="l00841"></a>00841 
<a name="l00842"></a>00842 
<a name="l00843"></a>00843   <span class="comment">/* align one stem edge relative to the previous stem edge */</span>
<a name="l00844"></a>00844 
<a name="l00845"></a>00845   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00846"></a>00846   af_cjk_align_linked_edge( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l00847"></a>00847                             <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>   dim,
<a name="l00848"></a>00848                             <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>        base_edge,
<a name="l00849"></a>00849                             <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>        stem_edge )
<a name="l00850"></a>00850   {
<a name="l00851"></a>00851     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  dist = stem_edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> - base_edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a>;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  fitted_width = af_cjk_compute_stem_width(
<a name="l00854"></a>00854                              hints, dim, dist,
<a name="l00855"></a>00855                              (<a class="code" href="afhints_8h.html#a32a719d6ffa20f427eeb81da86300f60">AF_Edge_Flags</a>)base_edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a>,
<a name="l00856"></a>00856                              (<a class="code" href="afhints_8h.html#a32a719d6ffa20f427eeb81da86300f60">AF_Edge_Flags</a>)stem_edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> );
<a name="l00857"></a>00857 
<a name="l00858"></a>00858 
<a name="l00859"></a>00859     stem_edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> = base_edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> + fitted_width;
<a name="l00860"></a>00860   }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 
<a name="l00863"></a>00863   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00864"></a>00864   af_cjk_align_serif_edge( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l00865"></a>00865                            <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>        base,
<a name="l00866"></a>00866                            <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>        serif )
<a name="l00867"></a>00867   {
<a name="l00868"></a>00868     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( hints );
<a name="l00869"></a>00869 
<a name="l00870"></a>00870     serif-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> = base-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> + ( serif-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> - base-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> );
<a name="l00871"></a>00871   }
<a name="l00872"></a>00872 
<a name="l00873"></a>00873 
<a name="l00874"></a>00874   <span class="comment">/*************************************************************************/</span>
<a name="l00875"></a>00875   <span class="comment">/*************************************************************************/</span>
<a name="l00876"></a>00876   <span class="comment">/*************************************************************************/</span>
<a name="l00877"></a>00877   <span class="comment">/****                                                                 ****/</span>
<a name="l00878"></a>00878   <span class="comment">/****                    E D G E   H I N T I N G                      ****/</span>
<a name="l00879"></a>00879   <span class="comment">/****                                                                 ****/</span>
<a name="l00880"></a>00880   <span class="comment">/*************************************************************************/</span>
<a name="l00881"></a>00881   <span class="comment">/*************************************************************************/</span>
<a name="l00882"></a>00882   <span class="comment">/*************************************************************************/</span>
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 
<a name="l00885"></a>00885 <span class="preprocessor">#define AF_LIGHT_MODE_MAX_HORZ_GAP    9</span>
<a name="l00886"></a>00886 <span class="preprocessor"></span><span class="preprocessor">#define AF_LIGHT_MODE_MAX_VERT_GAP   15</span>
<a name="l00887"></a>00887 <span class="preprocessor"></span><span class="preprocessor">#define AF_LIGHT_MODE_MAX_DELTA_ABS  14</span>
<a name="l00888"></a>00888 <span class="preprocessor"></span>
<a name="l00889"></a>00889 
<a name="l00890"></a>00890   <span class="keyword">static</span> <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>
<a name="l00891"></a>00891   af_hint_normal_stem( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l00892"></a>00892                        <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>        edge,
<a name="l00893"></a>00893                        <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>        edge2,
<a name="l00894"></a>00894                        <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>         anchor,
<a name="l00895"></a>00895                        <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>   dim )
<a name="l00896"></a>00896   {
<a name="l00897"></a>00897     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  org_len, cur_len, org_center;
<a name="l00898"></a>00898     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  cur_pos1, cur_pos2;
<a name="l00899"></a>00899     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  d_off1, u_off1, d_off2, u_off2, delta;
<a name="l00900"></a>00900     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  offset;
<a name="l00901"></a>00901     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  threshold = 64;
<a name="l00902"></a>00902 
<a name="l00903"></a>00903 
<a name="l00904"></a>00904     <span class="keywordflow">if</span> ( !<a class="code" href="aflatin_8h.html#ab816330c2f7a043f26039b06d21b567f">AF_LATIN_HINTS_DO_STEM_ADJUST</a>( hints ) )
<a name="l00905"></a>00905     {
<a name="l00906"></a>00906       <span class="keywordflow">if</span> ( ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a>  &amp; <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa8e934813176a94ea8ce1902c533e4f89">AF_EDGE_ROUND</a> ) &amp;&amp;
<a name="l00907"></a>00907            ( edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> &amp; <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa8e934813176a94ea8ce1902c533e4f89">AF_EDGE_ROUND</a> ) )
<a name="l00908"></a>00908       {
<a name="l00909"></a>00909         <span class="keywordflow">if</span> ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a> )
<a name="l00910"></a>00910           threshold = 64 - AF_LIGHT_MODE_MAX_HORZ_GAP;
<a name="l00911"></a>00911         <span class="keywordflow">else</span>
<a name="l00912"></a>00912           threshold = 64 - AF_LIGHT_MODE_MAX_VERT_GAP;
<a name="l00913"></a>00913       }
<a name="l00914"></a>00914       <span class="keywordflow">else</span>
<a name="l00915"></a>00915       {
<a name="l00916"></a>00916         <span class="keywordflow">if</span> ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a> )
<a name="l00917"></a>00917           threshold = 64 - AF_LIGHT_MODE_MAX_HORZ_GAP / 3;
<a name="l00918"></a>00918         <span class="keywordflow">else</span>
<a name="l00919"></a>00919           threshold = 64 - AF_LIGHT_MODE_MAX_VERT_GAP / 3;
<a name="l00920"></a>00920       }
<a name="l00921"></a>00921     }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     org_len    = edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> - edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a>;
<a name="l00924"></a>00924     cur_len    = af_cjk_compute_stem_width( hints, dim, org_len,
<a name="l00925"></a>00925                                             (<a class="code" href="afhints_8h.html#a32a719d6ffa20f427eeb81da86300f60">AF_Edge_Flags</a>)edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a>,
<a name="l00926"></a>00926                                             (<a class="code" href="afhints_8h.html#a32a719d6ffa20f427eeb81da86300f60">AF_Edge_Flags</a>)edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> );
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     org_center = ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> + edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> ) / 2 + anchor;
<a name="l00929"></a>00929     cur_pos1   = org_center - cur_len / 2;
<a name="l00930"></a>00930     cur_pos2   = cur_pos1 + cur_len;
<a name="l00931"></a>00931     d_off1     = cur_pos1 - <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( cur_pos1 );
<a name="l00932"></a>00932     d_off2     = cur_pos2 - <a class="code" href="ftobjs_8h.html#a3d6722c08cefc2dd0f12506564d6ae7f">FT_PIX_FLOOR</a>( cur_pos2 );
<a name="l00933"></a>00933     u_off1     = 64 - d_off1;
<a name="l00934"></a>00934     u_off2     = 64 - d_off2;
<a name="l00935"></a>00935     delta      = 0;
<a name="l00936"></a>00936 
<a name="l00937"></a>00937 
<a name="l00938"></a>00938     <span class="keywordflow">if</span> ( d_off1 == 0 || d_off2 == 0 )
<a name="l00939"></a>00939       <span class="keywordflow">goto</span> Exit;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <span class="keywordflow">if</span> ( cur_len &lt;= threshold )
<a name="l00942"></a>00942     {
<a name="l00943"></a>00943       <span class="keywordflow">if</span> ( d_off2 &lt; cur_len )
<a name="l00944"></a>00944       {
<a name="l00945"></a>00945         <span class="keywordflow">if</span> ( u_off1 &lt;= d_off2 )
<a name="l00946"></a>00946           delta =  u_off1;
<a name="l00947"></a>00947         <span class="keywordflow">else</span>
<a name="l00948"></a>00948           delta = -d_off2;
<a name="l00949"></a>00949       }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951       <span class="keywordflow">goto</span> Exit;
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="keywordflow">if</span> ( threshold &lt; 64 )
<a name="l00955"></a>00955     {
<a name="l00956"></a>00956       <span class="keywordflow">if</span> ( d_off1 &gt;= threshold || u_off1 &gt;= threshold ||
<a name="l00957"></a>00957            d_off2 &gt;= threshold || u_off2 &gt;= threshold )
<a name="l00958"></a>00958         <span class="keywordflow">goto</span> Exit;
<a name="l00959"></a>00959     }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     offset = cur_len % 64;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963     <span class="keywordflow">if</span> ( offset &lt; 32 )
<a name="l00964"></a>00964     {
<a name="l00965"></a>00965       <span class="keywordflow">if</span> ( u_off1 &lt;= offset || d_off2 &lt;= offset )
<a name="l00966"></a>00966         <span class="keywordflow">goto</span> Exit;
<a name="l00967"></a>00967     }
<a name="l00968"></a>00968     <span class="keywordflow">else</span>
<a name="l00969"></a>00969       offset = 64 - threshold;
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     d_off1 = threshold - u_off1;
<a name="l00972"></a>00972     u_off1 = u_off1    - offset;
<a name="l00973"></a>00973     u_off2 = threshold - d_off2;
<a name="l00974"></a>00974     d_off2 = d_off2    - offset;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976     <span class="keywordflow">if</span> ( d_off1 &lt;= u_off1 )
<a name="l00977"></a>00977       u_off1 = -d_off1;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="keywordflow">if</span> ( d_off2 &lt;= u_off2 )
<a name="l00980"></a>00980       u_off2 = -d_off2;
<a name="l00981"></a>00981 
<a name="l00982"></a>00982     <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a2e917e84ed753da51ddd54c784b5991d">FT_ABS</a>( u_off1 ) &lt;= <a class="code" href="ftobjs_8h.html#a2e917e84ed753da51ddd54c784b5991d">FT_ABS</a>( u_off2 ) )
<a name="l00983"></a>00983       delta = u_off1;
<a name="l00984"></a>00984     <span class="keywordflow">else</span>
<a name="l00985"></a>00985       delta = u_off2;
<a name="l00986"></a>00986 
<a name="l00987"></a>00987   Exit:
<a name="l00988"></a>00988 
<a name="l00989"></a>00989 <span class="preprocessor">#if 1</span>
<a name="l00990"></a>00990 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( !<a class="code" href="aflatin_8h.html#ab816330c2f7a043f26039b06d21b567f">AF_LATIN_HINTS_DO_STEM_ADJUST</a>( hints ) )
<a name="l00991"></a>00991     {
<a name="l00992"></a>00992       <span class="keywordflow">if</span> ( delta &gt; AF_LIGHT_MODE_MAX_DELTA_ABS )
<a name="l00993"></a>00993         delta = AF_LIGHT_MODE_MAX_DELTA_ABS;
<a name="l00994"></a>00994       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( delta &lt; -AF_LIGHT_MODE_MAX_DELTA_ABS )
<a name="l00995"></a>00995         delta = -AF_LIGHT_MODE_MAX_DELTA_ABS;
<a name="l00996"></a>00996     }
<a name="l00997"></a>00997 <span class="preprocessor">#endif</span>
<a name="l00998"></a>00998 <span class="preprocessor"></span>
<a name="l00999"></a>00999     cur_pos1 += delta;
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     <span class="keywordflow">if</span> ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> &lt; edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> )
<a name="l01002"></a>01002     {
<a name="l01003"></a>01003       edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>  = cur_pos1;
<a name="l01004"></a>01004       edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> = cur_pos1 + cur_len;
<a name="l01005"></a>01005     }
<a name="l01006"></a>01006     <span class="keywordflow">else</span>
<a name="l01007"></a>01007     {
<a name="l01008"></a>01008       edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>  = cur_pos1 + cur_len;
<a name="l01009"></a>01009       edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> = cur_pos1;
<a name="l01010"></a>01010     }
<a name="l01011"></a>01011 
<a name="l01012"></a>01012     <span class="keywordflow">return</span> delta;
<a name="l01013"></a>01013   }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015 
<a name="l01016"></a>01016   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01017"></a>01017   af_cjk_hint_edges( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l01018"></a>01018                      <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>   dim )
<a name="l01019"></a>01019   {
<a name="l01020"></a>01020     <a class="code" href="struct_a_f___axis_hints_rec__.html">AF_AxisHints</a>  axis       = &amp;hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a88d06a7880ba2423c73f937b7baedb46">axis</a>[dim];
<a name="l01021"></a>01021     <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>       edges      = axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a4c2d0f3a7406e87957d4a8cbdb9f5d44">edges</a>;
<a name="l01022"></a>01022     <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>       edge_limit = edges + axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a3313ee61ecfaac9625f5925c79b0a9bb">num_edges</a>;
<a name="l01023"></a>01023     <a class="code" href="fttypes_8h.html#a2469cb02129d36e468be22f7a8bf5b33">FT_PtrDist</a>    n_edges;
<a name="l01024"></a>01024     <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>       edge;
<a name="l01025"></a>01025     <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>       anchor   = 0;
<a name="l01026"></a>01026     <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>        delta    = 0;
<a name="l01027"></a>01027     <a class="code" href="fttypes_8h.html#af90e5fb0d07e21be9fe6faa33f02484c">FT_Int</a>        skipped  = 0;
<a name="l01028"></a>01028 
<a name="l01029"></a>01029 
<a name="l01030"></a>01030     <span class="comment">/* now we align all stem edges. */</span>
<a name="l01031"></a>01031     <span class="keywordflow">for</span> ( edge = edges; edge &lt; edge_limit; edge++ )
<a name="l01032"></a>01032     {
<a name="l01033"></a>01033       <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>  edge2;
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 
<a name="l01036"></a>01036       <span class="keywordflow">if</span> ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> &amp; <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a> )
<a name="l01037"></a>01037         <span class="keywordflow">continue</span>;
<a name="l01038"></a>01038 
<a name="l01039"></a>01039       <span class="comment">/* skip all non-stem edges */</span>
<a name="l01040"></a>01040       edge2 = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>;
<a name="l01041"></a>01041       <span class="keywordflow">if</span> ( !edge2 )
<a name="l01042"></a>01042       {
<a name="l01043"></a>01043         skipped++;
<a name="l01044"></a>01044         <span class="keywordflow">continue</span>;
<a name="l01045"></a>01045       }
<a name="l01046"></a>01046 
<a name="l01047"></a>01047       <span class="comment">/* now align the stem */</span>
<a name="l01048"></a>01048 
<a name="l01049"></a>01049       <span class="keywordflow">if</span> ( edge2 &lt; edge )
<a name="l01050"></a>01050       {
<a name="l01051"></a>01051         af_cjk_align_linked_edge( hints, dim, edge2, edge );
<a name="l01052"></a>01052         edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a>;
<a name="l01053"></a>01053         <span class="keywordflow">continue</span>;
<a name="l01054"></a>01054       }
<a name="l01055"></a>01055 
<a name="l01056"></a>01056       <span class="keywordflow">if</span> ( dim != <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a> &amp;&amp; !anchor )
<a name="l01057"></a>01057       {
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 <span class="preprocessor">#if 0</span>
<a name="l01060"></a>01060 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( fixedpitch )
<a name="l01061"></a>01061         {
<a name="l01062"></a>01062           <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>     left  = edge;
<a name="l01063"></a>01063           <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>     right = edge_limit - 1;
<a name="l01064"></a>01064           <a class="code" href="struct_a_f___edge_rec__.html">AF_EdgeRec</a>  left1, left2, right1, right2;
<a name="l01065"></a>01065           <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>      target, center1, center2;
<a name="l01066"></a>01066           <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>      delta1, delta2, d1, d2;
<a name="l01067"></a>01067 
<a name="l01068"></a>01068 
<a name="l01069"></a>01069           <span class="keywordflow">while</span> ( right &gt; left &amp;&amp; !right-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> )
<a name="l01070"></a>01070             right--;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072           left1  = *left;
<a name="l01073"></a>01073           left2  = *left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>;
<a name="l01074"></a>01074           right1 = *right-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>;
<a name="l01075"></a>01075           right2 = *right;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077           delta  = ( ( ( hinter-&gt;pp2.x + 32 ) &amp; -64 ) - hinter-&gt;pp2.x ) / 2;
<a name="l01078"></a>01078           target = left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> + ( right-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> - left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> ) / 2 + delta - 16;
<a name="l01079"></a>01079 
<a name="l01080"></a>01080           delta1  = delta;
<a name="l01081"></a>01081           delta1 += af_hint_normal_stem( hints, left, left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>,
<a name="l01082"></a>01082                                          delta1, 0 );
<a name="l01083"></a>01083 
<a name="l01084"></a>01084           <span class="keywordflow">if</span> ( left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> != right )
<a name="l01085"></a>01085             af_hint_normal_stem( hints, right-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>, right, delta1, 0 );
<a name="l01086"></a>01086 
<a name="l01087"></a>01087           center1 = left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> + ( right-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> - left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> ) / 2;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089           <span class="keywordflow">if</span> ( center1 &gt;= target )
<a name="l01090"></a>01090             delta2 = delta - 32;
<a name="l01091"></a>01091           <span class="keywordflow">else</span>
<a name="l01092"></a>01092             delta2 = delta + 32;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094           delta2 += af_hint_normal_stem( hints, &amp;left1, &amp;left2, delta2, 0 );
<a name="l01095"></a>01095 
<a name="l01096"></a>01096           <span class="keywordflow">if</span> ( delta1 != delta2 )
<a name="l01097"></a>01097           {
<a name="l01098"></a>01098             <span class="keywordflow">if</span> ( left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> != right )
<a name="l01099"></a>01099               af_hint_normal_stem( hints, &amp;right1, &amp;right2, delta2, 0 );
<a name="l01100"></a>01100 
<a name="l01101"></a>01101             center2 = left1.<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> + ( right2.<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> - left1.<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> ) / 2;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103             d1 = center1 - target;
<a name="l01104"></a>01104             d2 = center2 - target;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106             <span class="keywordflow">if</span> ( <a class="code" href="ftobjs_8h.html#a2e917e84ed753da51ddd54c784b5991d">FT_ABS</a>( d2 ) &lt; <a class="code" href="ftobjs_8h.html#a2e917e84ed753da51ddd54c784b5991d">FT_ABS</a>( d1 ) )
<a name="l01107"></a>01107             {
<a name="l01108"></a>01108               left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>       = left1.<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>;
<a name="l01109"></a>01109               left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> = left2.<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111               <span class="keywordflow">if</span> ( left-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> != right )
<a name="l01112"></a>01112               {
<a name="l01113"></a>01113                 right-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> = right1.<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>;
<a name="l01114"></a>01114                 right-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>       = right2.<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>;
<a name="l01115"></a>01115               }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117               delta1 = delta2;
<a name="l01118"></a>01118             }
<a name="l01119"></a>01119           }
<a name="l01120"></a>01120 
<a name="l01121"></a>01121           delta               = delta1;
<a name="l01122"></a>01122           right-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a>;
<a name="l01123"></a>01123           right-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a>       |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a>;
<a name="l01124"></a>01124         }
<a name="l01125"></a>01125         <span class="keywordflow">else</span>
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 <span class="preprocessor">#endif </span><span class="comment">/* 0 */</span>
<a name="l01128"></a>01128 
<a name="l01129"></a>01129           delta = af_hint_normal_stem( hints, edge, edge2, 0,
<a name="l01130"></a>01130                                        <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> );
<a name="l01131"></a>01131       }
<a name="l01132"></a>01132       <span class="keywordflow">else</span>
<a name="l01133"></a>01133         af_hint_normal_stem( hints, edge, edge2, delta, dim );
<a name="l01134"></a>01134 
<a name="l01135"></a>01135 <span class="preprocessor">#if 0</span>
<a name="l01136"></a>01136 <span class="preprocessor"></span>      printf( <span class="stringliteral">&quot;stem (%d,%d) adjusted (%.1f,%.1f)\n&quot;</span>,
<a name="l01137"></a>01137                edge - edges, edge2 - edges,
<a name="l01138"></a>01138                ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> - edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> ) / 64.0,
<a name="l01139"></a>01139                ( edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> - edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> ) / 64.0 );
<a name="l01140"></a>01140 <span class="preprocessor">#endif</span>
<a name="l01141"></a>01141 <span class="preprocessor"></span>
<a name="l01142"></a>01142       anchor = edge;
<a name="l01143"></a>01143       edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a>  |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a>;
<a name="l01144"></a>01144       edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a>;
<a name="l01145"></a>01145     }
<a name="l01146"></a>01146 
<a name="l01147"></a>01147     <span class="comment">/* make sure that lowercase m&#39;s maintain their symmetry */</span>
<a name="l01148"></a>01148 
<a name="l01149"></a>01149     <span class="comment">/* In general, lowercase m&#39;s have six vertical edges if they are sans */</span>
<a name="l01150"></a>01150     <span class="comment">/* serif, or twelve if they are with serifs.  This implementation is  */</span>
<a name="l01151"></a>01151     <span class="comment">/* based on that assumption, and seems to work very well with most    */</span>
<a name="l01152"></a>01152     <span class="comment">/* faces.  However, if for a certain face this assumption is not      */</span>
<a name="l01153"></a>01153     <span class="comment">/* true, the m is just rendered like before.  In addition, any stem   */</span>
<a name="l01154"></a>01154     <span class="comment">/* correction will only be applied to symmetrical glyphs (even if the */</span>
<a name="l01155"></a>01155     <span class="comment">/* glyph is not an m), so the potential for unwanted distortion is    */</span>
<a name="l01156"></a>01156     <span class="comment">/* relatively low.                                                    */</span>
<a name="l01157"></a>01157 
<a name="l01158"></a>01158     <span class="comment">/* We don&#39;t handle horizontal edges since we can&#39;t easily assure that */</span>
<a name="l01159"></a>01159     <span class="comment">/* the third (lowest) stem aligns with the base line; it might end up */</span>
<a name="l01160"></a>01160     <span class="comment">/* one pixel higher or lower.                                         */</span>
<a name="l01161"></a>01161 
<a name="l01162"></a>01162     n_edges = edge_limit - edges;
<a name="l01163"></a>01163     <span class="keywordflow">if</span> ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> &amp;&amp; ( n_edges == 6 || n_edges == 12 ) )
<a name="l01164"></a>01164     {
<a name="l01165"></a>01165       <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>  edge1, edge2, edge3;
<a name="l01166"></a>01166       <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>   dist1, dist2, span;
<a name="l01167"></a>01167 
<a name="l01168"></a>01168 
<a name="l01169"></a>01169       <span class="keywordflow">if</span> ( n_edges == 6 )
<a name="l01170"></a>01170       {
<a name="l01171"></a>01171         edge1 = edges;
<a name="l01172"></a>01172         edge2 = edges + 2;
<a name="l01173"></a>01173         edge3 = edges + 4;
<a name="l01174"></a>01174       }
<a name="l01175"></a>01175       <span class="keywordflow">else</span>
<a name="l01176"></a>01176       {
<a name="l01177"></a>01177         edge1 = edges + 1;
<a name="l01178"></a>01178         edge2 = edges + 5;
<a name="l01179"></a>01179         edge3 = edges + 9;
<a name="l01180"></a>01180       }
<a name="l01181"></a>01181 
<a name="l01182"></a>01182       dist1 = edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> - edge1-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a>;
<a name="l01183"></a>01183       dist2 = edge3-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a> - edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a>;
<a name="l01184"></a>01184 
<a name="l01185"></a>01185       span = dist1 - dist2;
<a name="l01186"></a>01186       <span class="keywordflow">if</span> ( span &lt; 0 )
<a name="l01187"></a>01187         span = -span;
<a name="l01188"></a>01188 
<a name="l01189"></a>01189       <span class="keywordflow">if</span> ( edge1-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> == edge1 + 1 &amp;&amp;
<a name="l01190"></a>01190            edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> == edge2 + 1 &amp;&amp;
<a name="l01191"></a>01191            edge3-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> == edge3 + 1 &amp;&amp; span &lt; 8 )
<a name="l01192"></a>01192       {
<a name="l01193"></a>01193         delta = edge3-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> - ( 2 * edge2-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> - edge1-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> );
<a name="l01194"></a>01194         edge3-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> -= delta;
<a name="l01195"></a>01195         <span class="keywordflow">if</span> ( edge3-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> )
<a name="l01196"></a>01196           edge3-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> -= delta;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198         <span class="comment">/* move the serifs along with the stem */</span>
<a name="l01199"></a>01199         <span class="keywordflow">if</span> ( n_edges == 12 )
<a name="l01200"></a>01200         {
<a name="l01201"></a>01201           ( edges + 8 )-&gt;pos -= delta;
<a name="l01202"></a>01202           ( edges + 11 )-&gt;pos -= delta;
<a name="l01203"></a>01203         }
<a name="l01204"></a>01204 
<a name="l01205"></a>01205         edge3-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a>;
<a name="l01206"></a>01206         <span class="keywordflow">if</span> ( edge3-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a> )
<a name="l01207"></a>01207           edge3-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a41f8d4233ca7d53b4233ebbe86dc9869">link</a>-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a>;
<a name="l01208"></a>01208       }
<a name="l01209"></a>01209     }
<a name="l01210"></a>01210 
<a name="l01211"></a>01211     <span class="keywordflow">if</span> ( !skipped )
<a name="l01212"></a>01212       <span class="keywordflow">return</span>;
<a name="l01213"></a>01213 
<a name="l01214"></a>01214     <span class="comment">/*</span>
<a name="l01215"></a>01215 <span class="comment">     *  now hint the remaining edges (serifs and single) in order</span>
<a name="l01216"></a>01216 <span class="comment">     *  to complete our processing</span>
<a name="l01217"></a>01217 <span class="comment">     */</span>
<a name="l01218"></a>01218     <span class="keywordflow">for</span> ( edge = edges; edge &lt; edge_limit; edge++ )
<a name="l01219"></a>01219     {
<a name="l01220"></a>01220       <span class="keywordflow">if</span> ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> &amp; <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a> )
<a name="l01221"></a>01221         <span class="keywordflow">continue</span>;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223       <span class="keywordflow">if</span> ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a12d7731f9283877723fc7a2d9c40d937">serif</a> )
<a name="l01224"></a>01224       {
<a name="l01225"></a>01225         af_cjk_align_serif_edge( hints, edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a12d7731f9283877723fc7a2d9c40d937">serif</a>, edge );
<a name="l01226"></a>01226         edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> |= <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a>;
<a name="l01227"></a>01227         skipped--;
<a name="l01228"></a>01228       }
<a name="l01229"></a>01229     }
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     <span class="keywordflow">if</span> ( !skipped )
<a name="l01232"></a>01232       <span class="keywordflow">return</span>;
<a name="l01233"></a>01233 
<a name="l01234"></a>01234     <span class="keywordflow">for</span> ( edge = edges; edge &lt; edge_limit; edge++ )
<a name="l01235"></a>01235     {
<a name="l01236"></a>01236       <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>  before, after;
<a name="l01237"></a>01237 
<a name="l01238"></a>01238 
<a name="l01239"></a>01239       <span class="keywordflow">if</span> ( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> &amp; <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a> )
<a name="l01240"></a>01240         <span class="keywordflow">continue</span>;
<a name="l01241"></a>01241 
<a name="l01242"></a>01242       before = after = edge;
<a name="l01243"></a>01243 
<a name="l01244"></a>01244       <span class="keywordflow">while</span> ( --before &gt;= edges )
<a name="l01245"></a>01245         <span class="keywordflow">if</span> ( before-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> &amp; <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a> )
<a name="l01246"></a>01246           <span class="keywordflow">break</span>;
<a name="l01247"></a>01247 
<a name="l01248"></a>01248       <span class="keywordflow">while</span> ( ++after &lt; edge_limit )
<a name="l01249"></a>01249         <span class="keywordflow">if</span> ( after-&gt;<a class="code" href="struct_a_f___edge_rec__.html#aad7515038f97e092e10ff4e84bab74ca">flags</a> &amp; <a class="code" href="afhints_8h.html#af5e8be4ddd5b6c768d848428d0fdeeaaa50ed589315999bfaa9aca538797fa0af">AF_EDGE_DONE</a> )
<a name="l01250"></a>01250           <span class="keywordflow">break</span>;
<a name="l01251"></a>01251 
<a name="l01252"></a>01252       <span class="keywordflow">if</span> ( before &gt;= edges || after &lt; edge_limit )
<a name="l01253"></a>01253       {
<a name="l01254"></a>01254         <span class="keywordflow">if</span> ( before &lt; edges )
<a name="l01255"></a>01255           af_cjk_align_serif_edge( hints, after, edge );
<a name="l01256"></a>01256         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( after &gt;= edge_limit )
<a name="l01257"></a>01257           af_cjk_align_serif_edge( hints, before, edge );
<a name="l01258"></a>01258         <span class="keywordflow">else</span>
<a name="l01259"></a>01259         {
<a name="l01260"></a>01260           <span class="keywordflow">if</span> ( after-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a> == before-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a> )
<a name="l01261"></a>01261             edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> = before-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>;
<a name="l01262"></a>01262           <span class="keywordflow">else</span>
<a name="l01263"></a>01263             edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> = before-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> +
<a name="l01264"></a>01264                         <a class="code" href="freetype_8h.html#ae31c0f444ce1bba445af776b86beaa60">FT_MulDiv</a>( edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a> - before-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a>,
<a name="l01265"></a>01265                                    after-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> - before-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>,
<a name="l01266"></a>01266                                    after-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a> - before-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a7890171d1e3f1fbd44b2ab7196594d46">fpos</a> );
<a name="l01267"></a>01267         }
<a name="l01268"></a>01268       }
<a name="l01269"></a>01269     }
<a name="l01270"></a>01270   }
<a name="l01271"></a>01271 
<a name="l01272"></a>01272 
<a name="l01273"></a>01273   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01274"></a>01274   af_cjk_align_edge_points( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>  hints,
<a name="l01275"></a>01275                             <a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>   dim )
<a name="l01276"></a>01276   {
<a name="l01277"></a>01277     <a class="code" href="struct_a_f___axis_hints_rec__.html">AF_AxisHints</a>  axis       = &amp; hints-&gt;<a class="code" href="struct_a_f___glyph_hints_rec__.html#a88d06a7880ba2423c73f937b7baedb46">axis</a>[dim];
<a name="l01278"></a>01278     <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>       edges      = axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a4c2d0f3a7406e87957d4a8cbdb9f5d44">edges</a>;
<a name="l01279"></a>01279     <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>       edge_limit = edges + axis-&gt;<a class="code" href="struct_a_f___axis_hints_rec__.html#a3313ee61ecfaac9625f5925c79b0a9bb">num_edges</a>;
<a name="l01280"></a>01280     <a class="code" href="struct_a_f___edge_rec__.html">AF_Edge</a>       edge;
<a name="l01281"></a>01281     <a class="code" href="fttypes_8h.html#a1a832a256bb5a7e6e884afaa1a07f3ae">FT_Bool</a>       snapping;
<a name="l01282"></a>01282 
<a name="l01283"></a>01283 
<a name="l01284"></a>01284     snapping = <a class="code" href="fttypes_8h.html#adf712510036d534403cbddf4f18c2083">FT_BOOL</a>( ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a>             &amp;&amp;
<a name="l01285"></a>01285                           <a class="code" href="aflatin_8h.html#ab27325e7809741769de2f67a2fc34751">AF_LATIN_HINTS_DO_HORZ_SNAP</a>( hints ) )  ||
<a name="l01286"></a>01286                         ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a>             &amp;&amp;
<a name="l01287"></a>01287                           <a class="code" href="aflatin_8h.html#a59bce244780a44f655898f856b9e46ec">AF_LATIN_HINTS_DO_VERT_SNAP</a>( hints ) )  );
<a name="l01288"></a>01288 
<a name="l01289"></a>01289     <span class="keywordflow">for</span> ( edge = edges; edge &lt; edge_limit; edge++ )
<a name="l01290"></a>01290     {
<a name="l01291"></a>01291       <span class="comment">/* move the points of each segment     */</span>
<a name="l01292"></a>01292       <span class="comment">/* in each edge to the edge&#39;s position */</span>
<a name="l01293"></a>01293       <a class="code" href="struct_a_f___segment_rec__.html">AF_Segment</a>  seg = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a>;
<a name="l01294"></a>01294 
<a name="l01295"></a>01295 
<a name="l01296"></a>01296       <span class="keywordflow">if</span> ( snapping )
<a name="l01297"></a>01297       {
<a name="l01298"></a>01298         <span class="keywordflow">do</span>
<a name="l01299"></a>01299         {
<a name="l01300"></a>01300           <a class="code" href="struct_a_f___point_rec__.html">AF_Point</a>  point = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a73795f6dab95b41ea461c3ffd926f90c">first</a>;
<a name="l01301"></a>01301 
<a name="l01302"></a>01302 
<a name="l01303"></a>01303           <span class="keywordflow">for</span> (;;)
<a name="l01304"></a>01304           {
<a name="l01305"></a>01305             <span class="keywordflow">if</span> ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> )
<a name="l01306"></a>01306             {
<a name="l01307"></a>01307               point-&gt;<a class="code" href="struct_a_f___point_rec__.html#a6e7d497eb848230b6f517a2a5ffdbad2">x</a>      = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>;
<a name="l01308"></a>01308               point-&gt;<a class="code" href="struct_a_f___point_rec__.html#ade9c4b603d4d6a0223b7b5efec75a321">flags</a> |= <a class="code" href="afhints_8h.html#a7e299cfd9a20868dd4a5ec833b18b38fac697b8073c08aef14f03bc9578f815d7">AF_FLAG_TOUCH_X</a>;
<a name="l01309"></a>01309             }
<a name="l01310"></a>01310             <span class="keywordflow">else</span>
<a name="l01311"></a>01311             {
<a name="l01312"></a>01312               point-&gt;<a class="code" href="struct_a_f___point_rec__.html#a4deaa8af957928bb5bc9d6aa9aeeb095">y</a>      = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a>;
<a name="l01313"></a>01313               point-&gt;<a class="code" href="struct_a_f___point_rec__.html#ade9c4b603d4d6a0223b7b5efec75a321">flags</a> |= <a class="code" href="afhints_8h.html#a7e299cfd9a20868dd4a5ec833b18b38fade502a8fcb063005f5ebac671b0f0a05">AF_FLAG_TOUCH_Y</a>;
<a name="l01314"></a>01314             }
<a name="l01315"></a>01315 
<a name="l01316"></a>01316             <span class="keywordflow">if</span> ( point == seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1e2d450a4f1684bee96c39209970f324">last</a> )
<a name="l01317"></a>01317               <span class="keywordflow">break</span>;
<a name="l01318"></a>01318 
<a name="l01319"></a>01319             point = point-&gt;<a class="code" href="struct_a_f___point_rec__.html#a645170dd7325b98848313447aeee08fa">next</a>;
<a name="l01320"></a>01320           }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322           seg = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a68786aed948ad02e736927b29413b77f">edge_next</a>;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324         } <span class="keywordflow">while</span> ( seg != edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a> );
<a name="l01325"></a>01325       }
<a name="l01326"></a>01326       <span class="keywordflow">else</span>
<a name="l01327"></a>01327       {
<a name="l01328"></a>01328         <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>  delta = edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a2b8e96f147dcff3bcf0bcdfff6924256">pos</a> - edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a8c44f0a3e4aa3254b0dd5777ad3a997b">opos</a>;
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 
<a name="l01331"></a>01331         <span class="keywordflow">do</span>
<a name="l01332"></a>01332         {
<a name="l01333"></a>01333           <a class="code" href="struct_a_f___point_rec__.html">AF_Point</a>  point = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a73795f6dab95b41ea461c3ffd926f90c">first</a>;
<a name="l01334"></a>01334 
<a name="l01335"></a>01335 
<a name="l01336"></a>01336           <span class="keywordflow">for</span> (;;)
<a name="l01337"></a>01337           {
<a name="l01338"></a>01338             <span class="keywordflow">if</span> ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> )
<a name="l01339"></a>01339             {
<a name="l01340"></a>01340               point-&gt;<a class="code" href="struct_a_f___point_rec__.html#a6e7d497eb848230b6f517a2a5ffdbad2">x</a>     += delta;
<a name="l01341"></a>01341               point-&gt;<a class="code" href="struct_a_f___point_rec__.html#ade9c4b603d4d6a0223b7b5efec75a321">flags</a> |= <a class="code" href="afhints_8h.html#a7e299cfd9a20868dd4a5ec833b18b38fac697b8073c08aef14f03bc9578f815d7">AF_FLAG_TOUCH_X</a>;
<a name="l01342"></a>01342             }
<a name="l01343"></a>01343             <span class="keywordflow">else</span>
<a name="l01344"></a>01344             {
<a name="l01345"></a>01345               point-&gt;<a class="code" href="struct_a_f___point_rec__.html#a4deaa8af957928bb5bc9d6aa9aeeb095">y</a>     += delta;
<a name="l01346"></a>01346               point-&gt;<a class="code" href="struct_a_f___point_rec__.html#ade9c4b603d4d6a0223b7b5efec75a321">flags</a> |= <a class="code" href="afhints_8h.html#a7e299cfd9a20868dd4a5ec833b18b38fade502a8fcb063005f5ebac671b0f0a05">AF_FLAG_TOUCH_Y</a>;
<a name="l01347"></a>01347             }
<a name="l01348"></a>01348 
<a name="l01349"></a>01349             <span class="keywordflow">if</span> ( point == seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a1e2d450a4f1684bee96c39209970f324">last</a> )
<a name="l01350"></a>01350               <span class="keywordflow">break</span>;
<a name="l01351"></a>01351 
<a name="l01352"></a>01352             point = point-&gt;<a class="code" href="struct_a_f___point_rec__.html#a645170dd7325b98848313447aeee08fa">next</a>;
<a name="l01353"></a>01353           }
<a name="l01354"></a>01354 
<a name="l01355"></a>01355           seg = seg-&gt;<a class="code" href="struct_a_f___segment_rec__.html#a68786aed948ad02e736927b29413b77f">edge_next</a>;
<a name="l01356"></a>01356 
<a name="l01357"></a>01357         } <span class="keywordflow">while</span> ( seg != edge-&gt;<a class="code" href="struct_a_f___edge_rec__.html#a57614243a3a4d8cebd088d7c9cbc80af">first</a> );
<a name="l01358"></a>01358       }
<a name="l01359"></a>01359     }
<a name="l01360"></a>01360   }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362 
<a name="l01363"></a>01363   <a class="code" href="ftconfig_8h.html#a065cda933183dff5dc368794eefa7c93">FT_LOCAL_DEF</a>( <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a> )
<a name="l01364"></a>01364   <a class="code" href="afcjk_8h.html#a1c8d1d5b4959ceba1532c178c17e2d3b">af_cjk_hints_apply</a>( <a class="code" href="struct_a_f___glyph_hints_rec__.html">AF_GlyphHints</a>    hints,
<a name="l01365"></a>01365                       <a class="code" href="struct_f_t___outline__.html">FT_Outline</a>*      outline,
<a name="l01366"></a>01366                       <a class="code" href="struct_a_f___latin_metrics_rec__.html">AF_LatinMetrics</a>  metrics )
<a name="l01367"></a>01367   {
<a name="l01368"></a>01368     <a class="code" href="fttypes_8h.html#a64c8060bdb3d6eec844a1bf670e06bdd">FT_Error</a>  error;
<a name="l01369"></a>01369     <span class="keywordtype">int</span>       dim;
<a name="l01370"></a>01370 
<a name="l01371"></a>01371     <a class="code" href="ftconfig_8h.html#a4db62b7638f149986cdc24d0c03e062f">FT_UNUSED</a>( metrics );
<a name="l01372"></a>01372 
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     error = <a class="code" href="afhints_8c.html#a8a6d51fb4ccbf90913b144ebe45969fe">af_glyph_hints_reload</a>( hints, outline );
<a name="l01375"></a>01375     <span class="keywordflow">if</span> ( error )
<a name="l01376"></a>01376       <span class="keywordflow">goto</span> Exit;
<a name="l01377"></a>01377 
<a name="l01378"></a>01378     <span class="comment">/* analyze glyph outline */</span>
<a name="l01379"></a>01379     <span class="keywordflow">if</span> ( <a class="code" href="afhints_8h.html#a55d606a7921dacba6f130fde7904f3fb">AF_HINTS_DO_HORIZONTAL</a>( hints ) )
<a name="l01380"></a>01380     {
<a name="l01381"></a>01381       error = af_cjk_hints_detect_features( hints, <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> );
<a name="l01382"></a>01382       <span class="keywordflow">if</span> ( error )
<a name="l01383"></a>01383         <span class="keywordflow">goto</span> Exit;
<a name="l01384"></a>01384     }
<a name="l01385"></a>01385 
<a name="l01386"></a>01386     <span class="keywordflow">if</span> ( <a class="code" href="afhints_8h.html#acd903b03a2447601ac31953c0d1391ca">AF_HINTS_DO_VERTICAL</a>( hints ) )
<a name="l01387"></a>01387     {
<a name="l01388"></a>01388       error = af_cjk_hints_detect_features( hints, <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a> );
<a name="l01389"></a>01389       <span class="keywordflow">if</span> ( error )
<a name="l01390"></a>01390         <span class="keywordflow">goto</span> Exit;
<a name="l01391"></a>01391     }
<a name="l01392"></a>01392 
<a name="l01393"></a>01393     <span class="comment">/* grid-fit the outline */</span>
<a name="l01394"></a>01394     <span class="keywordflow">for</span> ( dim = 0; dim &lt; <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9b0a2476820acd253fff9d77a41cfd58">AF_DIMENSION_MAX</a>; dim++ )
<a name="l01395"></a>01395     {
<a name="l01396"></a>01396       <span class="keywordflow">if</span> ( ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a> &amp;&amp; <a class="code" href="afhints_8h.html#a55d606a7921dacba6f130fde7904f3fb">AF_HINTS_DO_HORIZONTAL</a>( hints ) ) ||
<a name="l01397"></a>01397            ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da9c155f811daf156cf4d23afe561fd8de">AF_DIMENSION_VERT</a> &amp;&amp; <a class="code" href="afhints_8h.html#acd903b03a2447601ac31953c0d1391ca">AF_HINTS_DO_VERTICAL</a>( hints ) )   )
<a name="l01398"></a>01398       {
<a name="l01399"></a>01399 
<a name="l01400"></a>01400 <span class="preprocessor">#ifdef AF_USE_WARPER</span>
<a name="l01401"></a>01401 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( dim == <a class="code" href="afhints_8h.html#a5f8184f30ac4a73bab7c720c7a962e7da009437e0fce5aa1a6bb9c6398bc5ca33">AF_DIMENSION_HORZ</a>                                  &amp;&amp;
<a name="l01402"></a>01402              metrics-&gt;root.scaler.render_mode == <a class="code" href="freetype_8h.html#ac338334d31cff69250d1e916b9f77ebba33d5620a2c09624a042f9f222b28e197">FT_RENDER_MODE_NORMAL</a> )
<a name="l01403"></a>01403         {
<a name="l01404"></a>01404           <a class="code" href="struct_a_f___warper_rec__.html">AF_WarperRec</a>  warper;
<a name="l01405"></a>01405           <a class="code" href="fttypes_8h.html#a5f5a679cc09f758efdd0d1c5feed3c3d">FT_Fixed</a>      scale;
<a name="l01406"></a>01406           <a class="code" href="ftimage_8h.html#af5f230f4b253d4c7715fd2e595614c90">FT_Pos</a>        delta;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408 
<a name="l01409"></a>01409           <a class="code" href="afwarp_8h.html#aa28e7b2ac592fc7df95a50f484b2ab3a">af_warper_compute</a>( &amp;warper, hints, dim, &amp;scale, &amp;delta );
<a name="l01410"></a>01410           af_glyph_hints_scale_dim( hints, dim, scale, delta );
<a name="l01411"></a>01411           <span class="keywordflow">continue</span>;
<a name="l01412"></a>01412         }
<a name="l01413"></a>01413 <span class="preprocessor">#endif </span><span class="comment">/* AF_USE_WARPER */</span>
<a name="l01414"></a>01414 
<a name="l01415"></a>01415         af_cjk_hint_edges( hints, (<a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>)dim );
<a name="l01416"></a>01416         af_cjk_align_edge_points( hints, (<a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>)dim );
<a name="l01417"></a>01417         <a class="code" href="afhints_8c.html#ab9f947dd580194ccead8641a5fcbbdc1">af_glyph_hints_align_strong_points</a>( hints, (<a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>)dim );
<a name="l01418"></a>01418         <a class="code" href="afhints_8c.html#abff73ba9f7ba216798390a82133d1557">af_glyph_hints_align_weak_points</a>( hints, (<a class="code" href="afhints_8h.html#a8b4e7c99095ceea05159cb3000a77549">AF_Dimension</a>)dim );
<a name="l01419"></a>01419       }
<a name="l01420"></a>01420     }
<a name="l01421"></a>01421 
<a name="l01422"></a>01422 <span class="preprocessor">#if 0</span>
<a name="l01423"></a>01423 <span class="preprocessor"></span>    <a class="code" href="afhints_8c.html#a3a8604647eb9def6ce0f6d5b852f9720">af_glyph_hints_dump_points</a>( hints );
<a name="l01424"></a>01424     <a class="code" href="afhints_8c.html#a508f20382501e010f0331485af1f29a3">af_glyph_hints_dump_segments</a>( hints );
<a name="l01425"></a>01425     <a class="code" href="afhints_8c.html#adde24c9105eae7e71fd4edeb62a7faac">af_glyph_hints_dump_edges</a>( hints );
<a name="l01426"></a>01426 <span class="preprocessor">#endif</span>
<a name="l01427"></a>01427 <span class="preprocessor"></span>
<a name="l01428"></a>01428     <a class="code" href="afhints_8c.html#a7d36c83f2d45da57f2714b33d3359581">af_glyph_hints_save</a>( hints, outline );
<a name="l01429"></a>01429 
<a name="l01430"></a>01430   Exit:
<a name="l01431"></a>01431     <span class="keywordflow">return</span> error;
<a name="l01432"></a>01432   }
<a name="l01433"></a>01433 
<a name="l01434"></a>01434 
<a name="l01435"></a>01435   <span class="comment">/*************************************************************************/</span>
<a name="l01436"></a>01436   <span class="comment">/*************************************************************************/</span>
<a name="l01437"></a>01437   <span class="comment">/*****                                                               *****/</span>
<a name="l01438"></a>01438   <span class="comment">/*****                C J K   S C R I P T   C L A S S                *****/</span>
<a name="l01439"></a>01439   <span class="comment">/*****                                                               *****/</span>
<a name="l01440"></a>01440   <span class="comment">/*************************************************************************/</span>
<a name="l01441"></a>01441   <span class="comment">/*************************************************************************/</span>
<a name="l01442"></a>01442 
<a name="l01443"></a>01443 
<a name="l01444"></a>01444   <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_a_f___script___uni_range_rec__.html">AF_Script_UniRangeRec</a>  af_cjk_uniranges[] =
<a name="l01445"></a>01445   {
<a name="l01446"></a>01446 <span class="preprocessor">#if 0</span>
<a name="l01447"></a>01447 <span class="preprocessor"></span>    <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x0100UL,  0xFFFFUL ),  <span class="comment">/* why this? */</span>
<a name="l01448"></a>01448 <span class="preprocessor">#endif</span>
<a name="l01449"></a>01449 <span class="preprocessor"></span>    <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x2E80UL,  0x2EFFUL ),  <span class="comment">/* CJK Radicals Supplement                 */</span>
<a name="l01450"></a>01450     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x2F00UL,  0x2FDFUL ),  <span class="comment">/* Kangxi Radicals                         */</span>
<a name="l01451"></a>01451     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x3000UL,  0x303FUL ),  <span class="comment">/* CJK Symbols and Punctuation             */</span>
<a name="l01452"></a>01452     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x3040UL,  0x309FUL ),  <span class="comment">/* Hiragana                                */</span>
<a name="l01453"></a>01453     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x30A0UL,  0x30FFUL ),  <span class="comment">/* Katakana                                */</span>
<a name="l01454"></a>01454     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x3100UL,  0x312FUL ),  <span class="comment">/* Bopomofo                                */</span>
<a name="l01455"></a>01455     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x3130UL,  0x318FUL ),  <span class="comment">/* Hangul Compatibility Jamo               */</span>
<a name="l01456"></a>01456     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x31A0UL,  0x31BFUL ),  <span class="comment">/* Bopomofo Extended                       */</span>
<a name="l01457"></a>01457     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x31C0UL,  0x31EFUL ),  <span class="comment">/* CJK Strokes                             */</span>
<a name="l01458"></a>01458     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x31F0UL,  0x31FFUL ),  <span class="comment">/* Katakana Phonetic Extensions            */</span>
<a name="l01459"></a>01459     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x3200UL,  0x32FFUL ),  <span class="comment">/* Enclosed CJK Letters and Months         */</span>
<a name="l01460"></a>01460     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x3300UL,  0x33FFUL ),  <span class="comment">/* CJK Compatibility                       */</span>
<a name="l01461"></a>01461     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x3400UL,  0x4DBFUL ),  <span class="comment">/* CJK Unified Ideographs Extension A      */</span>
<a name="l01462"></a>01462     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x4DC0UL,  0x4DFFUL ),  <span class="comment">/* Yijing Hexagram Symbols                 */</span>
<a name="l01463"></a>01463     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0x4E00UL,  0x9FFFUL ),  <span class="comment">/* CJK Unified Ideographs                  */</span>
<a name="l01464"></a>01464     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0xF900UL,  0xFAFFUL ),  <span class="comment">/* CJK Compatibility Ideographs            */</span>
<a name="l01465"></a>01465     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0xFE30UL,  0xFE4FUL ),  <span class="comment">/* CJK Compatibility Forms                 */</span>
<a name="l01466"></a>01466     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(  0xFF00UL,  0xFFEFUL ),  <span class="comment">/* Halfwidth and Fullwidth Forms           */</span>
<a name="l01467"></a>01467     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>( 0x20000UL, 0x2A6DFUL ),  <span class="comment">/* CJK Unified Ideographs Extension B      */</span>
<a name="l01468"></a>01468     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>( 0x2F800UL, 0x2FA1FUL ),  <span class="comment">/* CJK Compatibility Ideographs Supplement */</span>
<a name="l01469"></a>01469     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>(       0UL,       0UL )
<a name="l01470"></a>01470   };
<a name="l01471"></a>01471 
<a name="l01472"></a>01472 
<a name="l01473"></a>01473   <a class="code" href="aftypes_8h.html#a11688babd82c754e2e6bc849ba3faa18">AF_DEFINE_SCRIPT_CLASS</a>(af_cjk_script_class,
<a name="l01474"></a>01474     <a class="code" href="aftypes_8h.html#a5d34f6ae37ebfda327a1088a03198214a221320e78f281c7396ed82f622cb3306">AF_SCRIPT_CJK</a>,
<a name="l01475"></a>01475     af_cjk_uniranges,
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     <span class="keyword">sizeof</span>( <a class="code" href="struct_a_f___latin_metrics_rec__.html">AF_LatinMetricsRec</a> ),
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     (<a class="code" href="aftypes_8h.html#a00b00ebbbe61db12c6258e3072156acf">AF_Script_InitMetricsFunc</a>) <a class="code" href="afcjk_8h.html#afc55671a558d499d0630872ef463e925">af_cjk_metrics_init</a>,
<a name="l01480"></a>01480     (<a class="code" href="aftypes_8h.html#a29fd36db518adf7f23fe656563db16d8">AF_Script_ScaleMetricsFunc</a>)<a class="code" href="afcjk_8h.html#abe0b153d1ec6f83c5d85bca479d12d31">af_cjk_metrics_scale</a>,
<a name="l01481"></a>01481     (<a class="code" href="aftypes_8h.html#a090f5bb463927d22823cbcf407656f2d">AF_Script_DoneMetricsFunc</a>) <a class="code" href="ftobjs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l01482"></a>01482 
<a name="l01483"></a>01483     (<a class="code" href="aftypes_8h.html#acb6628967f1df86ecb6f97a7913c80e4">AF_Script_InitHintsFunc</a>)   <a class="code" href="afcjk_8h.html#a648eade290f5b95e9699fb690594a94f">af_cjk_hints_init</a>,
<a name="l01484"></a>01484     (<a class="code" href="aftypes_8h.html#a9f24b7d2c42594c4f947905ec670f033">AF_Script_ApplyHintsFunc</a>)  <a class="code" href="afcjk_8h.html#a1c8d1d5b4959ceba1532c178c17e2d3b">af_cjk_hints_apply</a>
<a name="l01485"></a>01485   )
<a name="l01486"></a>01486 
<a name="l01487"></a>01487 <span class="preprocessor">#else </span><span class="comment">/* !AF_CONFIG_OPTION_CJK */</span>
<a name="l01488"></a>01488 
<a name="l01489"></a>01489   <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_a_f___script___uni_range_rec__.html">AF_Script_UniRangeRec</a>  af_cjk_uniranges[] =
<a name="l01490"></a>01490   {
<a name="l01491"></a>01491     <a class="code" href="aftypes_8h.html#a5c857e1e3c4bd350f09f988c2f612d46">AF_UNIRANGE_REC</a>( 0UL, 0UL )
<a name="l01492"></a>01492   };
<a name="l01493"></a>01493 
<a name="l01494"></a>01494 
<a name="l01495"></a>01495   <a class="code" href="aftypes_8h.html#a11688babd82c754e2e6bc849ba3faa18">AF_DEFINE_SCRIPT_CLASS</a>(af_cjk_script_class,
<a name="l01496"></a>01496     <a class="code" href="aftypes_8h.html#a5d34f6ae37ebfda327a1088a03198214a221320e78f281c7396ed82f622cb3306">AF_SCRIPT_CJK</a>,
<a name="l01497"></a>01497     af_cjk_uniranges,
<a name="l01498"></a>01498 
<a name="l01499"></a>01499     <span class="keyword">sizeof</span>( <a class="code" href="struct_a_f___latin_metrics_rec__.html">AF_LatinMetricsRec</a> ),
<a name="l01500"></a>01500 
<a name="l01501"></a>01501     (<a class="code" href="aftypes_8h.html#a00b00ebbbe61db12c6258e3072156acf">AF_Script_InitMetricsFunc</a>) NULL,
<a name="l01502"></a>01502     (<a class="code" href="aftypes_8h.html#a29fd36db518adf7f23fe656563db16d8">AF_Script_ScaleMetricsFunc</a>)NULL,
<a name="l01503"></a>01503     (<a class="code" href="aftypes_8h.html#a090f5bb463927d22823cbcf407656f2d">AF_Script_DoneMetricsFunc</a>) NULL,
<a name="l01504"></a>01504 
<a name="l01505"></a>01505     (<a class="code" href="aftypes_8h.html#acb6628967f1df86ecb6f97a7913c80e4">AF_Script_InitHintsFunc</a>)   NULL,
<a name="l01506"></a>01506     (<a class="code" href="aftypes_8h.html#a9f24b7d2c42594c4f947905ec670f033">AF_Script_ApplyHintsFunc</a>)  NULL
<a name="l01507"></a>01507   )
<a name="l01508"></a>01508 
<a name="l01509"></a>01509 <span class="preprocessor">#endif </span><span class="comment">/* !AF_CONFIG_OPTION_CJK */</span>
<a name="l01510"></a>01510 
<a name="l01511"></a>01511 
<a name="l01512"></a>01512 <span class="comment">/* END */</span>
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="afcjk_8c.html">afcjk.c</a>      </li>

    <li class="footer">Generated on Tue Mar 13 2012 11:44:02 for ARK2D by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
